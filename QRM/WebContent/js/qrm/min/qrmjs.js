var descend=false;var projectID;var userID;var userName;var project;var tempIndex=-100;var projects;var primCats=new Array();var secCats=new Array();var viewState="Regular";var projObjectives;var projCats;
var projType;var qrmCtrlColor="#FFFFFF";var qrmProjectMap=new Map();var dateEnd=new Date();var ajaxRequest;var qoStakeHolders={RiskOwners:new Array(),RiskManagers:new Array(),RiskOwnersIDs:new Array(),RiskManagersIDs:new Array()};
var qoRiskController=new Object();var qoRiskEditor=new RiskEditor();var qoProjectManager=new ProjectManager();var qoReportEngine=new ReportEngine();var qoValueMap={manager:null,categories:null,owner:null,project:null,projectReport:null,distributionTypeMap:new Map(),quantTypes:new Object(),distributionType:{"au.com.quaysystems.qrm.util.probability.NormalDistribution":"Normal","au.com.quaysystems.qrm.util.probability.TruncNormalDistribution":"Truncated Normal","au.com.quaysystems.qrm.util.probability.TriangularDistribution":"Triangular","au.com.quaysystems.qrm.util.probability.TriGenDistribution":"Truncated Triangular","au.com.quaysystems.qrm.util.probability.SimpleDistribution":"Simple","au.com.quaysystems.qrm.util.probability.UniformDistribution":"Uniform","au.com.quaysystems.qrm.util.probability.DiscreteDistribution":"Discrete","au.com.quaysystems.qrm.util.probability.NullDistribution":"No Distribution Defined"},init:function(){this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.NormalDistribution","Normal");
this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.TruncNormalDistribution","Truncated Normal");this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.TriangularDistribution","Triangular");
this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.TriGenDistribution","Truncated Triangular");this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.SimpleDistribution","Simple");
this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.UniformDistribution","Uniform");this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.DiscreteDistribution","Discrete");
this.distributionTypeMap.put("au.com.quaysystems.qrm.util.probability.NullDistribution","No Distribution Defined");}};var qoCurrent={currentTabNum:0,currentPaneNum:0};var qoAll={Matrices:new Array(),Categories:new Array(),Users:new Array(),Objectives:new Array(),clear:function(){this.Matrices.clear();
this.Categories.clear();this.Users.clear();this.Objectives.clear();}};var qoQRM={currentEditorMask:0,pageRiskData:1,pageProbImpact:2,pageMitigation:4,pageResponse:8,pageConsequence:16,pageControl:32,pageObjective:64,pageAttachment:128,pageComment:256,pageAudit:512,defaultViewChoice:0,qrmNewRisk:-1,qrmNewSummaryRisk:-2,qrmNewPropogatedRisk:-3,selectedCellID:null,selectedCellClassName:null,singlePhase:false,uMat:null,uMatRef:null,tMat:null,tMatRef:null,relMatrixRisks:null,loggedOnUser:null,projectTitleStr:null,navigatorInit:false,descendantsCurrent:false,mgrAdded:false,explorerSetProject:true,riskProjectEditMode:"risk",updateProgress:function(a){if(a.lengthComputable){var b=100*a.loaded/a.total;
$(fileUploadProgress).html("Uploading "+this.roundDoubleStr(b,-1)+" Complete");}},submitAttachment:function(bFileImport){try{if("undefined"===typeof window.FormData){alert("Your Browser does not support QRM's attachment mechanism");
return;}var submiturl;if(bFileImport){submiturl="./importRisk?uploadRisks=true";}else{submiturl="./QRMAttachment?saveAttachment=true";}var formData=new FormData($("form#data")[0]);$.ajax({url:submiturl,type:"POST",data:formData,processData:false,contentType:false,error:function(jqXHR,textStatus,errorThrown){alert(errorThrown);
try{qoQRM.formSubmitReturnError();}catch(e){alert(e.message);}},success:function(data,status){if(bFileImport){qoQRM.formSubmitReturn(data);return;}try{eval(data);}catch(e){alert(data);}try{qoQRM.formSubmitReturn();
}catch(e){alert(e.message);}},xhr:function(){var myXhr=$.ajaxSettings.xhr();if(myXhr.upload){myXhr.upload.addEventListener("progress",qoQRM.updateProgress,false);}return myXhr;},});}catch(e){alert(e.message);
}},roundDoubleStr:function(c,a){if(c==0){return"0.00%";}if(c==100){return"100%";}var d=c.toString();var f="";var b=0;while(f.length<d.indexOf(".")+a+1){f+=d.charAt(b++);}return f+"%";},defineQRMButtons:function(){isc.defineClass("QRMSaveButton","IButton");
isc.defineClass("QRMEditButton","IButton");isc.defineClass("QRMDeleteButton","IButton");isc.defineClass("QRMAddButton","IButton");isc.defineClass("QRMRefreshButton","IButton");isc.defineClass("QRMExportButton","IButton");
isc.defineClass("QRMCancelButton","IButton");isc.defineClass("QRMFinishButton","IButton");isc.QRMSaveButton.addProperties({title:"Save",icon:"[SKIN]/actions/save.png",width:100,showDisabledIcon:false});
isc.QRMExportButton.addProperties({title:"Export",icon:"[SKIN]/actions/download.png",width:100,showDisabledIcon:false});isc.QRMEditButton.addProperties({title:"Edit",icon:"[SKIN]/actions/edit.png",width:100,showDisabledIcon:true});
isc.QRMDeleteButton.addProperties({title:"Delete",icon:"[SKIN]/actions/remove.png",width:100,showDisabledIcon:true});isc.QRMCancelButton.addProperties({title:"Cancel",icon:"[SKIN]/actions/close.png",width:100,showDisabledIcon:true});
isc.QRMAddButton.addProperties({title:"Save",icon:"[SKIN]/actions/add.png",width:100,showDisabledIcon:false});isc.QRMFinishButton.addProperties({title:"OK",icon:"[SKIN]/actions/ok.png",width:100,showDisabledIcon:false});
isc.QRMRefreshButton.addProperties({title:"Refresh",icon:"[SKIN]/actions/refresh.png",width:100,showDisabledIcon:false});},defineDataSources:function(){isc.RestDataSource.create({ID:"contextReportsDS",dataFormat:"xml",fields:[{name:"id",title:"id"},{name:"reportName",title:"Report Name",align:"left"}],recordXPath:"//response/data/record",transformRequest:function(a){var b={NOCACHE:Math.random()};
return isc.addProperties({},a.data,b);},fetchDataURL:"./getContextReports"});isc.RestDataSource.create({ID:"registerReportsDS",dataFormat:"xml",fields:[{name:"id",title:"id"},{name:"reportName",title:"Report Name",align:"left"}],recordXPath:"//response/data/record",transformRequest:function(a){var b={NOCACHE:Math.random()};
return isc.addProperties({},a.data,b);},fetchDataURL:"./getRegisterReports"});isc.RestDataSource.create({ID:"riskReportsDS",dataFormat:"xml",fields:[{name:"id",title:"id"},{name:"reportName",title:"Report Name",align:"left"}],recordXPath:"//response/data/record",transformRequest:function(a){var b={NOCACHE:Math.random()};
return isc.addProperties({},a.data,b);},fetchDataURL:"./getRiskReports"});isc.RestDataSource.create({ID:"analToolDS",fields:[{name:"title",title:"Analysis Tool",type:"string"},{name:"clazz",type:"string"},{name:"param1",type:"string"},{name:"b3D",type:"boolean"},{name:"bTol",type:"boolean"},{name:"bNumElem",type:"boolean"},{name:"bReverse",type:"boolean"}],fetchDataURL:"./getAnalToolsFetch"});
isc.RestDataSource.create({ID:"userTemplateDS",titleField:"templateName",fields:[{name:"templateName",type:"string"},{name:"template",type:"string"}],fetchDataURL:"./getUserImportTemplate"});isc.DataSource.create({ID:"riskSelectGridDS",fields:[{name:"riskProjectCode",title:"Risk Code",primaryKey:true},{name:"title",title:"Risk Title"}],dataFormat:"json",clientOnly:true,testData:"[{}]",transformResponse:function(b,a,c){b.data=qoQRM.relMatrixRisks;
b.totalRows=qoQRM.relMatrixRisks.length;b.startRow=0;b.endRow=qoQRM.relMatrixRisks.length-1;}});isc.RestDataSource.create({ID:"reviewSelectGridDS",fields:[{name:"title",title:"Review Title",type:"text"},{name:"scheduledDate",title:"Scheduled Date",type:"date",width:150},{name:"actualDate",title:"Actual Date",type:"date"},{name:"reviewID",hidden:true,primaryKey:true},{name:"reviewComplete",title:"Complete",type:"boolean"}],fetchDataURL:"./getExistingReviews"});
isc.RestDataSource.create({ID:"incidentSelectGridDS",fields:[{name:"title",title:"Incident Title"},{name:"incidentDate",title:"Incident Date"},{name:"incidentID",hidden:true,primaryKey:true}],fetchDataURL:"./getExistingIncidents"});
isc.RestDataSource.create({ID:"riskLiteDS",dataFormat:"xml",fields:[{name:"riskProjectCode",title:"Risk Code"},{name:"title",title:"Title",align:"left"},{name:"description",title:"Risk Description"},{name:"startExposure",title:"Start of Exposure",type:"date",align:"center"},{name:"endExposure",title:"End of Exposure",type:"date",align:"center"},{name:"ownerName",title:"Owner",align:"center"},{name:"parentRiskProjectCode",title:"Parent Risk",align:"center"},{name:"manager1Name",title:"Manager",align:"center"},{name:"cause",title:"Cause"},{name:"treatedImpact",title:"Treated Impact",type:"double",align:"center"},{name:"treatedProb",title:"Treated Prob",type:"double",align:"center"},{name:"inherentImpact",title:"Inherent Impact",type:"double",align:"center"},{name:"inherentProb",title:"Inherent Prob",type:"double",align:"center"},{name:"treatedTolerance",title:"Treated Tolerance",type:"integer",align:"center"},{name:"currentTolerance",title:"Current Tolerance",type:"integer",align:"center"},{name:"riskID",title:"Risk ID",type:"integer",align:"center",primaryKey:true},{name:"dateIDRev",title:"Reviewed",type:"date",align:"center"},{name:"dateEvalRev",title:"Reviewed",type:"date",align:"center"},{name:"dateMitRev",title:"Reviewed",type:"date",align:"center"},{name:"dateIDApp",title:"Approved",type:"date",align:"center"},{name:"dateEvalApp",title:"Approved",type:"date",align:"center"},{name:"dateMitApp",title:"Approved",type:"date",align:"center"},{name:"promotionCode",title:"Promoted",align:"center"},{name:"active",title:"Active",type:"boolean"},{name:"summaryRisk",title:"Summary Risk",type:"boolean"},{name:"treated",title:"Treated",type:"boolean"}],fetchDataURL:"./getRiskLiteFetch"});
isc.RestDataSource.create({ID:"riskLiteParentDS",dataFormat:"xml",fields:[{name:"riskProjectCode",title:"Risk Code"},{name:"title",title:"Title",align:"left"},{name:"description",title:"Risk Description"},{name:"startExposure",title:"Start of Exposure",type:"date",align:"center"},{name:"endExposure",title:"End of Exposure",type:"date",align:"center"},{name:"ownerName",title:"Owner",align:"center"},{name:"parentRiskProjectCode",title:"Parent Risk",align:"center"},{name:"manager1Name",title:"Manager",align:"center"},{name:"cause",title:"Cause"},{name:"treatedImpact",title:"Treated Impact",type:"double",align:"center"},{name:"treatedProb",title:"Treated Prob",type:"double",align:"center"},{name:"inherentImpact",title:"Inherent Impact",type:"double",align:"center"},{name:"inherentProb",title:"Inherent Prob",type:"double",align:"center"},{name:"treatedTolerance",title:"Treated Tolerance",type:"integer",align:"center"},{name:"currentTolerance",title:"Current Tolerance",type:"integer",align:"center"},{name:"riskID",title:"Risk ID",type:"integer",align:"center",primaryKey:true},{name:"dateIDRev",title:"Reviewed",type:"date",align:"center"},{name:"dateEvalRev",title:"Reviewed",type:"date",align:"center"},{name:"dateMitRev",title:"Reviewed",type:"date",align:"center"},{name:"dateIDApp",title:"Approved",type:"date",align:"center"},{name:"dateEvalApp",title:"Approved",type:"date",align:"center"},{name:"dateMitApp",title:"Approved",type:"date",align:"center"},{name:"promotionCode",title:"Promoted",align:"center"},{name:"active",title:"Active",type:"boolean"},{name:"summaryRisk",title:"Summary Risk",type:"boolean"},{name:"treated",title:"Treated",type:"boolean"}],fetchDataURL:"./getRiskLiteFetch"});
isc.RestDataSource.create({ID:"allRiskStakeholdersDS",fields:[{name:"name",title:"Name"},{name:"email",title:"Email"},{name:"stakeholderID",title:"StakeholderID"},{name:"compoundName",title:"Role"}],fetchDataURL:"./getAllRiskStakeholdersDS"});
isc.RestDataSource.create({ID:"allUsersDS",fields:[{name:"name",title:"Name"},{name:"email",title:"Email"},{name:"compoundName",title:"Compound Name"}],fetchDataURL:"./getAllRepositoryUsers"});},defineQRMAttachmentForm:function(){isc.defineClass("QRMAttachmentForm","HTMLFlow");
isc.QRMAttachmentForm.addProperties({width:600,border:"10px solid white",showForm:function(f,b,d,a){var c='<form class="attachmentsUpload" enctype="multipart/form-data" id="data" onsubmit="qoQRM.submitAttachment(); return false;">Enter the URL of the attachment or select a file to attach<table><tr><td style="text-align:right"><label>Description</label></td><td colspan="2"><input type="text" size="90" name="description"  /></td></tr><tr><td colspan="3" style="height:8px"></td></tr> <tr><td style="text-align:right"><label>URL</label></td><td colspan="2"><input type="text" size="90" name="url" /></td></tr><tr><td></td><td colspan="2"><em>OR</em></td> <tr><td></td><td width="160"><div class="upload"><input type="file" name="file" id="fileInputID" onchange="qoQRM.inputFileChange($(this).val())"></div></td><td> <div id="uploadFileName"></div></td></tr><tr><td></td><td colspan="2" style="text-align:left"><div id = "fileUploadProgress" style="height:20px"></div></td></tr><tr><td></td><td colspan = "2" style="text-align:right"><input type= "submit" value="Attach" /></td></tr></table><input type="hidden" name="hostID" value="'+f+'" /><input type="hidden" name="hostType" value="'+b+'" /></form>';
this.setContents(c);qoQRM.formSubmitReturn=d;if(a){qoQRM.formSubmitReturnError=a;}else{qoQRM.formSubmitReturnError=d;}}});isc.defineClass("QRMImportAttachmentForm","HTMLFlow");isc.QRMImportAttachmentForm.addProperties({width:470,border:"10px solid white",showForm:function(c,a){var b='<form class="attachmentsUpload" enctype="multipart/form-data" id="data" onsubmit="qoQRM.submitAttachment(true); return false;"><table width="100%"><tr><td></td><td width="160"><div class="upload2"><input type="file" name="file" id="fileInputID" onchange="qoQRM.inputFileChangeUpload($(this).val())"></div></td><td> <div id="uploadFileName"></div></td></tr><tr><td></td><td colspan="2" style="text-align:left"><div id = "fileUploadProgress" style="height:20px"></div></td></tr><tr><td></td><td width="100%" colspan = "2" style="text-align:right"><input type= "submit" value="Upload Risk File" /></td></tr></table></form>';
this.setContents(b);qoQRM.formSubmitReturn=c;if(a){qoQRM.formSubmitReturnError=a;}else{qoQRM.formSubmitReturnError=c;}}});},inputFileChange:function(b){try{$(uploadFileName).html(b.split("\\").pop());$(fileUploadProgress).html('Select "Attach" to upload');
}catch(a){alert(a.message);}},inputFileChangeUpload:function(b){try{$(uploadFileName).html(b.split("\\").pop());}catch(a){alert(a.message);}},defineQRMLabel:function(){isc.defineClass("QRMLabel","Label");
isc.QRMLabel.addProperties({height:30,padding:5,align:"left",valign:"center",wrap:false,title:"Title",template:"<span style='font-size:12px;font-weight:bold;font-famliy:Verdana,sans-serif'>",initWidget:function(){this.Super("initWidget",arguments);
this.contents=this.template+this.title+"</span>";}});},defineQRMRiskEditorLabel:function(){isc.defineClass("QRMRiskEditorLabel","Label");isc.QRMRiskEditorLabel.addProperties({height:30,width:"100%",padding:5,align:"left",valign:"center",wrap:false,title:"Title",template:"<span style='font-size:14px;font-weight:bold;font-famliy:Verdana,sans-serif'>",initWidget:function(){this.Super("initWidget",arguments);
this.contents=this.template+this.title+"</span>";}});},showHelpWindow:function(){if(typeof(helpWindow)=="undefined"){isc.Window.create({ID:"helpWindow",title:"Quay Risk Manager Quick Help Guide",showMinimizeButton:false,showModalMask:true,showResizer:false,canDragReposition:false,isModal:true,autoCenter:true,width:"95%",height:"95%",items:[isc.Label.create({contents:"<span style=\"padding:9px 10px;\" class='qrmMajorTitle'>Quay Risk Manager Quick Help Guide<span>",height:25,width:"100%"}),isc.Label.create({contents:"<span style=\"padding:9px 10px;\" class='qrmSemiMajorTitle'>Select the topic for guided assistance<span>",height:25,width:"100%"}),isc.HTMLPane.create({width:"100%",height:"100%",contents:'<div style="overflow: hidden;"><div onclick="qoHelper.newRisk();" style="float:left;width:160px;height:26px;margin-top:10px;margin-left:5px" class="css_btn_class"><center>Create New Risk</center></div><div onclick="qoHelper.runReport();" style="float:left;width:160px;height:26px;margin-top:10px;margin-left:5px" class="css_btn_class"><center>Run a Report</center></div><div onclick="qoHelper.promoteRisk();" style="float:left;width:160px;height:26px;margin-top:10px;margin-left:5px" class="css_btn_class"><center>Promote a Risk</center></div></div>'})]});
}helpWindow.show();},checkTableSelection:function(){if(viewState=="Regular"){return true;}else{alert("Please Use The 'Regular' Table Format View");return false;}},init:function(){this.defineDataSources();
this.defineQRMButtons();this.defineQRMAttachmentForm();try{defineRelMatrixWidget();defineRelMatrixItem();defineRiskMatrixItem();defineAnalysisWidget();defineSubjectiveRankWidget();defineRelationshipWidget();
defineReportWidget();defineQRMTileImage();defineOverviewWidget();defineRiskTableWidget();defineRiskCalendar();defineRiskConsequenceProbWidget();}catch(a){alert("Define Component Error "+a.message);}this.defineQRMRiskEditorLabel();
this.defineQRMLabel();qoQRM.RankPane=isc.SubjectiveRankWidget.create();qoQRM.AnalysisPane=isc.AnalysisWidget.create();qoQRM.RiskTablePane=isc.RiskTableWidget.create();qoQRM.RelMatrixPane=isc.RelMatrixWidget.create();
qoQRM.RelationshipPane=isc.RelationshipWidget.create();qoQRM.ConcurrentPane=isc.ConcurrentWidget.create();qoQRM.CalPane=isc.CalendarWidget.create();qoQRM.OverviewPane=isc.OverviewWidget.create();qoQRM.IncidentPane=getIncidentWidgetPane();
qoQRM.ReviewPane=getReviewPane();}};var qoHelper={showHelpWindow:function(a,b){isc.Window.create({showMinimizeButton:false,showHeaderIcon:false,canDragReposition:true,width:300,height:400,left:50,top:50,title:b,backgroundColor:"#ffffd0",isModal:true,showModalMask:false,autoDraw:true,items:[isc.Label.create({width:"100%",height:"100%",styleName:"exampleTitle",align:"center",valign:"center",padding:10,showEdges:false,contents:a})]});
},newRisk:function(){helpWindow.hide();RiskTableWindow.selectTab("ExplorerPaneID");newRisk(-1);this.showHelpWindow("Enter the required information and then select 'Submit'","QRM Guide - New Risk");},runReport:function(){helpWindow.hide();
RiskTableWindow.selectTab("ReportPaneID");qoReportEngine.selectAndRunReport();this.showHelpWindow("Select the report you wish to run and then select 'Execute Report'","QRM Guide - Run a Report");},promoteRisk:function(){helpWindow.hide();
RiskTableWindow.selectTab("ExplorerPaneID");this.showHelpWindow("A 'promoted' risk will appear in the list of risks for a project higher up in the project heirarchy<br/>This allows attention to be put on the risk while retaining controller within the risk project.<br/><br/>Click on and drag a risk from the Risk Explorer to the project in the Project Navigator to which you want to promote the risk","QRM Guide - Promote a Risk");
}};var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";
this.OS=this.searchString(this.dataOS)||"an unknown OS";},searchString:function(d){for(var a=0;a<d.length;a++){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;
if(b){if(b.indexOf(d[a].subString)!=-1){return d[a].identity;}}else{if(c){return d[a].identity;}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a==-1){return;}return parseFloat(b.substring(a+this.versionSearchString.length+1));
},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};
function RiskEditor(){this.displayRisk=function(risk){if(risk.primCatID===0){risk.primCatID=null;}if(risk.secCatID===0){risk.secCatID=null;}riskBasicForm.clearValues();riskBasicForm.getItem("ownerID").setValueMap(qoValueMap.owner);
riskBasicForm.getItem("manager1ID").setValueMap(qoValueMap.manager);riskBasicForm.getItem("primCatID").setValueMap(qoValueMap.categories);riskBasicForm.setValues(risk);riskBasicForm.getItem("summaryRisk").enable();
try{riskBasicForm.getItem("secCatID").setValueMap(secCats[risk.primCatID].getValueMap("secCatID","name"));}catch(e){riskBasicForm.getItem("secCatID").setValueMap({});riskBasicForm.getItem("secCatID").setValue(null);
}if(risk.forceDownParent||risk.summaryRisk){riskTabSet.setTabTitle(3,"Contributing Risks & Stakeholders");}else{riskTabSet.setTabTitle(3,"Contributing Stakeholders");}riskBasicForm.getField("estimatedContingencey").setDisabled(riskBasicForm.getField("useCalculatedContingency").getValue());
if(!project.useAdvancedConsequences){riskBasicForm.getField("estimatedContingencey").setDisabled(false);}if(qoQRM.currentEditorMask&qoQRM.pageObjective){try{qoAll.Objectives.setProperty("active",false);
RiskObjectiveTree.setData(isc.Tree.create({modelType:"parent",nameProperty:"objective",idField:"objectiveID",parentIdField:"parentID",data:qoAll.Objectives}));var objs=risk.objectivesImpacted;for(var i=0;
i<objs.length;i++){RiskObjectiveTree.data.data.find("objectiveID",objs[i]).active=true;}RiskObjectiveTree.getData().openAll();}catch(e){isc.say(e);}}if(qoQRM.currentEditorMask&qoQRM.pageMitigation){riskMitPlanSummaryForm.setValues(risk);
try{var mitPlan=risk.mitigationPlan.findAll("response",0);if(mitPlan==null){riskEditorMitPlanTable.setData([]);riskEditorCommentMitPlanTable.setData([]);}else{riskEditorMitPlanTable.setData(mitPlan);riskEditorCommentMitPlanTable.setData(mitPlan);
}}catch(e){alert(e);}}if(qoQRM.currentEditorMask&qoQRM.pageResponse){try{var resPlan=risk.mitigationPlan.findAll("response",1);if(resPlan==null){riskEditorResponseTable.setData([]);}else{riskEditorResponseTable.setData(resPlan);
}}catch(e){alert(e);}}if(qoQRM.currentEditorMask&qoQRM.pageControl){try{riskEditorControlTable.setData(risk.controls);}catch(e){isc.say(e);}}for(var i=0;i<riskTabSet.tabs.length;i++){try{var thisTab=riskTabSet.getTab(i);
var title=thisTab.title;if(title.charAt(title.length-1)=="*"){riskTabSet.setTabTitle(thisTab,title.substring(0,title.length-1));}}catch(e1){isc.say(e1);}}};this.getRiskEditorEvalLayout=function(){var form=isc.DynamicForm.create({ID:"riskBasicForm",numCols:4,autoDraw:false,titleWidth:170,hiliteRequiredFields:true,width:"100%",fields:[{name:"title",type:"text",title:"Risk Title",width:"100%",colSpan:4,changed:"riskBasicEditorLayout.changed();",required:true},{name:"summaryRisk",title:"Summary Risk",defaultValue:false,changed:"riskBasicEditorLayout.changed();",type:"checkbox"},{name:"description",width:"100%",type:"textarea",required:true,colSpan:4,height:85,changed:"riskBasicEditorLayout.changed();",title:"Description"},{name:"consequences",width:"100%",title:"Consequences",colSpan:4,height:85,required:true,changed:"riskBasicEditorLayout.changed();",type:"textarea"},{name:"cause",width:"100%",title:"Possible Causes",height:85,colSpan:4,changed:"riskBasicEditorLayout.changed();",type:"textarea"},{name:"impact",width:"100%",title:"Areas Affected",height:85,colSpan:4,changed:"riskBasicEditorLayout.changed();",type:"textarea"},{name:"estimatedContingencey",title:"Estimated Contigency",required:false,type:"double",allowEmptyValue:true,changed:"riskBasicEditorLayout.changed();",validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]"},{name:"useCalculatedContingency",title:"Use Calculated Contingency",required:false,type:"checkbox",changed:"riskBasicForm.getField('estimatedContingencey').setDisabled(value);riskBasicEditorLayout.changed();",showTitle:false,showIf:"project.useAdvancedConsequences == true"},{name:"securityLevel",title:"Security Level",required:true,type:"select",valueMap:{0:"Public",1:"Restricted",2:"Private"},allowEmptyValue:false,colSpan:4,changed:"riskBasicEditorLayout.changed();"},{name:"ownerID",width:200,title:"Risk Owner",required:true,type:"select",allowEmptyValue:false,changed:"riskBasicEditorLayout.changed();",startRow:true},{type:"header",defaultValue:"Impact",startRow:false},{name:"manager1ID",width:200,title:"Risk Manager",required:true,type:"select",allowEmptyValue:false,changed:"riskBasicEditorLayout.changed();",startRow:true},{name:"impReputation",width:200,title:"Reputation",type:"checkbox",defaultValue:false,changed:"riskBasicEditorLayout.changed();",showTitle:false},{name:"impSafety",width:200,title:"Human Safety",type:"checkbox",defaultValue:false,changed:"riskBasicEditorLayout.changed();",showTitle:false},{name:"treated",width:200,title:"Treated Risk",type:"checkbox",defaultValue:false,changed:"riskBasicEditorLayout.changed();",startRow:true},{name:"impSpec",width:200,title:"Specification",showTitle:false,defaultValue:false,changed:"riskBasicEditorLayout.changed();",type:"checkbox"},{name:"impTime",width:200,title:"Schedule",showTitle:false,defaultValue:false,changed:"riskBasicEditorLayout.changed();",type:"checkbox"},{name:"startExposure",width:300,title:"Start of Exposure",type:"date",changed:"riskBasicEditorLayout.changed();",startRow:true},{name:"impCost",width:200,title:"Cost",defaultValue:false,type:"checkbox",changed:"riskBasicEditorLayout.changed();",showTitle:false},{name:"impEnvironment",width:200,title:"Environment",defaultValue:false,type:"checkbox",changed:"riskBasicEditorLayout.changed();",showTitle:false},{name:"endExposure",width:300,title:"End of Exposure",type:"date",changed:"riskBasicEditorLayout.changed();",startRow:true},{type:"header",defaultValue:"Treatment Strategy",startRow:false},{name:"primCatID",width:200,title:"Primary Category",type:"select",allowEmptyValue:true,startRow:true,autoFetchData:false,changed:function(){riskBasicEditorLayout.changed();
try{riskBasicForm.getItem("secCatID").setValueMap(secCats[riskBasicForm.getItem("primCatID").getValue()].getValueMap("secCatID","name"));}catch(e){riskBasicForm.getItem("secCatID").setValueMap({});}riskBasicForm.getItem("secCatID").setValue(null);
}},{width:200,title:"Avoidence",defaultValue:false,type:"checkbox",name:"treatmentAvoidance",changed:"riskBasicEditorLayout.changed();",showTitle:false},{width:200,title:"Reduction",defaultValue:false,type:"checkbox",name:"treatmentReduction",changed:"riskBasicEditorLayout.changed();",showTitle:false},{name:"secCatID",width:200,title:"Secondary Category",type:"select",allowEmptyValue:true,startRow:true,changed:"riskBasicEditorLayout.changed();",autoFetchData:false},{width:200,title:"Retention",name:"treatmentRetention",defaultValue:false,type:"checkbox",changed:"riskBasicEditorLayout.changed();",showTitle:false},{width:200,title:"Transfer/Sharing",name:"treatmentTransfer",defaultValue:false,type:"checkbox",changed:"riskBasicEditorLayout.changed();",showTitle:false},{name:"riskID",_constructor:"HiddenItem"},{name:"projectID",_constructor:"HiddenItem"}]});
return isc.VLayout.create({members:[form],dirty:false,ID:"riskBasicEditorLayout",changed:function(){riskBasicEditorLayout.dirty=true;riskEditorDirty();},cancelFn:function(){editRiskBasicModalWindow.closeClick();
}});};this.getRiskEditorControlLayout=function(){return isc.VLayout.create({membersMargin:5,ID:"riskControlLayout",dirty:false,deleteControl:function(){isc.RPCManager.sendRequest({evalResult:false,showPrompt:true,prompt:"Deleting Risk Control",actionURL:"./deleteRiskControl",params:{DATA:JSON.stringify(riskEditorControlTable.getSelection().getProperty("internalID")),PROJECTID:project.projectID,RISKID:qoRiskController.currentRisk.riskID},callback:function(rpcResponse,data,rpcRequest){try{var controls=JSON.parse(data,dateParser).controls;
if(controls==null){riskEditorControlTable.setData([]);}else{riskEditorControlTable.setData(controls);}}catch(e){isc.say(e.message);}}});},showMainButtons:function(show){if(show){controlNewStepBtn.show();
controlEditBtn.show();controlDeleteBtn.show();controlCancelEditBtn.hide();controlFinishEditBtn.hide();}else{controlNewStepBtn.hide();controlEditBtn.hide();controlDeleteBtn.hide();controlCancelEditBtn.show();
controlFinishEditBtn.show();}},initWidget:function(){this.Super("initWidget",arguments);this.toolStrip=isc.HLayout.create({width:"100%",membersMargin:5,align:"right",height:24,initWidget:function(){this.Super("initWidget",arguments);
this.newBtn=isc.QRMAddButton.create({ID:"controlNewStepBtn",title:"Create New",click:function(){this.parentElement.editBtn.setDisabled(true);isc.RPCManager.sendRequest({prompt:"Adding Risk Control",showPrompt:true,evalResult:false,actionURL:"./newRiskControl",params:{DATA:JSON.stringify(riskEditorControlTable.getSelection().getProperty("internalID")),PROJECTID:project.projectID,RISKID:qoRiskController.currentRisk.riskID},callback:function(rpcResponse,data,rpcRequest){try{var controls=JSON.parse(data,dateParser).controls;
if(controls==null){riskEditorControlTable.setData([]);}else{riskEditorControlTable.setData(controls);}}catch(e){isc.say(e.message);}}});}});this.delBtn=isc.QRMDeleteButton.create({ID:"controlDeleteBtn",disabled:true,click:function(){this.parentElement.editBtn.setDisabled(true);
riskControlLayout.deleteControl();}});this.editBtn=isc.QRMEditButton.create({ID:"controlEditBtn",disabled:true,click:function(){this.parentElement.parentElement.table.editSelectedRecord();}});this.cancelBtn=isc.QRMCancelButton.create({ID:"controlCancelEditBtn",title:"Cancel Edits",disabled:true,click:function(){this.parentElement.parentElement.table.cancelEditing();
}});this.finishBtn=isc.QRMFinishButton.create({ID:"controlFinishEditBtn",title:"Finish Edits",disabled:true,click:function(){this.parentElement.parentElement.table.endEditing();}});this.addMembers([this.editBtn,this.delBtn,this.newBtn,this.cancelBtn,this.finishBtn]);
}});this.table=isc.ListGrid.create({ID:"riskEditorControlTable",autoDraw:false,alternateRecordStyles:true,height:"100%",confirmCancelEditing:false,confirmDiscardEdits:false,showGridSummary:true,wrapCells:true,fixedRecordHeights:false,selectionAppearance:"checkbox",editComplete:function(rowNum,colNum,newValues,oldValues,editCompletionEvent){riskControlLayout.showMainButtons(true);
this.parentElement.toolStrip.cancelBtn.setDisabled(true);this.parentElement.toolStrip.finishBtn.setDisabled(true);this.parentElement.toolStrip.delBtn.setDisabled(true);this.parentElement.toolStrip.editBtn.setDisabled(true);
isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({evalResult:false,prompt:"Updating Risk Controls",params:{DATA:JSON.stringify(this.getData()),RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(rpcResponse,data,rpcRequest){try{var controls=JSON.parse(data,dateParser).controls;
if(controls==null){riskEditorControlTable.setData([]);}else{riskEditorControlTable.setData(controls);}qoRiskController.dirty=true;}catch(e){isc.say(e.message);}},actionURL:"./saveRiskControls"});},editorExit:function(editCompletionEvent,record,newValue,rowNum,colNum){riskControlLayout.showMainButtons(true);
this.parentElement.toolStrip.cancelBtn.setDisabled(true);this.parentElement.toolStrip.finishBtn.setDisabled(true);this.parentElement.toolStrip.delBtn.setDisabled(true);this.parentElement.toolStrip.editBtn.setDisabled(true);
return true;},emptyMessage:"No Risk Controls Documented",fields:[{name:"control",title:"Control",canEdit:true,width:"100%",align:"left",summaryFunction:"count",pluralTitle:"Controls"},{name:"effectiveness",title:"Effectivenes",canEdit:true,width:140,align:"center",type:"select",valueMap:{1:"Ad Hoc",2:"Repeatable",3:"Documented",4:"Integrated",5:"Optimized"}},{name:"contribution",title:"Contribution",canEdit:true,width:200,align:"center"}],expansionDetailsProperties:{overflow:"visible",fields:[{name:"control",title:"Control"},{name:"effectiveness",title:"Effectivenes",type:"select",valueMap:{1:"Ad Hoc",2:"Repeatable",3:"Documented",4:"Integrated",5:"Optimized"}},{name:"contribution",title:"Contribution"}]},recordClick:function(){this.parentElement.toolStrip.delBtn.setDisabled(false);
this.parentElement.toolStrip.editBtn.setDisabled(false);},editSelectedRecord:function(){riskControlLayout.showMainButtons(false);this.startEditing(this.getRecordIndex(this.getSelectedRecord()));},editorEnter:function(){riskControlLayout.showMainButtons(false);
this.parentElement.toolStrip.cancelBtn.setDisabled(false);this.parentElement.toolStrip.finishBtn.setDisabled(false);},selectionChanged:function(record,state){riskControlLayout.showMainButtons(true);this.parentElement.toolStrip.editBtn.setDisabled(!state);
this.parentElement.toolStrip.delBtn.setDisabled(!state);}});this.addMember(isc.QRMRiskEditorLabel.create({title:"Risk Controls"}));this.addMembers([this.table,this.toolStrip]);}});};this.getRiskEditorAttachmentLayout=function(){return isc.VLayout.create({membersMargin:5,ID:"riskAttachmentLayout",saveFn:function(){},resetFn:function(){},dirty:false,initWidget:function(){this.Super("initWidget",arguments);
this.toolStrip=isc.HLayout.create({width:"100%",align:"right",membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);this.newBtn=isc.IButton.create({title:"Create New",icon:"[SKIN]/actions/add.png",width:100,showDisabledIcon:true,click:function(){isc.Window.create({title:"New Risk Attachement",ID:"riskAttachmentWindow",isModal:true,showModalMask:true,showMaximizeButton:true,autoCenter:true,autoSize:true,layoutMargin:5,items:[isc.VLayout.create({width:600,members:[isc.QRMAttachmentForm.create({ID:"RiskAttachmentForm"})]})]});
RiskAttachmentForm.showForm(qoRiskController.currentRisk.riskID,"RISK",function(){riskAttachmentWindow.hide();getRiskAttachments();});riskAttachmentWindow.show();}});this.delBtn=isc.IButton.create({title:"Delete",icon:"[SKIN]/actions/remove.png",showDisabledIcon:true,width:100,disabled:true,click:function(){var ids=riskEditorAttachmentTable.getSelection().getProperty("internalID");
isc.RPCManager.sendRequest({prompt:"Removing Attachment",showPrompt:true,evalResult:true,params:{DATA:JSON.stringify(ids),PROJECTID:project.projectID,RISKID:qoRiskController.currentRisk.riskID},callback:function(rpcResponse,data,rpcRequest){getRiskAttachments();
},actionURL:"./removeAttachments"});}});this.addMembers([this.delBtn,this.newBtn]);}});this.table=isc.ListGrid.create({ID:"riskEditorAttachmentTable",autoDraw:false,selectionAppearance:"checkbox",alternateRecordStyles:true,height:"100%",emptyMessage:"No Attachments Found",selectionChanged:function(record,state){this.parentElement.toolStrip.delBtn.setDisabled(!state);
},fields:[{name:"description",title:"Decription",width:"50%",align:"left"},{title:"Attachment",type:"text",width:100,align:"center",formatCellValue:function(value,record,rowNum,colNum,grid){if(record.attachmentURL){return"<a href = '"+record.attachmentURL+"' target='_blank'>Download</a>";
}else{return"<a href = '"+record.url+"' target='_blank'>View</a>";}}}]});this.addMember(isc.QRMRiskEditorLabel.create({title:"Risk Attachements"}));this.addMembers([this.table,this.toolStrip]);}});};this.getRiskEditorCommentLayout=function(){return isc.VLayout.create({membersMargin:5,ID:"riskCommentLayout",saveFn:function(){},resetFn:function(){},dirty:false,members:[isc.QRMRiskEditorLabel.create({title:"Risk Status Updates and Comments"}),isc.ListGrid.create({ID:"riskEditorCommentTable",autoDraw:false,alternateRecordStyles:true,height:"100%",emptyMessage:"No Comments Found",wrapCells:true,fixedRecordHeights:false,fields:[{name:"comment",title:"Comment",width:"100%",align:"left"},{name:"type",title:"Type",width:125,type:"text",align:"center"},{name:"personName",title:"Entered By",width:100,type:"text",align:"center"},{name:"dateEntered",title:"Date",width:100,type:"date",align:"center",formatCellValue:function(value){if(value){return value.getShortMonthName()+" "+value.getDate()+", "+value.getFullYear();
}}},{title:"Attachment",type:"text",width:100,align:"center",formatCellValue:function(value,record,rowNum,colNum,grid){if(record.attachmentURL){return"<a href = '"+record.attachmentURL+"' target='_blank'>Download</a>";
}else{if(record.url){return"<a href = '"+record.url+"' target='_blank'>View</a>";}else{return"";}}}}],getCellCSSText:function(record,rowNum,colNum){if(record.approval||record.review){return"color:blue;vertical-align:top";
}else{if(record.schedReview){return"color:orange;vertical-align:top";}else{return"vertical-align:top";}}}}),isc.HLayout.create({height:24,width:"100%",align:"right",members:[isc.QRMRiskEditorLabel.create({title:"Detail Mitigation Plan Updates",width:"100%"}),isc.QRMAddButton.create({title:"New Comment",width:120,click:function(){newRiskComment();
}})]}),isc.ListGrid.create({ID:"riskEditorCommentMitPlanTable",autoDraw:false,alternateRecordStyles:true,height:"100%",wrapCells:true,fixedRecordHeights:false,autoFetchData:false,selectionType:"single",getCellCSSText:function(record,rowNum,colNum){return"vertical-align:top";
},emptyMessage:"No Mitigation Steps Defined",fields:[{name:"description",title:"Description",width:"100%",align:"left",editorType:"textArea"},{name:"updates",title:"Updates",width:"100%",align:"left"},{name:"personID",title:"Person Reponsible",width:130,align:"center",type:"select",valueMap:qoValueMap.manager,required:true},{name:"estCost",title:"Est. Cost",width:70,align:"center",formatCellValue:function(value){if(isc.isA.Number(value)){if(value==0){return"-";
}else{return value.toCurrencyString("$");}}else{var val=parseFloat(value);if(isc.isA.Number(val)){if(val==0){return"-";}else{return val.toCurrencyString("$");}}}return"-";}},{name:"percentComplete",title:"% Compl.",width:70,align:"center",formatCellValue:"isc.Format.toUSString(value)",includeInRecordSummary:false,showGridSummary:false},{name:"endDate",title:"Date",width:100,align:"center",formatCellValue:function(value){if(value){return value.getShortMonthName()+" "+value.getDate()+", "+value.getFullYear();
}}}],selectionChanged:function(record,state){riskMitCommentAddUpdateBtn.setDisabled(!state);}}),isc.HLayout.create({width:"100%",align:"right",membersMargin:5,height:24,members:[isc.QRMAddButton.create({ID:"riskMitCommentAddUpdateBtn",title:"Add Update",width:120,disabled:true,click:function(){isc.Window.create({ID:"mitCommentUpdateModalWindow",title:"Mitigation Detail Step Update",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,headerControls:["headerIcon","headerLabel","closeButton"],autoDraw:false,closeClick:function(){this.Super("closeClick",arguments);
},items:[isc.VLayout.create({layoutMargin:5,members:[isc.Label.create({width:550,wrap:true,contents:"<em>"+riskEditorCommentMitPlanTable.getSelection().getProperty("description")+"</em><br/><br/>"}),isc.DynamicForm.create({ID:"mitCommentUpdateForm2",autoDraw:false,titleOrientation:"top",padding:4,fields:[{title:"Enter Update",required:true,name:"value",type:"textarea",width:600,height:80}]}),isc.QRMSaveButton.create({layoutAlign:"right",click:function(){var value=mitCommentUpdateForm2.getValue("value");
if(value==null){mitCommentUpdateModalWindow.hide();return;}isc.RPCManager.sendRequest({prompt:"Adding Mitigation Update",showPrompt:true,evalResult:false,actionURL:"./addMitigationUpdate",params:{PROJECTID:project.projectID,RISKID:qoRiskController.currentRisk.riskID,MITSTEPID:riskEditorCommentMitPlanTable.getSelection().getProperty("mitstepID")[0],UPDATE:value},callback:function(rpcResponse,data,rpcRequest){mitCommentUpdateModalWindow.hide();
try{var mitPlan=JSON.parse(data,dateParser).mitigationPlan.findAll("response",0);if(mitPlan==null){riskEditorMitPlanTable.setData([]);riskEditorCommentMitPlanTable.setData([]);}else{riskEditorMitPlanTable.setData(mitPlan);
riskEditorCommentMitPlanTable.setData(mitPlan);}}catch(e){isc.say(e.message);}}});}})]})]});mitCommentUpdateModalWindow.show();}})]})]});};this.getRiskEditorMitigationLayout=function(){return isc.VLayout.create({membersMargin:2,ID:"riskMitigationLayout",dirty:false,deleteMitigation:function(){isc.RPCManager.sendRequest({prompt:"Deleting Mitigation Step",showPrompt:true,evalResult:false,actionURL:"./deleteRiskMitigation",params:{DATA:JSON.stringify(riskEditorMitPlanTable.getSelection().getProperty("mitstepID")),PROJECTID:project.projectID,RISKID:qoRiskController.currentRisk.riskID},callback:function(rpcResponse,data,rpcRequest){try{var mitPlan=JSON.parse(data,dateParser).mitigationPlan.findAll("response",0);
if(mitPlan==null){riskEditorMitPlanTable.setData([]);riskEditorCommentMitPlanTable.setData([]);}else{riskEditorMitPlanTable.setData(mitPlan);riskEditorCommentMitPlanTable.setData(mitPlan);}}catch(e){isc.say("Security Restriction: Unable to delete selected mitigation step");
}}});},showMainButtons:function(show){if(show){riskMitNewStepBtn.show();riskMitEditBtn.show();riskMitDeleteBtn.show();riskMitAddUpdateBtn.show();riskMitCancelEditBtn.hide();riskMitFinishEditBtn.hide();
}else{riskMitNewStepBtn.hide();riskMitEditBtn.hide();riskMitDeleteBtn.hide();riskMitAddUpdateBtn.hide();riskMitCancelEditBtn.show();riskMitFinishEditBtn.show();}},initWidget:function(){this.Super("initWidget",arguments);
this.toolStrip=isc.HLayout.create({width:"100%",align:"right",membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);this.newBtn=isc.QRMAddButton.create({ID:"riskMitNewStepBtn",title:"Create New",click:function(){isc.RPCManager.sendRequest({prompt:"Adding Mitigation Action",showPrompt:true,evalResult:false,actionURL:"./newRiskMitigation",params:{PROJECTID:project.projectID,RESPONSE:false,RISKID:qoRiskController.currentRisk.riskID},callback:function(rpcResponse,data,rpcRequest){try{var mitPlan=JSON.parse(data,dateParser).mitigationPlan.findAll("response",0);
if(mitPlan==null){riskEditorMitPlanTable.setData([]);riskEditorCommentMitPlanTable.setData([]);}else{riskEditorMitPlanTable.setData(mitPlan);riskEditorCommentMitPlanTable.setData(mitPlan);}}catch(e){isc.say(e.message);
}}});}});this.delBtn=isc.QRMDeleteButton.create({ID:"riskMitDeleteBtn",disabled:true,showDisabledIcon:true,click:function(){riskMitigationLayout.deleteMitigation();this.parentElement.toolStrip.addBtn.setDisabled(true);
this.parentElement.toolStrip.editBtn.setDisabled(true);}});this.editBtn=isc.QRMEditButton.create({ID:"riskMitEditBtn",disabled:true,showDisabledIcon:true,click:function(){riskMitigationLayout.showMainButtons(false);
this.parentElement.parentElement.table.editSelectedRecord();}});this.cancelBtn=isc.QRMCancelButton.create({ID:"riskMitCancelEditBtn",title:"Cancel Edits",disabled:true,click:function(){try{this.parentElement.parentElement.table.cancelEditing();
this.parentElement.cancelBtn.setDisabled(true);this.parentElement.finishBtn.setDisabled(true);riskMitigationLayout.showMainButtons(true);}catch(e){alert(e.message);}}});this.finishBtn=isc.QRMFinishButton.create({ID:"riskMitFinishEditBtn",title:"Finish Edits",disabled:true,click:function(){this.parentElement.parentElement.table.endEditing();
this.parentElement.cancelBtn.setDisabled(true);this.parentElement.finishBtn.setDisabled(true);riskMitigationLayout.showMainButtons(true);}});this.addBtn=isc.QRMAddButton.create({ID:"riskMitAddUpdateBtn",title:"Add Update",disabled:true,click:function(){isc.Window.create({ID:"mitUpdateModalWindow",title:"Mitigation Detail Step Update",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,headerControls:["headerIcon","headerLabel","closeButton"],autoDraw:false,closeClick:function(){this.Super("closeClick",arguments);
},items:[isc.VLayout.create({layoutMargin:5,members:[isc.Label.create({width:550,wrap:true,contents:"<em>"+riskEditorMitPlanTable.getSelection().getProperty("description")+"</em><br/><br/>"}),isc.DynamicForm.create({ID:"mitCommentUpdateForm1",autoDraw:false,titleOrientation:"top",padding:4,fields:[{title:"Enter Update",required:true,name:"value",type:"textarea",width:600,height:80}]}),isc.QRMSaveButton.create({layoutAlign:"right",click:function(){var value=mitCommentUpdateForm1.getValue("value");
if(value==null){mitUpdateModalWindow.hide();return;}isc.RPCManager.sendRequest({prompt:"Adding Mitigation Update",showPrompt:true,evalResult:false,actionURL:"./addMitigationUpdate",params:{PROJECTID:project.projectID,RISKID:qoRiskController.currentRisk.riskID,MITSTEPID:riskEditorMitPlanTable.getSelection().getProperty("mitstepID")[0],UPDATE:value},callback:function(rpcResponse,data,rpcRequest){mitUpdateModalWindow.hide();
try{var mitPlan=JSON.parse(data,dateParser).mitigationPlan.findAll("response",0);if(mitPlan==null){riskEditorMitPlanTable.setData([]);riskEditorCommentMitPlanTable.setData([]);}else{riskEditorMitPlanTable.setData(mitPlan);
riskEditorCommentMitPlanTable.setData(mitPlan);}}catch(e){isc.say(e.message);}}});}})]})]});mitUpdateModalWindow.show();}});this.addMembers([this.editBtn,this.delBtn,this.newBtn,this.addBtn,this.cancelBtn,this.finishBtn]);
}});this.form=isc.DynamicForm.create({ID:"riskMitPlanSummaryForm",numCols:1,titleOrientation:"top",height:110,autoDraw:false,hiliteRequiredFields:true,width:"100%",fields:[{name:"mitPlanSummary",type:"textarea",title:"Mitigation Plan Summary",width:"100%",height:100,showTitle:false,changed:"qoRiskController.dirty = true;riskMitigationLayout.dirty = true;riskBasicEditorLayout.changed();",required:true}]});
this.form2=isc.DynamicForm.create({ID:"riskMitPlanSummaryForm2",numCols:1,titleOrientation:"top",height:110,autoDraw:false,hiliteRequiredFields:true,width:"100%",fields:[{name:"mitPlanSummaryUpdate",type:"textarea",title:"Mitigation Plan Update",width:"100%",height:100,showTitle:false,changed:"qoRiskController.dirty = true;riskMitigationLayout.dirty = true;riskBasicEditorLayout.changed();",required:false}]});
this.table=isc.ListGrid.create({ID:"riskEditorMitPlanTable",autoDraw:false,alternateRecordStyles:true,height:"100%",wrapCells:true,fixedRecordHeights:false,confirmCancelEditing:false,confirmDiscardEdits:false,autoFetchData:false,canEdit:true,editEvent:"doubleClick",selectionType:"single",showGridSummary:true,getCellCSSText:function(record,rowNum,colNum){return"vertical-align:top";
},editComplete:function(rowNum,colNum,newValues,oldValues,editCompletionEvent){riskMitigationLayout.showMainButtons(true);isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({evalResult:false,actionURL:"./saveRiskMitigation",prompt:"Updating Mitigation Action",params:{DATA:JSON.stringify(this.getData()),RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(rpcResponse,data,rpcRequest){try{var riskTemp=JSON.parse(data,dateParser);
var mitPlan=riskTemp.mitigationPlan.findAll("response",0);if(mitPlan==null){riskEditorMitPlanTable.setData([]);riskEditorCommentMitPlanTable.setData([]);}else{riskEditorMitPlanTable.setData(mitPlan);riskEditorCommentMitPlanTable.setData(mitPlan);
}qoRiskController.dirty=true;}catch(e){isc.say(e.message);}}});},emptyMessage:"No Mitigation Steps Defined",fields:[{name:"description",title:"Description",canEdit:true,width:"100%",align:"left",editorType:"textArea",summaryFunction:"count",pluralTitle:"Mitigation Actions",editorProperties:{height:80}},{name:"updates",title:"Updates",canEdit:false,width:"100%",align:"left"},{name:"personID",title:"Person Reponsible",canEdit:true,width:130,align:"center",type:"select",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,valueMap:qoValueMap.manager,required:true},{name:"estCost",title:"Est. Cost",canEdit:true,width:70,align:"center",summaryFunction:"sum",showGridSummary:true,showGroupSummary:true,formatCellValue:function(value){if(isc.isA.Number(value)){if(value==0){return"-";
}else{return value.toCurrencyString("$");}}else{var val=parseFloat(value);if(isc.isA.Number(val)){if(val==0){return"-";}else{return val.toCurrencyString("$");}}}return"-";}},{name:"percentComplete",title:"% Compl.",canEdit:true,width:70,align:"center",formatCellValue:"isc.Format.toUSString(value)",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,editorType:"spinner",editorProperties:{max:100,min:0}},{name:"endDate",title:"Date",canEdit:true,width:100,align:"center",editorType:"date",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,formatCellValue:function(value){if(value){return value.getShortMonthName()+" "+value.getDate()+", "+value.getFullYear();
}}}],recordClick:function(){this.parentElement.toolStrip.delBtn.setDisabled(false);this.parentElement.toolStrip.editBtn.setDisabled(false);this.parentElement.toolStrip.addBtn.setDisabled(false);},editSelectedRecord:function(){riskMitigationLayout.showMainButtons(false);
this.startEditing(this.getRecordIndex(this.getSelectedRecord()));},removeSelectedRecord:function(){var records=this.data;records.remove(this.getSelectedRecord());this.setData(records);},editorEnter:function(){riskMitigationLayout.showMainButtons(false);
this.parentElement.toolStrip.cancelBtn.setDisabled(false);this.parentElement.toolStrip.finishBtn.setDisabled(false);},selectionChanged:function(record,state){this.cancelEditing();riskMitigationLayout.showMainButtons(true);
this.parentElement.toolStrip.editBtn.setDisabled(!state);this.parentElement.toolStrip.delBtn.setDisabled(!state);this.parentElement.toolStrip.addBtn.setDisabled(!state);this.parentElement.toolStrip.cancelBtn.setDisabled(true);
this.parentElement.toolStrip.finishBtn.setDisabled(true);}});this.addMembers([isc.QRMRiskEditorLabel.create({title:"Mitigation Plan Summary"}),this.form,isc.QRMRiskEditorLabel.create({title:"Mitigation Plan Summary Update"}),this.form2,isc.QRMRiskEditorLabel.create({title:"Mitigation Plan Detail"}),this.table,this.toolStrip]);
}});};this.getRiskEditorConsequenceLayout=function(){return isc.VLayout.create({membersMargin:5,ID:"riskConsequenceLayout",saveFn:function(){},dirty:false,initWidget:function(){this.Super("initWidget",arguments);
this.toolStrip=isc.HLayout.create({width:"100%",align:"right",membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);this.newBtn=isc.QRMAddButton.create({title:"Create New",click:function(){qoRiskEditor.editConsequence(-1);
}});this.delBtn=isc.QRMDeleteButton.create({title:"Delete",disabled:true,click:function(){deleteConsequence(riskEditorConsequenceTable.getSelectedRecord().internalID);}});this.editBtn=isc.QRMEditButton.create({title:"Edit",disabled:true,click:function(){qoRiskEditor.editConsequence(riskEditorConsequenceTable.getSelectedRecord().internalID);
}});this.addMembers([this.editBtn,this.delBtn,this.newBtn]);}});this.table=isc.ListGrid.create({ID:"riskEditorConsequenceTable",autoDraw:false,alternateRecordStyles:true,showGridSummary:true,height:"60%",emptyMessage:"No Consequences Defined",getBaseStyle:function(record,rowNum,colNum){if(!riskBasicForm.getItem("useCalculatedContingency").getValue()&&record.costCategroy){return"consqCostWarning";
}else{return this.Super("getBaseStyle",arguments);}},fields:[{name:"description",title:"Consequnce",width:"100%",align:"left",summaryFunction:"count",pluralTitle:"Consequences"},{name:"type",title:"Type",width:200,align:"left"},{name:"riskConsequenceProb",title:"Prob",width:"40",align:"center",formatCellValue:function(value,record,rowNum,colNum){try{if(record.treated){return record.postRiskConsequenceProb;
}else{return record.riskConsequenceProb;}}catch(e){isc.say(e.message);return"Unknown";}}},{name:"costDistributionType",title:"Distribution",width:110,align:"center",formatCellValue:function(value,record,rowNum,colNum){try{if(record.treated){return qoValueMap.distributionTypeMap.get(record.postCostDistributionType);
}else{return qoValueMap.distributionTypeMap.get(record.costDistributionType);}}catch(e){isc.say(e.message);return"Error";}}}],recordClick:function(){var record=this.getSelectedRecord();if(record===null){return this.parentElement.detViewer.clearDetails();
}this.parentElement.toolStrip.delBtn.setDisabled(false);},recordDoubleClick:function(){var record=this.getSelectedRecord();this.parentElement.toolStrip.delBtn.setDisabled(false);qoRiskEditor.editConsequence(record.internalID);
},removeSelectedRecord:function(){var records=this.data;records.remove(this.getSelectedRecord());this.setData(records);},selectionChanged:function(record,state){this.parentElement.toolStrip.editBtn.setDisabled(!state);
this.parentElement.toolStrip.delBtn.setDisabled(!state);}});this.addMember(isc.QRMRiskEditorLabel.create({title:"Risk Consequences"}));this.addMembers([this.table,this.detViewer,isc.Label.create({align:"left",valign:"center",width:"100%",height:15,wrap:false,ID:"consqCostWarningLabel",baseStyle:"consqCostWarning",contents:"This risk has been configured to use the supplied contingency. Cost will be ignored"}),this.toolStrip]);
isc.DynamicForm.create({ID:"contingencyForm",autoDraw:false,padding:10,titleWidth:200,numCols:2,width:"100%",height:"100%",fields:[{type:"header",defaultValue:"Calculate Contingency"},{name:"contingencyPercentile",title:"Contingency Percentile",width:50,editorType:"spinner",defaultValue:70,min:0,max:100,step:5},{title:"Calulate",type:"button",width:175,align:"right",showTitle:false,endRow:true,click:function(){if(qoRiskController.dirty){isc.say("Please save changes before calculating the contingency");
return;}var values=contingencyForm.getValues();values.riskID=qoRiskController.riskID;isc.RPCManager.sendRequest({actionURL:"./calcRiskContingency",showPrompt:true,prompt:"Calculating Contingency",evalResult:false,params:{RISKID:qoRiskController.currentRisk.riskID,PROJECTID:qoRiskController.currentRisk.projectID,DATA:JSON.stringify(values)},callback:function(rpcResponse,data,rpcRequest){try{contingencyForm2.getItem("viewState").setDisabled(false);
contingencyForm2.getItem("viewState").setValueDisabled("UnTreated",false);contingencyForm2.getItem("viewState").setValueDisabled("Treated",false);contingencyForm2.markForRedraw();contingencyForm.setValues(JSON.parse(data,dateParser));
contingencyForm.getItem("saveContingencyButton").setDisabled(false);contingencyGraph.setSrc(Page.getAppDir()+"getContingencyGraph?HEIGHT="+contingencyGraph.getHeight()+"&WIDTH="+contingencyGraph.getWidth()+"&preMit="+contingencyForm2.getItem("viewState").getValue()+"&nocache="+Math.random());
}catch(e){isc.say(e.message);}}});}},{name:"blurb1",defaultValue:"<strong  style='color:red'>Un Treated</strong>",type:"BlurbItem"},{name:"preMitContingency",title:"Contingency",type:"StaticTextItem",width:80,canEdit:false},{name:"preMitContingencyWeighted",title:"Weighted Contingency",type:"StaticTextItem",width:80,canEdit:false},{name:"blurbt",defaultValue:"<strong style='color:blue'>Treated</strong>",type:"BlurbItem"},{name:"postMitContingency",title:"Contingency",type:"StaticTextItem",width:80,canEdit:false},{name:"postMitContingencyWeighted",title:"Weighted Contingency",type:"StaticTextItem",width:80,canEdit:false},{type:"spacer"},{title:"Save Contingency Values",type:"button",width:175,align:"right",showTitle:false,endRow:true,name:"saveContingencyButton",disabled:true,click:function(){if(qoRiskController.dirty){isc.say("Please save changes before saving the contingency values");
return;}updateRiskEditorContingency();}}]});isc.DynamicForm.create({ID:"contingencyForm2",autoDraw:false,padding:10,titleWidth:100,titleOrientation:"top",numCols:1,width:"100%",height:"100%",fields:[{defaultValue:"Select Treatment State:",type:"BlurbItem"},{showTitle:false,name:"viewState",type:"radioGroup",colSpan:"*",vertical:true,defaultValue:"UnTreated",valueMap:["UnTreated","Treated"],redrawOnChange:true,changed:function(form,item,value){contingencyGraph.setSrc(Page.getAppDir()+"getContingencyGraph?HEIGHT="+contingencyGraph.getHeight()+"&WIDTH="+contingencyGraph.getWidth()+"&preMit="+contingencyForm2.getItem("viewState").getValue()+"&nocache="+Math.random());
}}]});isc.Img.create({ID:"contingencyGraph",width:"100%",height:"100%",src:"[SKIN]grid.gif",imageType:"tile",autoDraw:false});this.addMember(isc.HLayout.create({layoutMargin:5,membersMargin:5,height:"100%",members:[isc.VLayout.create({members:[contingencyForm,contingencyForm2]}),contingencyGraph]}));
}});};this.editConsequence=function(id){isc.Window.create({title:"Risk Consequence Editor",ID:"riskConsequenceEditor",width:800,height:600,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:false,items:[qoRiskEditor.getConsequenceEditorPanel()],closeClick:function(){var values=contingencyForm.getValues();
values.riskID=qoRiskController.riskID;isc.RPCManager.sendRequest({actionURL:"./calcRiskContingency",showPrompt:true,prompt:"Calculating Contingency",evalResult:false,params:{RISKID:qoRiskController.currentRisk.riskID,PROJECTID:qoRiskController.currentRisk.projectID,DATA:JSON.stringify(values)},callback:function(rpcResponse,data,rpcRequest){try{contingencyForm2.getItem("viewState").setDisabled(false);
contingencyForm2.getItem("viewState").setValueDisabled("UnTreated",false);contingencyForm2.getItem("viewState").setValueDisabled("Treated",false);contingencyForm2.markForRedraw();contingencyForm.setValues(JSON.parse(data,dateParser));
contingencyForm.getItem("saveContingencyButton").setDisabled(false);contingencyGraph.setSrc(Page.getAppDir()+"getContingencyGraph?HEIGHT="+contingencyGraph.getHeight()+"&WIDTH="+contingencyGraph.getWidth()+"&preMit="+contingencyForm2.getItem("viewState").getValue()+"&nocache="+Math.random());
}catch(e){isc.say(e.message);}}});this.hide();}});try{riskConsequenceEditor.show();try{riskConsequenceEditorPanel.clear();}catch(e){isc.say(e.message);}if(id>0){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./getConsequence",evalResult:false,params:{ID:id,PROJECTID:project.projectID},callback:function(rpcResponse,data,rpcRequest){riskConsequenceEditorPanel.setConsequence(JSON.parse(data));
}});}}catch(e){isc.say(e);}};this.getConsequenceEditorPanel=function(){var layout=isc.VLayout.create({ID:"riskConsequenceEditorPanel",membersMargin:5,layoutMargin:5,height:"100%",width:"100%",clear:function(){try{this.preMitPane.clear();
this.postMitPane.clear();this.mainForm.reset();}catch(e){isc.say(e);}},setConsequence:function(record){try{this.clear();this.preMitPane.setQRMData(record);this.postMitPane.setQRMData(record);this.mainForm.setValues(record);
}catch(e){isc.say(e);}},getData:function(){var data=new Object();data.description=this.mainForm.getValue("description");data.internalID=this.mainForm.getValue("internalID");data.quantType=this.mainForm.getValue("quantType");
data.preMitData1=this.preMitPane.probInputForm.getValues();data.preMitData2=this.preMitPane.descreteGrid.getData();data.postMitData1=this.postMitPane.probInputForm.getValues();data.postMitData2=this.postMitPane.descreteGrid.getData();
return data;},clear:function(){this.mainForm.clearValues();this.preMitPane.clear();this.postMitPane.clear();},initWidget:function(){this.Super("initWidget",arguments);var toolStrip=isc.HLayout.create({membersMargin:5,members:[isc.Label.create({contents:"",width:"100%"}),isc.IButton.create({title:"Save",width:100,click:function(){try{isc.RPCManager.sendRequest({actionURL:"./saveConsequences",evalResult:true,params:{DATA:JSON.stringify(this.parentElement.parentElement.getData()),RISKID:qoRiskController.riskID},callback:function(rpcResponse,data,rpcRequest){try{for(var i=0;
i<data.length;i++){try{data[i].type=data[i].quantImpactType.description+" ("+data[i].quantImpactType.units+")";}catch(e){isc.say(e.message);}}}catch(e){isc.say(e.message);}try{riskEditorConsequenceTable.setData(data);
contingencyForm.getItem("saveContingencyButton").setDisabled(true);contingencyForm.clearValues();contingencyForm2.getItem("viewState").setDisabled(true);contingencyGraph.setSrc("[SKIN]grid.gif");qoRiskController.currentRisk.probConsequenceNodes=data;
updateConsequnceTable();riskConsequenceEditor.closeClick();}catch(e){isc.say(e.message);}}});}catch(e){isc.say(e);}}}),isc.IButton.create({title:"Cancel",width:100,click:function(){riskConsequenceEditor.closeClick();
}})]});this.mainForm=isc.DynamicForm.create({titleOrientation:"left",autoDraw:false,titleWidth:140,width:"100%",items:[{name:"internalID",type:"hidden",defaultValue:0},{startRow:true,width:500,name:"description",title:"Consequence",defaultValue:"Enter description of the consequence",required:true},{startRow:true,name:"quantType",width:300,title:"Consequence Type",editorType:"select",defaultValue:2,valueMap:qoValueMap.quantTypes}]});
try{this.preMitPane=isc.RiskConsequenceProbWidget.create({height:"100%",preMit:false});this.preMitPane.setMitState(true);this.postMitPane=isc.RiskConsequenceProbWidget.create({height:"100%",preMit:false});
this.postMitPane.setMitState(false);}catch(e){isc.say(e);}this.addMembers([this.mainForm,this.preMitPane,this.postMitPane,toolStrip]);if(qoQRM.singlePhase){this.postMitPane.hide();}}});return layout;};
this.getRiskEditorProbImpactLayout=function(){isc.VLayout.create({membersMargin:5,backgroundColor:"white",dirty:false,ID:"riskProbImpactLayout",setDirty:function(){this.dirty=true;riskEditorDirty();},setAndCalcFormProb:function(){try{this.setAndCalcFormProbInternal(true);
if(!qoQRM.singlePhase){this.setAndCalcFormProbInternal(false);}}catch(e){isc.say(e.message);}},setAndCalcFormProbInternal:function(preMit){var type=(preMit)?probImpactFreqForm.getItem("liketype").getValue():probImpactFreqForm.getItem("likepostType").getValue();
var num=(preMit)?probImpactFreqForm.getItem("liket").getValue():probImpactFreqForm.getItem("likepostT").getValue();var occ=(preMit)?probImpactFreqForm.getItem("likealpha").getValue():probImpactFreqForm.getItem("likepostAlpha").getValue();
try{var T=0;switch(parseInt(type,10)){case 1:T=365;break;case 2:T=30;break;case 3:T=parseFloat(num);break;default:}if(preMit){qoRiskController.currentRisk.liketype=parseInt(type,10);qoRiskController.currentRisk.liket=T;
qoRiskController.currentRisk.likealpha=parseFloat(occ);if(qoQRM.singlePhase){qoRiskController.currentRisk.likepostType=parseInt(type,10);qoRiskController.currentRisk.likepostT=T;qoRiskController.currentRisk.likepostAlpha=parseFloat(occ);
}}else{qoRiskController.currentRisk.likepostType=parseInt(type,10);qoRiskController.currentRisk.likepostT=T;qoRiskController.currentRisk.likepostAlpha=parseFloat(occ);}var prob=calcProb(qoRiskController.currentRisk,preMit);
if(isNaN(prob)){prob=0;}if(preMit){probImpactFreqForm.getItem("prob").setValue(qoQRM.roundDoubleStr(prob,2));qoRiskController.currentRisk.inherentProb=probToMatrix(prob,project.matrix);}else{probImpactFreqForm.getItem("probPost").setValue(qoQRM.roundDoubleStr(prob,2));
qoRiskController.currentRisk.treatedProb=probToMatrix(prob,project.matrix);}qoRiskController.currentRisk.inherentImpact=probImpactMatrixImgPreMitImg.getImpact();qoRiskController.currentRisk.treatedImpact=probImpactMatrixImgPostMitImg.getImpact();
var rsk=qoRiskController.currentRisk;try{probImpactMatrixImg.removeChild(probImpactMatrixImgPreMitImg);probImpactMatrixImgPreMitImg.destroy();}catch(err){}try{probImpactMatrixImg.removeChild(probImpactMatrixImgPostMitImg);
probImpactMatrixImgPostMitImg.destroy();}catch(err){}isc.RiskMatrixItem.create({ID:"probImpactMatrixImgPreMitImg",preMit:true,hostImg:probImpactMatrixImg,treatedImpact:rsk.treatedImpact,treatedProb:rsk.treatedProb,untreatedImpact:rsk.inherentImpact,untreatedProb:rsk.inherentProb,contents:rsk.riskProjectCode,baseStyle:"matrixWidgetUnTreated"});
probImpactMatrixImg.addChild(probImpactMatrixImgPreMitImg);probImpactMatrixImgPreMitImg.setposition();isc.RiskMatrixItem.create({ID:"probImpactMatrixImgPostMitImg",preMit:false,hostImg:probImpactMatrixImg,treatedImpact:rsk.treatedImpact,treatedProb:rsk.treatedProb,untreatedImpact:rsk.inherentImpact,untreatedProb:rsk.inherentProb,contents:rsk.riskProjectCode,baseStyle:"matrixWidgetTreated"});
probImpactMatrixImg.addChild(probImpactMatrixImgPostMitImg);probImpactMatrixImgPostMitImg.setposition();if(qoQRM.singlePhase){if(rsk.treated){probImpactMatrixImgPreMitImg.baseStyle="matrixWidgetTreated";
}else{probImpactMatrixImgPreMitImg.baseStyle="matrixWidgetUnTreated";}probImpactMatrixImgPostMitImg.hide();}probImpactMatrixImgPreMitImg.redraw();probImpactMatrixImgPostMitImg.redraw();}catch(e){isc.say(e.message);
}},setSinglePhase:function(sPhase,rsk){try{if(sPhase){if(rsk.treated){probImpactFreqForm.getItem("headerUnTreated").setValue("Treated State");probImpactMatrixImgPreMitImg.baseStyle="matrixWidgetTreated";
}else{probImpactFreqForm.getItem("headerUnTreated").setValue("Un Treated State");probImpactMatrixImgPreMitImg.baseStyle="matrixWidgetUnTreated";}probImpactMatrixImgPostMitImg.hide();}else{probImpactFreqForm.getItem("headerUnTreated").setValue("Un Treated State");
probImpactMatrixImgPreMitImg.baseStyle="matrixWidgetUnTreated";probImpactMatrixImgPostMitImg.baseStyle="matrixWidgetTreated";probImpactMatrixImgPostMitImg.show();}probImpactMatrixImgPreMitImg.redraw();
probImpactMatrixImgPostMitImg.redraw();probImpactFreqForm.redraw();}catch(e){isc.say("Prob/Impact setSingle Phase "+e.message);}}});isc.Img.create({src:"[SKIN]grid.gif",height:300,width:300,ID:"probImpactMatrixImg",imageType:"normal",autoDraw:false,setDirty:function(){riskProbImpactLayout.setDirty();
try{this.setFormProb();}catch(e){isc.say(e.message);}},setFormProb:function(){probImpactFreqForm.getItem("prob").setValue(qoQRM.roundDoubleStr(probFromMatrix(probImpactMatrixImgPreMitImg.getProb(),project.matrix),2));
probImpactFreqForm.getItem("probPost").setValue(qoQRM.roundDoubleStr(probFromMatrix(probImpactMatrixImgPostMitImg.getProb(),project.matrix),2));probImpactFreqForm.getItem("useCalculatedProb").setValue(false);
probImpactFreqForm.setFormState(probImpactFreqForm,false);},setMatrix:function(rsk){this.setSrc(Page.getAppDir()+"getRelMatrix?WIDTH="+this.getWidth()+"&HEIGHT="+this.getHeight()+"&REQUIRERISKS=NO&PROJECTID="+project.projectID+"&DESCENDANTS=false&NOCACHE="+Math.random());
try{this.removeChild(probImpactMatrixImgPreMitImg);probImpactMatrixImgPreMitImg.destroy();}catch(err){}try{this.removeChild(probImpactMatrixImgPostMitImg);probImpactMatrixImgPostMitImg.destroy();}catch(err){}isc.RiskMatrixItem.create({ID:"probImpactMatrixImgPreMitImg",preMit:true,hostImg:probImpactMatrixImg,treatedImpact:rsk.treatedImpact,treatedProb:rsk.treatedProb,untreatedImpact:rsk.inherentImpact,untreatedProb:rsk.inherentProb,contents:rsk.riskProjectCode,baseStyle:"matrixWidgetUnTreated"});
this.addChild(probImpactMatrixImgPreMitImg);probImpactMatrixImgPreMitImg.setposition();isc.RiskMatrixItem.create({ID:"probImpactMatrixImgPostMitImg",preMit:false,hostImg:probImpactMatrixImg,treatedImpact:rsk.treatedImpact,treatedProb:rsk.treatedProb,untreatedImpact:rsk.inherentImpact,untreatedProb:rsk.inherentProb,contents:rsk.riskProjectCode,baseStyle:"matrixWidgetTreated"});
this.addChild(probImpactMatrixImgPostMitImg);probImpactMatrixImgPostMitImg.setposition();}});isc.VStack.create({ID:"probImpactInfoLayout",members:[isc.HLayout.create({height:35,membersMargin:10,members:[isc.Label.create({height:30,width:60,align:"center",valign:"center",wrap:false,contents:"Risk ID",baseStyle:"matrixWidgetUnTreated"}),isc.Label.create({height:30,width:200,align:"left",valign:"center",contents:"<b>Un Treated</b> Probability/Impact"})]}),isc.HLayout.create({height:35,membersMargin:10,members:[isc.Label.create({height:30,width:60,align:"center",valign:"center",wrap:false,contents:"Risk ID",baseStyle:"matrixWidgetTreated"}),isc.Label.create({height:30,width:200,align:"left",valign:"center",contents:"<b>Treated</b> Probability/Impact"})]})]});
isc.DynamicForm.create({autoDraw:false,ID:"probImpactFreqForm",width:380,colWidths:[190,190],titleOrientation:"left",setFormState:function(form,value){try{form.getItem("likealpha").setDisabled(!value);
form.getItem("liket").setDisabled(!value||!(form.getItem("liketype").getValue()==3));form.getItem("liketype").setDisabled(!value);form.getItem("likepostAlpha").setDisabled(!value);form.getItem("likepostT").setDisabled(!value||!(form.getItem("likepostType").getValue()==3));
form.getItem("likepostType").setDisabled(!value);}catch(e){isc.say(e.message);}},fields:[{defaultValue:false,align:"left",name:"useCalculatedProb",title:"Use Calculated Probability",type:"CheckboxItem",changed:function(form,item,value){try{probImpactFreqForm.setFormState(form,value);
riskProbImpactLayout.setAndCalcFormProb();riskProbImpactLayout.dirty=true;riskEditorDirty();}catch(e){isc.say(e.message);}}},{name:"headerUnTreated",type:"header",defaultValue:"Untreated State"},{width:160,title:"Frequency Type",defaultValue:1,type:"Select",autoFetchData:false,disabled:true,redrawOnChange:true,changed:function(form,item,value){if(value<3){form.getItem("liket").setDisabled(true);
}else{form.getItem("liket").setDisabled(false);}form.getItem("likealpha").setDisabled(false);riskProbImpactLayout.setAndCalcFormProbInternal(true);riskProbImpactLayout.dirty=true;riskEditorDirty();},name:"liketype",valueMap:{1:"Frequency per Year",2:"Frequency per Month",3:"Frequency per Days"}},{title:"Frequency of Occurances",editorType:"text",keyPressFilter:"[0-9.]",validators:[{type:"isFloat",min:0}],disabled:true,width:50,name:"likealpha",changed:function(form,item,value){try{riskProbImpactLayout.setAndCalcFormProbInternal(true);
riskProbImpactLayout.dirty=true;}catch(e){isc.say(e.message);}riskEditorDirty();}},{name:"liket",title:"Number of Days",editorType:"text",keyPressFilter:"[0-9]",validators:[{type:"isInteger"}],width:50,disabled:true,changed:function(form,item,value){try{riskProbImpactLayout.setAndCalcFormProbInternal(true);
riskProbImpactLayout.dirty=true;}catch(e){isc.say(e.message);}riskEditorDirty();}},{name:"prob",canEdit:false,title:"Probability",type:"StaticTextItem"},{type:"header",showIf:"(!qoQRM.singlePhase)",defaultValue:"Treated State"},{width:160,title:"Frequency Type",defaultValue:1,showIf:"(!qoQRM.singlePhase)",type:"Select",autoFetchData:false,disabled:true,changed:function(form,item,value){if(value<3){form.getItem("likepostT").setDisabled(true);
}else{form.getItem("likepostT").setDisabled(false);}form.getItem("likepostAlpha").setDisabled(false);riskProbImpactLayout.setAndCalcFormProbInternal(false);riskProbImpactLayout.dirty=true;riskEditorDirty();
},name:"likepostType",valueMap:{1:"Frequency per Year",2:"Frequency per Month",3:"Frequency per Days"}},{title:"Frequency of Occurances",editorType:"text",keyPressFilter:"[0-9.]",validators:[{type:"isFloat",min:0}],disabled:true,showIf:"(!qoQRM.singlePhase)",width:50,name:"likepostAlpha",changed:function(form,item,value){try{riskProbImpactLayout.setAndCalcFormProbInternal(false);
riskProbImpactLayout.dirty=true;}catch(e){isc.say(e.message);}riskEditorDirty();}},{name:"likepostT",title:"Number of Days",editorType:"text",showIf:"(!qoQRM.singlePhase)",keyPressFilter:"[0-9]",validators:[{type:"isInteger"}],disabled:true,width:50,changed:function(form,item,value){try{riskProbImpactLayout.setAndCalcFormProbInternal(false);
riskProbImpactLayout.dirty=true;}catch(e){isc.say(e.message);}riskEditorDirty();}},{name:"probPost",canEdit:false,showIf:"(!qoQRM.singlePhase)",title:"Probability",type:"StaticTextItem"}]});var top=isc.HLayout.create({backgroundColor:"white",height:"100%",border:"1px solid lightgray",layoutMargin:5});
isc.VLayout.create({ID:"probImpactMatStack",membersMargin:0,width:300,members:[probImpactMatrixImg]});top.addMembers([probImpactMatStack,probImpactFreqForm]);var rightLayout=isc.HLayout.create({width:"100%",members:[isc.VLayout.create({ID:"probImpactProbDescLayout",wdith:"50%"}),isc.VLayout.create({ID:"probImpactImpactDescLayout",wdith:"50%"})]});
var bottomLeft=isc.VLayout.create({width:320,members:[probImpactInfoLayout,isc.VLayout.create({ID:"probImpactDescriptionLayout"})]});var bottom=isc.HLayout.create({height:150,border:"1px solid lightgray",layoutMargin:5,membersMargin:5});
bottom.addMembers([bottomLeft,rightLayout]);riskProbImpactLayout.addMember(top);riskProbImpactLayout.addMember(bottom);return riskProbImpactLayout;};this.getRiskEditorReviewLayout=function(){return isc.VLayout.create({ID:"riskReviewLayout",membersMargin:5,members:[isc.HLayout.create({height:30,width:"100%",align:"right",layoutMargin:5,members:[isc.QRMRiskEditorLabel.create({title:"Scheduled Reviews for this Risk"})]}),isc.ListGrid.create({ID:"riskReviewLayoutRevTable",autoDraw:false,alternateRecordStyles:true,height:"70%",emptyMessage:"No Reviews Scheduled for this Risk",fields:[{name:"title",title:"Review Title",width:"100%",align:"left"},{name:"comment",title:"Review Comment For Risk",width:"100%",align:"left"},{name:"scheduleDate",title:"Scheduled Date",width:100,align:"center",type:"date"},{name:"actualDate",title:"Actual Date",width:100,align:"center",type:"date"}]}),isc.HLayout.create({height:30,width:"100%",align:"right",layoutMargin:5,members:[isc.QRMRiskEditorLabel.create({title:"Process Audits Milestones"}),isc.QRMAddButton.create({title:"Schedule Review",width:120,click:function(){scheduleReview();
}})]}),isc.ListGrid.create({ID:"riskReviewLayoutAuditTable",alternateRecordStyles:true,wrapCells:true,fixedRecordHeights:false,height:"100%",fields:[{name:"step",title:"Audit Point",width:160,align:"left"},{name:"dateEntered",title:"Date",width:100,align:"center",formatCellValue:function(value){if(value){return value.getShortMonthName()+" "+value.getDate()+", "+value.getFullYear();
}}},{name:"personName",title:"Person",width:130,align:"center"},{name:"comment",title:"Comment",width:"100%",align:"left"}],getCellCSSText:function(record,rowNum,colNum){if(record.dateEntered==null){return"color:red;vertical-align:top";
}else{return"color:blue;vertical-align:top";}}}),isc.HLayout.create({height:24,width:"100%",align:"right",members:[isc.QRMAddButton.create({title:"Register Audit",showDisabledIcon:true,width:120,click:function(){newAudit();
}})]})]});};this.getRiskEditorChildRiskLayout=function(){return isc.VLayout.create({membersMargin:0,ID:"riskChildRiskLayout",dirty:false,initWidget:function(){this.Super("initWidget",arguments);this.table=isc.ListGrid.create({height:"100%",ID:"ChildRiskTable",dataSource:riskLiteDS,alternateRecordStyles:true,emptyMessage:"No Contributing Risks Allocated to this Summary Risk",showGridSummary:true,sortField:"currentTolerance",sortDirection:"descending",canExpandRecords:true,expansionMode:"details",selectionAppearance:"checkbox",getBaseStyle:function(record,rowNum,colNum){if(colNum==0||colNum==1||colNum==2){return"rankItem"+record.currentTolerance;
}else{return this.Super("getBaseStyle",arguments);}},fields:[{name:"riskProjectCode",title:"Risk Code",width:85,canGroupBy:false,align:"left",includeInRecordSummary:false,summaryFunction:"count",pluralTitle:"Risks",canReorder:false,formatCellValue:function(value,record){if(record.promotionCode!="-"){return value+" ("+record.toProjCode+")";
}else{return value;}}},{name:"currentTolerance",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,title:"Tolerance",type:"image",align:"center",width:70,canReorder:false,canGroupBy:true,imageURLPrefix:"tol",imageURLSuffix:".png",getGroupValue:function(value,record,field,fieldName,grid){return value;
},getGroupTitle:function(groupValue,groupNode,field,fieldName,grid){switch(groupValue){case 5:return"Extreme";break;case 4:return"High";break;case 3:return"Significant";break;case 2:return"Moderate";break;
case 1:return"Low";break;}}},{name:"title",title:"Title",align:"left",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,width:"100%"},{name:"ownerName",title:"Owner",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,width:120},{name:"manager1Name",title:"Manager",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,width:120,canGroupBy:true,showIf:"false"},{name:"treatedImpact",title:"Treated Impact",type:"float",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,width:40,formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);
}return value;},showIf:"false"},{name:"treatedProb",title:"Treated Prob",type:"float",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,width:40,formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);
}return value;},showIf:"false"},{name:"inherentImpact",title:"Inherent Impact",type:"float",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,width:40,formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);
}return value;},showIf:"false"},{name:"inherentProb",title:"Inherent Prob",type:"float",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,align:"center",width:40,formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);
}return value;},showIf:"false"},{name:"riskID",title:"Risk ID",type:"integer",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,align:"center",width:0,canGroupBy:false,showIf:"false"},{name:"active",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,title:"Active",type:"boolean",canGroupBy:true,width:55,getGroupTitle:function(groupValue,groupNode,field,fieldName,grid){if(groupValue){return"Active Risks";
}else{return"Dormant Risks";}}},{name:"treated",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,title:"Treated",type:"boolean",canGroupBy:true,width:55}],expansionDetailsProperties:{height:200,width:"100%",overflow:"scroll",fields:[{name:"riskProjectCode",title:"Risk Code",canEdit:false,width:60,align:"left"},{name:"title",title:"Title",align:"left",width:"100%"},{name:"description",title:"Description",align:"left",width:"100%"},{name:"startExposure",title:"Start of Exposure",type:"date",align:"center",width:120,formatCellValue:function(value){if(value){return value.getShortMonthName()+" "+value.getDate()+", "+value.getFullYear();
}}},{name:"endExposure",title:"End of Exposure",type:"date",align:"center",width:120,formatCellValue:function(value){if(value){return value.getShortMonthName()+" "+value.getDate()+", "+value.getFullYear();
}}},{name:"ownerName",title:"Owner",align:"center",width:120},{name:"manager1Name",title:"Manager",align:"center",width:120},{name:"treatedImpact",title:"Treated Impact",type:"double",align:"center",formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);
}return value;}},{name:"treatedProb",title:"Treated Prob",type:"double",align:"center",formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);}return value;}},{name:"inherentImpact",title:"Inherent Impact",type:"double",align:"center",formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);
}return value;}},{name:"inherentProb",title:"Inherent Prob",type:"double",align:"center",formatCellValue:function(value){if(isc.isA.Number(value)){return Math.floor(value);}return value;}},{name:"treated",title:"Treated",type:"boolean",width:55,formatCellValue:function(value){if(value){return"Yes";
}return"No";}}]}});try{isc.ToolStrip.create({ID:"childButtonLayout",width:"100%",height:24,border:"1px solid "+qrmCtrlColor,backgroundColor:qrmCtrlColor,members:[isc.Label.create({contents:"",height:20,width:"100%"}),isc.ToolStripButton.create({icon:"icons/16/icon_add_files.png",title:"Add Contributiong Risk",click:function(){isc.say('Close this Risk Editor and use the "Summary and Propogated Risks" main tab to associate contributing risks');
}}),isc.ToolStripMenuButton.create({title:"Selected Risks",showRollOver:false,menu:isc.Menu.create({showShadow:true,shadowDepth:10,data:[{title:"Remove as a Contributing Risk",icon:"[SKIN]/actions/remove.png",enableIf:"(ChildRiskTable.getSelection().length > 0)?true:false",click:function(){try{isc.RPCManager.sendRequest({actionURL:"./removeContributingRisk",prompt:"Removing Contributing Risks",evalResult:false,params:{PROJECTID:projectID,RISKID:qoRiskController.currentRisk.riskID,RISKS:JSON.stringify(ChildRiskTable.getSelection())},callback:function(rpcResponse,data2,rpcRequest){ChildRiskTable.fetchData({PROJECTID:projectID,OPERATION:"getRiskLiteFetch",PARENTRISKID:qoRiskController.currentRisk.riskID,DESCENDANTS:true,NOCACHE:Math.random()});
isc.say(data2);}});}catch(e){alert(e.message);}}},{isSeparator:true},{title:"Request Update from Risk Owner",icon:"icons/16/person_into.png",enableIf:"(ChildRiskTable.getSelection().length > 0)?true:false",click:function(){alert("Request Owner");
}},{title:"Request Update from Risk Manager",icon:"icons/16/person_into.png",enableIf:"(ChildRiskTable.getSelection().length > 0)?true:false",click:function(){alert("Request Manager");}}]})})]});}catch(e){alert(e.message);
}this.table2=isc.ListGrid.create({height:"100%",ID:"ChildStakeHolderTable",dataSource:allRiskStakeholdersDS,sortField:"name",sortDirection:"descending",alternateRecordStyles:true,emptyMessage:"No Contributing Stakeholders to this Risk",selectionAppearance:"checkbox",fields:[{name:"name",title:"Stakeholder",width:200,align:"left"},{name:"email",title:"Email Address",align:"left",width:"100%"},{name:"compoundName",title:"Role",align:"left",width:"300"}]});
try{isc.ToolStrip.create({ID:"childStakeHolderButtonLayout",width:"100%",height:24,border:"1px solid "+qrmCtrlColor,backgroundColor:qrmCtrlColor,members:[isc.Label.create({contents:"",height:20,width:"100%"}),isc.ToolStripButton.create({title:"Add Contributing Stakeholder",icon:"icons/16/person.png",click:function(){qoRiskEditor.addStakeholderToRisk();
}}),isc.ToolStripMenuButton.create({title:"Selected Stakeholders",showRollOver:false,menu:isc.Menu.create({showShadow:true,shadowDepth:10,data:[{title:"Remove as a Contributing Stakeholder",icon:"icons/16/folder_out.png",enableIf:"(ChildStakeHolderTable.getSelection().length > 0)?true:false",click:function(){try{isc.RPCManager.sendRequest({actionURL:"./removeContributingRiskStakeholder",prompt:"Removing Stakeholder",evalResult:false,params:{RISKID:qoRiskController.currentRisk.riskID,STAKEHOLDERS:JSON.stringify(ChildStakeHolderTable.getSelection())},callback:function(rpcResponse,data2,rpcRequest){ChildStakeHolderTable.fetchData({PROJECTID:projectID,RISKID:qoRiskController.currentRisk.riskID,NOCACHE:Math.random()});
isc.say(data2);}});}catch(e){alert(e.message);}}},{isSeparator:true},{title:"Request Update from Stakeholder",icon:"icons/16/disk_blue.png",enableIf:"(ChildStakeHolderTable.getSelection().length > 0)?true:false",click:function(){alert("Request Stakeholder");
}}]})})]});}catch(e){alert(e.message);}this.addMembers([isc.QRMRiskEditorLabel.create({title:"Contributing Risks",height:30,ID:"IDContributingRiskLabel"}),childButtonLayout,this.table,isc.QRMRiskEditorLabel.create({title:"Contributing Stakeholders",height:40}),childStakeHolderButtonLayout,this.table2]);
}});};this.addStakeholderToRisk=function(){isc.Window.create({title:"Add Contributing Stakeholder To Risk",ID:"addRiskStakeholderWin",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,showMinimizeButton:false,autoDraw:true,closeClick:function(){this.Super("closeClick",arguments);
},items:[isc.DynamicForm.create({width:550,titleWidth:180,padding:10,ID:"addRiskStakeholderForm",fields:[{type:"header",defaultValue:"Add Stakeholder to Risk"},{name:"RowSpacerItem0",_constructor:"RowSpacerItem"},{name:"stakeholder",width:320,title:"Contributing Stakeholder",type:"comboBox",allowEmptyValue:false,optionDataSource:"allUsersDS",pickListWidth:320,displayField:"compoundName",valueField:"stakeholderID",required:true},{name:"role",showTitle:true,editorType:"text",title:"Role",width:320,required:true},{name:"RowSpacerItem0",_constructor:"RowSpacerItem"},{name:"validateBtn",title:"Submit",type:"button",align:"right",colSpan:2,click:function(){addRiskStakeholderWin.hide();
try{isc.RPCManager.sendRequest({actionURL:"./addRiskStakeholder",prompt:"Adding Stakeholder",evalResult:false,params:{RISKID:qoRiskController.currentRisk.riskID,STAKEHOLDERID:addRiskStakeholderForm.getValue("stakeholder"),ROLE:addRiskStakeholderForm.getValue("role")},callback:function(rpcResponse,data2,rpcRequest){ChildStakeHolderTable.fetchData({PROJECTID:projectID,RISKID:qoRiskController.currentRisk.riskID,NOCACHE:Math.random()});
isc.say(data2);}});}catch(e){alert(e.message);}}}]})]});};this.getRiskEditorObjectiveLayout=function(){return isc.VLayout.create({ID:"ObjectiveLayout",height:"100%",width:"100%",membersMargin:5,members:[isc.QRMRiskEditorLabel.create({title:"Objectives Impacted"}),isc.TreeGrid.create({ID:"RiskObjectiveTree",height:"100%",width:"100%",cursor:"hand",showConnectors:true,nodeIcon:"[SKIN]file.png",folderIcon:"[SKIN]file.png",closedIconSuffix:"",showOpenIcons:false,showDropIcons:false,rowClick:function(record,recordNum,fieldNum){record.active=!record.active;
RiskObjectiveTree.redraw();var activeRecords=RiskObjectiveTree.data.data.findAll("active",true);var idsRec=new Array();if(activeRecords!=null){for(var i=0;i<activeRecords.length;i++){idsRec.add(activeRecords[i].objectiveID);
}}else{idsRec.add(-1);}isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({promptStyle:"cursor",evalResult:false,params:{DATA:JSON.stringify(idsRec),RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(rpcResponse,data,rpcRequest){if(data=="false"){isc.say("You do not have updates rights on this risk\nChanges not saved");
}},actionURL:"./saveRiskObjectives"});},getCellCSSText:function(record,rowNum,colNum){if(rowNum==0){return"color:black;";}if(colNum==0){if(record.active){return"color:red;";}}}})]});};this.getRiskEditorResponseLayout=function(){return isc.VLayout.create({membersMargin:5,ID:"riskResponseLayout",dirty:false,deleteResponse:function(){isc.RPCManager.sendRequest({prompt:"Deleting Response Step",showPrompt:true,evalResult:false,actionURL:"./deleteRiskMitigation",params:{DATA:JSON.stringify(riskEditorResponseTable.getSelection().getProperty("mitstepID")),PROJECTID:project.projectID,RISKID:qoRiskController.currentRisk.riskID},callback:function(rpcResponse,data,rpcRequest){try{var resPlan=JSON.parse(data,dateParser).mitigationPlan.findAll("response",1);
if(resPlan==null){riskEditorResponseTable.setData([]);}else{riskEditorResponseTable.setData(resPlan);}}catch(e){isc.say(e.message);}}});},showMainButtons:function(show){if(show){responseNewStepBtn.show();
responseEditBtn.show();responseDeleteBtn.show();responseCancelEditBtn.hide();responseFinishEditBtn.hide();}else{responseNewStepBtn.hide();responseEditBtn.hide();responseDeleteBtn.hide();responseCancelEditBtn.show();
responseFinishEditBtn.show();}},initWidget:function(){this.Super("initWidget",arguments);this.toolStrip=isc.HLayout.create({width:"100%",align:"right",membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);
this.newBtn=isc.QRMAddButton.create({ID:"responseNewStepBtn",title:"Create New",click:function(){isc.RPCManager.sendRequest({prompt:"Adding Response Action",showPrompt:true,evalResult:false,actionURL:"./newRiskMitigation",params:{PROJECTID:project.projectID,RESPONSE:true,RISKID:qoRiskController.currentRisk.riskID},callback:function(rpcResponse,data,rpcRequest){try{var riskTemp=JSON.parse(data,dateParser);
var mitPlan=riskTemp.mitigationPlan.findAll("response",1);if(mitPlan==null){riskEditorResponseTable.setData([]);}else{riskEditorResponseTable.setData(mitPlan);}}catch(e){isc.say(e.message);}}});}});this.delBtn=isc.QRMDeleteButton.create({ID:"responseDeleteBtn",disabled:true,click:function(){riskResponseLayout.deleteResponse();
}});this.editBtn=isc.QRMEditButton.create({ID:"responseEditBtn",disabled:true,click:function(){this.parentElement.parentElement.table.editSelectedRecord();}});this.cancelBtn=isc.QRMCancelButton.create({ID:"responseCancelEditBtn",title:"Cancel Edits",disabled:true,click:function(){this.parentElement.parentElement.table.cancelEditing();
}});this.finishBtn=isc.QRMFinishButton.create({ID:"responseFinishEditBtn",title:"Finish Edits",disabled:true,click:function(){this.parentElement.parentElement.table.endEditing();}});this.addMembers([this.editBtn,this.delBtn,this.newBtn,this.cancelBtn,this.finishBtn]);
}});this.table=isc.ListGrid.create({ID:"riskEditorResponseTable",autoDraw:false,alternateRecordStyles:true,wrapCells:true,fixedRecordHeights:false,height:"100%",confirmCancelEditing:false,confirmDiscardEdits:false,showGridSummary:true,selectionAppearance:"checkbox",editComplete:function(rowNum,colNum,newValues,oldValues,editCompletionEvent){riskResponseLayout.showMainButtons(true);
this.parentElement.dirty=true;isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({evalResult:false,actionURL:"./saveRiskResponse",prompt:"Updating Response Action",params:{DATA:JSON.stringify(this.getData()),RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(rpcResponse,data,rpcRequest){try{var resPlan=JSON.parse(data,dateParser).mitigationPlan.findAll("response",1);
if(resPlan==null){riskEditorResponseTable.setData([]);}else{riskEditorResponseTable.setData(resPlan);}qoRiskController.dirty=true;}catch(e){isc.say(e.message);}}});},editorExit:function(editCompletionEvent,record,newValue,rowNum,colNum){riskResponseLayout.showMainButtons(true);
this.parentElement.toolStrip.cancelBtn.setDisabled(true);this.parentElement.toolStrip.finishBtn.setDisabled(true);this.parentElement.toolStrip.delBtn.setDisabled(true);this.parentElement.toolStrip.editBtn.setDisabled(true);
return true;},emptyMessage:"No Response Actions Defined",fields:[{name:"description",title:"Description",canEdit:true,width:"100%",align:"left",summaryFunction:"count",pluralTitle:"Response Actions",editorType:"textArea",editorProperties:{height:40}}],recordClick:function(){this.parentElement.toolStrip.delBtn.setDisabled(false);
this.parentElement.toolStrip.editBtn.setDisabled(false);},editSelectedRecord:function(){riskResponseLayout.showMainButtons(false);this.startEditing(this.getRecordIndex(this.getSelectedRecord()));},editorEnter:function(){riskResponseLayout.showMainButtons(false);
this.setValueMap(1,qoValueMap.manager);this.parentElement.toolStrip.cancelBtn.setDisabled(false);this.parentElement.toolStrip.finishBtn.setDisabled(false);},selectionChanged:function(record,state){this.parentElement.toolStrip.editBtn.setDisabled(!state);
this.parentElement.toolStrip.delBtn.setDisabled(!state);}});this.addMember(isc.QRMRiskEditorLabel.create({title:"Response Plan"}));this.addMembers([this.table,this.toolStrip]);}});};this.riskEditorTabSelected=function(tabNum,tabPane,ID,tab){qoCurrent.TabNum=tabNum;
qoCurrent.TabPane=tabPane;qoCurrent.TabID=ID;qoCurrent.Tab=tab;try{riskMitigationLayout.table.cancelEditing();riskMitigationLayout.showMainButtons(true);riskResponseLayout.table.cancelEditing();riskResponseLayout.showMainButtons(true);
riskControlLayout.table.cancelEditing();riskControlLayout.showMainButtons(true);}catch(e){}try{if(tabPane.ID=="riskChildRiskLayout"){try{ChildRiskTable.fetchData({PROJECTID:projectID,OPERATION:"getRiskLiteFetch",PARENTRISKID:qoRiskController.currentRisk.riskID,DESCENDANTS:true,NOCACHE:Math.random()});
ChildStakeHolderTable.fetchData({PROJECTID:projectID,RISKID:qoRiskController.currentRisk.riskID,NOCACHE:Math.random()});}catch(e){alert(e);}if(qoRiskController.currentRisk.summaryRisk||qoRiskController.currentRisk.forceDownParent){ChildRiskTable.show();
childButtonLayout.show();IDContributingRiskLabel.show();}else{ChildRiskTable.hide();childButtonLayout.hide();IDContributingRiskLabel.hide();}}if(tabPane.ID=="riskAttachmentLayout"){getRiskAttachments();
}if(tabPane.ID=="riskCommentLayout"){getRiskComments();}if(tabPane.ID=="riskReviewLayout"){getRiskReviewLayoutData();getRiskAuditData();}if(tabPane.ID=="riskConsequenceLayout"){updateConsequnceTable();
updateRiskEditorContingency();}if(tabPane.ID=="riskProbImpactLayout"&&!riskProbImpactLayout.dirty){probImpactMatrixImg.setMatrix(qoRiskController.currentRisk);probImpactFreqForm.clearValues();if(qoRiskController.currentRisk.useCalculatedProb){probImpactFreqForm.setValue("liketype",qoRiskController.currentRisk.liketype);
probImpactFreqForm.setValue("likealpha",qoRiskController.currentRisk.likealpha);if(qoRiskController.currentRisk.liketype==3){probImpactFreqForm.setValue("liket",qoRiskController.currentRisk.liket);}else{probImpactFreqForm.setValue("liket",0);
}probImpactFreqForm.setValue("useCalculatedProb","true");probImpactFreqForm.setFormState(probImpactFreqForm,true);probImpactFreqForm.setValue("likepostType",qoRiskController.currentRisk.likepostType);probImpactFreqForm.setValue("likepostAlpha",qoRiskController.currentRisk.likepostAlpha);
if(qoRiskController.currentRisk.liketype==3){probImpactFreqForm.setValue("likepostT",qoRiskController.currentRisk.likepostT);}else{probImpactFreqForm.setValue("likepostT",0);}var prob=calcProb(qoRiskController.currentRisk,true);
if(isNaN(prob)){prob=0;}probImpactFreqForm.getItem("prob").setValue(qoQRM.roundDoubleStr(prob,2));prob=calcProb(qoRiskController.currentRisk,false);if(isNaN(prob)){prob=0;}probImpactFreqForm.getItem("probPost").setValue(qoQRM.roundDoubleStr(prob,2));
}else{probImpactMatrixImg.setFormProb();}probImpactFreqForm.setValue("useCalculatedProb",qoRiskController.currentRisk.useCalculatedProb);probImpactFreqForm.setFormState(probImpactFreqForm,qoRiskController.currentRisk.useCalculatedProb);
probImpactProbDescLayout.removeMembers(probImpactProbDescLayout.members);probImpactProbDescLayout.addMember(isc.Label.create({contents:"<div style='margin-bottom:15px;font-size:12px;font-weight:bold;font-famliy:Verdana,sans-serif'>Probability Descriptions</div>",height:20}));
for(var p=1;p<=qoCurrent.Matrix.maxProb;p++){var str1=eval("qoCurrent.Matrix.prob"+p);var val=eval("qoCurrent.Matrix.probVal"+p);var cont="<span style='margin:20px'><b>"+p+" - "+str1+"</b>&nbsp;&nbsp;&nbsp;<i>Pr()< "+val+"</i></span>";
probImpactProbDescLayout.addMember(isc.Label.create({contents:cont,height:20}));}probImpactDescriptionLayout.removeMembers(probImpactDescriptionLayout.members);probImpactImpactDescLayout.removeMembers(probImpactImpactDescLayout.members);
probImpactImpactDescLayout.addMember(isc.Label.create({contents:"<div style='margin-bottom:15px;font-size:12px;font-weight:bold;font-famliy:Verdana,sans-serif'>Impact Descriptions</div>",height:20}));for(var p=1;
p<=qoCurrent.Matrix.maxImpact;p++){var cont="<span style='margin:20px'><b>"+p+" - "+eval("qoCurrent.Matrix.impact"+p)+"</b></span>";probImpactImpactDescLayout.addMember(isc.Label.create({contents:cont,height:20}));
}var action;try{action=project.tolActions[4].tolAction;if(action.length==0){action=project.tolActions[4].longName;}}catch(e){action="-";}probImpactDescriptionLayout.addMember(isc.Label.create({contents:"<span style='color:white;font-weight:bold;background:red;padding:2px 5px 2px 5px;'>Tolerance 5</span>&nbsp;&nbsp;"+action,height:20}));
try{action=project.tolActions[3].tolAction;if(action.length==0){action=project.tolActions[3].longName;}}catch(e){action="-";}probImpactDescriptionLayout.addMember(isc.Label.create({contents:"<span style='color:black;font-weight:bold;background:orange;padding:2px 5px 2px 5px;'>Tolerance 4</span>&nbsp;&nbsp;"+action,height:20}));
try{action=project.tolActions[2].tolAction;if(action.length==0){action=project.tolActions[2].longName;}}catch(e){action="-";}probImpactDescriptionLayout.addMember(isc.Label.create({contents:"<span style='color:black;font-weight:bold;background:yellow;padding:2px 5px 2px 5px;'>Tolerance 3</span>&nbsp;&nbsp;"+action,height:20}));
try{action=project.tolActions[1].tolAction;if(action.length==0){action=project.tolActions[1].longName;}}catch(e){action="-";}probImpactDescriptionLayout.addMember(isc.Label.create({contents:"<span style='color:black;font-weight:bold;background:#00ff00;padding:2px 5px 2px 5px;'>Tolerance 2</span>&nbsp;&nbsp;"+action,height:20}));
try{action=project.tolActions[0].tolAction;if(action.length==0){action=project.tolActions[0].longName;}}catch(e){action="-";}probImpactDescriptionLayout.addMember(isc.Label.create({contents:"<span style='color:black;font-weight:bold;background:#00ffff;padding:2px 5px 2px 5px;'>Tolerance 1</span>&nbsp;&nbsp;"+action,height:20}));
riskProbImpactLayout.setSinglePhase(qoQRM.singlePhase,qoRiskController.currentRisk);}}catch(e){isc.say(e.message);}};this.createRiskEditor=function(){try{if(typeof(idRiskEditorWindow)!="undefined"&&project.tabsToUse==qoQRM.currentEditorMask){return;
}qoQRM.currentEditorMask=project.tabsToUse;isc.TabSet.create({width:"100%",height:"100%",ID:"riskTabSet",backgroundColor:"white",tabBarPosition:"top",tabSelected:function(tabNum,tabPane,ID,tab){try{qoRiskEditor.riskEditorTabSelected(tabNum,tabPane,ID,tab);
}catch(error){alert(error.message);}}});try{riskTabSet.addTab({title:"Evaluation",pane:this.getRiskEditorEvalLayout()});riskTabSet.addTab({title:"Prob/Impact",pane:this.getRiskEditorProbImpactLayout()});
if(qoQRM.currentEditorMask&qoQRM.pageMitigation){riskTabSet.addTab({title:"Mitigation",pane:this.getRiskEditorMitigationLayout()});}riskTabSet.addTab({ID:"riskEditorChildTabID",title:"Contributing Risks & Stakeholders",pane:this.getRiskEditorChildRiskLayout()});
if(qoQRM.currentEditorMask&qoQRM.pageComment){riskTabSet.addTab({title:"Staus Updates",pane:this.getRiskEditorCommentLayout()});}if(qoQRM.currentEditorMask&qoQRM.pageResponse){riskTabSet.addTab({title:"Response",pane:this.getRiskEditorResponseLayout()});
}if(qoQRM.currentEditorMask&qoQRM.pageConsequence){riskTabSet.addTab({title:"Consequences",pane:this.getRiskEditorConsequenceLayout()});}if(qoQRM.currentEditorMask&qoQRM.pageControl){riskTabSet.addTab({title:"Controls",pane:this.getRiskEditorControlLayout()});
}if(qoQRM.currentEditorMask&qoQRM.pageObjective){riskTabSet.addTab({title:"Objectives",pane:this.getRiskEditorObjectiveLayout()});}if(qoQRM.currentEditorMask&qoQRM.pageAttachment){riskTabSet.addTab({title:"Attachments",pane:this.getRiskEditorAttachmentLayout()});
}if(qoQRM.currentEditorMask&qoQRM.pageAudit){riskTabSet.addTab({title:"Audits & Reviews",pane:this.getRiskEditorReviewLayout()});}}catch(e){alert(e.message);}isc.QRMSaveButton.create({ID:"riskSaveBtn",autoDraw:false,disabled:true,click:function(){var tab=0;
if(riskTabSet.getTab(1).pane.dirty){tab=1;}if(riskTabSet.getTab(0).pane.dirty){tab=0;}if(riskTabSet.getTab(2).pane.dirty){tab=2;}if(qoRiskController.allowEditorChanges&&qoRiskController.secAllowEdit){try{if(riskTabSet.getTab(0).pane.dirty||riskTabSet.getTab(1).pane.dirty){if(!riskBasicForm.validate()){riskTabSet.selectTab(0);
return;}var values=riskBasicForm.getValues();values.mitigationPlan=null;values.probConsequenceNodes=null;values.controls=null;values.objectivesImpacted=null;values.startExposure=simplifyDate(values.startExposure);
values.endExposure=simplifyDate(values.endExposure);values.mitPlanSummary=riskMitPlanSummaryForm.getItem("mitPlanSummary").getValue();values.mitPlanSummaryUpdate=riskMitPlanSummaryForm2.getItem("mitPlanSummaryUpdate").getValue();
if(riskTabSet.getTab(1).pane.dirty){if(qoQRM.singlePhase){values.treatedProb=probImpactMatrixImgPreMitImg.getProb();values.treatedImpact=probImpactMatrixImgPreMitImg.getImpact();values.inherentProb=probImpactMatrixImgPreMitImg.getProb();
values.inherentImpact=probImpactMatrixImgPreMitImg.getImpact();values.useCalculatedProb=probImpactFreqForm.getItem("useCalculatedProb").getValue();values.liket=probImpactFreqForm.getItem("liket").getValue();
values.likealpha=probImpactFreqForm.getItem("likealpha").getValue();values.likepostT=probImpactFreqForm.getItem("liket").getValue();values.likepostAlpha=probImpactFreqForm.getItem("likealpha").getValue();
values.liketype=probImpactFreqForm.getItem("liketype").getValue();values.likepostType=probImpactFreqForm.getItem("liketype").getValue();values.likeprop=probImpactFreqForm.getItem("prob").getValue();values.likepostProb=probImpactFreqForm.getItem("prob").getValue();
}else{values.treatedProb=probImpactMatrixImgPostMitImg.getProb();values.treatedImpact=probImpactMatrixImgPostMitImg.getImpact();values.inherentProb=probImpactMatrixImgPreMitImg.getProb();values.inherentImpact=probImpactMatrixImgPreMitImg.getImpact();
values.liket=probImpactFreqForm.getItem("liket").getValue();values.likealpha=probImpactFreqForm.getItem("likealpha").getValue();values.likepostT=probImpactFreqForm.getItem("likepostT").getValue();values.likepostAlpha=probImpactFreqForm.getItem("likepostAlpha").getValue();
values.liketype=probImpactFreqForm.getItem("liketype").getValue();values.likepostType=probImpactFreqForm.getItem("likepostType").getValue();values.likeprop=probImpactFreqForm.getItem("prob").getValue();
values.likepostProb=probImpactFreqForm.getItem("probPost").getValue();values.useCalculatedProb=probImpactFreqForm.getItem("useCalculatedProb").getValue();}}isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({promptStyle:"cursor",evalResult:false,actionURL:"./saveRisk",params:{RISKID:qoRiskController.currentRisk.riskID,PROJECTID:qoRiskController.currentRisk.projectID,DATA:JSON.stringify(values),NOCACHE:Math.random()},callback:function(rpcResponse,data,rpcRequest){try{riskTabSet.getTab(0).pane.dirty=false;
riskTabSet.getTab(1).pane.dirty=false;riskTabSet.setTabTitle(riskTabSet.getTab(0),"Evaluation");riskTabSet.setTabTitle(riskTabSet.getTab(1),"Prob/Impact");qoRiskController.resetOnExit=true;getRiskAndDisplayCallBack(data,tab,false);
RiskEditorTabSetHolder.show();}catch(e){isc.say(e.message);}}});}riskResetBtn.setDisabled(true);riskSaveBtn.setDisabled(true);if(qoRiskController.dirty){idRiskEditorWindow.setTitle("<span style='color:white'>"+qoRiskController.currentRisk.riskProjectCode+" - "+qoRiskController.currentRisk.title+"</span>");
}}catch(e){isc.say(e.message);}}}});isc.QRMRefreshButton.create({title:"Reset",ID:"riskResetBtn",autoDraw:false,disabled:true,click:function(){riskTabSet.selectTab(0);getRiskAndDisplay(qoRiskController.riskID);
riskProbImpactLayout.dirty=false;riskResponseLayout.dirty=false;ObjectiveLayout.dirty=false;riskMitigationLayout.dirty=false;riskEditorLikelihoodCombo.dirty=false;riskControlLayout.dirty=false;riskConsequenceLayout.dirty=false;
allowEditorChange=true;}});isc.QRMExportButton.create({ID:"riskDownloadBtn",autoDraw:false,disabled:true,click:function(){alert("DOWNLOAD RISK");}});var holder=isc.VLayout.create({ID:"RiskEditorTabSetHolder",backgroundColor:"white",height:"100%",width:"100%",members:[riskTabSet],layoutTopMargin:5,layoutMargin:5});
var btnholder=isc.HLayout.create({vwidth:"100%",align:"right",members:[riskSaveBtn,riskResetBtn,riskDownloadBtn],layoutTopMargin:5,layoutMargin:5,membersMargin:4});isc.Window.create({title:"Risk Editor",ID:"idRiskEditorWindow",headerControls:["headerLabel","maximizeButton","closeButton"],headerDefaults:{layoutMargin:1,membersMargin:5,height:26},items:[btnholder,holder],height:Math.min(MainPane.height,760),width:Math.min(MainPane.width*0.98,1250),isModal:true,showModalMask:true,showMaximizeButton:false,autoCenter:true,closeClick:function(){try{if(qoRiskController.dirty){isc.ask("You have unsaved changes.\n\nUnsaved changes will be lost if you continue. \nDo you wish to continue?",function(value){if(!value){return true;
}else{try{riskMitigationLayout.table.cancelEditing();}catch(e){}riskProbImpactLayout.dirty=false;qoRiskController.allowEditorChanges=true;qoRiskController.riskID=0;RiskTableWindow.show();idRiskEditorWindow.hide();
registerRiskInterest(null);if(qoRiskController.dirty||qoRiskController.contingencyDirty||qoRiskController.resetOnExit){updateSelectedProject();qoRiskController.dirty=false;qoRiskController.contingencyDirty=false;
qoRiskController.resetOnExit=false;}return false;}},{buttons:[Dialog.OK,Dialog.CANCEL]});}else{try{riskMitigationLayout.table.cancelEditing();}catch(e){}try{riskProbImpactLayout.dirty=false;qoRiskController.allowEditorChanges=true;
qoRiskController.riskID=0;RiskTableWindow.show();idRiskEditorWindow.hide();registerRiskInterest(null);if(qoRiskController.dirty||qoRiskController.contingencyDirty||qoRiskController.resetOnExit){updateSelectedProject();
qoRiskController.dirty=false;qoRiskController.contingencyDirty=false;qoRiskController.resetOnExit=false;}return false;}catch(e){alert("Position 1 "+e.message);}}}catch(e){alert(e.message);}}});return idRiskEditorWindow;
}catch(ex1){alert(ex1.message);}};}function ReportEngine(){this.reportParamMap=new Map();this.flowController=function(a){var b=false;if(a.checkTableSelection){if(!this.checkTableSelection()){return;}}if(a.baseValues){this.setBaseReportValues(a.reportID);
}if(a.excelOnly){this.reportParamMap.put("format","MS Excel");}if(a.projectRisk){this.reportParamMap.put("projectRisk",true);this.setExtForProjectReport();}if(a.addAllRiskIDS){this.addAllRiskIDS();this.setExtForRegistryReport();
}if(a.registerReport){this.reportParamMap.put("registerReport",true);this.setExtForRegistryReport();}if(a.addSelectedRiskIDS){this.addSelectedRiskIDS();this.setExtForRegistryReport();}if(a.analysisWidget){b=true;
AnalysisWidgetID.prepareExport();}if(a.relMatrix){b=true;if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Current Tolerance"){this.reportParamMap.put("currentState",true);
this.reportParamMap.put("inherentState",false);this.reportParamMap.put("treatedState",false);}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Un Treated Tolerance"){this.reportParamMap.put("currentState",false);
this.reportParamMap.put("inherentState",true);this.reportParamMap.put("treatedState",false);}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Treated Tolerance"){this.reportParamMap.put("currentState",false);
this.reportParamMap.put("inherentState",false);this.reportParamMap.put("treatedState",true);}}if(a.noSelectWindow){b=true;}if(a.detailConfigWindow){this.getRiskReportConfigWindow(b);return;}if(a.submit){this.submitBackGroundReport(b);
return;}};this.checkTableSelection=function(){if(viewState=="Regular"){return true;}else{alert("Please Use The 'Regular' Table Format View");return false;}};this.submitBackGroundReport=function(a){startChatChannel();
isc.RPCManager.sendRequest({showPrompt:true,prompt:"Submitting Report for Processing",evalResult:true,prompt:"Submitting Report Request",params:{OPERATION:"submitReportRequest",DATA:JSON.stringify(this.reportParamMap),PROJECTID:projectID,DESCENDANTS:checkDescendants.getValue(),action:"SUBMITANDEXECUTE"},callback:function(d,c,b){if(a){isc.say("Report Submitted for Processing (ID: "+c+").<br/><br/>Use the 'Reports' tab to view result");
}else{qoQRM.ConcurrentPane.setProject(true);ReportSelectWindow.hide();isc.say("Report Submitted for Processing (ID: "+c+").");}},actionURL:"./report"});if(typeof(idRiskReportConfigWindow)!="undefined"){idRiskReportConfigWindow.hide();
}};this.setBaseReportValues=function(a){this.reportParamMap.clear();this.reportParamMap.put("userID",userID);this.reportParamMap.put("contextID",projectID);this.reportParamMap.put("projectID",projectID);
this.reportParamMap.put("reportID",a);this.reportParamMap.put("project",project.projectTitle);this.reportParamMap.put("descendants",checkDescendants.getValue());this.reportParamMap.put("nocache",Math.random());
};this.addSelectedRiskIDS=function(){var c=RiskTable.getSelection();var a=c.length;for(var b=0;b<a;b++){this.reportParamMap.put("riskID"+b,c[b].riskID);}};this.addAllRiskIDS=function(){var a=RiskTable.data.localData.length;
for(var b=0;b<a;b++){this.reportParamMap.put("riskID"+b,RiskTable.data.localData[b].riskID);}};this.setExtForRegistryReport=function(){this.reportParamMap.put("extremeFilter",DynamicFormTolerance.getItem("Extreme").getValue());
this.reportParamMap.put("highFilter",DynamicFormTolerance.getItem("High").getValue());this.reportParamMap.put("sigFilter",DynamicFormTolerance.getItem("Significant").getValue());this.reportParamMap.put("modFilter",DynamicFormTolerance.getItem("Moderate").getValue());
this.reportParamMap.put("lowFilter",DynamicFormTolerance.getItem("Low").getValue());this.reportParamMap.put("activeFilter",DynamicFormStatus.getItem("Active").getValue());this.reportParamMap.put("pendingFilter",DynamicFormStatus.getItem("Pending").getValue());
this.reportParamMap.put("inactiveFilter",DynamicFormStatus.getItem("In Active").getValue());this.reportParamMap.put("treatedStatus",DynamicFormStatus.getItem("Treated").getValue());this.reportParamMap.put("inherentStatus",DynamicFormStatus.getItem("Untreated").getValue());
this.reportParamMap.put("tol5","Extreme");this.reportParamMap.put("tol4","High");this.reportParamMap.put("tol3","Significant");this.reportParamMap.put("tol2","Moderate");this.reportParamMap.put("tol1","Low");
this.reportParamMap.put("descendants",checkDescendants.getValue());this.reportParamMap.put("contextName",project.projectTitle);this.reportParamMap.put("riskOwner",DynamicFormOwner.getItem("ownerID").getDisplayValue());
this.reportParamMap.put("riskManager",DynamicFormOwner.getItem("manager1ID").getDisplayValue());this.reportParamMap.put("riskCategory",DynamicFormOwner.getItem("primCatID").getDisplayValue());this.reportParamMap.put("DESCENDANTS",checkDescendants.getValue());
this.reportParamMap.put("PROJECTID",projectID);this.reportParamMap.put("OPERATION","getRiskLiteFetch");this.reportParamMap.put("PROCESSFILTER",true);this.reportParamMap.put("TOLEX",DynamicFormTolerance.getItem("Extreme").getValue());
this.reportParamMap.put("TOLHIGH",DynamicFormTolerance.getItem("High").getValue());this.reportParamMap.put("TOLSIG",DynamicFormTolerance.getItem("Significant").getValue());this.reportParamMap.put("TOLMOD",DynamicFormTolerance.getItem("Moderate").getValue());
this.reportParamMap.put("TOLLOW",DynamicFormTolerance.getItem("Low").getValue());this.reportParamMap.put("STATACTIVE",DynamicFormStatus.getItem("Active").getValue());this.reportParamMap.put("STATPENDING",DynamicFormStatus.getItem("Pending").getValue());
this.reportParamMap.put("STATINACTIVE",DynamicFormStatus.getItem("In Active").getValue());this.reportParamMap.put("STATTREATED",DynamicFormStatus.getItem("Treated").getValue());this.reportParamMap.put("STATUNTREATED",DynamicFormStatus.getItem("Untreated").getValue());
this.reportParamMap.put("CATID",(typeof(DynamicFormOwner.getItem("primCatID").getValue())=="object"||typeof(DynamicFormOwner.getItem("primCatID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("primCatID").getValue());
this.reportParamMap.put("OWNERID",(typeof(DynamicFormOwner.getItem("ownerID").getValue())=="object"||typeof(DynamicFormOwner.getItem("ownerID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("ownerID").getValue());
this.reportParamMap.put("MANAGERID",(typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="object"||typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("manager1ID").getValue());
try{this.reportParamMap.put("sortBy",RiskTable.getField(RiskTable.getFieldNum(RiskTable.sortField)).title);}catch(a){this.reportParamMap.put("sortBy","-");}};this.setExtForProjectReport=function(){this.reportParamMap.put("extremeFilter",true);
this.reportParamMap.put("highFilter",true);this.reportParamMap.put("sigFilter",true);this.reportParamMap.put("modFilter",true);this.reportParamMap.put("lowFilter",true);this.reportParamMap.put("activeFilter",true);
this.reportParamMap.put("pendingFilter",true);this.reportParamMap.put("inactiveFilter",true);this.reportParamMap.put("treatedStatus",true);this.reportParamMap.put("inherentStatus",true);this.reportParamMap.put("tol5","Extreme");
this.reportParamMap.put("tol4","High");this.reportParamMap.put("tol3","Significant");this.reportParamMap.put("tol2","Moderate");this.reportParamMap.put("tol1","Low");this.reportParamMap.put("descendants",checkDescendants.getValue());
this.reportParamMap.put("contextName",project.projectTitle);this.reportParamMap.put("riskOwner","-");this.reportParamMap.put("riskManager","-");this.reportParamMap.put("riskCategory","-");this.reportParamMap.put("sortBy","-");
};this.setExtForRiskReport=function(){try{this.reportParamMap.put("showCause",idRiskReportConfigForm0.getItem("Cause").getValue());this.reportParamMap.put("showCategories",idRiskReportConfigForm0.getItem("Categories").getValue());
this.reportParamMap.put("showTolerance",idRiskReportConfigForm0.getItem("Tolerance").getValue());this.reportParamMap.put("showKeyDates",idRiskReportConfigForm0.getItem("KeyDates").getValue());this.reportParamMap.put("showAreaImpacted",idRiskReportConfigForm0.getItem("Impacted Area").getValue());
this.reportParamMap.put("showObjectives",idRiskReportConfigForm0.getItem("Objectives Impacted").getValue());this.reportParamMap.put("showProb",idRiskReportConfigForm0.getItem("Probability").getValue());
this.reportParamMap.put("showImpact",idRiskReportConfigForm0.getItem("Impact").getValue());this.reportParamMap.put("showMitPlan",idRiskReportConfigForm0.getItem("Mitigation Plans").getValue());this.reportParamMap.put("showControls",idRiskReportConfigForm0.getItem("Controls").getValue());
this.reportParamMap.put("showComments",idRiskReportConfigForm0.getItem("Comments").getValue());this.reportParamMap.put("showConsequence",idRiskReportConfigForm0.getItem("Consequences").getValue());this.reportParamMap.put("showRiskMatrix",idRiskReportConfigForm0.getItem("Risk Matrix").getValue());
}catch(a){alert("Got an Error "+a.message);}};this.getRiskReportConfigWindow=function(a){if(typeof(idRiskReportConfigWindow)=="undefined"){isc.Window.create({ID:"idRiskReportConfigWindow",title:"Risk Report Configuration",memberMargin:5,autoSize:true,showMinimizeButton:false,autoCenter:true,isModal:true,headerIconProperties:{src:"icons/16/printer3.png"},showModalMask:true,autoDraw:false,items:[isc.DynamicForm.create({fields:[{type:"header",defaultValue:"Report Content",startRow:true},{showTitle:false,name:"Cause",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"Categories",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"Tolerance",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"KeyDates",title:"Key Dates",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"ImpactedArea",title:"Impacted Area",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,title:"Objectives Impacted",name:"ObjectivesImpacted",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"Probability",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"Treatment",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,title:"Mitigation Plans",name:"MitigationPlans",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"Controls",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"Consequences",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,name:"Comments",defaultValue:true,_constructor:"CheckboxItem"},{showTitle:false,title:"Risk Matrix",name:"RiskMatrix",defaultValue:true,_constructor:"CheckboxItem"}],numCols:4,ID:"idRiskReportConfigForm0",autoDraw:false}),isc.HLayout.create({width:250,height:35,layoutMargin:5,members:[isc.LayoutSpacer.create({width:"100%"}),isc.IButton.create({width:150,title:"Generate Report",click:function(){qoReportEngine.generateReport(a);
}})]})]});}idRiskReportConfigWindow.show();};this.generateReport=function(a){try{qoReportEngine.reportParamMap.put("format","PDF");qoReportEngine.reportParamMap.put("showCause",idRiskReportConfigForm0.getItem("Cause").getValue());
qoReportEngine.reportParamMap.put("showCategories",idRiskReportConfigForm0.getItem("Categories").getValue());qoReportEngine.reportParamMap.put("showTolerance",idRiskReportConfigForm0.getItem("Tolerance").getValue());
qoReportEngine.reportParamMap.put("showKeyDates",idRiskReportConfigForm0.getItem("KeyDates").getValue());qoReportEngine.reportParamMap.put("showImpactedAreas",idRiskReportConfigForm0.getItem("ImpactedArea").getValue());
qoReportEngine.reportParamMap.put("showObjectivesImpacted",idRiskReportConfigForm0.getItem("ObjectivesImpacted").getValue());qoReportEngine.reportParamMap.put("showTreatment",idRiskReportConfigForm0.getItem("Treatment").getValue());
qoReportEngine.reportParamMap.put("showProbability",idRiskReportConfigForm0.getItem("Probability").getValue());qoReportEngine.reportParamMap.put("showMitigationPlans",idRiskReportConfigForm0.getItem("MitigationPlans").getValue());
qoReportEngine.reportParamMap.put("showControls",idRiskReportConfigForm0.getItem("Controls").getValue());qoReportEngine.reportParamMap.put("showConsequences",idRiskReportConfigForm0.getItem("Consequences").getValue());
qoReportEngine.reportParamMap.put("showComments",idRiskReportConfigForm0.getItem("Comments").getValue());qoReportEngine.reportParamMap.put("showRiskMatrix",idRiskReportConfigForm0.getItem("RiskMatrix").getValue());
qoReportEngine.submitBackGroundReport(a);}catch(b){alert(b);}};this.selectAndRunReport=function(){if(typeof(ReportSelectWindow)=="undefined"){isc.ListGrid.create({ID:"reportReportGrid",width:"100%",height:"100%",alternateRecordStyles:true,selectionType:"single",recordClick:function(c,a){try{reportPreviewPane.setSrc("./reportPreview?repID="+a.reportID+"&h="+reportPreviewPane.getHeight()+"&w="+reportPreviewPane.getWidth());
}catch(b){alert(b.message);}},gridComponents:["header","body",isc.ToolStrip.create({width:"100%",height:26,defaultLayoutAlign:"center",members:[isc.LayoutSpacer.create({width:"*"}),isc.IButton.create({title:"Execute Report",showOverCanvas:true,showRollOver:true,showDisabledIcon:true,icon:"[SKIN]/actions/forward.png",width:140,click:function(){try{qoReportEngine.flowController(reportReportGrid.getSelection()[0]);
ReportSelectWindow.hide();}catch(a){alert(a.message);}}}),isc.LayoutSpacer.create({width:5})]})],fields:[{name:"title",title:"Report Title"},{name:"type",title:"Type",showIf:"false",GRP_RISK:2,GRP_PROJECT:1,GRP_EXPORT:3,getGroupValue:function(c,a,d,f,b){if(a.type=="RISK"){return this.GRP_RISK;
}if(a.type=="PROJECT"){return this.GRP_PROJECT;}if(a.type=="EXPORT"){return this.GRP_EXPORT;}},getGroupTitle:function(a,b,f,g,c){var d="";switch(a){case this.GRP_RISK:d="Risk Report - All Project Risks";
break;case this.GRP_PROJECT:d="Project Reports";break;case this.GRP_EXPORT:d="Export All Project Risks";break;}return d;}}],groupByField:"type",groupStartOpen:"all"});isc.Window.create({title:"Select Report To Execute",ID:"ReportSelectWindow",layoutMargin:5,headerControls:["headerLabel","maximizeButton","closeButton"],headerDefaults:{layoutMargin:1,membersMargin:5,height:26},items:[isc.VLayout.create({width:"100%",height:"100%",layoutMargin:5,membersMargin:5,members:[isc.Label.create({ID:"ReportWindowProjectLabel",height:40,width:"100%",layoutMargin:5,backgroundColor:qrmCtrlColor,align:"left",wrap:false}),isc.HLayout.create({width:"100%",membersMargin:5,height:"100%",members:[isc.VLayout.create({width:"100%",height:"100%",members:[isc.QRMLabel.create({title:"Select Report"}),reportReportGrid]}),isc.VLayout.create({width:"100%",height:"100%",members:[isc.QRMLabel.create({title:"Report Sample Preview"}),isc.Img.create({border:"1px solid black",imageType:"stretch",ID:"reportPreviewPane",height:"100%",width:"100%"})]})]})]})],height:Math.min(MainPane.height,760),width:Math.min(MainPane.width*0.98,1250),isModal:true,showModalMask:true,showMaximizeButton:false,autoCenter:true});
}ReportSelectWindow.show();isc.RPCManager.sendRequest({prompt:"Retrieving Reports",evalResult:true,actionURL:"./getHomePageReports",callback:function(d,b,a){try{reportReportGrid.setData(b);}catch(c){alert(c.message);
}}});ReportWindowProjectLabel.setContents("<span style='font-weight:normal;font-size:11pt'> &nbsp;&nbsp;Any project specifc reports will be run against: </span><span style='font-weight:bold;font-size:11pt'>"+qoQRM.projectTitleStr+"</span>");
reportPreviewPane.setSrc("./reportPreview?repID=0");};}function defineJSON(){if(!this.JSON){JSON=function(){function f(n){return n<10?"0"+n:n;}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z";
};var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){return escapeable.test(string)?'"'+string.replace(escapeable,function(a){var c=meta[a];
if(typeof c==="string"){return c;}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];
if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){length=value.length;
for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(typeof rep==="object"){length=rep.length;
for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value,rep);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){v=str(k,value,rep);if(v){partial.push(quote(k)+(gap?": ":":")+v);
}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}return{stringify:function(value,replacer,space){var i;gap="";indent="";if(space){if(typeof space==="number"){for(i=0;
i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}}if(!replacer){rep=function(key,value){if(!Object.hasOwnProperty.call(this,key)){return undefined;}return value;};}else{if(typeof replacer==="function"||(typeof replacer==="object"&&typeof replacer.length==="number")){rep=replacer;
}else{throw new Error("JSON.stringify");}}return str("",{"":value});},parse:function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");},quote:quote};}();}}function dateParser(c,f){var b;if(typeof f==="string"){b=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/.exec(f);
if(b){var g=new Date();g.setFullYear(+b[1],+b[2]-1,+b[3]);g.setHours(+b[4],+b[5],+b[6],0);return g;}b=/^(\d{4})-(\d{2})-(\d{2})/.exec(f);if(b){return new Date(Date.UTC(+b[1],+b[2]-1,+b[3]));}}return f;
}function simplifyDate(i){var h=i;try{if(h==null){h=new Date();}var c=h.getFullYear();var g=h.getMonth()+1;var b=h.getDate();var f="";if(g<10){f=f+"0"+g;}else{f=f+g;}var a="";if(b<10){a=a+"0"+b;}else{a=a+b;
}return c+"-"+f+"-"+a;}catch(d){return h;}}function Map(){this.keyArray=new Array();this.valArray=new Array();this.put=function(a,c){var b=this.findIt(a);if(b==(-1)){this.keyArray.push(a);this.valArray.push(c);
}else{this.valArray[b]=c;}};this.get=function(b){var a=null;var c=this.findIt(b);if(c!=(-1)){a=this.valArray[c];}return a;};this.remove=function(a){var b=this.findIt(a);if(b!=(-1)){this.keyArray=this.keyArray.removeAt(b);
this.valArray=this.valArray.removeAt(b);}return;};this.size=function(){return(this.keyArray.length);};this.clear=function(){while(this.keyArray.length>0){this.keyArray.pop();this.valArray.pop();}};this.keySet=function(){return(this.keyArray);
};this.valSet=function(){return(this.valArray);};this.showMe=function(){var a="";for(var b=0;b<this.keyArray.length;b++){a+="Key: "+this.keyArray[b]+"\tValues: "+this.valArray[b]+"\n";}return a;};this.findIt=function(c){var a=(-1);
for(var b=0;b<this.keyArray.length;b++){if(this.keyArray[b]==c){a=b;break;}}return a;};this.removeAt=function(a){var c=this.slice(0,a);var b=this.slice(a+1);return(c.concat(b));};}function ProjectManager(){this.dirtyEditor=false;
this.projectEditorDirty=function(){projectSaveBtn.setDisabled(false);projectResetBtn.setDisabled(false);if(!this.dirtyEditor){this.dirtyEditor=true;}};this.projectEditorClean=function(){projectResetBtn.setDisabled(true);
projectSaveBtn.setDisabled(true);projectEditorCategory.dirty=false;projectEditorConsequence.dirty=false;projectEditorMatrix.dirty=false;projectEditorObjective.dirty=false;projectEditorStakeholders.dirty=false;
projectEditorBasic.dirty=false;if(this.dirtyEditor){this.dirtyEditor=false;}};this.getUserMgrProjects=function(b,a){try{projects="";project=b;isc.RPCManager.sendRequest({evalResult:true,showPrompt:true,bypassCache:true,prompt:"Retrieving Managed Projects",callback:function(i,g,d){qoAll.Users.clear();
qoAll.Matrices.clear();try{projects=g[0];projects.setProperty("isFolder","true");if(projects.length<=0){isc.say(("You do not have Project Management Rights to any of the projects"),function(){toggleMode(0);
});}else{qoAll.Users=g[1];for(var f=0;f<g[2].length;f++){qoAll.Matrices[g[2][f].matrixID]=g[2][f];}projects.remove(projects.find("projectID",-1));QRMNavigator.setData(isc.Tree.create({ID:"projectTreeData",modelType:"parent",showRoot:false,idField:"projectID",parentIdField:"parentID",data:projects}));
QRMNavigator.getData().openAll();if(a){QRMNavigator.selectRecord(0);QRMNavigator.recordClick();}}}catch(h){alert(h.message);}},actionURL:"./getUserMgmtProjects"});}catch(c){isc.say(c.message);}};this.constructMgrApp=function(){try{isc.VLayout.create({backgroundColor:qrmCtrlColor,membersMargin:2,ID:"ProjectEditorWindow",layoutMargin:2,layoutTopMargin:2,layoutBottomMargin:2,layoutRightMargin:2,layoutLeftMargin:2,height:"100%",width:"100%",members:[this.getProjectEditorTabSet()],autoDraw:true});
}catch(a){alert("QRM Construct App Error "+a.message);}return ProjectEditorWindow;};this.getProjectEditorTabSet=function(){return isc.TabSet.create({width:"100%",height:"100%",paneContainerProperties:{backgroundColor:qrmCtrlColor},ID:"projectTabSet",tabBarPosition:"top",tabDeselected:function(f,b,a,c){try{if(projectTabSet.getTabPane(projectTabSet.getSelectedTab()).dirty){isc.ask("Save Changes?",function(g){if(g){projectTabSet.getTabPane(projectTabSet.getSelectedTab()).saveFn();
}else{projectTabSet.getTabPane(projectTabSet.getSelectedTab()).resetFn();}});}}catch(d){}},tabs:[{title:"Project Definition",pane:this.getPaneProjectBasic()},{title:"Owner and Managers",pane:this.getPaneOwnersAndManagers()},{title:"Objectives",pane:this.getPaneObjectives()},{title:"Categories",pane:this.getPaneCategories()},{title:"Quantifiable Consequences",pane:this.getPaneConsequences()},{title:"Tolerance and Matrix",pane:this.getPaneMatrix()}]});
};this.attachTemplate=function(){if(typeof(modalAttachTemplateWindow)=="undefined"){isc.Window.create({ID:"modalAttachTemplateWindow",title:"AttachTemplate",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,showMinimizeButton:false,autoDraw:true,closeClick:function(){ProjectTemplateForm.clearValue("projectID");
ProjectTemplateForm.clearValue("UploadItem0");this.Super("closeClick",arguments);},items:[isc.DynamicForm.create({ID:"ProjectTemplateForm",encoding:"multipart",width:400,numCols:2,target:"_qrmFormTarget",action:"./installTemplate",fields:[{_constructor:"HeaderItem",defaultValue:"Attach Template"},{title:"Template File",name:"UploadItem0",_constructor:"UploadItem",showTitle:false,colSpan:2,width:400},{name:"inludeTemplateRoot",title:"Include Template Root",type:"boolean",showTitle:false,align:"left",defaultValue:true,colSpan:2},{name:"inludeRisks",title:"Include Risk (if present)",type:"boolean",showTitle:false,align:"left",defaultValue:true,colSpan:2},{name:"inheritStakeholders",title:"Inherit stakeolders from root",type:"boolean",showTitle:false,align:"left",defaultValue:true,colSpan:2},{name:"projectID",type:"hidden"},{name:"SubmitItem0",_constructor:"ButtonItem",title:"Install Template",align:"right",startRow:false,colSpan:2,click:function(){if(this.eventParent.validate()){isc.Window.create({ID:"waitingOnTemplateUploadWindow",title:"Quay Risk Manager",width:600,height:150,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,headerIconProperties:{src:"icons/16/import.png"},autoDraw:true,items:[isc.Label.create({height:"100%",padding:10,align:"center",valign:"center",wrap:false,contents:"<div><img alt='' src='./wait30trans.gif' style='float:left' /><h3 style='font-size:14;font-weight:bold'>Uploading and Installing Project Template</h3><br><h4 style='font-size:12;font-weight:bold'>Please Standby</h4></div>"})]});
waitingOnTemplateUploadWindow.show();this.eventParent.submitForm();this.eventParent.clearValue("UploadItem0");modalAttachTemplateWindow.hide();}}}]})]});}else{modalAttachTemplateWindow.show();}ProjectTemplateForm.getItem("projectID").setValue(QRMNavigator.getSelectedRecord().projectID);
};this.getPaneProjectBasic=function(){var a=isc.DynamicForm.create({ID:"projectBasicForm",numCols:2,autoDraw:false,titleWidth:160,hiliteRequiredFields:true,width:"100%",fields:[{name:"projectTitle",type:"text",title:"Project Title",width:500,colSpan:4,changed:"projectEditorBasic.changed();",required:true},{name:"projectCode",type:"text",title:"Project Code",width:60,colSpan:4,changed:"projectEditorBasic.changed();",required:true},{name:"projectDescription",width:500,type:"textarea",required:true,colSpan:4,height:90,changed:"projectEditorBasic.changed();",title:"Description"},{name:"projectRiskManagerID",width:"200",title:"Project Risk Manager",required:true,type:"select",allowEmptyValue:false,changed:"projectEditorBasic.changed();",startRow:true},{name:"projectStartDate",width:"300",title:"Project Start Date",type:"date",changed:"projectEditorBasic.changed();",startRow:true},{name:"projectEndDate",width:"300",title:"Project End Date",type:"date",changed:"projectEditorBasic.changed();",startRow:true},{name:"minimumSecurityLevel",title:"Minimum Security",required:true,type:"select",valueMap:{0:"Public",1:"Restricted",2:"Private"},allowEmptyValue:false,changed:"projectEditorBasic.changed();",startRow:true},{name:"singlePhase",title:"Use Single Phase Modelling",type:"checkbox",changed:"projectEditorBasic.changed();",startRow:true},{name:"projectID",_constructor:"HiddenItem"}]});
isc.ListGrid.create({width:"100%",height:"100%",ID:"reportGrid",alternateRecordStyles:true,fields:[{name:"reportName",type:"text",title:"Report Name",width:200},{name:"reportDescription",title:"Description",type:"text"},{name:"reporttype",title:"Type",type:"text",width:100}]});
isc.DynamicForm.create({ID:"projectTabsForm",numCols:2,autoDraw:false,titleWidth:10,hiliteRequiredFields:true,width:"100%",fields:[{defaultValue:"Risk Editor Tabs to Enable",type:"header"},{name:"riskData",type:"checkbox",title:"Risk Data",disabled:true,defaultValue:true},{name:"riskProbImpact",type:"checkbox",title:"Probability and Impact",disabled:true,defaultValue:true},{name:"riskMitigation",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Mitigation Plan"},{name:"riskResponse",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Response Plan"},{name:"riskConsequences",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Quantifiable Consequences"},{name:"riskControls",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Risk Controls"},{name:"riskObjectives",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Objectives Impacted"},{name:"riskAttachment",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Attachments"},{name:"riskComments",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Comments"},{name:"riskAudit",type:"checkbox",changed:"projectEditorBasic.changed();",title:"Audit Status"}]});
return isc.VLayout.create({members:[a,isc.QRMReportAttachmentForm.create(),isc.HLayout.create({membersMargin:15,members:[reportGrid,projectTabsForm],width:"100%"})],dirty:false,ID:"projectEditorBasic",membersMargin:5,backgroundColor:qrmCtrlColor,changed:function(){this.dirty=true;
qoProjectManager.projectEditorDirty();},saveFn:function(){if(!projectBasicForm.validate()){return;}var b=projectBasicForm.getValues();b.projectStartDate=simplifyDate(b.projectStartDate);b.projectEndDate=simplifyDate(b.projectEndDate);
isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({evalResult:false,params:{PROJECTID:project.projectID,DATA:JSON.stringify(b),DATA2:JSON.stringify(projectTabsForm.getValues())},callback:function(f,d,c){project=JSON.parse(d,dateParser);
projectEditorBasic.dirty=false;qoProjectManager.projectEditorClean();this.getUserMgrProjects(project);resetCurrentProject();},actionURL:"./updateProject"});},resetFn:function(){resetProject(project.projectID);
this.dirty=false;},autoDraw:false});};this.newProject=function(){if(typeof(editNewProjectModalWindow)=="undefined"){isc.Window.create({ID:"editNewProjectModalWindow",title:"New Project",autoSize:true,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[this.getNewProjectLayout()]});
}else{editNewProjectModalWindow.show();}var a=projects.sortByProperty("projectID",true);a.remove(a.find("projectID",-1));projectNewForm.getItem("parentID").setValueMap(a.getValueMap("projectID","projectTitle"));
projectNewForm.getItem("parentID").setValue(QRMMgrNavigator.getSelectedRecord().projectID);};this.deleteProject=function(){try{var a=QRMNavigator.getSelectedRecord();var b=confirm("Are you sure you want to delete the risk context "+a.projectTitle+" ("+a.projectCode+"), all its sub contexts and the associated risks?");
if(b){isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:"Deleting risk context "+a.projectTitle+" ("+a.projectCode+")",evalResult:true,params:{DATA:a.projectID},callback:function(g,f,d){isc.say("Risk Context Deleted");
qoProjectManager.getUserMgrProjects();},actionURL:"./deleteProject"});}else{return;}}catch(c){alert(c.message);}};this.getNewProjectLayout=function(){var a=isc.DynamicForm.create({ID:"projectNewForm",width:750,numCols:2,autoDraw:false,titleWidth:180,hiliteRequiredFields:true,fields:[{name:"projectTitle",type:"text",title:"Project Title",width:500,required:true},{name:"projectCode",type:"text",title:"Project Code",width:80,required:true},{name:"parentID",width:200,title:"Parent Project",required:true,type:"select",allowEmptyValue:false,startRow:true},{name:"projectDescription",width:500,type:"textarea",required:true,height:100,title:"Description"},{name:"projectStartDate",width:"300",title:"Start of Project",type:"date",startRow:true},{name:"projectEndDate",width:"300",title:"End of Project",type:"date",startRow:true},{name:"validateBtn",title:"Create New Project",type:"button",align:"right",colSpan:2,click:function(){if(!projectNewForm.validate()){return;
}var b=projectNewForm.getValues();b.startProject=simplifyDate(b.startProject);b.endProject=simplifyDate(b.endProject);try{b.singlePhase=projects.find("projectID",b.parentID).singlePhase;}catch(c){alert(c.message);
}isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:"Creating Risk Context '"+b.projectTitle+"'",evalResult:true,params:{OPERATION:"newProject",DATA:JSON.stringify(b)},callback:function(g,f,d){isc.say("Project Created");
editNewProjectModalWindow.closeClick();qoProjectManager.getUserMgrProjects();},actionURL:"./newProject"});}}]});return isc.VLayout.create({width:"100%",membersMargin:5,layoutMargin:5,members:[a]});};this.getPaneOwnersAndManagers=function(){var a=isc.ListGrid.create({ID:"stakeGrid",editOnFocus:true,modalEditing:true,alternateRecordStyles:true,fields:[{name:"name",type:"text",title:"Stake Holder",width:200,canEdit:false},{name:"email",type:"text",title:"Email Address",width:350,canEdit:false},{name:"owner",title:"Risk Owner",type:"boolean",width:100,canEdit:true},{name:"manager",title:"Risk Manager",type:"boolean",width:100,canEdit:true},{name:"user",title:"Risk User",type:"boolean",width:100,canEdit:true}],editComplete:function(g,c,d,b,f){if(d!=b){projectEditorStakeholders.changed();
}}});isc.ToolStrip.create({width:"100%",align:"right",ID:"projectEditorStakeholdersToolStrip",backgroundColor:qrmCtrlColor,border:"0px solid "+qrmCtrlColor,layoutMargin:5,membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);
this.newBtn=isc.IButton.create({title:"New User",disabled:false,click:function(){if(typeof(newPersonModalWindow)=="undefined"){var b=isc.DynamicForm.create({width:600,titleWidth:150,padding:10,ID:"newPersonForm",fields:[{type:"header",defaultValue:"New User Details"},{name:"name",type:"text",title:"Name",required:true,width:400},{name:"email",type:"text",title:"Email",required:true,width:400},{name:"passwordNew",type:"password",title:"New Password",required:true},{name:"password2",title:"Password Again",type:"password",required:true,validators:[{type:"matchesField",otherField:"passwordNew",errorMessage:"Passwords do not match"},{type:"lengthRange",min:6,max:10,errorMessage:"Passwords must be at least 6 characters long"}]},{name:"validateBtn",title:"Submit",type:"button",align:"right",colSpan:2,click:function(){if(newPersonForm.validate()){isc.RPCManager.sendRequest({evalResult:true,actionURL:"./newPersonRep",params:{OPERATION:"newPersonRep",DATA:JSON.stringify(newPersonForm.getValues())},callback:function(f,d,c){if(d=="-1"){isc.confirm("User with entered email already exists. Add to repository?",function(g){if(g){isc.RPCManager.sendRequest({evalResult:true,actionURL:"./newExistingPersonRep",params:{DATA:JSON.stringify(newPersonForm.getValues())},callback:function(i,h,j){isc.say(h);
newPersonModalWindow.hide();resetProject(project.projectID);this.dirty=false;}});}else{newPersonModalWindow.hide();resetProject(project.projectID);this.dirty=false;}});}else{isc.say(d);newPersonModalWindow.hide();
resetProject(project.projectID);this.dirty=false;}}});}}}]});isc.Window.create({ID:"newPersonModalWindow",title:"New Quay Risk Manager User",showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,autoSize:true,items:[b]});
}else{newPersonModalWindow.show();}}});this.existingBtn=isc.IButton.create({title:"Add Existing",disabled:false,click:function(){if(typeof(newPersonModalWindow)=="undefined"){var b=isc.DynamicForm.create({width:600,titleWidth:150,padding:10,ID:"newPersonForm2",fields:[{type:"header",defaultValue:"Existing User Details"},{name:"email",type:"text",title:"Email",required:true,width:400},{name:"validateBtn",title:"Submit",type:"button",align:"right",colSpan:2,click:function(){isc.RPCManager.sendRequest({evalResult:true,actionURL:"./newExistingPersonRep",params:{DATA:JSON.stringify(newPersonForm2.getValues())},callback:function(f,d,c){isc.say(d);
newPersonModalWindow2.hide();resetProject(project.projectID);this.dirty=false;}});}}]});isc.Window.create({ID:"newPersonModalWindow2",title:"Add Existing User to Repository",showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,autoSize:true,items:[b]});
}else{newPersonModalWindow2.show();}}});this.deleteBtn=isc.IButton.create({title:"Delete User",disabled:false,click:function(){try{var b=a.getSelectedRecord();isc.confirm("Are you sure you want to delete the user "+b.name+"?",function(d){if(d){isc.RPCManager.showPrompt=true;
isc.RPCManager.sendRequest({prompt:"Deleting user "+b.name,evalResult:true,params:{OPERATION:"deleteUser",DATA:b.stakeholderID},callback:function(h,g,f){isc.say(g);resetProject(project.projectID);},actionURL:"./deleteUser"});
}else{return;}});}catch(c){alert(c.message);}}});this.addMembers([this.deleteBtn,this.newBtn,this.existingBtn]);}});return isc.VLayout.create({width:"100%",ID:"projectEditorStakeholders",backgroundColor:qrmCtrlColor,membersMargin:5,layoutMargin:5,members:[a,projectEditorStakeholdersToolStrip],changed:function(){this.dirty=true;
qoProjectManager.projectEditorDirty();},saveFn:function(){isc.RPCManager.sendRequest({evalResult:true,actionURL:"./saveProjectStakeholders",params:{PROJECTID:project.projectID,OWNERS:(JSON.stringify(a.data.findAll("owner",true))),MANAGERS:(JSON.stringify(a.data.findAll("manager",true))),USERS:(JSON.stringify(a.data.findAll("user",true))),NONCACHE:Math.random()},callback:function(d,c,b){resetProject(project.projectID);
this.dirty=false;}});},resetFn:function(){resetProject(project.projectID);this.dirty=false;}});};this.getPaneObjectives=function(){isc.DataSource.create({ID:"objectiveTreeDS",clientOnly:true,fields:[{type:"text",title:"Objective",name:"objective",length:128},{type:"integer",name:"objectiveID",required:true,primaryKey:true},{type:"integer",name:"parentID",required:true,foreignKey:"objectiveTreeDS.objectiveID",rootValue:-1}]});
isc.TreeGrid.create({ID:"idProjectObjectiveTree",backgroundColor:qrmCtrlColor,height:"100%",width:"100%",nodeIcon:"[SKIN]file.png",folderIcon:"[SKIN]file.png",alternateRecordStyles:true,closedIconSuffix:"",showOpenIcons:false,showDropIcons:false,showConnectors:true,modalEditing:true,canEdit:true,recordClick:function(){if(this.getSelectedRecord().generation>=0){projectEditorObjectiveToolStrip.delBtn.enable();
projectEditorObjectiveToolStrip.editBtn.enable();projectEditorObjectiveToolStrip.newBtn.enable();}else{projectEditorObjectiveToolStrip.delBtn.disable();projectEditorObjectiveToolStrip.editBtn.disable();
projectEditorObjectiveToolStrip.newBtn.enable();}},dataArrived:function(){idProjectObjectiveTree.getData().openAll();projectEditorObjectiveToolStrip.delBtn.disable();projectEditorObjectiveToolStrip.editBtn.disable();
projectEditorObjectiveToolStrip.newBtn.disable();},editorEnter:function(){switch(this.getSelectedRecord().generation){case -1:this.endEditing();break;case 1:isc.say("Caution. Objective was defined by a sub project");
break;}},editorExit:function(c,a,d,f,b){if(a.generation>=0){if(c!="escape"){a.imageIndicator=3;a.dirty=true;projectEditorObjective.changed();}}return true;},editSelectedRecord:function(){this.startEditing(this.getRecordIndex(this.getSelectedRecord()));
},dataSource:objectiveTreeDS,fields:[{name:"objective",parseEditorValue:function(d,a,g,b,c){try{if(a.generation<0){return a.decription;}return d;}catch(f){return d;}}},{name:"imageIndicator",title:"Status",canEdit:false,type:"image",align:"center",width:70,imageURLPrefix:"leg",imageURLSuffix:".png"}]});
isc.ToolStrip.create({width:"100%",align:"right",border:"0px solid "+qrmCtrlColor,ID:"projectEditorObjectiveToolStrip",backgroundColor:qrmCtrlColor,layoutMargin:5,membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);
this.newBtn=isc.IButton.create({title:"Create New",disabled:true,click:function(){projectEditorObjective.changed();projObjectives.add({objectiveID:tempIndex--,parentID:idProjectObjectiveTree.getSelectedRecord().objectiveID,objective:"New Project Objectives",generation:0,imageIndicator:3});
objectiveTreeDS.testData=projObjectives;idProjectObjectiveTree.fetchData();}});this.delBtn=isc.IButton.create({title:"Delete",disabled:true,click:function(){if(idProjectObjectiveTree.getSelectedRecord().generation>=0){if(idProjectObjectiveTree.getSelectedRecord().objectiveID>0){projectEditorObjective.deleteObjs.push(idProjectObjectiveTree.getSelectedRecord().objectiveID);
}projectEditorObjective.changed();projObjectives.remove(projObjectives.find("objectiveID",idProjectObjectiveTree.getSelectedRecord().objectiveID));objectiveTreeDS.testData=projObjectives;idProjectObjectiveTree.fetchData();
}}});this.editBtn=isc.IButton.create({title:"Edit",disabled:true,click:function(){if(idProjectObjectiveTree.getSelectedRecord().generation>=0){projectEditorObjective.changed();idProjectObjectiveTree.editSelectedRecord();
}}});this.addMembers([this.newBtn,this.delBtn,this.editBtn]);}});return isc.VLayout.create({width:"100%",ID:"projectEditorObjective",deleteObjs:new Array(),backgroundColor:qrmCtrlColor,membersMargin:5,layoutMargin:5,members:[idProjectObjectiveTree,isc.Legend.create(),projectEditorObjectiveToolStrip],changed:function(){this.dirty=true;
qoProjectManager.projectEditorDirty();},saveFn:function(){isc.RPCManager.sendRequest({evalResult:true,params:{PROJECTID:project.projectID,DATA:(JSON.stringify(idProjectObjectiveTree.getData().dataSource.testData.findAll("generation",0))),DATADELETE:(JSON.stringify(projectEditorObjective.deleteObjs))},callback:function(c,b,a){resetProject(project.projectID);
this.dirty=false;this.deleteObjs.clear();},actionURL:"./saveProjectObjectives"});},resetFn:function(){this.deleteObjs.clear();resetProject(project.projectID);this.dirty=false;}});};this.getPaneCategories=function(){var a=isc.VLayout.create({width:"50%",membersMargin:5,layoutMargin:5});
isc.ListGrid.create({ID:"primCatGrid",alternateRecordStyles:true,modalEditing:true,recordClick:function(){secCatGrid.setData([]);secCatGrid.setData(this.getSelectedRecord().sec);if(this.getSelectedRecord().generation>=0){projectEditorPrimCatToolStrip.delBtn.enable();
projectEditorPrimCatToolStrip.editBtn.enable();projectEditorSecCatToolStrip.delBtn.disable();projectEditorSecCatToolStrip.editBtn.disable();projectEditorSecCatToolStrip.newBtn.enable();}else{projectEditorPrimCatToolStrip.delBtn.disable();
projectEditorPrimCatToolStrip.editBtn.disable();projectEditorSecCatToolStrip.delBtn.disable();projectEditorSecCatToolStrip.editBtn.disable();projectEditorSecCatToolStrip.newBtn.enable();}},fields:[{name:"imageIndicator",title:"Status",canEdit:false,type:"image",align:"center",width:70,imageURLPrefix:"leg",imageURLSuffix:".png"},{name:"description",type:"text",title:"Primary Category",canEdit:true,editorEnter:function(c,f,g,d){this.parseValueAlert=false;
},parseEditorValue:function(g,c,i,d,f){try{if(c.generation<0){return c.decription;}return g;}catch(h){return g;}}}],editSelectedRecord:function(){this.startEditing(this.getRecordIndex(this.getSelectedRecord()));
},removeSelectedRecord:function(){this.data.remove(this.getSelectedRecord());},editorEnter:function(){switch(this.getSelectedRecord().generation){case -1:this.endEditing();break;case 1:isc.say("Caution. Category was defined by a sub project");
break;}},editorExit:function(f,c,g,h,d){if(c.generation>=0){if(f!="escape"){c.dirty=true;c.imageIndicator=3;projectEditorCategory.changed();}}return true;}});a.addMember(primCatGrid);isc.ToolStrip.create({width:"100%",align:"right",border:"0px solid "+qrmCtrlColor,ID:"projectEditorPrimCatToolStrip",backgroundColor:qrmCtrlColor,layoutMargin:5,membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);
this.newBtn=isc.IButton.create({title:"Create New",click:function(){var c=primCatGrid.getData();c.push({contextID:projectID,description:"New Primary Category",generation:0,internalID:tempIndex--,parentID:1,sec:new Array(),dirty:true,imageIndicator:3});
primCatGrid.setData([]);primCatGrid.setData(c);projectEditorCategory.changed();}});this.delBtn=isc.IButton.create({title:"Delete",disabled:true,click:function(){if(primCatGrid.getSelectedRecord().generation>=0){if(primCatGrid.getSelectedRecord().internalID>0){projectEditorCategory.deleteCats.push(primCatGrid.getSelectedRecord().internalID);
}primCatGrid.removeSelectedRecord();secCatGrid.setData([]);projectEditorPrimCatToolStrip.delBtn.disable();projectEditorPrimCatToolStrip.editBtn.disable();projectEditorCategory.changed();}}});this.editBtn=isc.IButton.create({title:"Edit",disabled:true,click:function(){projectEditorCategory.changed();
primCatGrid.editSelectedRecord();}});this.addMembers([this.newBtn,this.delBtn,this.editBtn]);}});a.addMembers([isc.Legend.create(),projectEditorPrimCatToolStrip]);var b=isc.VLayout.create({width:"50%",membersMargin:5,layoutMargin:5});
isc.ListGrid.create({ID:"secCatGrid",alternateRecordStyles:true,modalEditing:true,parseValueAlert:false,recordClick:function(){if(this.getSelectedRecord().generation>=0){projectEditorSecCatToolStrip.delBtn.enable();
projectEditorSecCatToolStrip.editBtn.enable();}else{projectEditorSecCatToolStrip.delBtn.disable();projectEditorSecCatToolStrip.editBtn.disable();}},fields:[{name:"imageIndicator",title:"Status",canEdit:false,type:"image",align:"center",width:70,imageURLPrefix:"leg",imageURLSuffix:".png"},{name:"description",type:"text",title:"Secondary Category",canEdit:true,editorEnter:function(c,f,g,d){this.parseValueAlert=false;
},parseEditorValue:function(g,c,i,d,f){try{if(c.generation<0){return c.decription;}return g;}catch(h){return g;}}}],editSelectedRecord:function(){this.startEditing(this.getRecordIndex(this.getSelectedRecord()));
},editorEnter:function(){switch(this.getSelectedRecord().generation){case -1:this.endEditing();break;case 1:isc.say("Caution. Category was defined by a sub project");break;}},editorExit:function(f,c,g,h,d){if(c.generation>=0){if(f!="escape"){c.imageIndicator=3;
c.dirty=true;projectEditorCategory.changed();}}return true;}});b.addMember(secCatGrid);isc.ToolStrip.create({width:"100%",align:"right",ID:"projectEditorSecCatToolStrip",border:"0px solid "+qrmCtrlColor,backgroundColor:qrmCtrlColor,layoutMargin:5,membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);
this.newBtn=isc.IButton.create({title:"Create New",disabled:true,click:function(){secCatGrid.endEditing();var d={contextID:projectID,description:"New Secondary Category",generation:0,internalID:tempIndex--,parentID:primCatGrid.getSelectedRecord().internalID,sec:null,imageIndicator:3,dirty:true};
var c=primCatGrid.getSelectedRecord();if(!c.sec){c.sec=new Array();}c.sec.push(d);secCatGrid.setData([]);secCatGrid.setData(c.sec);projectEditorCategory.changed();projectEditorSecCatToolStrip.delBtn.disable();
projectEditorSecCatToolStrip.editBtn.disable();}});this.delBtn=isc.IButton.create({title:"Delete",disabled:true,click:function(){var c=secCatGrid.getSelectedRecord();var d=primCatGrid.getSelectedRecord();
if(c.internalID>0){projectEditorCategory.deleteCats.push(c.internalID);d.sec.remove(c);secCatGrid.setData(d.sec);projectEditorSecCatToolStrip.delBtn.disable();projectEditorSecCatToolStrip.editBtn.disable();
projectEditorCategory.changed();}}});this.editBtn=isc.IButton.create({title:"Edit",disabled:true,click:function(){projectEditorCategory.changed();secCatGrid.editSelectedRecord();projectEditorSecCatToolStrip.delBtn.disable();
projectEditorSecCatToolStrip.editBtn.disable();}});this.addMembers([this.newBtn,this.delBtn,this.editBtn]);}});b.addMembers([isc.Legend.create(),projectEditorSecCatToolStrip]);return isc.HLayout.create({width:"100%",ID:"projectEditorCategory",deleteCats:new Array(),backgroundColor:qrmCtrlColor,membersMargin:5,members:[a,b],layoutMargin:0,changed:function(){this.dirty=true;
qoProjectManager.projectEditorDirty();},saveFn:function(){isc.RPCManager.sendRequest({evalResult:true,params:{PROJECTID:project.projectID,DATA:(JSON.stringify(primCatGrid.getData())),DATADELETE:(JSON.stringify(projectEditorCategory.deleteCats))},callback:function(f,d,c){resetProject(project.projectID);
this.dirty=false;this.deleteCats.clear();},actionURL:"./saveProjectCategories"});},resetFn:function(){primCatGrid.setData([]);secCatGrid.setData([]);projectEditorPrimCatToolStrip.newBtn.enable();projectEditorPrimCatToolStrip.delBtn.disable();
projectEditorPrimCatToolStrip.editBtn.disable();projectEditorSecCatToolStrip.delBtn.disable();projectEditorSecCatToolStrip.editBtn.disable();projectEditorSecCatToolStrip.newBtn.disable();resetProject(project.projectID);
this.dirty=false;}});};this.getPaneSecurity=function(){return isc.VLayout.create({width:"100%",ID:"projectEditorSecurity",backgroundColor:qrmCtrlColor,membersMargin:5,layoutMargin:5,changed:function(){this.dirty=true;
qoProjectManager.projectEditorDirty();},saveFn:function(){},resetFn:function(){resetProject(project.projectID);this.dirty=false;}});};this.getPaneMatrix=function(){return isc.VLayout.create({width:"100%",ID:"projectEditorMatrix",backgroundColor:qrmCtrlColor,membersMargin:5,layoutMargin:5,autoDraw:false,initWidget:function(){this.Super("initWidget",arguments);
this.addMember(isc.MatrixEditor.create());},setDirty:function(){this.changed();},changed:function(){this.dirty=true;qoProjectManager.projectEditorDirty();},saveFn:function(){isc.RPCManager.sendRequest({evalResult:true,params:{PROJECTID:project.projectID,DATA:(JSON.stringify(matEditor.getData()))},callback:function(c,b,a){resetProject(project.projectID);
this.dirty=false;},actionURL:"./saveProjectMatrix"});},resetFn:function(){matEditor.reset();qoProjectManager.projectEditorClean();resetProject(project.projectID);this.dirty=false;}});};this.getPaneConsequences=function(){isc.ListGrid.create({height:"100%",ID:"EditorQuantTypesGrid",alternateRecordStyles:true,modalEditing:true,canEdit:true,editorEnter:function(){switch(this.getSelectedRecord().generation){case -1:this.endEditing();
break;case 1:isc.say("Caution. Consequence was defined by a sub project");break;}},editSelectedRecord:function(){this.startEditing(this.getRecordIndex(this.getSelectedRecord()));},editorExit:function(c,a,d,f,b){if(a.generation>=0){if(c!="escape"){a.dirty=true;
a.imageIndicator=2;projectEditorConsequence.changed();}}return true;},parseEditorValue:function(d,a,g,b,c){try{if(a.generation<0){if(b==0){return a.decription;}else{if(b==1){return a.units;}else{return a.costCategroy;
}}}return d;}catch(f){return d;}},recordClick:function(){if(this.getSelectedRecord().generation>=0){projectEditorQuantToolStrip.delBtn.enable();projectEditorQuantToolStrip.editBtn.enable();projectEditorQuantToolStrip.newBtn.enable();
}else{projectEditorQuantToolStrip.delBtn.disable();projectEditorQuantToolStrip.editBtn.disable();projectEditorQuantToolStrip.newBtn.enable();}},fields:[{name:"imageIndicator",title:"Status",canEdit:false,type:"image",align:"center",width:70,imageURLPrefix:"leg",imageURLSuffix:".png"},{name:"description",title:"Quantifiable Consequence"},{name:"units",title:"Units",align:"center",width:120},{name:"costCategroy",title:"Cost Category",align:"center",type:"boolean",defaultValue:false,width:120}]});
isc.ToolStrip.create({width:"100%",align:"right",ID:"projectEditorQuantToolStrip",border:"0px solid "+qrmCtrlColor,backgroundColor:qrmCtrlColor,layoutMargin:5,membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);
this.newBtn=isc.IButton.create({title:"Create New",click:function(){projectEditorConsequence.changed();project.impactTypes.add({typeID:tempIndex--,description:"New Quantifiable Consequence",units:"Units",costCategroy:false,generation:0,imageIndicator:3,dirty:true});
EditorQuantTypesGrid.setData(project.impactTypes);}});this.delBtn=isc.IButton.create({title:"Delete",disabled:true,click:function(){if(EditorQuantTypesGrid.getSelectedRecord().generation>=0){projectEditorConsequence.changed();
projectEditorConsequence.deleteCons.push(EditorQuantTypesGrid.getSelectedRecord().typeID);project.impactTypes.remove(project.impactTypes.find("typeID",EditorQuantTypesGrid.getSelectedRecord().typeID));
EditorQuantTypesGrid.setData(project.impactTypes);}}});this.editBtn=isc.IButton.create({title:"Edit",disabled:true,click:function(){if(EditorQuantTypesGrid.getSelectedRecord().generation>=0){projectEditorConsequence.changed();
EditorQuantTypesGrid.editSelectedRecord();}}});this.addMembers([this.newBtn,this.delBtn,this.editBtn]);}});return isc.VLayout.create({width:"100%",ID:"projectEditorConsequence",backgroundColor:qrmCtrlColor,membersMargin:5,layoutMargin:5,deleteCons:new Array(),members:[EditorQuantTypesGrid,isc.Legend.create(),projectEditorQuantToolStrip],changed:function(){this.dirty=true;
qoProjectManager.projectEditorDirty();},saveFn:function(){isc.RPCManager.sendRequest({evalResult:true,params:{PROJECTID:project.projectID,DATA:(JSON.stringify(EditorQuantTypesGrid.getData())),DATADELETE:(JSON.stringify(projectEditorConsequence.deleteCons))},callback:function(c,b,a){resetProject(project.projectID);
this.dirty=false;this.deleteCons.clear();},actionURL:"./saveProjectCons"});},resetFn:function(){resetProject(project.projectID);this.dirty=false;}});};this.defineMgrWidgets=function(){isc.defineClass("MatrixElement","Label");
isc.MatrixElement.addProperties({autoDraw:false,height:20,width:20,align:"center",valign:"center",backgroundColor:"gray",wrap:false,state:0,prob:0,impact:0,probimpact:0,active:false,qrmelement:true,cursor:"hand",qrmEnable:function(a){this.active=a;
if(a){this.state=1;this.setBackgroundColor("00ff00");}},reset:function(){this.state=0;this.setBackgroundColor("gray");this.qrmEnable(false);},click:function(){if(!this.active){return;}switch(this.state){case 0:this.setBackgroundColor("#00ffff");
this.state=1;break;case 1:this.setBackgroundColor("#00ff00");this.state=2;break;case 2:this.setBackgroundColor("#ffff00");this.state=3;break;case 3:this.setBackgroundColor("#ffa500");this.state=4;break;
case 4:this.setBackgroundColor("#ff0000");this.state=5;break;case 5:this.setBackgroundColor("#00ffff");this.state=1;break;}try{projectEditorMatrix.setDirty();parentElement.setDirty();}catch(a){}}});isc.defineClass("MatrixEditor","TileLayout");
isc.MatrixEditor.addProperties({ID:"matEditor",height:"100%",width:"100%",autoDraw:true,layoutPolicy:"fit",tilesPerLine:9,expandMargins:false,tileHeight:25,tileWidth:25,tileMargin:2,maxProb:0,maxImpact:0,lockMatrix:false,dirty:false,checkProbChange:function(b,a){if((b&&a!=this.maxProb+1)||(!b&&a!=this.maxProb)||this.lockMatrix){return false;
}this.maxProb=(b)?a:a-1;this.setDirty();return true;},setDirty:function(){if(!this.dirty){this.dirty=true;try{this.parentElement.setDirty();}catch(a){}}},setLockMatrix:function(c){this.lockMatrix=c;var b=this.tiles.findAll("qrmelement",true);
for(var a=0;a<64;a++){if(!c){var d=b[a];if(d.prob<=this.maxProb&&d.impact<=this.maxImpact){d.active=true;}else{d.active=false;}}else{b[a].active=false;}if(b[a].state==0){if(c){b[a].setBackgroundColor("#eee9e9");
}else{b[a].setBackgroundColor("gray");}}}},checkImpactChange:function(b,a){if((b&&a!=this.maxImpact+1)||(!b&&a!=this.maxImpact)||this.lockMatrix){return false;}this.maxImpact=(b)?a:a-1;this.setDirty();
return true;},enableProb:function(b,f){var d=this.tiles.findAll("prob",b);var c=this.tiles.findAll("qrmProbCheck",true).find("index",b);if(f){c.getItems()[1].enable();c.getItems()[2].enable();c.getItems()[1].setValue("Probability Description");
c.getItems()[2].setValue("Max Prob.");for(var a=0;a<8;a++){if(d[a].impact<=this.maxImpact){d[a].qrmEnable(true);}}}else{c.getItems()[1].disable();c.getItems()[2].disable();c.getItems()[1].setValue("");
c.getItems()[2].setValue(0);for(var a=0;a<8;a++){d[a].reset();}}},enableImpact:function(f,d){var b=this.tiles.findAll("impact",f);var c=matrixImpactDesc.members.sortByProperty("index",true);try{if(d){c[f].getItems()[0].setValue("Impact Description");
c[f].show();for(var a=0;a<8;a++){if(b[a].prob<=this.maxProb){b[a].qrmEnable(true);}}}else{c[f].getItems()[0].setValue("Impact Description");c[f].hide();for(var a=0;a<8;a++){b[a].reset();}}}catch(g){alert(c+" "+g.message);
}},getTolString:function(){try{var b=this.tiles.findAll("qrmelement",true);var g=b.findAll("active",true);var f=g.sortByProperty("probimpact",true);var d=f[0].state.stringify(1);for(var a=1;a<f.length;
a++){d=d+f[a].state.stringify(1);}return d;}catch(c){return null;}},setTolString:function(c){this.reset();this.maxProb=c.maxProb;this.maxImpact=c.maxImpact;for(var h=1;h<=c.maxProb;h++){var f=this.tiles.findAll("qrmelement",true);
for(var b=1;b<=c.maxImpact;b++){var a=f.find("probimpact",h*100+b);a.active=true;a.state=parseInt(c.tolString.substr((h-1)*c.maxImpact+b-1,1)-1,10);a.click();}var a=this.tiles.findAll("qrmProbCheck",true).find("index",h);
a.setValues(c);var g=a.getItems();g[0].setValue(true);g[1].enable();g[2].enable();}var j=this.tiles.findAll("qrmImpactCheck",true);for(var b=1;b<=c.maxImpact;b++){j.find("index",b).getItems()[0].setValue(true);
}var d=matrixImpactDesc.members.sortByProperty("index",true);for(var b=1;b<=c.maxImpact;b++){d[b].show();d[b].setValues(c);}},getData:function(){var a=new Object();a.tolString=this.getTolString();a.maxProb=this.maxProb;
a.maxImpact=this.maxImpact;a.matrixID=project.matrix.matrixID;a.projectID=project.matrix.projectID;var c=this.tiles.findAll("qrmProbCheck",true).sortByProperty("index",true);a.prob1=c[0].getItems()[1].getValue();
a.prob2=c[1].getItems()[1].getValue();a.prob3=c[2].getItems()[1].getValue();a.prob4=c[3].getItems()[1].getValue();a.prob5=c[4].getItems()[1].getValue();a.prob6=c[5].getItems()[1].getValue();a.prob7=c[6].getItems()[1].getValue();
a.prob8=c[7].getItems()[1].getValue();a.probVal1=c[0].getItems()[2].getValue();a.probVal2=c[1].getItems()[2].getValue();a.probVal3=c[2].getItems()[2].getValue();a.probVal4=c[3].getItems()[2].getValue();
a.probVal5=c[4].getItems()[2].getValue();a.probVal6=c[5].getItems()[2].getValue();a.probVal7=c[6].getItems()[2].getValue();a.probVal8=c[7].getItems()[2].getValue();var b=matrixImpactDesc.members.sortByProperty("index",true);
a.impact1=b[1].getItems()[0].getValue();a.impact2=b[2].getItems()[0].getValue();a.impact3=b[3].getItems()[0].getValue();a.impact4=b[4].getItems()[0].getValue();a.impact5=b[5].getItems()[0].getValue();a.impact6=b[6].getItems()[0].getValue();
a.impact7=b[7].getItems()[0].getValue();a.impact8=b[8].getItems()[0].getValue();a.tolAction5=tolActionForm.getItem("action5").getValue();a.tolAction4=tolActionForm.getItem("action4").getValue();a.tolAction3=tolActionForm.getItem("action3").getValue();
a.tolAction2=tolActionForm.getItem("action2").getValue();a.tolAction1=tolActionForm.getItem("action1").getValue();return a;},setClean:function(){this.dirty=false;try{parentElement.setDirty();}catch(a){}},reset:function(){this.setClean();
this.maxProb=0;this.maxImpact=0;var b=this.tiles.findAll("qrmelement",true);for(var a=0;a<64;a++){b[a].reset();}b=this.tiles.findAll("qrmProbCheck",true);for(var a=0;a<8;a++){b[a].reset();b[a].getItems()[0].setValue(false);
b[a].getItems()[1].disable();b[a].getItems()[2].disable();b[a].getItems()[2].setValue(null);}b=this.tiles.findAll("qrmImpactCheck",true);for(var a=0;a<8;a++){b[a].getItems()[0].setValue(false);}try{b=matrixImpactDesc.members;
for(var a=1;a<b.length;a++){b[a].hide();}}catch(c){alert(c.message);}},initWidget:function(){this.Super("initWidget",arguments);this.addTile(isc.Label.create({contents:"<b>Probability</b>"}));for(var d=1;
d<=7;d++){this.addTile(isc.Label.create({contents:""}));}var b=isc.VLayout.create({members:[isc.DynamicForm.create({fields:[{defaultValue:"Probability Description",type:"header"}],numCols:1})],layoutLeftMargin:130});
this.addTile(b);for(var h=8;h>0;h--){for(var d=1;d<=8;d++){this.addTile(isc.MatrixElement.create({prob:h,impact:d,probimpact:100*h+d}));}var a=isc.DynamicForm.create({fields:[{showTitle:false,type:"CheckboxItem",defaultValue:false,index:h,type:"CheckboxItem",change:function(k,j,l,i){if(k.parentElement.checkProbChange(l,this.index)){k.parentElement.enableProb(this.index,l);
return true;}return false;}},{showTitle:true,name:"prob"+h,title:"Probability&nbsp;"+h,width:200,change:function(k,j,l,i){k.parentElement.setDirty();}},{showTitle:false,name:"probVal"+h,type:"float",validateOnChange:true,validators:[{type:"floatRange",min:0,max:100}],width:70,change:function(k,j,l,i){k.parentElement.setDirty();
}}],qrmProbCheck:true,index:h,numCols:4,titleWidth:50,cellBorder:0});this.addTile(a);}for(var d=1;d<=8;d++){var a=isc.DynamicForm.create({fields:[{defaultValue:false,index:d,type:"CheckboxItem",showTitle:false,change:function(k,j,l,i){if(k.parentElement.checkImpactChange(l,this.index)){k.parentElement.enableImpact(this.index,l);
return true;}return false;}}],titleWidth:0,cellBorder:0,numCols:1,align:"center",titleWidth:0,index:d,qrmImpactCheck:true});this.addTile(a);}for(var d=1;d<=7;d++){this.addTile(isc.Label.create({contents:""}));
}this.addTile(isc.Label.create({contents:"<b>Impact</b>"}));this.addTile(isc.Label.create({contents:""}));this.addTile(isc.Label.create({contents:""}));var c=isc.HLayout.create({height:"100%",membersMargin:25});
var f=isc.VLayout.create({ID:"matrixImpactDesc",width:"100%"});var g=isc.DynamicForm.create({fields:[{defaultValue:"Impact Description",type:"header",width:300}],numCols:1});f.addMember(g);for(var h=1;
h<=8;h++){var a=isc.DynamicForm.create({fields:[{name:"impact"+h,title:"Impact&nbsp;"+h,showTitle:true,width:200,change:function(k,j,l,i){k.parentElement.parentElement.parentElement.setDirty();}}],index:h,qrmImpactDesc:true,numCols:2,titleWidth:100,cellBorder:0});
f.addMember(a);}isc.DynamicForm.create({ID:"tolActionForm",fields:[{defaultValue:"Tolerance Management Actions",type:"header",colSpan:2},{title:"<span style='color:white;font-weight:bold;background:red;padding:2px 5px 2px 5px;'>Tolerance&nbsp;4</span>",name:"action5",width:300,change:function(k,j,l,i){k.parentElement.parentElement.setDirty();
}},{title:"<span style='color:black;font-weight:bold;background:orange;padding:2px 5px 2px 5px;'>Tolerance&nbsp;3</span>",name:"action4",width:300,change:function(k,j,l,i){k.parentElement.parentElement.setDirty();
}},{title:"<span style='color:black;font-weight:bold;background:yellow;padding:2px 5px 2px 5px;'>Tolerance&nbsp;2</span>",name:"action3",width:300,change:function(k,j,l,i){k.parentElement.parentElement.setDirty();
}},{title:"<span style='color:black;font-weight:bold;background:#00ff00;padding:2px 5px 2px 5px;'>Tolerance&nbsp;1</span>",name:"action2",width:300,change:function(k,j,l,i){k.parentElement.parentElement.setDirty();
}},{title:"<span style='color:black;font-weight:bold;background:#00ffff;padding:2px 5px 2px 5px;'>Tolerance&nbsp;0</span>",name:"action1",width:300,change:function(k,j,l,i){k.parentElement.parentElement.setDirty();
}}],numCols:2,titleWidth:100});c.addMembers([f,tolActionForm]);this.addTile(c);this.reset();}});isc.defineClass("QRMReportAttachmentForm","DynamicForm");isc.QRMReportAttachmentForm.addProperties({encoding:"multipart",width:600,titleWidth:160,numCols:3,target:"_qrmFormTarget",action:"./QRMReportUpload?saveReport=true",fields:[{_constructor:"HeaderItem",defaultValue:"New Reports"},{title:"Report File or Archive",name:"UploadItem0",_constructor:"UploadItem",width:300},{name:"SubmitItem0",_constructor:"ButtonItem",title:"Install Reports",align:"left",startRow:false,click:function(){if(this.eventParent.validate()){this.eventParent.submitForm();
this.eventParent.clearValue("UploadItem0");}}},{name:"hostID",type:"hidden"},{name:"jsToReturn",type:"hidden",defaultValue:"alert('Report Uploaded');parent.resetCurrentProject()"},{name:"hostType",type:"hidden"}]});
isc.defineClass("Legend","VLayout");isc.Legend.addProperties({width:"100%",height:45,backgroundColor:qrmCtrlColor,membersMargin:2,initWidget:function(){this.Super("initWidget",arguments);this.LegendLabel=isc.Label.create({align:"left",valign:"center",width:"100%",height:15,margin:7,backgroundColor:qrmCtrlColor,wrap:false,contents:"<strong>Status Legend</strong>"});
this.Label1=isc.Label.create({align:"left",valign:"center",width:"100%",height:15,backgroundColor:qrmCtrlColor,icon:"leg4.png",wrap:false,contents:"Defined in a Higher Level project. <i><strong>Not Editable from Current Project</strong></i>"});
this.Label2=isc.Label.create({align:"left",valign:"center",width:"100%",height:15,backgroundColor:qrmCtrlColor,icon:"leg1.png",wrap:false,contents:"Defined in a Lower Level project. <i><strong>Editable</strong></i>"});
this.Label3=isc.Label.create({align:"left",valign:"center",width:"100%",height:15,backgroundColor:qrmCtrlColor,wrap:false,icon:"leg3.png",contents:"Modified or New Record <i><strong>Editable</strong></i>"});
this.Label4=isc.Label.create({align:"left",valign:"center",backgroundColor:qrmCtrlColor,width:"100%",height:15,wrap:false,icon:"leg5.png",contents:"Record defined in current selected project <i><strong>Editable</strong></i>"});
this.addMembers([this.LegendLabel,this.Label1,this.Label2,this.Label4,this.Label3]);}});};}function registerRiskInterest(b){try{if(ajaxRequest.readyState==3||ajaxRequest.readyState==2){ajaxRequest.abort();
}}catch(a){}ajaxRequest=null;ajaxRequest=$.ajax({url:pollURL+"?nocache="+Math.random()+"&action=registerRisk&userID="+userID+"&riskID="+b,type:"POST",timeout:60000,dataType:"json",success:function(c){ajaxRequest=null;
},error:function(c,f,d){if(f=="timeout"){isc.say("Connection to the serever lost. You will need to login to Quay Risk Manager. (MG001)",function(){window.open("./login.jsp","_self");});}}});}function startChatChannel(){var a=0;
try{a=qoRiskController.riskID;}catch(b){a=0;}ajaxChatRequest=$.ajax({url:pollURL+"?nocache="+Math.random()+"&action=poll&userID="+userID+"&riskID="+a,type:"POST",timeout:90000,dataType:"json",success:function(c){ajaxChatRequest=null;
if(c.sessionexpire){isc.say("Your session has expired. You will need to login to Quay Risk Manager.",function(){window.open("./login.jsp","_self");});}if(c.message){alert(c.message);startChatChannel();
return;}if(c.timeout){startChatChannel();return;}if(c.logout){return;}if(c.riskupdate){isc.ask("The risk has been updated by another user. Retrieve updated data?",function(d){if(d){getRiskAndDisplay(qoRiskController.riskID);
qoRiskController.allowEditorChanges=true;startChatChannel();return;}else{riskSaveBtn.setDisabled(true);riskSaveBtn.setTitle("<span style='color:#AAAAAA'>Save</span>");qoRiskController.allowEditorChanges=false;
isc.say("Saving of updates disabled until risk has been refreshed with new data.",function(){startChatChannel();return;});}});}if(c.reportupdate){qoQRM.ConcurrentPane.setProject();startChatChannel();return;
}},error:function(c,f,d){if(f=="timeout"){isc.say("Connection to the serever lost. You will need to login to Quay Risk Manager.",function(){window.open("./login.jsp","_self");});}}});}function constructApp(){try{isc.SectionStack.create({ID:"QRMNavigatorPanel",width:250,backgroundColor:"white",showResizeBar:true,visibilityMode:"multiple",animateSections:true,autoDraw:false,sections:[{title:"Project Navigator",autoShow:true,canCollapse:false,items:[createNavigatorLayout()]},{title:"QRM Guide",autoShow:true,canCollapse:true,items:[isc.HTMLPane.create({ID:"helpCanvas",contentsURL:"./html/riskTable_helpText.html",overflow:"auto",border:"1px solid #808080",padding:10,height:"40%"})]}]});
qoCurrent.Pane=qoQRM.RiskTablePane;qoCurrent.PaneNum=0;try{TabSet.create({ID:"RiskTableWindow",paneContainerProperties:{backgroundColor:qrmCtrlColor},backgroundColor:qrmCtrlColor,tabBarPosition:"top",tabs:[{title:"Risk Explorer",ID:"ExplorerPaneID",pane:qoQRM.RiskTablePane},{title:"Issues and Incidents",ID:"IncidentsPaneID",pane:qoQRM.IncidentPane},{title:"Project Overview",ID:"OverviewPaneID",pane:qoQRM.OverviewPane},{title:"Risk Calendar",ID:"CalendarPaneID",pane:qoQRM.CalPane},{title:"Summary and Propogated Risks",ID:"RelationPaneID",pane:qoQRM.RelationshipPane,tabDeselected:function(f,h,d,c,g,i){return qoQRM.RelationshipPane.navigateAway(false,i);
}},{title:"Risk Rank",ID:"RankPaneID",pane:qoQRM.RankPane,tabDeselected:function(f,h,d,c,g,i){return qoQRM.RankPane.navigateAway(false,i);}},{title:"Relative Matrix",ID:"MatrixPaneID",pane:qoQRM.RelMatrixPane,tabDeselected:function(f,h,d,c,g,i){return qoQRM.RelMatrixPane.navigateAway(false,i);
}},{title:"Analysis",ID:"AnalysisPaneID",pane:qoQRM.AnalysisPane},{title:"Reviews",ID:"ReviewPaneID",pane:qoQRM.ReviewPane},{title:"Reports",ID:"ReportPaneID",pane:qoQRM.ConcurrentPane}],tabSelected:function(h,d,c,f){qoCurrent.Pane=d;
qoCurrent.PaneNum=h;helpCanvas.setContentsURL(d.helpURL);projectSaveBtn.hide();projectResetBtn.hide();try{d.setProject();}catch(g){alert("QRM Utils line 112"+g.message);}if(c=="MatrixPaneID"){try{if(qoQRM.singlePhase){qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").hide();
}else{qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").show();}}catch(g){alert("Line 121 "+g.message);}}if(c=="RankPaneID"){SubjectiveRank.helpHTML.setContents(SubjectiveRank.helpHTML.contentsOrig);
}if(c=="IncidentsPaneID"){clearIncidentFilterGroup(true);}}});}catch(b){alert(b.message);}isc.QRMSaveButton.create({ID:"projectSaveBtn",disabled:true,click:function(){if(qoQRM.riskProjectEditMode=="project"){projectTabSet.getTabPane(projectTabSet.getSelectedTab()).saveFn();
}}});isc.QRMRefreshButton.create({ID:"projectResetBtn",disabled:true,click:function(){if(qoQRM.riskProjectEditMode=="project"){projectTabSet.getTabPane(projectTabSet.getSelectedTab()).resetFn();}}});isc.VLayout.create({backgroundColor:qrmCtrlColor,membersMargin:4,ID:"RightMainPane",layoutMargin:2,layoutTopMargin:2,layoutBottomMargin:2,layoutRightMargin:2,layoutLeftMargin:2,height:"100%",width:"100%",members:[RiskTableWindow],autoDraw:true});
isc.HLayout.create({membersMargin:2,ID:"mainBottomPanel",layoutMargin:2,layoutTopMargin:2,height:"100%",width:"100%",members:[QRMNavigatorPanel,RightMainPane],layoutBottomMargin:2,layoutRightMargin:2,layoutLeftMargin:2,resized:function(){try{if(idRiskEditorWindow.isVisible()){idRiskEditorWindow.setHeight(Math.min(MainPane.getHeight()*0.98,770));
idRiskEditorWindow.setWidth(Math.min(MainPane.getWidth()*0.95,1100));idRiskEditorWindow.centerInPage();}}catch(c){}try{if(viewEditReviewModalWindow.isVisible()){viewEditReviewModalWindow.setHeight(MainPane.getHeight()*0.95);
viewEditReviewModalWindow.setWidth(Math.min(MainPane.getWidth()*0.95,950));viewEditReviewModalWindow.centerInPage();}}catch(c){}}});isc.Menu.create({ID:"usernameMenu",showShadow:true,shadowDepth:10});usernameMenu.setData([{title:"Change Password/Secret Question",click:function(){isc.Window.create({title:"Change Password",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,showMinimizeButton:false,autoDraw:true,items:[isc.DynamicForm.create({width:400,titleWidth:150,padding:10,fields:[{type:"header",defaultValue:"Change Password"},{name:"passwordCurrent",type:"password",title:"Current Password",required:true},{name:"passwordNew",type:"password",title:"New Password",required:true},{name:"password2",title:"Password Again",type:"password",required:true,length:20,validators:[{type:"matchesField",otherField:"passwordNew",errorMessage:"Passwords do not match"},{type:"lengthRange",min:6,max:10,errorMessage:"Passwords must be at least 6 characters long"}]},{type:"header",defaultValue:"Secret Question/Answer for Forgotten Password"},{name:"secretQuestion",type:"text",title:"Secret Question",validators:[{type:"lengthRange",min:4,max:20}]},{name:"secretAnswer",type:"text",title:"Secret Answer",validators:[{type:"lengthRange",min:4,max:20}]},{name:"validateBtn",title:"Submit",type:"button",align:"right",colSpan:2,click:function(d,c){if(d.validate()){isc.RPCManager.sendRequest({actionURL:"./qrm",prompt:"Changing Password",evalResult:true,params:{OPERATION:"changePassword",DATA:JSON.stringify(d.getValues())},callback:function(h,g,f){if(g){isc.say("Password Changed Successfully");
}else{isc.say("Password Could Not Be Changed");}d.parentElement.parentElement.closeClick();}});}}}]})]});}},{isSeparator:true},{title:"Manage Risks",enableIf:"qoQRM.riskProjectEditMode == 'project' || qoQRM.riskProjectEditMode == 'rep' ",click:function(){toggleMode(0);
}},{title:"Manage Projects",enableIf:"qoQRM.riskProjectEditMode == 'risk' || qoQRM.riskProjectEditMode == 'rep' ",click:function(){toggleMode(1);}},{title:"Manage Repository",enableIf:"(qoQRM.riskProjectEditMode == 'risk' || qoQRM.riskProjectEditMode == 'project') && userID == 1 ",click:function(){toggleMode(2);
}},{isSeparator:true},{title:"Log Out",click:function(){logout();}}]);isc.ToolStripMenuButton.create({ID:"qrmHeaderUserName",title:userName,autoFit:true,showRollOver:false,menu:usernameMenu});isc.ToolStripButton.create({ID:"toolStripHelpBtn",title:"Guide",icon:"[SKIN]/actions/help.png",click:function(){qoQRM.showHelpWindow();
}});var a=isc.ToolStrip.create({defaultLayoutAlign:"center",layoutLeftMargin:10,layoutRightMargin:10,layoutBottonMargin:2,layoutTopMargin:2,membersMargin:4,height:25,width:"100%",members:[isc.Label.create({contents:"<span class='qrmMajorTitle'>Quay Risk Manager<span>",height:25,width:250}),isc.Label.create({height:20,ID:"projectLabel",padding:5,width:"100%",align:"left",valign:"top",wrap:false,showEdges:false,dynamicContents:true,contents:"<span class='qrmMajorTitle'>${qoQRM.projectTitleStr}</span>"}),projectSaveBtn,projectResetBtn,toolStripHelpBtn,qrmHeaderUserName]});
isc.VLayout.create({backgroundColor:qrmCtrlColor,membersMargin:2,ID:"MainPane",layoutMargin:2,layoutTopMargin:2,layoutBottomMargin:2,layoutRightMargin:2,layoutLeftMargin:2,height:"100%",width:"100%",members:[a,mainBottomPanel],autoDraw:true});
}catch(b){alert(b.message);}}function logout(){isc.RPCManager.sendRequest({actionURL:"./QRMServer",prompt:"Logging Out",params:{OPERATION:"logout"}});}function toggleMode(b){switch(qoQRM.riskProjectEditMode){case"risk":if(!qoCurrent.Pane.navigateAway(true)){return;
}break;case"project":if(qoProjectManager.dirtyEditor){isc.ask("Save Changes?",function(c){if(c){projectTabSet.getTabPane(projectTabSet.getSelectedTab()).saveFn();}else{projectTabSet.getTabPane(projectTabSet.getSelectedTab()).resetFn();
}});}break;case"rep":break;}switch(b){case 0:qoQRM.riskProjectEditMode="risk";projectSaveBtn.hide();projectResetBtn.hide();mainBottomPanel.show();try{RepMgrTabSet.hide();}catch(a){}RightMainPane.show();
DescendantsForm.show();try{ProjectEditorWindow.hide();}catch(a){}qoCurrent.PaneNum=qoQRM.defaultViewChoice;qoQRM.navigatorInit=false;clearFiltersBtn.disable();clearFilterGroup1();clearFilterGroup2();getUserProjects(true);
break;case 1:isc.RPCManager.sendRequest({evalResult:true,showPrompt:true,bypassCache:true,prompt:"Retrieving Managed Projects",callback:function(g,d,c){try{projects=d[0];if(projects.length<=0){isc.say(("You do not have Project Management Rights to any of the projects"),function(){return;
});}else{qoQRM.riskProjectEditMode="project";if(!qoQRM.mgrAdded){mainBottomPanel.addMember(qoProjectManager.constructMgrApp());qoQRM.mgrAdded=true;}navigatorContextMenu.setData([{title:"New Sub Project",icon:"icons/16/document_plain_new.png",click:function(){qoProjectManager.newProject();
}},{title:"Delete Project",icon:"icons/16/folder_out.png",click:function(){qoProjectManager.deleteProject();}},{title:"Export Project As Template",icon:"icons/16/export1.png",enableIf:"typeof(project) != 'string'",click:function(){isc.ask("Export project risks as well as the project?",function(h){if(h){open("./exportTemplate?RISKS=true&PROJECTID="+projectID,"_self");
}else{open("./exportTemplate?RISKS=false&PROJECTID="+projectID,"_self");}});}},{title:"Attach Template",click:function(){qoProjectManager.attachTemplate();}}]);projectSaveBtn.show();projectResetBtn.show();
mainBottomPanel.show();try{RepMgrTabSet.hide();}catch(f){}RightMainPane.hide();DescendantsForm.hide();ProjectEditorWindow.show();DescendantsForm.hide();ProjectEditorWindow.show();qoProjectManager.getUserMgrProjects(null,true);
}}catch(f){alert(f.message);}},actionURL:"./getUserMgmtProjects"});break;case 2:qoQRM.riskProjectEditMode="rep";if(!qoQRM.repMgrAdded){MainPane.addMember(constructRepMgrApp());qoQRM.repMgrAdded=true;}projectSaveBtn.hide();
projectResetBtn.hide();mainBottomPanel.hide();try{RepMgrTabSet.show();repMgrInit();}catch(a){alert(a.message);}qoQRM.projectTitleStr="Repository Manager";projectLabel.markForRedraw();break;}}function setFileMenuData(c,d,a){try{explorerActionMenu.setData([{title:"New Risk",enableIf:"(typeof(project.projectID) != 'undefined' && qoCurrent.PaneNum==0)?true:false",icon:"icons/16/document_plain_new.png",click:function(){newRisk(-1);
}},{title:"Delete Risk(s)",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",icon:"icons/16/close.png",click:function(){deleteRisks();}},{isSeparator:true},{title:"Remove Promotion",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",icon:"icons/16/uparrow.png",click:function(){unpromoteRisk();
}},{isSeparator:true},{title:"Print Registry Preview",icon:"icons/16/printer3.png",enableIf:"(qoCurrent.PaneNum==0)?true:false",click:function(){isc.Canvas.showPrintPreview(RiskTable);}},{isSeparator:true},{title:"Import Risks from File",icon:"icons/16/import.png",enableIf:"(typeof(project.projectID) != 'undefined' && qoCurrent.PaneNum==0)?true:false",click:function(){if(!qoReportEngine.checkTableSelection()){return;
}uploadImportedRisk();}},{title:"Update Project Contingency",enableIf:"(typeof(project.projectID) != 'undefined')",click:function(){isc.Window.create({ID:"percentileModalWindow",title:"Contingency Percentile",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[isc.DynamicForm.create({autoDraw:false,height:48,ID:"percentileForm",padding:4,fields:[{name:"percentile",title:"Percentile",type:"spinner",min:0,max:100,step:5,defaultValue:80},{type:"button",title:"Update Contingency",colSpan:2,align:"right",click:function(){percentileModalWindow.hide();
isc.RPCManager.sendRequest({prompt:"Updating Project Contingency Calculations",evalResult:false,params:{PROJECTID:project.projectID,DESCENDANTS:checkDescendants.getValue(),PERCENTILE:percentileForm.getItem("percentile").getValue()},callback:function(h,g,f){updateSelectedProject();
},actionURL:"./updateProjectContingency"});}}]})]});}},{isSeparator:true},d,c,{isSeparator:true},{title:"Monte Carlo Analysis",icon:"icons/16/dice.png",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",click:function(){if(!qoQRM.checkTableSelection()){return;
}initMonteCarlo();var g=new Date();var f=new Date();g.setFullYear(project.projectStartDate.substr(0,4),project.projectStartDate.substr(5,2),project.projectStartDate.substr(8,2));f.setFullYear(project.projectEndDate.substr(0,4),project.projectEndDate.substr(5,2),project.projectEndDate.substr(8,2));
monteCarloConfigForm.setValues({start:g,end:f});}},{title:"Schedule Review",icon:"icons/16/person.png",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",click:function(){if(!qoQRM.checkTableSelection()){return;
}scheduleReview();}},{title:"Associate with an Incident",icon:"icons/16/icon_add_files.png",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",click:function(){if(!qoQRM.checkTableSelection()){return;
}addRisksToIncident();}},{title:"Export As",icon:"icons/16/export1.png",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",submenu:[{title:"MS Excel",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",icon:"icons/16/disk_blue.png",click:function(){if(!qoQRM.checkTableSelection()){return;
}var f=getExportSubmitForm();f.setValues({OPERATION:"EXCEL",DATA:JSON.stringify(RiskTable.getSelection().getProperty("riskID"))});f.submitForm();}},{title:"XML",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",icon:"icons/16/disk_blue.png",click:function(){if(!qoQRM.checkTableSelection()){return;
}var f=getExportSubmitForm();f.setValues({OPERATION:"XML",DATA:JSON.stringify(RiskTable.getSelection().getProperty("riskID"))});f.submitForm();}},{title:"MS Project (MPX)",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",icon:"icons/16/disk_blue.png",click:function(){if(!qoQRM.checkTableSelection()){return;
}var f=getExportSubmitForm();f.setValues({OPERATION:"PROJECTMPX",DATA:JSON.stringify(RiskTable.getSelection().getProperty("riskID"))});f.submitForm();}},{title:"MS Project (XML)",enableIf:"(RiskTable.getSelection().length > 0 && qoCurrent.PaneNum==0 )?true:false",icon:"icons/16/disk_blue.png",click:function(){if(!qoQRM.checkTableSelection()){return;
}var f=getExportSubmitForm();f.setValues({OPERATION:"PROJECTXML",DATA:JSON.stringify(RiskTable.getSelection().getProperty("riskID"))});f.submitForm();}}]},a]);}catch(b){alert(b.message);}}function getUserProjects(a){qrmHeaderUserName.setTitle(userName);
qrmProjectMap.clear();try{projects="";project="";isc.RPCManager.sendRequest({showPrompt:true,prompt:"Retrieving User Projects",evalResult:true,actionURL:"./getUserProjects",bypassCache:true,callback:function(c,n,k){try{qoAll.clear();
projects=n[0];projects.setProperty("isFolder","true");for(var l=0;l<n[1].length;l++){qoAll.Users[n[1][l].stakeholderID]=n[1][l].name;}for(var g=0;g<n[2].length;g++){qoAll.Matrices[n[2][g].matrixID]=n[2][g];
}for(var f=0;f<n[3].length;f++){qoAll.Categories[n[3][f].internalID]=n[3][f];}qoValueMap.project=projects.getValueMap("projectID","projectTitle");qoAll.Objectives=n[4];qoAll.Objectives.remove(qoAll.Objectives.find("objectiveID",1));
qoAll.Objectives.add({objectiveID:1,parentID:-1,objective:"Objectives Impacted"});try{QRMNavigator.setData(isc.Tree.create({ID:"projectTreeData",modelType:"parent",showRoot:false,idField:"projectID",parentIdField:"parentID",data:projects}));
var j=n[5][1].submenu;j.addList(n[5][5].submenu);qoValueMap.projectReport=j.getValueMap("internalID","title");try{setFileMenuData(n[5][5],n[5][0],n[5][2]);}catch(m){alert("QRM Utils Line 565"+m);}try{var p=n[6];
p.remove(p.find("typeID",-1));for(var d=0;d<p.length;d++){qoValueMap.quantTypes[p[d].typeID]=p[d].description+" ("+p[d].units+")";}}catch(m){alert("QRM Utils Line 734"+m.message);}qoQRM.loggedOnUser=n[7];
userID=qoQRM.loggedOnUser.stakeholderID;QRMNavigator.getData().openAll();if(a){QRMNavigator.selectRecord(0);QRMNavigator.recordClick();}}catch(m){alert("Line 757 "+m.message);}var o=n[8];try{if(o.length>0){var h=isc.HLayout.create({height:30,width:"100%",align:"right",layoutMargin:5,members:[isc.IButton.create({title:"Close",autoFit:true,align:"right",click:function(){logonMessageModalWindow.closeClick();
}})]});isc.Window.create({ID:"logonMessageModalWindow",title:"Quay Risk Manager",width:600,height:400,showMinimizeButton:false,showCloseButton:true,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[isc.HTMLPane.create({width:"100%",height:"100%",showEdges:false,contents:o}),h]});
}}catch(m){}setTimeout(function(){startChatChannel();},5000);}catch(m){alert(m.message);}}});}catch(b){alert("QRM Utils Line 807"+b.message);}}function updateSelectedProject(h){qoQRM.projectTitleStr=project.projectTitle;
if(checkDescendants.getValue()){qoQRM.projectTitleStr=qoQRM.projectTitleStr+" (including sub projects)";}projectLabel.markForRedraw();qoStakeHolders.RiskManagers.clear();qoStakeHolders.RiskOwners.clear();
primCats.clear();secCats.clear();projectID=project.projectID;qoStakeHolders.RiskOwnersIDs=project.riskownersIDs;qoStakeHolders.RiskManagersIDs=project.riskmanagerIDs;projCats=project.riskCategorys;for(var c=0;
c<projCats.length;c++){primCats.push({primCatID:projCats[c].internalID,name:qoAll.Categories[projCats[c].internalID].description});try{var f=new Array();for(var a=0;a<projCats[c].sec.length;a++){f.push({secCatID:projCats[c].sec[a].internalID,name:qoAll.Categories[projCats[c].sec[a].internalID].description});
}secCats[projCats[c].internalID]=f;}catch(g){continue;}}for(var d=0;d<qoStakeHolders.RiskOwnersIDs.length;d++){qoStakeHolders.RiskOwners.push({stakeholderID:qoStakeHolders.RiskOwnersIDs[d],name:qoAll.Users[qoStakeHolders.RiskOwnersIDs[d]]});
}for(var b=0;b<qoStakeHolders.RiskManagersIDs.length;b++){qoStakeHolders.RiskManagers.push({stakeholderID:qoStakeHolders.RiskManagersIDs[b],name:qoAll.Users[qoStakeHolders.RiskManagersIDs[b]]});}qoValueMap.manager=qoStakeHolders.RiskManagers.getValueMap("stakeholderID","name");
qoValueMap.owner=qoStakeHolders.RiskOwners.getValueMap("stakeholderID","name");qoValueMap.categories=primCats.getValueMap("primCatID","name");qoCurrent.Matrix=project.matrix;try{if(!h){setActiveScreen();
}}catch(g){setActiveScreen();}}function createNavigatorLayout(){isc.TreeGrid.create({backgroundColor:qrmCtrlColor,showConnectors:true,height:"100%",ID:"QRMNavigator",autoDraw:false,autoFetchData:false,loadDataOnDemand:false,canAcceptDroppedRecords:true,canSort:false,folderIcon:"[SKIN]folder.png",nodeIcon:"[SKIN]folder.png",nameProperty:"projectTitle",contextMenu:isc.Menu.create({ID:"navigatorContextMenu"}),leafContextClick:function(c,a,b){if(qoQRM.riskProjectEditMode=="project"){if(!project||(project.projectID!=this.getSelectedRecord().projectID)){this.recordClick();
}}navigatorContextMenu.showContextMenu();return false;},folderContextClick:function(c,a,b){return this.leafContextClick(c,a,b);},fields:[{title:"Risk Projects",name:"projectTitle",formatCellValue:function(c,a,d,b){if(a.projectID>0){return c+" ("+a.projectCode+")";
}else{return c;}}}],drop:function(){try{var d=EventHandler.getDragTarget().cloneDragData();var c=this.getRecord(this.getEventRow());var a=c.projectTitle;if(d.getProperty("incidentID")!=null&&d.getProperty("incidentID")!=""&&d.length<=1){isc.Dialog.create({isModal:true,autoDraw:true,ID:"moveOrPromoteDialog",message:"Do you sure you wish to MOVE or PROMOTE the selected incident to project '"+a+"'?",icon:"[SKIN]ask.png",buttons:[isc.Button.create({title:"Move"}),isc.Button.create({title:"Promote"}),isc.Button.create({title:"Cancel"})],buttonClick:function(g,f){this.hide();
if(f==1||f==0){isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:(f==0)?"Reassigning Incident to '"+a+"'":"Promoting Incident to '"+a+"'",evalResult:false,params:{NEWPROJECTID:c.projectID,MOVEORPROMOTE:f,XFERINCIDENTS:JSON.stringify(d.getProperty("incidentID"))},callback:function(j,i,h){isc.say(i);
Issue.setProject();},actionURL:"./reassignIncidents"});}}});}else{isc.Dialog.create({isModal:true,autoDraw:true,ID:"moveOrPromoteDialog",message:"Do you sure you wish to MOVE or PROMOTE the selected risks to project '"+a+"'?",icon:"[SKIN]ask.png",buttons:[isc.Button.create({title:"Move"}),isc.Button.create({title:"Promote"}),isc.Button.create({title:"Cancel"})],buttonClick:function(g,f){this.hide();
if(f==1||f==0){isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:(f==0)?"Reassigning Risks to '"+a+"'":"Promoting Risks to '"+a+"'",evalResult:false,params:{NEWPROJECTID:c.projectID,MOVEORPROMOTE:f,XFERRISKS:JSON.stringify(d.getProperty("riskID"))},callback:function(j,i,h){isc.say(i);
updateSelectedProject();},actionURL:"./reassignRisks"});}}});}moveOrPromoteDialog.show();}catch(b){alert("QRM Utils Line 947"+b.message);}return false;},dataArrived:function(){this.getData().openAll();
},getCellCSSText:function(a,c,b){if(qoQRM.riskProjectEditMode=="project"){return"color:red;";}},recordClick:function(){qoQRM.navigatorInit=true;if(qoQRM.riskProjectEditMode=="project"){if(qoProjectManager.dirtyEditor){isc.ask("Save Changes?",function(a){if(a){projectTabSet.getTabPane(projectTabSet.getSelectedTab()).saveFn();
}else{projectTabSet.getTabPane(projectTabSet.getSelectedTab()).resetFn();}resetProject(QRMNavigator.getSelectedRecord().projectID);return;});}else{resetProject(this.getSelectedRecord().projectID);}}else{if(qrmProjectMap.get(QRMNavigator.getSelectedRecord().projectID)!=null&&qoQRM.descendantsCurrent){project=qrmProjectMap.get(QRMNavigator.getSelectedRecord().projectID);
qoQRM.singlePhase=project.singlePhase;updateSelectedProject();}else{qoQRM.projectTitleStr="";projectLabel.markForRedraw();isc.RPCManager.sendRequest({showPrompt:true,prompt:"Retrieving Risk Project",evalResult:false,params:{PROJECTID:this.getSelectedRecord().projectID,DESCENDANTS:checkDescendants.getValue()},callback:function(d,b,a){try{if(b.status){isc.say("Your session has expired or there has been a server connection error. You will need to login to Quay Risk Manager.",function(){window.open("./login.jsp","_self");
});}else{project=JSON.parse(b,dateParser);if(!project){isc.say("The risk repository has been updated.\n The risk project you selected is no longer available.");getUserProjects();RiskTable.ungroup();}else{qoQRM.descendantsCurrent=true;
qoQRM.singlePhase=project.singlePhase;updateSelectedProject();RiskTable.ungroup();qrmProjectMap.put(QRMNavigator.getSelectedRecord().projectID,project);}}}catch(c){getUserProjects(true);}},actionURL:"./getRiskProject"});
}}}});isc.DynamicForm.create({fields:[{ID:"checkDescendants",defaultValue:false,align:"left",name:"CheckboxItem0",title:"Include Descedant Projects",type:"CheckboxItem",startRow:true,changed:function(b,a,c){qoQRM.descendantsCurrent=false;
updateSelectedProject();}}],ID:"DescendantsForm",backgroundColor:qrmCtrlColor,align:"right",titleWidth:0,width:"100%",numCols:2});return isc.VLayout.create({backgroundColor:qrmCtrlColor,members:[QRMNavigator,DescendantsForm]});
}function setActiveScreen(){try{if(!qoQRM.navigatorInit){return;}qoCurrent.Pane.setProject();}catch(a){alert("Line 1123 "+a.message);}}function initMonteCarlo(){if(typeof(initMonteCarloModalWindow)=="undefined"){isc.Window.create({ID:"initMonteCarloModalWindow",title:"Monte Carlo Simulation Configuration",width:550,height:500,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,headerIconProperties:{src:"icons/16/dice.png"},items:[getMonteCarloLayout()]});
}else{initMonteCarloModalWindow.show();}MonteRiskTable.setData(RiskTable.getSelection());}function getMonteCarloLayout(){isc.ListGrid.create({width:"100%",height:"100%",alternateRecordStyles:true,selectionType:"none",ID:"MonteRiskTable",emptyMessage:"No Risks Were Selected",hoverWidth:200,hoverHeight:20,getBaseStyle:function(c,f,d){if(d==0){return"rankItem"+c.currentTolerance;
}else{return this.Super("getBaseStyle",arguments);}},fields:[{name:"riskProjectCode",title:"Risk Code",canEdit:false,width:80,align:"left"},{name:"title",title:"Title",align:"left",width:"100%"}]});var a=isc.DynamicForm.create({ID:"monteCarloConfigForm",numCols:2,titleWidth:200,hiliteRequiredFields:true,width:"100%",fields:[{name:"start",width:"300",title:"Start of Simulation Period",type:"date",startRow:true},{name:"end",width:"300",title:"End of Simulation Period",type:"date",startRow:true},{width:80,type:"text",name:"iterations",title:"Number of Iterations",keyPressFilter:"[0-9.]",validators:[{type:"integerRange",min:1000,max:5000}],defaultValue:2000},{name:"simType",type:"hidden",defaultValue:0},{name:"forceRiskActive",title:"Force Risks to be Active",type:"checkbox",defaultValue:false},{name:"forceConsequencesActive",title:"Force Consequences to be Active",type:"checkbox",defaultValue:false},{name:"reportFormatType",visible:false,valueMap:["PDF","HTML","MS Word","MS PowerPoint"],title:"Report Format",_constructor:"RadioGroupItem",defaultValue:"PDF",width:150,startRow:true}]});
var b=isc.ToolStrip.create({width:"100%",layoutMargin:5,membersMargin:5,height:24,saveFn:function(){if(monteCarloConfigForm.validate()){var c=monteCarloConfigForm.getValues();c.riskIDs=RiskTable.getSelection().getProperty("riskID");
isc.RPCManager.sendRequest({prompt:"Submitting Request",showPrompt:true,evalResult:true,params:{DATA:JSON.stringify(c),PROJECTID:project.projectID},callback:function(g,f,d){if(f<0){isc.say("Could not submit Monte Carlo Analysis Request");
initMonteCarloModalWindow.hide();}else{isc.say("Monte Carlo Analysis Submitted for Processing (ID: "+f+")<br/><br/>Use the 'Reports' tab to review results");initMonteCarloModalWindow.hide();qoQRM.ConcurrentPane.setProject(true);
}},actionURL:"./submiteMonteRequest"});}},initWidget:function(){this.Super("initWidget",arguments);var f=isc.IButton.create({title:"Submit",width:100,click:this.saveFn});var c=isc.IButton.create({title:"Cancel",width:100,click:function(){initMonteCarloModalWindow.hide();
}});var d=isc.Label.create({contents:"",width:"100%"});this.addMembers([d,f,c]);}});return isc.VLayout.create({membersMargin:5,layoutMargin:5,members:[a,MonteRiskTable,b],autoDraw:false});}function scheduleReview(){isc.Window.create({ID:"scheduleReviewModalWindow",title:"Schedule Review for Selected Risks",width:600,height:450,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[getScheduleReviewLayout()]});
ScheduleRiskTable.setData(RiskTable.getSelection());reviewSelectGridDS.fetchData();}function addRisksToIncident(){if(!checkTableSelection()){return;}isc.Window.create({ID:"addRisksToIncidentModalWindow",title:"Associate Risks To An Incident",width:600,height:450,showMinimizeButton:false,autoCenter:true,headerIconProperties:{src:"icons/16/icon_add_files.png"},isModal:true,showModalMask:true,autoDraw:true,closeClick:function(){updateSelectedProject();
},items:[getRiskToIncidentLayout()]});try{addRisksToIncidentModalWindow.show();RiskToIncidentTable.setData(RiskTable.getSelection());incidentSelectGridDS.fetchData();}catch(a){alert("QRM Utils Line 1346"+a.message);
}}function getRiskToIncidentLayout(){isc.ListGrid.create({width:"100%",height:"100%",top:10,alternateRecordStyles:true,selectionType:"none",ID:"RiskToIncidentTable",emptyMessage:"No Risks Were Selected",hoverWidth:200,hoverHeight:20,getBaseStyle:function(b,d,c){if(c==0){return"rankItem"+b.currentTolerance;
}else{return this.Super("getBaseStyle",arguments);}},fields:[{name:"riskProjectCode",title:"Risk Code",canEdit:false,width:80,align:"left"},{name:"title",title:"Title",align:"left",width:"100%"}]});isc.DynamicForm.create({ID:"riskToIncidentConfigForm",numCols:2,autoDraw:false,titleWidth:150,hiliteRequiredFields:true,width:"100%",fields:[{title:"Incident",required:true,name:"NewOrOld",_constructor:"RadioGroupItem",vertical:false,width:250,valueMap:{0:"New Incident",1:"Existing Incident"},defaultValue:0,changed:function(d,c,f,b){if(f==0){d.getItem("dateIncident").enable();
d.getItem("title").enable();d.getItem("existing").disable();}else{d.getItem("dateIncident").disable();d.getItem("title").disable();d.getItem("existing").enable();}return true;}},{_constructor:"RowSpacerItem"},{name:"dateIncident",width:300,title:"New Incident Date",type:"date"},{width:400,type:"text",name:"title",title:"New Incident Title"},{_constructor:"RowSpacerItem"},{width:400,editorType:"comboBox",name:"existing",disabled:true,title:"Existing Incident",optionDataSource:"incidentSelectGridDS",valueField:"incidentID"}]});
var a=isc.ToolStrip.create({autoDraw:false,width:"100%",layoutMargin:5,showReset:true,membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);this.sBtn=isc.QRMSaveButton.create({title:"Submit",click:function(){if(riskToIncidentConfigForm.validate()){var b=riskToIncidentConfigForm.getValues();
if(b.NewOrOld==0){b.dateIncident=simplifyDate(b.dateIncident);}b.riskIDs=RiskTable.getSelection().getProperty("riskID");isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({prompt:"Adding risk to incident",evalResult:true,params:{DATA:JSON.stringify(b)},callback:function(g,d,c){isc.RPCManager.showPrompt=true;
try{addRisksToIncidentModalWindow.hide();}catch(f){alert("QRM Utils Line 1475"+f.message);}if(d){isc.say("Risks were added to Incident");updateSelectedProject();}else{isc.say("Risk were *not* added to Incident");
}if(Issue.isVisible()){Issue.setProjectLocal();}},actionURL:"./updateIncidentRisks"});}}});this.cBtn=isc.QRMCancelButton.create({title:"Cancel",width:100,click:function(){addRisksToIncidentModalWindow.hide();
}});this.filler=isc.Label.create({contents:"",width:"100%"});this.addMembers([this.filler,this.sBtn,this.cBtn]);if(this.showReset){this.addMembers(this.rBtn);}}});return isc.VLayout.create({membersMargin:5,layoutMargin:5,members:[riskToIncidentConfigForm,RiskToIncidentTable,a]});
}function getScheduleReviewLayout(){isc.ListGrid.create({width:"100%",height:"100%",alternateRecordStyles:true,selectionType:"none",ID:"ScheduleRiskTable",emptyMessage:"No Risks Were Selected",hoverWidth:200,hoverHeight:20,getBaseStyle:function(b,d,c){if(c==0){return"rankItem"+b.currentTolerance;
}else{return this.Super("getBaseStyle",arguments);}},fields:[{name:"riskProjectCode",title:"Risk Code",canEdit:false,width:80,align:"left"},{name:"title",title:"Title",align:"left",width:"100%"}]});isc.DynamicForm.create({ID:"scheduleReviewConfigForm",numCols:2,autoDraw:false,titleWidth:150,hiliteRequiredFields:true,width:"100%",fields:[{title:"Review",required:true,name:"NewOrOld",_constructor:"RadioGroupItem",vertical:false,width:250,redrawOnChange:true,valueMap:{0:"New Review",1:"Existing Review"},defaultValue:0,changed:function(d,c,f,b){if(f==0){d.getItem("scheduled").enable();
d.getItem("description").enable();d.getItem("existing").disable();}else{d.getItem("scheduled").disable();d.getItem("description").disable();d.getItem("existing").enable();}return true;}},{_constructor:"RowSpacerItem"},{name:"scheduled",width:300,title:"New Review Date",type:"date"},{width:400,type:"text",name:"description",title:"New Review Description"},{_constructor:"RowSpacerItem"},{width:400,type:"select",name:"existing",disabled:true,title:"Existing Review",optionDataSource:"reviewSelectGridDS",pickListWidth:450,pickListFields:[{name:"title"},{name:"scheduledDate"}],valueField:"reviewID",displayField:"title",autoFetchData:false}]});
var a=isc.ToolStrip.create({autoDraw:false,width:"100%",layoutMargin:5,showReset:true,membersMargin:5,backgroundColor:"white",height:24,saveFn:function(){if(scheduleReviewConfigForm.validate()){var b=scheduleReviewConfigForm.getValues();
if(b.NewOrOld==0){b.scheduled=simplifyDate(b.scheduled);}b.riskIDs=RiskTable.getSelection().getProperty("riskID");isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:"Scheduling Review",evalResult:true,params:{DATA:JSON.stringify(b),PROJECTID:project.projectID},callback:function(g,d,c){try{scheduleReviewModalWindow.hide();
}catch(f){alert("QRM Utils Line 1621"+f.message);}if(d){isc.say("Risk Review Scheduled");}else{isc.say("Risk Review Was Not Able To Be Scheuled");}try{if(riskReviewLayout.isVisible()){getRiskReviewLayoutData();
}}catch(f){}try{if(Review.isVisible()){Review.setProjectLocal();}}catch(f){}},actionURL:"./scheduleReview"});}},initWidget:function(){this.Super("initWidget",arguments);var d=isc.QRMSaveButton.create({title:"Submit",click:this.saveFn});
var b=isc.QRMCancelButton.create({title:"Cancel",click:function(){scheduleReviewModalWindow.hide();}});var c=isc.Label.create({contents:"",width:"100%"});this.addMembers([c,d,b]);}});return isc.VLayout.create({membersMargin:5,layoutMargin:5,members:[scheduleReviewConfigForm,ScheduleRiskTable,a],autoDraw:false});
}function getScheduleReviewSimpleLayout(){var a=isc.DynamicForm.create({numCols:2,autoDraw:false,titleWidth:180,width:530,hiliteRequiredFields:true,width:"100%",fields:[{name:"scheduled",width:300,required:true,title:"Scheduled Review Date",type:"date"},{width:350,type:"text",name:"description",title:"Review Description"}]});
var b=isc.HLayout.create({autoDraw:false,width:"100%",layoutMargin:5,showReset:true,membersMargin:5,height:24,initWidget:function(){this.Super("initWidget",arguments);var f=isc.QRMSaveButton.create({title:"Submit",click:function(){if(a.validate()){var h=a.getValues();
h.scheduled=simplifyDate(h.scheduled);isc.RPCManager.sendRequest({prompt:"Scheduling Review",showPrompt:true,evalResult:true,params:{DATA:JSON.stringify(h),PROJECTID:project.projectID},callback:function(l,j,i){try{scheduleReviewSimpleModalWindow.hide();
}catch(k){alert("QRM Utils Line 1715"+k.message);}if(j){isc.say("Review Scheduled",function(){if(Review.isVisible()){Review.setProjectLocal();}});}else{isc.say("Review Was Not Able To Be Scheuled");}},actionURL:"./scheduleReview"});
}}});var c=isc.QRMCancelButton.create({click:function(){scheduleReviewSimpleModalWindow.hide();}});var d=isc.Label.create({contents:"",width:"100%"});try{this.addMembers([d,f,c]);}catch(g){alert("QRM Utils Line 1746"+g);
}}});return isc.VLayout.create({membersMargin:5,layoutMargin:5,width:535,members:[a,b]});}function addAttachment(a){if(typeof(attachmentModalWindow)=="undefined"){isc.Window.create({ID:"attachmentModalWindow",headerIconProperties:{src:"icons/16/icon_add_files.png"},title:"Add Attachment",width:520,height:250,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,showFooter:true,autoDraw:true,items:[getRiskAttachmentLayout()]});
}else{attachmentModalWindow.show();}RiskAttachmentForm.setValues({hostID:a,hostType:"RISK"});}function getRiskAttachmentLayout(){return isc.VLayout.create({height:"100%",width:"100%",membersMargin:5,layoutMargin:5,members:[isc.DynamicForm.create({encoding:"multipart",width:"450",titleWidth:"150",target:"_qrmFormTarget",ID:"RiskAttachmentForm",action:"./QRMAttachment?saveAttachment=true",fields:[{_constructor:"HeaderItem",defaultValue:"Attachment Details"},{title:"Description",required:true,name:"description",_constructor:"TextItem",width:300},{title:"Type of Attachment",required:true,name:"UrlOrFile",_constructor:"RadioGroupItem",vertical:false,width:300,redrawOnChange:true,valueMap:{0:"Link to Web Page (URL)",1:"File Attachment"}},{title:"URL",name:"url",_constructor:"TextItem",width:300,showIf:"form.getValue('UrlOrFile') == '0'",validators:[{type:"regexp",expression:"^(http|https|ftp|file|HTTP|HTTPS|FTP|FILE)://*"}]},{title:"File Attachment",name:"UploadItem0",_constructor:"UploadItem",width:300,showIf:"form.getValue('UrlOrFile') == '1'"},{_constructor:"RowSpacerItem"},{_constructor:"ToolbarItem",width:180,align:"right",buttons:[{_constructor:"ButtonItem",title:"Submit",click:function(b,a){if(b.validate()){b.submitForm();
}}},{_constructor:"ButtonItem",title:"Cancel",click:function(b,a){b.parentElement.parentElement.hide();}}]},{name:"hostID",type:"hidden"},{name:"hostType",type:"hidden"}]})]});}function deleteRisks(){isc.ask("Are you sure you want to delete the selected risks?",function(a){if(a){var b=RiskTable.getSelection().getProperty("riskID");
isc.RPCManager.sendRequest({prompt:"Deleting Risks",showPrompt:true,evalResult:true,params:{DATA:JSON.stringify(b),PROJECTID:project.projectID},callback:function(f,d,c){if(d){isc.say("Security Restriction: You were not authorised to delete one or more of the selected risks");
}updateSelectedProject();},actionURL:"./deleteRisks"});}});}function unpromoteRisk(){var a=RiskTable.getSelection().getProperty("riskID");isc.RPCManager.sendRequest({prompt:"Removing Promotion from Risk",showPrompt:true,evalResult:false,params:{DATA:JSON.stringify(a),PROJECTID:project.projectID},callback:function(d,c,b){isc.say(c);
updateSelectedProject();},actionURL:"./unpromoteRisks"});}function deleteRisk(b){try{isc.ask("Are you sure you want to delete the selected risk?",function(c){if(c){var d=new Array();d.add(b);isc.RPCManager.sendRequest({prompt:"Deleting Risks",showPrompt:true,evalResult:true,params:{DATA:JSON.stringify(d),PROJECTID:project.projectID},callback:function(h,g,f){if(g){isc.say("Security Restriction: You were not authorised to delete one or more of the selected risks");
}updateSelectedProject();},actionURL:"./deleteRisks"});}});}catch(a){alert("Line 1948 "+a.message);}}function qrmFindRisk(id){isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:"Finding Risk",evalResult:false,actionURL:"./findRisk",params:{RISKID:id,NOCACHE:Math.random()},callback:function(rpcResponse,data,rpcRequest){try{var foundRisk=eval(data);
if(!foundRisk.projectID){isc.say("Risk Could Not Be Found");DynamicFormTolerance.getItem("riskID").setValue(null);return;}else{findRiskCB(foundRisk);}}catch(e){isc.say("Risk Could Not Be Found");DynamicFormTolerance.getItem("riskID").setValue(null);
return;}}});}function findRiskCB(a){try{isc.RPCManager.sendRequest({prompt:"Getting Risk Project",showPrompt:true,evalResult:false,params:{PROJECTID:a.projectID,DESCENDANTS:checkDescendants.getValue()},callback:function(j,g,f){project=JSON.parse(g,dateParser);
updateSelectedProject(true);clearFiltersBtn.enable();setTolMatixCB(project);var c=-1;try{for(var d=0;QRMNavigator.getRecord(d).projectID!=project.projectID&&d<1000;d++){c++;}}catch(h){}QRMNavigator.selectSingleRecord(c+1);
qoQRM.RiskTablePane.RiskTable.fetchData({DESCENDANTS:checkDescendants.getValue(),PROJECTID:a.projectID,OPERATION:"getRiskLiteFetch",RISKID:a.riskID,PROCESSFILTER:true,TOLEX:true,TOLHIGH:true,TOLSIG:true,TOLMOD:true,TOLLOW:true,STATACTIVE:true,STATPENDING:true,STATINACTIVE:true,STATTREATED:true,STATUNTREATED:true,CATID:-1,OWNERID:-1,MANAGERID:-1,NOCACHE:Math.random()});
},actionURL:"./getRiskProject"});}catch(b){isc.say("Risk Could Not Be Found");DynamicFormTolerance.getItem("riskID").setValue(null);return;}}function getExportSubmitForm(){if(typeof(ExportSubmitForm)=="undefined"){isc.DynamicForm.create({autoDraw:true,ID:"ExportSubmitForm",visibility:"hidden",action:"./QRMMSFormat",canSubmit:true,fields:[{name:"OPERATION",type:"hidden"},{name:"DATA",type:"hidden"}]});
}return ExportSubmitForm;}function uploadImportedRisk(){isc.Window.create({ID:"riskUploadFormWindow",title:"Select Risk File to Import",width:500,height:260,canDragReposition:false,canDragResize:false,autoCenter:true,isModal:true,showModalMask:true,showMinimizeButton:false,layoutMargin:5,headerIconProperties:{src:"icons/16/import.png"},autoDraw:true,items:[isc.Label.create({wrap:true,width:"100%",contents:"<b>Importing Risks</b><br/><br/>Select the file containing the risks. After the file has been uploaded you will be able to select the specific risks you wish to import.<br/><br />Selected file must be in either QRM XML format or CSV (Comma Separated Variable) format"}),isc.QRMImportAttachmentForm.create({ID:"importUploadFileWidget"})]});
importUploadFileWidget.showForm(function(c){riskUploadFormWindow.hide();if(c=="FORMAT_ERROR"){isc.say("The uploaded file was not in a recognised format. <br/><br/>Please upload a QRM XML file or a CSV file");
}else{try{var a=JSON.parse(c);if(a.type=="CSV"){csvDefineAndChoose(a.colCount,a.myArr,a.key);}else{if(a.type=="XML"){selectUploadedRisks(a.myArr,a.key);}}}catch(b){isc.say(b.message);isc.say(rtnCode);}}});
}function selectUploadedRisks(b,f){try{waitingOnRiskUploadWindow.hide();}catch(d){}var a=new Array();for(var c=0;c<b.length;c++){a.add(b[c]);}try{isc.Window.create({title:"Select Risks to Import",ID:"selectRisksToImportGridWinXML",height:Math.min(MainPane.getHeight()*0.98,600),width:Math.min(MainPane.getWidth()*0.98,900),showMinimizeButton:false,canDragReposition:false,canDragResize:false,autoCenter:true,isModal:true,showModalMask:true,headerIconProperties:{src:"icons/16/import.png"},autoDraw:true,memberMargin:5,layoutMargin:5,items:[isc.ListGrid.create({ID:"importRiskList",width:"100%",height:"100%",alternateRecordStyles:true,selectionAppearance:"checkbox",canExpandRecords:true,expansionMode:"details",data:a,fields:[{name:"title",title:"Title",width:"50%"},{name:"description",title:"Description",width:"50%"}]}),isc.ToolStrip.create({width:"100%",layoutMargin:5,membersMargin:5,height:24,align:"right",initWidget:function(){this.Super("initWidget",arguments);
this.addMembers([isc.IButton.create({title:"Import Selected",width:150,click:function(){if(importRiskList.getSelection().length>50){isc.say("Maximum of 50 risks at a time may be imported");}else{var g=importRiskList.getSelection().getProperty("riskID");
g.addAt(f,0);isc.RPCManager.sendRequest({showPrompt:true,prompt:"Importing Selected Risks",evalResult:false,params:{DATA:JSON.stringify(g),PROJECTID:project.projectID},callback:function(j,i,h){isc.say(i,function(){try{selectRisksToImportGridWinXML.closeClick();
updateSelectedProject();}catch(k){alert("Line 2430 "+k);}});},actionURL:"./importRisks"});}}}),isc.IButton.create({title:"Cancel",width:100,click:function(){try{selectRisksToImportGridWin.closeClick();
}catch(g){alert("Line 2441 "+g);}}})]);}})]});}catch(d){alert("Line 2461 "+d);}}function csvDefineAndChoose(colCount,myArr,id){waitingOnRiskUploadWindow.hide();fieldValueMap={noImport:"Ignore",riskID:"QRM ID",riskProjectCode:"QRM Risk Code",externalID:"External ID",title:"Title",description:"Description",cause:"Cause",consequences:"Consequences",mitPlanSummary:"Mitigation Plan Summary",mitPlanSummaryUpdate:"Mitigation Plan Update",impact:"Impacts",estimatedContingency:"Estimated Contingency Cost",mitigationPlan:"Mitigation",estimatedMitigation:"Estimated Mitigation Cost",comment:"Comment or Update",primCat:"Primary Category",secCat:"Secondary Category",ownerID:"Risk Owner",managerID:"Risk Manager",inherentProb:"Inherent Probability",inherentImpact:"Inherent Impact",treatedProb:"Treated Probability",treatedImpact:"Treated Impact",isImpCost:"Impacts Cost",isImpEnvironment:"Impacts Environment",isImpReputation:"Impacts Reputation",isImpSafety:"Impacts Safety",isImpSpec:"Impacts Quality or Specification",isImpTime:"Impacts Schedule"};
var fieldArray=new Array();var formArray=new Array();var formArray1=new Array();formArray.add({colSpan:3,type:"HeaderItem",defaultValue:"2. Match to existing risks"});formArray.add({change:"form.getField('key').setDisabled(!value)",redrawOnChange:true,title:"Match to existing risks if possible",name:"matchRisk",colSpan:3,type:"checkbox",value:true});
formArray.add({type:"StaticTextItem",colSpan:2,defaultValue:"Select which field should be the key for identifying existing risks"});formArray.add({name:"key",title:"Key",colSpan:2,showTitle:true,type:"radioGroup",value:"externalID",vertical:false,valueMap:{internalID:"QRM Internal ID",qrmRiskCode:"QRM Risk Code",externalID:"ExternalID"}});
formArray.add({colSpan:3,type:"HeaderItem",defaultValue:"3. Map the imported columns to risk fields"});for(var i=0;i<colCount;i++){fieldArray.add({name:"column"+i,width:80,title:"Field "+i});formArray.add({name:"column"+i,width:160,title:"Field "+i,type:"select",redrawOnChange:true,index:i,value:"noImport",valueMap:fieldValueMap,changed:function(form,item,value){importRiskList.setFieldProperties(this.index+2,{title:fieldValueMap[value]});
}});formArray.add({index:i,showIf:function(item,value,form,values){var x="column"+this.index;var dep=values[x];if(dep=="riskID"||dep=="riskProjectCode"||dep=="primCat"||dep=="secCat"||dep=="managerID"||dep=="ownerID"||dep=="inherentProb"||dep=="treatedProb"||dep=="inherentImpact"||dep=="treatedImpact"||dep=="externalID"||dep=="noImport"||form.getValue("matchRisk")!=true){return false;
}else{return true;}},name:"action"+i,showTitle:false,type:"radioGroup",value:"replace",vertical:false,valueMap:{replace:"Replace",append:"Append"}});}formArray1.add({colSpan:3,type:"HeaderItem",defaultValue:"4. Optionally, provide a name to save as a template"});
formArray1.add({title:"Template",name:"newTemplateName",colSpan:2,type:"TextItem"});formArray1.add({colSpan:3,type:"HeaderItem",defaultValue:"5. Select the risks to import"});isc.DynamicForm.create({width:"100%",height:"100%",ID:"csvConfig0",colWidths:[80,160,50,"*"],numCols:4,fields:[{colSpan:4,type:"HeaderItem",defaultValue:"1. Optionally, select a template"},{defaultToFirstOption:false,autoFetchData:false,cachePickListResults:false,changed:"try {csvConfig.setValues(JSON.parse(value));csvConfig0.getField('deleteTemplateButton').enable();} catch(e){alert (e.message);}",title:"Template",name:"templateName",displayField:"templateName",valueField:"template",type:"select",optionDataSource:userTemplateDS},{type:"SpacerItem"},{click:function(form,item){isc.RPCManager.sendRequest({showPrompt:true,prompt:"Deleting Template",evalResult:false,params:{DATA:csvConfig0.getField("templateName").getDisplayValue()},callback:function(rpcResponse,data,rpcRequest){csvConfig0.getField("templateName").fetchData();
csvConfig0.reset();},actionURL:"./deleteImportTemplate"});},title:"Delete Template",type:"button",name:"deleteTemplateButton",showTitle:false,startRow:false,disabled:true}]});isc.DynamicForm.create({width:"100%",height:"100%",ID:"csvConfig",colWidths:[80,160,"*"],numCols:3,fields:formArray});
isc.DynamicForm.create({width:"100%",height:"100%",ID:"csvConfig1",colWidths:[80,160,"*"],numCols:3,fields:formArray1});var dataArray=new Array();for(;i<myArr.length;i++){dataArray.add(myArr[i]);}var formLayout=isc.VLayout.create({width:450,height:"100%",overflow:"scroll",members:[csvConfig0,csvConfig,csvConfig1]});
isc.ListGrid.create({ID:"importRiskList",width:"100%",height:"100%",alternateRecordStyles:true,selectionAppearance:"checkbox",canExpandRecords:true,expansionMode:"details",data:dataArray,fields:fieldArray});
var winLayoutH=isc.HLayout.create({width:"100%",height:"100%",members:[formLayout,importRiskList]});var winLayoutV=isc.VLayout.create({width:"100%",height:"100%",members:[winLayoutH,isc.ToolStrip.create({width:"100%",layoutMargin:5,membersMargin:5,height:24,align:"right",initWidget:function(){this.Super("initWidget",arguments);
this.addMembers([isc.IButton.create({title:"Import Selected",width:150,click:function(){try{var x=new Object();x.ids=importRiskList.getSelection().getProperty("id");x.tempFileID=id;x.config=csvConfig.getValues();
x.templateConfig=csvConfig1.getValues();x.projectID=projectID;isc.RPCManager.sendRequest({showPrompt:true,prompt:"Importing Selected Risks",evalResult:false,params:{DATA:JSON.stringify(x),PROJECTID:projectID},callback:function(rpcResponse,data,rpcRequest){selectRisksToImportGridWin.closeClick();
try{eval(data);}catch(e){alert(e.message);}updateSelectedProject();},actionURL:"./importRisksCSV"});}catch(e){alert(e.message);}}}),isc.IButton.create({title:"Cancel",width:100,click:function(){selectRisksToImportGridWin.closeClick();
isc.RPCManager.sendRequest({showPrompt:false,params:{DATA:id},actionURL:"./cancelImport"});}})]);}})]});isc.Window.create({title:"Select Risks to Import",ID:"selectRisksToImportGridWin",height:MainPane.getHeight()*0.9,width:MainPane.getWidth()*0.9,showMinimizeButton:false,canDragReposition:false,canDragResize:true,autoCenter:true,isModal:true,showModalMask:true,headerIconProperties:{src:"icons/16/import.png"},autoDraw:true,memberMargin:5,layoutMargin:5,items:winLayoutV});
}function promptForProbAndImpactMap(h,f,c){var d=isc.ListGrid.create({ID:"probRankTable",canReorderRecords:true,dragDataAction:"MOVE",dragTrackerMode:"record",dragTrackrtStyle:"gridDragTrackerQRM",showAllRecords:true,alternateRecordStyles:true,canSort:false,data:h,fields:[{name:"probDesc",width:"100%",title:"Probability Description"}]});
var g=isc.ListGrid.create({ID:"impactRankTable",canReorderRecords:true,dragDataAction:"MOVE",dragTrackerMode:"record",dragTrackerStyle:"gridDragTrackerQRM",showAllRecords:true,alternateRecordStyles:true,canSort:false,data:f,fields:[{name:"impactDesc",width:"100%",title:"Impact Description"}]});
var b=isc.HLayout.create({width:"100%",height:"100%",membersMargin:5,layoutMargin:5,members:[d,g]});var i=isc.ToolStrip.create({width:"100%",layoutMargin:5,membersMargin:5,height:26,align:"right",initWidget:function(){this.addMembers([isc.QRMSaveButton.create({title:"Save and Import",width:150,click:function(){try{var n="";
var l="";if(d.data[0]){n=d.data[0].probDesc;var p=d.data;for(var k=1;k<p.length;k++){n=n+"##"+p[k].probDesc;}}if(g.data[0]){l=g.data[0].impactDesc;var m=g.data;for(var k=1;k<m.length;k++){l=l+"##"+m[k].impactDesc;
}}var j=new Object();j.probRank=n;j.impactRank=l;j.tempFileID=c;probImportConfigWin.closeClick();isc.RPCManager.sendRequest({showPrompt:true,prompt:"Save and Import",evalResult:false,params:{DATA:JSON.stringify(j),PROJECTID:projectID},callback:function(s,r,q){updateSelectedProject();
},actionURL:"./importRisksCSVWithRanks"});}catch(o){alert(o.message);}}}),isc.IButton.create({title:"Cancel",width:100,click:function(){try{probImportConfigWin.closeClick();}catch(j){alert("Line 2441 "+j);
}isc.RPCManager.sendRequest({showPrompt:false,params:{DATA:c},actionURL:"./cancelImport"});}})]);}});var a=isc.VLayout.create({width:"100%",height:"100%",membersMargin:2,layoutMargin:5,members:[isc.Label.create({height:20,contents:"Drag the probability and impact description into rank order from highest to lowest."}),b,i]});
isc.Window.create({title:"Define Probability and Impact Rank",ID:"probImportConfigWin",height:400,width:600,showMinimizeButton:false,canDragReposition:false,canDragResize:true,autoCenter:true,isModal:true,showModalMask:true,headerIconProperties:{src:"icons/16/import.png"},autoDraw:true,memberMargin:5,layoutMargin:5,items:a});
}function calcProb(d,a){var i=(d.endExposure.getTime()-d.startExposure.getTime())/(1000*60*60*24);var b=0;var c=0;var g=0;if(a){g=d.liketype;}else{g=d.likepostType;}try{if(g==4){if(a){return d.likeprob*100;
}else{return d.likepostProb*100;}}else{if(a){b=d.likealpha;c=d.liket;}else{b=d.likepostAlpha;c=d.likepostT;}var j=b*(i/c);var h=1-(Math.exp(-j)*((Math.pow(j,0)/fact(0))));return h*100;}}catch(f){alert("QRM Utils Line 2522"+f.message);
return -1;}}function fact(a){if(a==0){return 1;}return a*fact(a-1);}function probFromMatrix(f,c){var d=0;var b=0;switch(parseInt(Math.floor(f),10)){case 1:d=0;b=c.probVal1;break;case 2:d=c.probVal1;b=c.probVal2;
break;case 3:d=c.probVal2;b=c.probVal3;break;case 4:d=c.probVal3;b=c.probVal4;break;case 5:d=c.probVal4;b=c.probVal5;break;case 6:d=c.probVal5;b=c.probVal6;break;case 7:d=c.probVal6;b=c.probVal7;break;
case 8:d=c.probVal7;b=c.probVal8;break;}var a=d+(b-d)*(f-Math.floor(f));return a;}function probToMatrix(a,b){var c=0.5;if(b.probVal1!=null&&0<=a&&a<=b.probVal1&&b.maxProb>=1){c=1+(a/b.probVal1);}if(b.probVal1!=null&&b.probVal2!=null&&b.probVal1<a&&a<=b.probVal2&&b.maxProb>=2){c=2+((a-b.probVal1)/(b.probVal2-b.probVal1));
}if(b.probVal2!=null&&b.probVal3!=null&&b.probVal2<a&&a<=b.probVal3&&b.maxProb>=3){c=3+((a-b.probVal2)/(b.probVal3-b.probVal2));}if(b.probVal3!=null&&b.probVal4!=null&&b.probVal3<a&&a<=b.probVal4&&b.maxProb>=4){c=4+((a-b.probVal3)/(b.probVal4-b.probVal3));
}if(b.probVal4!=null&&b.probVal5!=null&&b.probVal4<a&&a<=b.probVal5&&b.maxProb>=5){c=5+((a-b.probVal4)/(b.probVal5-b.probVal4));}if(b.probVal5!=null&&b.probVal6!=null&&b.probVal5<a&&a<=b.probVal6&&b.maxProb>=6){c=6+((a-b.probVal5)/(b.probVal6-b.probVal5));
}if(b.probVal6!=null&&b.probVal7!=null&&b.probVal6<a&&a<=b.probVal7&&b.maxProb>=7){c=7+((a-b.probVal6)/(b.probVal7-b.probVal6));}if(b.probVal7!=null&&b.probVal8!=null&&b.probVal7<a&&a<=b.probVal8&&b.maxProb==8){c=8+((a-b.probVal7)/(b.probVal8-b.probVal7));
}return c;}function getRiskAndDisplay(b){try{getRiskAndDisplayInt(b);}catch(a){alert(a.message);}}function getRiskCodeAndDisplay(b){try{getRiskCodeAndDisplayInt(b);}catch(a){alert(a.message);}}function defineRiskTableWidget(){isc.defineClass("RiskTableWidget","VLayout");
isc.RiskTableWidget.addProperties({helpURL:"./html/riskTable_helpText.html",backgroundColor:qrmCtrlColor,visibiliy:"inherit",initWidget:function(){this.Super("initWidget",arguments);this.RiskTable=isc.ListGrid.create({ID:"RiskTable",dataSource:riskLiteDS,alternateRecordStyles:true,canDragSelect:false,emptyMessage:"Select the Risk Project from the Navigator",canDragRecordsOut:true,hoverWidth:200,hoverHeight:20,showGridSummary:true,canExpandRecords:true,expansionMode:"details",recordDoubleClick:function(){qoRiskController.riskID=this.getSelectedRecord().riskID;
getRiskAndDisplayInt(qoRiskController.riskID,true);},getBaseStyle:function(b,d,c){if(c==0||c==1){return"rankItem"+b.currentTolerance;}else{return this.Super("getBaseStyle",arguments);}},groupStartOpen:"all",sortField:"currentTolerance",sortDirection:"descending",fields:[{name:"riskProjectCode",title:"Risk Code",width:95,canGroupBy:false,align:"left",summaryFunction:"count",canReorder:false,formatGridSummary:'return value+" Risks"',formatCellValue:function(c,b){if(b.summaryRisk&&b.promotionCode!="-"){return c+"* ("+b.toProjCode+")";
}else{if(b.promotionCode!="-"){return c+" ("+b.toProjCode+")";}else{if(b.summaryRisk){return c+"*";}else{return c;}}}}},{name:"currentTolerance",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,title:"Tolerance",type:"image",align:"center",width:70,canReorder:false,canGroupBy:true,imageURLPrefix:"tol",imageURLSuffix:".png",getGroupValue:function(d,b,f,g,c){return d;
},getGroupTitle:function(b,c,f,g,d){switch(b){case 5:return"Extreme";break;case 4:return"High";break;case 3:return"Significant";break;case 2:return"Moderate";break;case 1:return"Low";break;}}},{name:"title",title:"Title",align:"left",showGridSummary:false,showGroupSummary:false,canGroupBy:true,width:500},{name:"startExposure",title:"Start of Exposure",type:"date",align:"center",width:120,canGroupBy:true,showIf:"false",formatCellValue:function(b){if(b){return b.getShortMonthName()+" "+b.getDate()+", "+b.getFullYear();
}}},{name:"endExposure",title:"End of Exposure",type:"date",align:"center",width:120,canGroupBy:true,showIf:"false",formatCellValue:function(b){if(b){return b.getShortMonthName()+" "+b.getDate()+", "+b.getFullYear();
}}},{name:"ownerName",title:"Owner",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,width:120},{name:"manager1Name",title:"Manager",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,width:120,canGroupBy:true,showIf:"false"},{name:"estimatedContingencey",title:"Est. Contingency",type:"float",align:"center",canGroupBy:false,groupPrecision:1,width:120,showIf:"false",summaryFunction:"sum",showGridSummary:true,showGroupSummary:true,align:"right",formatCellValue:function(b){if(isc.isA.Number(b)){if(b==0){return"-";
}else{return b.toCurrencyString("$");}}else{var c=parseFloat(b);if(isc.isA.Number(c)){if(c==0){return"-";}else{return c.toCurrencyString("$");}}}return"-";}},{name:"mitigationCost",title:"Mitigation Cost",type:"float",align:"center",canGroupBy:false,groupPrecision:1,width:120,showIf:"false",summaryFunction:"sum",showGridSummary:true,showGroupSummary:true,align:"right",formatCellValue:function(b){if(isc.isA.Number(b)){if(b==0){return"-";
}else{return b.toCurrencyString("$");}}else{var c=parseFloat(b);if(isc.isA.Number(c)){if(c==0){return"-";}else{return c.toCurrencyString("$");}}}return"-";}},{name:"preMitContingency",title:"Contingency",type:"float",align:"center",canGroupBy:false,groupPrecision:1,width:100,showIf:"false",formatCellValue:function(d,b,f,c){if(b.treated){return b.postMitContingency;
}else{return b.preMitContingency;}},summaryFunction:"sum",showGridSummary:true,showGroupSummary:true,align:"right",formatCellValue:function(b){if(isc.isA.Number(b)){if(b==0){return"-";}else{return b.toCurrencyString("$");
}}else{var c=parseFloat(b);if(isc.isA.Number(c)){if(c==0){return"-";}else{return c.toCurrencyString("$");}}}return"-";}},{name:"contingencyPercentile",title:"Cont. Percentile",type:"float",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:false,groupPrecision:1,width:120,showIf:"false"},{name:"treatedImpact",title:"Treated Impact",type:"float",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,width:40,formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);
}return b;},showIf:"false"},{name:"treatedProb",title:"Treated Prob",type:"float",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,width:40,formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);
}return b;},showIf:"false"},{name:"inherentImpact",title:"Inherent Impact",type:"float",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,width:40,formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);
}return b;},showIf:"false"},{name:"inherentProb",title:"Inherent Prob",type:"float",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,canGroupBy:true,groupPrecision:1,align:"center",width:40,formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);
}return b;},showIf:"false"},{name:"riskID",title:"Risk ID",type:"integer",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,align:"center",width:0,canGroupBy:false,showIf:"false"},{name:"active",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,title:"Active",type:"boolean",canGroupBy:true,width:55,getGroupTitle:function(b,c,f,g,d){if(b){return"Active Risks";
}else{return"Dormant Risks";}}},{name:"treated",align:"center",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,title:"Treated",type:"boolean",canGroupBy:true,width:55}],expansionDetailsProperties:{height:200,width:"100%",overflow:"scroll",fields:[{name:"riskProjectCode",title:"Risk Code",canEdit:false,width:60,align:"left"},{name:"title",title:"Title",align:"left",width:"100%"},{name:"description",title:"Description",align:"left",width:"100%"},{name:"startExposure",title:"Start of Exposure",type:"date",align:"center",width:120,formatCellValue:function(b){if(b){return b.getShortMonthName()+" "+b.getDate()+", "+b.getFullYear();
}}},{name:"endExposure",title:"End of Exposure",type:"date",align:"center",width:120,formatCellValue:function(b){if(b){return b.getShortMonthName()+" "+b.getDate()+", "+b.getFullYear();}}},{name:"ownerName",title:"Owner",align:"center",width:120},{name:"manager1Name",title:"Manager",align:"center",width:120},{name:"treatedImpact",title:"Treated Impact",type:"double",align:"center",formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);
}return b;}},{name:"treatedProb",title:"Treated Prob",type:"double",align:"center",formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);}return b;}},{name:"inherentImpact",title:"Inherent Impact",type:"double",align:"center",formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);
}return b;}},{name:"inherentProb",title:"Inherent Prob",type:"double",align:"center",formatCellValue:function(b){if(isc.isA.Number(b)){return Math.floor(b);}return b;}},{name:"treated",title:"Treated",type:"boolean",width:55,formatCellValue:function(b){if(b){return"Yes";
}return"No";}}]}});this.RiskTable2=isc.ListGrid.create({ID:"RiskTable2",visibility:"hidden",headerHeight:40,dataSource:riskLiteDS,alternateRecordStyles:true,canDragSelect:false,emptyMessage:"Select the Risk Project from the Navigator",canDragRecordsOut:true,sortField:"currentTolerance",sortDirection:"descending",hoverWidth:200,hoverHeight:20,groupStartOpen:"all",cellContextClick:function(){riskTableContextMenu.showContextMenu();
return false;},recordDoubleClick:function(){qoRiskController.riskID=this.getSelectedRecord().riskID;getRiskAndDisplayInt(qoRiskController.riskID,true);},getBaseStyle:function(b,d,c){switch(c){case 0:return"rankItem"+b.currentTolerance;
break;case 2:if(b.dateIDRev==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);}break;case 3:if(b.dateIDApp==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);
}break;case 4:if(b.dateEvalRev==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);}break;case 5:if(b.dateEvalApp==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);
}break;case 6:if(b.dateMitRev==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);}break;case 7:if(b.dateMitApp==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);
}break;default:return this.Super("getBaseStyle",arguments);}},fields:[{name:"riskProjectCode",title:"Risk Code",width:95,canGroupBy:false,align:"left",formatCellValue:function(c,b){var d=c;if(b.summaryRisk){d=c+"*";
}if(b.promotionCode!="-"){return d+" ("+b.toProjCode+")";}else{return d;}}},{name:"title",title:"Title",align:"left",canGroupBy:true,width:"100%"},{name:"dateIDRev",title:"Reviewed",align:"center",width:70},{name:"dateIDApp",title:"Approved",align:"center",width:70},{name:"dateEvalRev",title:"Reviewed",align:"center",width:70},{name:"dateEvalApp",title:"Approved",align:"center",width:70},{name:"dateMitRev",title:"Reviewed",align:"center",width:70},{name:"dateMitApp",title:"Approved",align:"center",width:70},{name:"treated",title:"Treated",type:"boolean",canGroupBy:true,width:55}],headerSpans:[{fields:["dateEntered","dateIDRev","dateIDApp"],title:"Identification"},{fields:["dateEvalRev","dateEvalApp"],title:"Evaluation"},{fields:["dateMitRev","dateMitApp"],title:"Mitigation"}]});
this.RiskTable3=isc.ListGrid.create({ID:"RiskTable3",visibility:"hidden",headerHeight:40,dataSource:riskLiteParentDS,alternateRecordStyles:true,sortField:"currentTolerance",sortDirection:"descending",canDragSelect:false,emptyMessage:"Select the Risk Project from the Navigator",canDragRecordsOut:true,hoverWidth:200,hoverHeight:20,groupStartOpen:"all",cellContextClick:function(){riskTableContextMenu.showContextMenu();
return false;},recordDoubleClick:function(){qoRiskController.riskID=this.getSelectedRecord().riskID;getRiskAndDisplayInt(qoRiskController.riskID,true);},getBaseStyle:function(b,d,c){switch(c){case 0:return"rankItem"+b.currentTolerance;
break;case 2:if(b.dateIDRev==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);}break;case 3:if(b.dateIDApp==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);
}break;case 4:if(b.dateEvalRev==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);}break;case 5:if(b.dateEvalApp==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);
}break;case 6:if(b.dateMitRev==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);}break;case 7:if(b.dateMitApp==null){return"alertAudit";}else{return this.Super("getBaseStyle",arguments);
}break;default:return this.Super("getBaseStyle",arguments);}},fields:[{name:"riskProjectCode",title:"Risk Code",width:80,canGroupBy:false,align:"left",formatCellValue:function(c,b){var d=c;if(b.summaryRisk){d=c+"*";
}if(b.promotionCode!="-"){return d+" ("+b.toProjCode+")";}else{return d;}}},{name:"title",title:"Title",align:"left",canGroupBy:true,width:"100%"},{name:"dateIDRev",title:"Reviewed",align:"center",width:70},{name:"dateIDApp",title:"Approved",align:"center",width:70},{name:"dateEvalRev",title:"Reviewed",align:"center",width:70},{name:"dateEvalApp",title:"Approved",align:"center",width:70},{name:"dateMitRev",title:"Reviewed",align:"center",width:70},{name:"dateMitApp",title:"Approved",align:"center",width:70},{name:"treated",title:"Treated",type:"boolean",canGroupBy:true,width:55}],headerSpans:[{fields:["dateEntered","dateIDRev","dateIDApp"],title:"Identification"},{fields:["dateEvalRev","dateEvalApp"],title:"Evaluation"},{fields:["dateMitRev","dateMitApp"],title:"Mitigation"}]});
this.RiskTableFilterPane=createRiskTableFilterPane();try{isc.Menu.create({ID:"explorerActionMenu",showShadow:true,shadowDepth:10});isc.DynamicForm.create({ID:"viewSelector",width:150,minWidth:150,numCols:1,fields:[{name:"selectView",showTitle:false,width:"*",change:function(d,c,f,b){if(f=="audit"){RiskTable2.show();
clearFilterGroup1();RiskTable.hide();RiskTable3.hide();viewState="Audit";filterGroup2Changed();setTolMatrix(project);}else{if(f=="detail"){RiskTable.show();RiskTable2.hide();RiskTable3.hide();clearFilterGroup1();
viewState="Regular";filterGroup2Changed();setTolMatrix(project);}else{RiskTable3.show();clearFilterGroup1();RiskTable.hide();RiskTable2.hide();viewState="Rolled";filterGroup2Changed();setTolMatrix(project);
}}},valueMap:{detail:"Detail View",audit:"Audit View",rollup:"Summary Risks"},defaultValue:"detail"}]});isc.ToolStrip.create({ID:"buttonLayout",width:"100%",height:24,border:"1px solid "+qrmCtrlColor,backgroundColor:qrmCtrlColor,members:[isc.Label.create({contents:"* Designates a Summary or Propogated Risk. (XX) Identifies the risk project the risk has been promoted to",height:20,width:"100%"}),isc.ToolStripMenuButton.create({title:"Action",showRollOver:false,menu:explorerActionMenu}),isc.ToolStripButton.create({ID:"underlined",icon:"[SKIN]/actions/filter.png",actionType:"checkbox",action:function(){if(qoQRM.RiskTablePane.RiskTableFilterPane.isVisible()){qoQRM.RiskTablePane.RiskTableFilterPane.hide();
}else{qoQRM.RiskTablePane.RiskTableFilterPane.show();}}}),viewSelector]});}catch(a){alert(a.message);}this.addMembers([this.RiskTableFilterPane,buttonLayout,this.RiskTable,this.RiskTable2,this.RiskTable3]);
},setProject:function(){if(qoQRM.explorerSetProject){try{clearFiltersBtn.disable();DynamicFormOwner.getItem("ownerID").setValueMap(qoValueMap.owner);DynamicFormOwner.getItem("manager1ID").setValueMap(qoValueMap.manager);
DynamicFormOwner.getItem("primCatID").setValueMap(qoValueMap.categories);clearFilterGroup2();clearFilterGroup1();if(typeof(project)!="undefined"){filterGroup2Changed();clearFilterGroup1();setTolMatrix(project);
}}catch(a){clearFilterGroup2();clearFilterGroup1();qoQRM.RiskTablePane.RiskTable.fetchData({PROJECTID:-100,DESCENDANTS:false});}}qoQRM.explorerSetProject=true;},navigateAway:function(){return true;}});
}function createRiskTableFilterPane(){isc.HTMLFlow.create({ID:"ImgTreatedMat",dynamicContents:true,width:165,contents:"${qoQRM.tMat}"});isc.HTMLFlow.create({ID:"ImgUnTreatedMat",dynamicContents:true,width:165,contents:"${qoQRM.uMat}"});
isc.DynamicForm.create({fields:[{type:"header",defaultValue:"Exposure Status",startRow:true},{showTitle:false,name:"Active",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{showTitle:false,name:"Pending",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{showTitle:false,name:"In Active",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{type:"header",defaultValue:"Treatment Status",startRow:true},{showTitle:false,name:"Treated",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{showTitle:false,name:"Untreated",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"}],numCols:1,ID:"DynamicFormStatus",autoDraw:false});
isc.DynamicForm.create({fields:[{type:"header",defaultValue:"Risk Owner",startRow:true},{showTitle:false,name:"ownerID",changed:"filterGroup2Changed()",allowEmptyValue:true,_constructor:"SelectItem"},{type:"header",defaultValue:"Risk Manager",startRow:true},{showTitle:false,name:"manager1ID",changed:"filterGroup2Changed()",allowEmptyValue:true,_constructor:"SelectItem"},{type:"header",defaultValue:"Risk Category",startRow:true},{showTitle:false,name:"primCatID",allowEmptyValue:true,changed:"filterGroup2Changed()",_constructor:"SelectItem"}],numCols:1,ID:"DynamicFormOwner",autoDraw:false});
isc.HStack.create({membersMargin:15,margin:2,backgroundColor:qrmCtrlColor,layoutMargin:5,height:"180",ID:"FilterGroup1",members:[isc.VLayout.create({membersMargin:5,members:[isc.DynamicForm.create({fields:[{type:"header",defaultValue:"Treated Risks",startRow:true}],numCols:1,autoDraw:false}),ImgTreatedMat],autoDraw:false}),isc.VLayout.create({membersMargin:5,members:[isc.DynamicForm.create({fields:[{type:"header",defaultValue:"Un Treated Risks",startRow:true}],numCols:1,autoDraw:false}),ImgUnTreatedMat],autoDraw:false})],autoDraw:false});
isc.DynamicForm.create({numCols:2,ID:"DynamicFormTolerance",autoDraw:false,titleWidth:40,fields:[{type:"header",defaultValue:"Tolerance",changed:"filterGroup2Changed()",startRow:true},{showTitle:false,name:"Extreme",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{showTitle:false,name:"High",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{showTitle:false,name:"Significant",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{showTitle:false,name:"Moderate",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{showTitle:false,name:"Low",defaultValue:true,changed:"filterGroup2Changed()",_constructor:"CheckboxItem"},{type:"header",defaultValue:"Risk Code:",startRow:true},{name:"riskID",type:"text",showTitle:false,characterCasing:"upper",width:100,colSpan:2,keyPress:function(d,c,b,a){if(b=="Enter"||b=="Tab"){try{qrmFindRisk(d.getValue());
}catch(f){alert("Risk Table Line 1065"+f.message);}}}},{_constructor:"RowSpacerItem"},{_constructor:"Button",align:"right",colSpan:2,endRow:true,disabled:true,title:"Clear Filters",ID:"clearFiltersBtn",click:function(){try{qoQRM.explorerSetProject=true;
clearFilterGroup2();clearFilterGroup1();qoQRM.RiskTablePane.setProject();this.disable();}catch(a){alert(a.message);}}}]});isc.HStack.create({membersMargin:15,backgroundColor:qrmCtrlColor,margin:2,layoutMargin:5,height:"180",ID:"FilterGroup2",members:[DynamicFormOwner,DynamicFormStatus,DynamicFormTolerance],autoDraw:false});
return isc.HStack.create({backgroundColor:qrmCtrlColor,membersMargin:15,height:"180",members:[FilterGroup1,FilterGroup2],autoDraw:false});}function setTolMatrix(a){isc.RPCManager.sendRequest({prompt:"Retrieving Risk Project",evalResult:false,showPrompt:true,params:{PROJECTID:a.projectID,DESCENDANTS:checkDescendants.getValue(),ROLLED:(viewState=="Rolled")?true:false},callback:function(f,c,b){try{setTolMatixCB(JSON.parse(c,dateParser));
}catch(d){alert(d.message);}},actionURL:"./getRiskProject"});}function setTolMatixCB(c){qoQRM.selectedCellClassName=null;var k=c.extraStuff.split(";")[0].split(":");var j=c.extraStuff.split(";")[1].split(":");
var i=c.matrix.tolString;var a=c.matrix.maxImpact;var d=c.matrix.maxProb;qoQRM.uMat="<table border='1' cellspacing='0' cellpadding='0' style='cursor:pointer;cursor:hand'>";qoQRM.tMat="<table border='1' cellspacing='0' cellpadding='0' style='cursor:pointer;cursor:hand'>";
qoQRM.uMatRef="<table border='1' cellspacing='0' cellpadding='0' style='cursor:pointer;cursor:hand'>";qoQRM.tMatRef="<table border='1' cellspacing='0' cellpadding='0' style='cursor:pointer;cursor:hand'>";
for(var l=d;l>0;l--){qoQRM.uMat=qoQRM.uMat+"<tr>";qoQRM.tMat=qoQRM.tMat+"<tr>";qoQRM.uMatRef=qoQRM.uMatRef+"<tr>";qoQRM.tMatRef=qoQRM.tMatRef+"<tr>";for(var b=1;b<=a;b++){var f=(l-1)*a+b-1;var m=i.substring(f,f+1);
var h="cellExtreme";if(m=="1"){h="cellLow";}if(m=="2"){h="cellModerate";}if(m=="3"){h="cellSignificant";}if(m=="4"){h="cellHigh";}if(m=="5"){h="cellExtreme";}if(BrowserDetect.browser=="Explorer"){qoQRM.uMat=qoQRM.uMat+'<td id="uCell'+b+"p"+l+'" width="28" height="28" class="'+h+"\" onmouseout=\"if (this.className != 'qrmCellSelected'){this.className='"+h+"'}\" onmouseover=\"if (this.className != 'qrmCellSelected'){this.className='matCellHighLight'}\" onClick=\"matrixFilter("+b+", "+l+", false, this.id, '"+h+'\')"><span class="matText">'+j[(l-1)*a+b-1]+"</span></td>";
qoQRM.tMat=qoQRM.tMat+'<td id="tCell'+b+"p"+l+'" width="28" height="28" class="'+h+"\" onmouseout=\"if (this.className != 'qrmCellSelected'){this.className='"+h+"'}\" onmouseover=\"if (this.className != 'qrmCellSelected'){this.className='matCellHighLight'}\" onClick=\"matrixFilter("+b+", "+l+", true, this.id, '"+h+'\')"><span class="matText">'+k[(l-1)*a+b-1]+"</span></td>";
qoQRM.uMatRef=qoQRM.uMatRef+'<td id="uCell'+b+"p"+l+'" width="28" height="28" class="'+h+"\" onmouseout=\"if (this.className != 'qrmCellSelected'){this.className='"+h+"'}\" onmouseover=\"if (this.className != 'qrmCellSelected'){this.className='matCellHighLight'}\" onClick=\"RiskTableWindow.selectTab('ExplorerPaneID');matrixFilter("+b+", "+l+", false, this.id, '"+h+'\')"><span class="matText">'+j[(l-1)*a+b-1]+"</span></td>";
qoQRM.tMatRef=qoQRM.tMatRef+'<td id="tCell'+b+"p"+l+'" width="28" height="28" class="'+h+"\" onmouseout=\"if (this.className != 'qrmCellSelected'){this.className='"+h+"'}\" onmouseover=\"if (this.className != 'qrmCellSelected'){this.className='matCellHighLight'}\" onClick=\"RiskTableWindow.selectTab('ExplorerPaneID');matrixFilter("+b+", "+l+", true, this.id, '"+h+'\')"><span class="matText">'+k[(l-1)*a+b-1]+"</span></td>";
}else{qoQRM.uMat=qoQRM.uMat+'<td id="uCell'+b+"p"+l+'" width="28" height="28" class="'+h+'" onClick="matrixFilter('+b+", "+l+', false, this.id)"><span class="matText">'+j[(l-1)*a+b-1]+"</span></td>";qoQRM.tMat=qoQRM.tMat+'<td id="tCell'+b+"p"+l+'" width="28" height="28" class="'+h+'" onClick="matrixFilter('+b+", "+l+', true, this.id)"><span class="matText">'+k[(l-1)*a+b-1]+"</span></td>";
qoQRM.uMatRef=qoQRM.uMatRef+'<td id="uCell'+b+"p"+l+'" width="28" height="28" class="'+h+"\" onClick=\"RiskTableWindow.selectTab('ExplorerPaneID');matrixFilter("+b+", "+l+', false, this.id)"><span class="matText">'+j[(l-1)*a+b-1]+"</span></td>";
qoQRM.tMatRef=qoQRM.tMatRef+'<td id="tCell'+b+"p"+l+'" width="28" height="28" class="'+h+"\" onClick=\"RiskTableWindow.selectTab('ExplorerPaneID');matrixFilter("+b+", "+l+', true, this.id)"><span class="matText">'+k[(l-1)*a+b-1]+"</span></td>";
}}qoQRM.uMat=qoQRM.uMat+"</tr>";qoQRM.tMat=qoQRM.tMat+"</tr>";qoQRM.uMatRef=qoQRM.uMatRef+"</tr>";qoQRM.tMatRef=qoQRM.tMatRef+"</tr>";}qoQRM.uMatRef=qoQRM.uMatRef+"</table>";qoQRM.tMatRef=qoQRM.tMatRef+"</table>";
ImgTreatedMat.markForRedraw();ImgUnTreatedMat.markForRedraw();try{ImgTreatedMatRef.markForRedraw();ImgUnTreatedMatRef.markForRedraw();}catch(g){}}function matrixFilter(d,b,c,f,a){if(qoQRM.selectedCellID!=null&&qoQRM.selectedCellClassName!=null){document.getElementById(qoQRM.selectedCellID).className=qoQRM.selectedCellClassName;
}qoQRM.selectedCellID=f;if(a!=null){qoQRM.selectedCellClassName=a;}else{qoQRM.selectedCellClassName=document.getElementById(f).className;}document.getElementById(f).className="qrmCellSelected";clearFilterGroup2();
clearFiltersBtn.enable();if(viewState=="Regular"){qoQRM.RiskTablePane.RiskTable.fetchData({DESCENDANTS:checkDescendants.getValue(),PROJECTID:project.projectID,OPERATION:"getRiskLiteFetch",TREATEDPROB:c?b:-1,TREATEDIMPACT:c?d:-1,UNTREATEDPROB:c?-1:b,UNTREATEDIMPACT:c?-1:d,TREATED:c});
}else{if(viewState=="Audit"){qoQRM.RiskTablePane.RiskTable2.fetchData({DESCENDANTS:checkDescendants.getValue(),PROJECTID:project.projectID,OPERATION:"getRiskLiteFetch",TREATEDPROB:c?b:-1,TREATEDIMPACT:c?d:-1,UNTREATEDPROB:c?-1:b,UNTREATEDIMPACT:c?-1:d,TREATED:c});
}else{if(viewState=="Rolled"){qoQRM.RiskTablePane.RiskTable3.fetchData({ROLLED:true,DESCENDANTS:checkDescendants.getValue(),PROJECTID:project.projectID,OPERATION:"getRiskLiteFetch",TREATEDPROB:c?b:-1,TREATEDIMPACT:c?d:-1,UNTREATEDPROB:c?-1:b,UNTREATEDIMPACT:c?-1:d,TREATED:c});
}}}}function ownerFind(b,a){muliFind(b,null,null,null,null,null,a);}function managerFind(b,a){muliFind(null,b,null,null,null,null,a);}function statusFind(b,a){muliFind(null,null,null,b,null,null,a);}function categoryFind(b,a){muliFind(null,null,b,null,null,null,a);
}function toleranceFind(a){muliFind(null,null,null,null,null,null,a);}function projectToleranceFind(a,b){qoQRM.explorerSetProject=false;if(qrmProjectMap.get(b)!=null){project=qrmProjectMap.get(b);qoQRM.singlePhase=project.singlePhase;
updateSelectedProject();muliFind(null,null,null,null,null,null,a);}else{isc.RPCManager.sendRequest({prompt:"Retrieving Risk Project",showPrompt:true,evalResult:false,params:{PROJECTID:b},callback:function(g,d,c){try{project=JSON.parse(d,dateParser);
if(!project){alert("The risk repository has been updated.\n The risk project you selected is no longer available.");getUserProjects();}else{qoQRM.singlePhase=project.singlePhase;updateSelectedProject();
qrmProjectMap.put(b,project);}muliFind(null,null,null,null,null,null,a);setTolMatrix(project);}catch(f){alert("Risk Table Line 1318"+f.message);getUserProjects();}},actionURL:"./getRiskProject"});}}function muliFind(a,d,g,b,f,h,c){RiskTableWindow.selectTab(0);
qoQRM.explorerSetProject=false;qoCurrent.PaneNum=0;qoCurrent.Pane.navigateAway();DynamicFormTolerance.getItem("Extreme").setValue(false);DynamicFormTolerance.getItem("High").setValue(false);DynamicFormTolerance.getItem("Significant").setValue(false);
DynamicFormTolerance.getItem("Moderate").setValue(false);DynamicFormTolerance.getItem("Low").setValue(false);DynamicFormStatus.getItem("Active").setValue(false);DynamicFormStatus.getItem("Pending").setValue(false);
DynamicFormStatus.getItem("In Active").setValue(false);DynamicFormStatus.getItem("Treated").setValue(true);DynamicFormStatus.getItem("Untreated").setValue(true);DynamicFormOwner.getItem("primCatID").setValue(null);
DynamicFormOwner.getItem("ownerID").setValue(null);DynamicFormOwner.getItem("manager1ID").setValue(null);DynamicFormTolerance.getItem("riskID").setValue(null);if(f!=null&&!f){DynamicFormStatus.getItem("Treated").setValue(false);
}if(h!=null&&!h){DynamicFormStatus.getItem("Untreated").setValue(false);}if(c==null||c=="Extreme"){DynamicFormTolerance.getItem("Extreme").setValue(true);}if(c==null||c=="High"){DynamicFormTolerance.getItem("High").setValue(true);
}if(c==null||c=="Significant"){DynamicFormTolerance.getItem("Significant").setValue(true);}if(c==null||c=="Moderate"){DynamicFormTolerance.getItem("Moderate").setValue(true);}if(c==null||c=="Low"){DynamicFormTolerance.getItem("Low").setValue(true);
}if(b==null||b=="Active"){DynamicFormStatus.getItem("Active").setValue(true);}if(b==null||b=="Pending"){DynamicFormStatus.getItem("Pending").setValue(true);}if(b==null||b=="In+Active"){DynamicFormStatus.getItem("In Active").setValue(true);
}if(a!=null){DynamicFormOwner.getItem("ownerID").setValue(a);}if(d!=null){DynamicFormOwner.getItem("manager1ID").setValue(d);}if(g!=null){DynamicFormOwner.getItem("primCatID").setValue(g);}filterGroup2Changed();
}function filterGroup2Changed(){clearFiltersBtn.enable();clearFilterGroup1();if(qoQRM.navigatorInit){if(viewState=="Regular"){qoQRM.RiskTablePane.RiskTable.fetchData({DESCENDANTS:checkDescendants.getValue(),PROJECTID:projectID,OPERATION:"getRiskLiteFetch",PROCESSFILTER:true,TOLEX:DynamicFormTolerance.getItem("Extreme").getValue(),TOLHIGH:DynamicFormTolerance.getItem("High").getValue(),TOLSIG:DynamicFormTolerance.getItem("Significant").getValue(),TOLMOD:DynamicFormTolerance.getItem("Moderate").getValue(),TOLLOW:DynamicFormTolerance.getItem("Low").getValue(),STATACTIVE:DynamicFormStatus.getItem("Active").getValue(),STATPENDING:DynamicFormStatus.getItem("Pending").getValue(),STATINACTIVE:DynamicFormStatus.getItem("In Active").getValue(),STATTREATED:DynamicFormStatus.getItem("Treated").getValue(),STATUNTREATED:DynamicFormStatus.getItem("Untreated").getValue(),CATID:(typeof(DynamicFormOwner.getItem("primCatID").getValue())=="object"||typeof(DynamicFormOwner.getItem("primCatID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("primCatID").getValue(),OWNERID:(typeof(DynamicFormOwner.getItem("ownerID").getValue())=="object"||typeof(DynamicFormOwner.getItem("ownerID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("ownerID").getValue(),MANAGERID:(typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="object"||typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("manager1ID").getValue(),NOCACHE:Math.random()});
}else{if(viewState=="Audit"){qoQRM.RiskTablePane.RiskTable2.fetchData({DESCENDANTS:checkDescendants.getValue(),PROJECTID:projectID,OPERATION:"getRiskLiteFetch",PROCESSFILTER:true,TOLEX:DynamicFormTolerance.getItem("Extreme").getValue(),TOLHIGH:DynamicFormTolerance.getItem("High").getValue(),TOLSIG:DynamicFormTolerance.getItem("Significant").getValue(),TOLMOD:DynamicFormTolerance.getItem("Moderate").getValue(),TOLLOW:DynamicFormTolerance.getItem("Low").getValue(),STATACTIVE:DynamicFormStatus.getItem("Active").getValue(),STATPENDING:DynamicFormStatus.getItem("Pending").getValue(),STATINACTIVE:DynamicFormStatus.getItem("In Active").getValue(),STATTREATED:DynamicFormStatus.getItem("Treated").getValue(),STATUNTREATED:DynamicFormStatus.getItem("Untreated").getValue(),CATID:(typeof(DynamicFormOwner.getItem("primCatID").getValue())=="object"||typeof(DynamicFormOwner.getItem("primCatID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("primCatID").getValue(),OWNERID:(typeof(DynamicFormOwner.getItem("ownerID").getValue())=="object"||typeof(DynamicFormOwner.getItem("ownerID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("ownerID").getValue(),MANAGERID:(typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="object"||typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("manager1ID").getValue(),NOCACHE:Math.random()});
}else{if(viewState=="Rolled"){qoQRM.RiskTablePane.RiskTable3.fetchData({DESCENDANTS:checkDescendants.getValue(),PROJECTID:projectID,OPERATION:"getRiskLiteFetch",PROCESSFILTER:true,ROLLED:true,TOLEX:DynamicFormTolerance.getItem("Extreme").getValue(),TOLHIGH:DynamicFormTolerance.getItem("High").getValue(),TOLSIG:DynamicFormTolerance.getItem("Significant").getValue(),TOLMOD:DynamicFormTolerance.getItem("Moderate").getValue(),TOLLOW:DynamicFormTolerance.getItem("Low").getValue(),STATACTIVE:DynamicFormStatus.getItem("Active").getValue(),STATPENDING:DynamicFormStatus.getItem("Pending").getValue(),STATINACTIVE:DynamicFormStatus.getItem("In Active").getValue(),STATTREATED:DynamicFormStatus.getItem("Treated").getValue(),STATUNTREATED:DynamicFormStatus.getItem("Untreated").getValue(),CATID:(typeof(DynamicFormOwner.getItem("primCatID").getValue())=="object"||typeof(DynamicFormOwner.getItem("primCatID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("primCatID").getValue(),OWNERID:(typeof(DynamicFormOwner.getItem("ownerID").getValue())=="object"||typeof(DynamicFormOwner.getItem("ownerID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("ownerID").getValue(),MANAGERID:(typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="object"||typeof(DynamicFormOwner.getItem("manager1ID").getValue())=="undefined")?-1:DynamicFormOwner.getItem("manager1ID").getValue(),NOCACHE:Math.random()});
}}}}}function clearFilterGroup2(){DynamicFormTolerance.getItem("Extreme").setValue(true);DynamicFormTolerance.getItem("High").setValue(true);DynamicFormTolerance.getItem("Significant").setValue(true);DynamicFormTolerance.getItem("Moderate").setValue(true);
DynamicFormTolerance.getItem("Low").setValue(true);DynamicFormStatus.getItem("Active").setValue(true);DynamicFormStatus.getItem("Pending").setValue(true);DynamicFormStatus.getItem("In Active").setValue(true);
DynamicFormStatus.getItem("Treated").setValue(true);DynamicFormStatus.getItem("Untreated").setValue(true);DynamicFormOwner.getItem("primCatID").setValue(null);DynamicFormOwner.getItem("ownerID").setValue(null);
DynamicFormOwner.getItem("manager1ID").setValue(null);DynamicFormTolerance.getItem("riskID").setValue(null);}function clearFilterGroup1(){if(qoQRM.selectedCellID!=null&&qoQRM.selectedCellClassName!=null){if(BrowserDetect.browser=="Explorer"){if(qoQRM.selectedCellClassName=="hltEx"){document.getElementById(qoQRM.selectedCellID).className="myCellEx";
}if(qoQRM.selectedCellClassName=="hltHigh"){document.getElementById(qoQRM.selectedCellID).className="myCellHigh";}if(qoQRM.selectedCellClassName=="hltSig"){document.getElementById(qoQRM.selectedCellID).className="myCellSig";
}if(qoQRM.selectedCellClassName=="hltMod"){document.getElementById(qoQRM.selectedCellID).className="myCellMod";}if(qoQRM.selectedCellClassName=="hltLow"){document.getElementById(qoQRM.selectedCellID).className="myCellLow";
}}else{document.getElementById(qoQRM.selectedCellID).className=qoQRM.selectedCellClassName;}}}function defineRelMatrixWidget(){isc.QRMSaveButton.create({ID:"projectSaveBtnMat",disabled:true,click:function(){qoQRM.RelMatrixPane.saveChanges();
}});isc.QRMRefreshButton.create({ID:"projectResetBtnMat",disabled:true,click:function(){qoQRM.RelMatrixPane.cancelChanges();}});isc.QRMExportButton.create({ID:"projectExportBtnMat",title:"Export Chart",action:"qoReportEngine.flowController({baseValues:true, reportID:-100, relMatrix:true,submit:true});"});
var a=isc.HLayout.create({width:"100%",align:"right",members:[projectSaveBtnMat,projectResetBtnMat,projectExportBtnMat],layoutTopMargin:5,layoutMargin:5,membersMargin:4});isc.defineClass("RelMatrixWidget","VLayout");
isc.RelMatrixWidget.addProperties({helpURL:"./html/relMatrix_helpText.html",qrmDirty:false,layoutLeftMargin:0,visibility:"hidden",initWidget:function(){this.Super("initWidget",arguments);this.controllerForm1=isc.DynamicForm.create({fields:[{title:"Locate Risk",ID:"relMatrixRiskLocatorSelectItem",name:"risk",optionDataSource:"riskSelectGridDS",pickListWidth:450,pickListFields:[{name:"riskProjectCode",width:80},{name:"title"}],valueField:"riskProjectCode",alternateRecordStyles:true,autoFetchData:false,type:"select",changed:function(c,b,d){RelMatrixImg.findRisk();
}},{title:"Risk Owner",ID:"riskOwnerSelectItem",name:"risk_ownerName",type:"Select",allowEmptyValue:true,changed:function(c,b,d){RelMatrixImg.filterItems();}},{title:"Risk Manager",ID:"riskManagerSelectItem",name:"manager1_name",type:"Select",allowEmptyValue:true,changed:function(c,b,d){RelMatrixImg.filterItems();
}},{title:"Show Tolerance",valueMap:["Current Tolerance","Un Treated Tolerance","Treated Tolerance"],name:"relMatrixTolType",_constructor:"RadioGroupItem",autoFetchData:false,defaultValue:"Current Tolerance",changed:function(c,b,d){RelMatrixImg.update();
}}],titleOrientation:"top",numCols:1,autoDraw:false});this.relMatrixDescription=isc.HTMLPane.create({width:180,height:"100%",styleName:"exampleTextBlock",overflow:"hidden"});this.controller=isc.VLayout.create({width:180,backgroundColor:qrmCtrlColor,autoDraw:false});
this.controller.addMembers([this.controllerForm1,this.relMatrixDescription]);this.relMatrixImg=isc.Img.create({src:"[SKIN]grid.gif",title:"Img5",height:"100%",width:"100%",ID:"RelMatrixImg",imageType:"normal",items:new Array(),fields:new Array(),mouseOver:function(){this.Super("mouseOver",arguments);
for(var b=0;b<this.items.length;b++){this.items[b].resetClass();}this.parentObj.controllerForm1.getItem("risk").setValue(null);},cancelChanges:function(){qoQRM.RelMatrixPane.cancelChanges();},saveChanges:function(){qoQRM.RelMatrixPane.saveChanges(false,false);
},update:function(){try{for(var b=0;b<this.items.length;b++){this.items[b].reposition();}}catch(c){alert(c.description);}},resizeBy:function(){this.Super("resizeBy",arguments);for(var d=0;d<this.items.length;
d++){this.items[d].resetClass();}try{this.setSrc(Page.getAppDir()+"getRelMatrix?WIDTH="+this.getWidth()+"&HEIGHT="+this.getHeight()+"&REQUIRERISKS=NO&PROJECTID="+project.projectID+"&DESCENDANTS="+checkDescendants.getValue());
}catch(f){this.setSrc("[SKIN]grid.gif");}try{for(var c=0;c<this.items.length;c++){this.items[c].reposition();}}catch(b){alert(f.description);}return true;},setMatrix:function(b){var c=Page.getAppDir()+"getRelMatrix?WIDTH="+this.getWidth()+"&HEIGHT="+this.getHeight()+"&REQUIRERISKS=NO&PROJECTID="+qoQRM.RelMatrixPane.currentProjectID+"&DESCENDANTS="+checkDescendants.getValue()+"&NOCACHE="+Math.random();
this.setSrc(c);try{for(var d=0;d<this.items.length;d++){this.removeChild(this.items[d]);this.items[d].destroy();}}catch(f){alert(f.message);}this.setRelMatrixRisks();riskOwnerSelectItem.setValueMap(qoValueMap.owner);
riskManagerSelectItem.setValueMap(qoValueMap.manager);relMatrixRiskLocatorSelectItem.setValue(null);riskOwnerSelectItem.setValue(null);riskManagerSelectItem.setValue(null);},findRisk:function(){try{for(var c=0;
c<this.items.length;c++){this.items[c].resetClass();}found=false;for(var b=0;b<this.items.length;b++){if(this.items[b].findRisk()){found=true;break;}}if(!found){isc.say("The risk was not found in the current selection.\n Try clearinng the owner and manager filters and check again.");
}}catch(d){alert(d.description);}},filterItems:function(){try{for(var b=0;b<this.items.length;b++){this.items[b].filter();}}catch(c){alert(c.description);}},setRelMatrixRisks:function(){this.items=new Array();
this.fields=new Array();this.items.clear();this.fields.clear();isc.RPCManager.sendRequest({actionURL:"./getRiskLiteRPC",prompt:"Retrieving Relative Matrix Risk Information",showPrompt:true,evalResult:true,params:{ULTRALITE:true,DESCENDANTS:checkDescendants.getValue(),PROJECTID:qoQRM.RelMatrixPane.currentProjectID,NOCACHE:Math.random()},callback:function(g,d,c){qoQRM.relMatrixRisks=d;
for(var b=0;b<qoQRM.relMatrixRisks.length;b++){risk=qoQRM.relMatrixRisks[b];var f=isc.RelMatrixItem.create({treatedImpact:risk.treatedImpact,treatedProb:risk.treatedProb,untreatedImpact:risk.inherentImpact,untreatedProb:risk.inherentProb,riskTitle:risk.title,riskOwner:risk.ownerID,riskManager:risk.manager1ID,riskID:risk.riskID,riskTreated:risk.treated,contents:risk.riskProjectCode,riskCode:risk.riskProjectCode,description:risk.description,baseStyle:(risk.treated)?"matrixWidgetTreated":"matrixWidgetUnTreated"});
RelMatrixImg.items.push(f);RelMatrixImg.addChild(f);f.setposition();}relMatrixRiskLocatorSelectItem.fetchData();}});}});this.relMatrixImg.parentObj=this;this.addMember([a,isc.HLayout.create({height:"100%",members:[this.controller,RelMatrixImg],membersMargin:4})]);
},setProject:function(){if(this.qrmDirty){isc.ask("Save Changes to Relative Matrix?",function(b){if(b){qoQRM.RelMatrixPane.saveChanges(true);}else{qoQRM.RelMatrixPane.setProjectLocal();}});}else{this.setProjectLocal();
}},setProjectLocal:function(){try{if(qoQRM.singlePhase){qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").hide();}else{qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").show();
}}catch(b){alert(b.message);}this.currentProjectID=projectID;this.relMatrixImg.setMatrix(qoCurrent.Matrix);this.setClean();},cancelChanges:function(){try{for(var b=0;b<this.relMatrixImg.items.length;b++){this.relMatrixImg.items[b].cancelChanges();
}qoQRM.RelMatrixPane.setClean();}catch(c){alert(c.description);}},saveChanges:function(d,g,c){var b=new Array();b.clear();try{for(var f=0;f<this.relMatrixImg.items.length;f++){if(!this.relMatrixImg.items[f].clean){var i=this.relMatrixImg.items[f];
b.push({riskID:i.riskID,newTreatedImpact:(i.treatedClean)?i.treatedImpact:i.newTreatedImpact,newTreatedProb:(i.treatedClean)?i.treatedProb:i.newTreatedProb,newUntreatedImpact:(i.untreatedClean)?i.untreatedImpact:i.newUntreatedImpact,newUntreatedProb:(i.untreatedClean)?i.untreatedProb:i.newUntreatedProb});
}}isc.RPCManager.sendRequest({prompt:"Saving Changes",showPrompt:true,evalResult:true,params:{DATA:JSON.stringify(b),PROJECTID:projectID},callback:function(o,m,j){try{for(var k=0;k<RelMatrixImg.items.length;
k++){var l=RelMatrixImg.items[k];if(!l.clean){l.treatedImpact=(l.treatedClean)?l.treatedImpact:l.newTreatedImpact;l.treatedProb=(l.treatedClean)?l.treatedProb:l.newTreatedProb;l.untreatedImpact=(l.untreatedClean)?l.untreatedImpact:l.newUntreatedImpact,l.untreatedProb=(l.untreatedClean)?l.untreatedProb:l.newUntreatedProb;
l.clean=true;}l.treatedClean=true;l.untreatedClean=true;}qoQRM.RelMatrixPane.setClean();if(isA.Boolean(d)){if(d){qoQRM.RelMatrixPane.setProjectLocal();}}if(isA.Boolean(g)){if(g){RiskTableWindow.selectTab(c);
}}}catch(n){alert(n.message);}},actionURL:"./updateRelMatrix"});}catch(h){alert(h.description);}},isDirty:function(){return this.isDirty;},setDirty:function(){projectResetBtnMat.enable();projectSaveBtnMat.enable();
this.qrmDirty=true;},setClean:function(){projectResetBtnMat.disable();projectSaveBtnMat.disable();this.qrmDirty=false;},navigateAway:function(c,b){if(c&&this.qrmDirty){isc.say("Please save changes before switching modes");
return false;}else{if(c&&!this.qrmDirty){return true;}}if(this.qrmDirty){isc.ask("Save Changes to Relative Risk Matrix?",function(d){if(d){qoQRM.RelMatrixPane.saveChanges(false,true,b);}else{qoQRM.RelMatrixPane.setClean();
RiskTableWindow.selectTab(b);}});return false;}else{qoQRM.RelMatrixPane.setClean();return true;}return true;}});}function defineRelMatrixItem(){isc.defineClass("RelMatrixItem","Label");isc.RelMatrixItem.addProperties({autoDraw:false,initImpact:1,initProb:1,treatedImpact:1,treatedProb:1,untreatedImpact:1,untreatedProb:1,newTreatedImpact:1,newTreatedProb:1,newUntreatedImpact:1,newUntreatedProb:1,clean:true,treatedClean:true,untreatedClean:true,canDragReposition:true,keepInParentRect:true,dragAppearance:"target",dragOpacity:60,autoDraw:false,height:30,width:60,align:"center",valign:"center",wrap:false,showRollOver:true,showFocused:true,highlighted:false,cancelChanges:function(){if(!this.clean){this.clean=true;
this.untreatedClean=true;this.treatedClean=true;this.newTreatedImpact=1;this.newTreatedProb=1;this.newUntreatedImpact=1;this.newUntreatedProb=1;this.reposition();}},reposition:function(){if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Current Tolerance"){if(this.riskTreated){this.repositionTreated();
}else{this.repositionUntreated();}}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Un Treated Tolerance"){this.repositionUntreated();}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Treated Tolerance"){this.repositionTreated();
}for(var a=0;a<RelMatrixImg.children.length;a++){var b=RelMatrixImg.children[a];if(b.ID!=this.ID){if(b.top==this.top&&b.left==this.left){this.moveBy(3,3);this.markForRedraw();}}}},repositionTreated:function(){if(this.treatedClean){this.moveTo(Math.round(this.getXDisplacement(this.treatedImpact)),Math.round(this.getYDisplacement(this.treatedProb)));
}else{this.moveTo(Math.round(this.getXDisplacement(this.newTreatedImpact)),Math.round(this.getYDisplacement(this.newTreatedProb)));}},repositionUntreated:function(){if(this.untreatedClean){this.moveTo(Math.round(this.getXDisplacement(this.untreatedImpact)),Math.round(this.getYDisplacement(this.untreatedProb)));
}else{this.moveTo(Math.round(this.getXDisplacement(this.newUntreatedImpact)),Math.round(this.getYDisplacement(this.newUntreatedProb)));}},setposition:function(){if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Current Tolerance"){if(this.riskTreated){this.setpositionTreated();
}else{this.setpositionUntreated();}}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Un Treated Tolerance"){this.setpositionUntreated();}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Treated Tolerance"){this.setpositionTreated();
}for(var a=0;a<RelMatrixImg.children.length;a++){var b=RelMatrixImg.children[a];if(b.ID!=this.ID){if(b.top==this.top&&b.left==this.left){this.moveBy(3,3);this.markForRedraw();}}}},setpositionTreated:function(){if(this.treatedClean){this.setTop(Math.round(this.getYDisplacement(this.treatedProb)));
this.setLeft(Math.round(this.getXDisplacement(this.treatedImpact)));}else{this.setTop(Math.round(this.getYDisplacement(this.newTreatedProb)));this.setLeft(Math.round(this.getXDisplacement(this.newTreatedImpact)));
}},setpositionUntreated:function(){if(this.untreatedClean){this.setTop(Math.round(this.getYDisplacement(this.untreatedProb)));this.setLeft(Math.round(this.getXDisplacement(this.untreatedImpact)));}else{this.setTop(Math.round(this.getYDisplacement(this.newUntreatedProb)));
this.setLeft(Math.round(this.getXDisplacement(this.newUntreatedImpact)));}},dragRepositionStop:function(){this.clean=false;qoQRM.RelMatrixPane.setDirty();if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Current Tolerance"){if(this.riskTreated){this.updateTreated();
}else{this.updateUntreated();}}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Un Treated Tolerance"){this.updateUntreated();}if(qoQRM.RelMatrixPane.controllerForm1.getItem("relMatrixTolType").getValue()=="Treated Tolerance"){this.updateTreated();
}return true;},updateTreated:function(){this.treatedClean=false;this.newTreatedImpact=this.calcImpact();this.newTreatedProb=this.calcProb();},updateUntreated:function(){this.untreatedClean=false;this.newUntreatedImpact=this.calcImpact();
this.newUntreatedProb=this.calcProb();},calcProb:function(){var b=this.getTop();var a=(RelMatrixImg.getHeight()-30)/(qoCurrent.Matrix.maxProb);return(qoCurrent.Matrix.maxProb+1)-(b/a);},calcImpact:function(){var b=this.getLeft();
var a=(RelMatrixImg.getWidth()-60)/(qoCurrent.Matrix.maxImpact);return(b/a)+1;},doubleClick:function(){qoRiskController.riskID=this.riskID;getRiskAndDisplay(qoRiskController.riskID);},initWidget:function(){this.Super("initWidget",arguments);
RelMatrixImg.addChild(this);},mouseOver:function(){this.Super("mouseOver",arguments);this.bringToFront();qoQRM.RelMatrixPane.relMatrixDescription.setContents("<div style='valign:top'><br><hr><strong>"+this.contents+" - "+this.riskTitle+"<br><br>Description:<br><br></strong>"+this.description.substring(0,500)+"<hr></div>");
},mouseOut:function(){this.Super("mouseOut",arguments);qoQRM.RelMatrixPane.relMatrixDescription.setContents("");},getXDisplacement:function(a){return(a-1)*((RelMatrixImg.width-60)/qoCurrent.Matrix.maxImpact);
},getYDisplacement:function(a){return((qoCurrent.Matrix.maxProb+1-a)*((RelMatrixImg.getHeight()-30)/(qoCurrent.Matrix.maxProb)));},filter:function(){var a=riskOwnerSelectItem.getValue();var b=riskManagerSelectItem.getValue();
if((a==null||a==this.riskOwner)&&(b==null||b==this.riskManager)){this.show();}else{this.hide();}},findRisk:function(){if(relMatrixRiskLocatorSelectItem.getValue()==this.riskCode&&this.isVisible()){this.setBackgroundColor("gray");
this.bringToFront();this.resizeBy(10,10);this.moveBy(-5,-5);this.highlighted=true;return true;}return false;},resetClass:function(){if(this.highlighted){this.resizeBy(-10,-10);this.moveBy(5,5);this.setBackgroundColor("white");
this.highlighted=false;}}});}function defineRiskMatrixItem(){isc.defineClass("RiskMatrixItem","Label");isc.RiskMatrixItem.addProperties({preMit:true,autoDraw:false,initImpact:1,initProb:1,treatedImpact:1,treatedProb:1,untreatedImpact:1,untreatedProb:1,newTreatedImpact:1,newTreatedProb:1,newUntreatedImpact:1,newUntreatedProb:1,clean:true,treatedClean:true,untreatedClean:true,canDragReposition:true,keepInParentRect:true,dragAppearance:"target",dragOpacity:60,height:30,width:60,align:"center",valign:"center",wrap:false,reset:function(a){if(!this.clean){this.clean=true;
this.untreatedClean=true;this.treatedClean=true;this.treatedImpact=a.treatedImpact;this.treatedProb=a.treatedProb;this.untreatedImpact=a.inherentImpact;this.untreatedProb=a.inherentProb;this.setposition();
}},setposition:function(){if(this.preMit){this.setpositionUntreated();}else{this.setpositionTreated();}},setpositionTreated:function(){if(this.treatedClean){this.setTop(Math.round(this.getYDisplacement(this.treatedProb)));
this.setLeft(Math.round(this.getXDisplacement(this.treatedImpact)));}else{this.setTop(Math.round(this.getYDisplacement(this.newTreatedProb)));this.setLeft(Math.round(this.getXDisplacement(this.newTreatedImpact)));
}},setpositionUntreated:function(){if(this.untreatedClean){this.setTop(Math.round(this.getYDisplacement(this.untreatedProb)));this.setLeft(Math.round(this.getXDisplacement(this.untreatedImpact)));}else{this.setTop(Math.round(this.getYDisplacement(this.newUntreatedProb)));
this.setLeft(Math.round(this.getXDisplacement(this.newUntreatedImpact)));}},dragRepositionStop:function(){this.clean=false;if(this.preMit){this.updateUntreated();}else{this.updateTreated();}this.hostImg.setDirty();
return true;},getImpact:function(){if(this.preMit){if(this.clean){return this.untreatedImpact;}else{return this.newUntreatedImpact;}}else{if(this.clean){return this.treatedImpact;}else{return this.newTreatedImpact;
}}},getProb:function(){if(this.preMit){if(this.clean){return this.untreatedProb;}else{return this.newUntreatedProb;}}else{if(this.clean){return this.treatedProb;}else{return this.newTreatedProb;}}},updateTreated:function(){this.treatedClean=false;
this.newTreatedImpact=this.calcImpact();this.newTreatedProb=this.calcProb();},updateUntreated:function(){this.untreatedClean=false;this.newUntreatedImpact=this.calcImpact();this.newUntreatedProb=this.calcProb();
},calcProb:function(){var b=this.getTop();var a=(this.hostImg.getHeight()-30)/(qoCurrent.Matrix.maxProb);return(qoCurrent.Matrix.maxProb+1)-(b/a);},calcImpact:function(){var b=this.getLeft();var a=(this.hostImg.getWidth()-60)/(qoCurrent.Matrix.maxImpact);
return(b/a)+1;},getXDisplacement:function(a){return(a-1)*((this.hostImg.width-60)/qoCurrent.Matrix.maxImpact);},getYDisplacement:function(a){return((qoCurrent.Matrix.maxProb+1-a)*((this.hostImg.getHeight()-30)/(qoCurrent.Matrix.maxProb)));
}});}function defineRiskCalendar(){isc.defineClass("CalendarWidget","VLayout");isc.CalendarWidget.addProperties({helpURL:"./html/cal_helpText.html",autoDraw:false,visibility:"hidden",calImgInit:false,height:"100%",width:"100%",layoutLeftMargin:0,autoDraw:false,initWidget:function(){this.calImage=isc.HTMLFlow.create({autoDraw:false,imageType:"center",height:"95%",width:"95%",contents:"<div id='loadingWrapper' style='margin-top:200px'><div id='loading'><div class='loadingIndicator'><img alt='' src='./wait30trans.gif' style='float: left' /> Quay Risk Manager<br /><span id='loadingMsg'>Retrieving Risk Calaendar</span></div></div></div>"});
this.addMembers([this.calImage]);},updateCalDetails:function(){var c=this.calImage;try{var a=Math.random();isc.RPCManager.sendRequest({prompt:"Retreiving Risk Calendar",actionURL:"./getCalChart",evalResult:true,params:{x:this.width,y:this.height,bDescend:checkDescendants.getValue(),contextID:projectID,map:true,nocache:a},callback:function(g,f,d){c.setContents('<img style="border-width:0px;border-style:none;" usemap="#imageMap_'+a+'" src="'+Page.getAppDir()+"getCalChart?map=false&nocache="+a+1+'">'+f);
}});}catch(b){alert(b.message);}},setProject:function(){this.updateCalDetails();},navigateAway:function(){return true;}});}function defineAnalysisWidget(){isc.ToolStrip.create({ID:"AnalysisWidgetControllerControl",width:"100%",height:26,defaultLayoutAlign:"center",members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMExportButton.create({title:"Export Chart",action:"qoReportEngine.flowController({baseValues:true, reportID:-400, submit:true, noSelectWindow:true});"}),isc.LayoutSpacer.create({width:5})]});
isc.defineClass("AnalysisWidget","HLayout");isc.AnalysisWidget.addProperties({helpURL:"./html/analysis_helpText.html",autoDraw:false,analImgInit:false,layoutLeftMargin:0,visibility:"hidden",ID:"AnalysisWidgetID",prepareExport:function(){try{var f="";
var a="";var c=AnalysisWidgetID.analysisGrid.getSelection();for(var b=0;b<c.length;b++){a=a+c[b].clazz+":";f=f+c[b].param1+":";}qoReportEngine.reportParamMap.put("x",730);qoReportEngine.reportParamMap.put("y",600);
qoReportEngine.reportParamMap.put("class",a);qoReportEngine.reportParamMap.put("param1",f);qoReportEngine.reportParamMap.put("num",AnalysisWidgetID.form2.getItem("numRecords").getValue());qoReportEngine.reportParamMap.put("b3D",AnalysisWidgetID.form3.getItem("3D").getValue());
qoReportEngine.reportParamMap.put("bReverse",AnalysisWidgetID.form3.getItem("Reverse").getValue());qoReportEngine.reportParamMap.put("bEx",AnalysisWidgetID.form1.getItem("Extreme").getValue());qoReportEngine.reportParamMap.put("bHigh",AnalysisWidgetID.form1.getItem("High").getValue());
qoReportEngine.reportParamMap.put("bSig",AnalysisWidgetID.form1.getItem("Significant").getValue());qoReportEngine.reportParamMap.put("bMod",AnalysisWidgetID.form1.getItem("Moderate").getValue());qoReportEngine.reportParamMap.put("bLow",AnalysisWidgetID.form1.getItem("Low").getValue());
qoReportEngine.reportParamMap.put("bDescend",checkDescendants.getValue());qoReportEngine.reportParamMap.put("contextID",projectID);qoReportEngine.reportParamMap.put("map",false);qoReportEngine.qrmSubmitBackGroundReport(-400);
}catch(d){alert(d+"  "+d.message);}},initWidget:function(){this.Super("initWidget",arguments);this.analysisGrid=isc.ListGrid.create({alternateRecordStyles:true,height:"100%",width:"100%",autoDraw:false,dataArrived:function(c,b){try{var a=Math.floor(Math.random()*b);
var f=this.getRecord(a);this.parent.updateAnalOptions(f);this.selectRecord(f);this.parent.updateAnalDetails(f);}catch(d){alert(d);}},gridComponents:["header","body",AnalysisWidgetControllerControl],fields:[{name:"title",title:"Analysis Tool",type:"string"},{name:"clazz",showIf:"false"},{name:"param1",type:"string",showIf:"false"},{name:"b3D",type:"boolean",showIf:"false"},{name:"bTol",type:"boolean",showIf:"false"},{name:"bNumElem",type:"boolean",showIf:"false"},{name:"bReverse",type:"boolean",showIf:"false"}],dataSource:analToolDS,recordClick:"this.parent.updateAnalOptions(this.getSelectedRecord());this.parent.updateAnalDetails()"});
this.analysisGrid.parent=this;this.form1=isc.DynamicForm.create({fields:[{defaultValue:"Tolerances",_constructor:"StaticTextItem",colSpan:4},{name:"Extreme",_constructor:"CheckboxItem",defaultValue:true,changed:function(b,a,c){b.parent.updateAnalDetails();
}},{name:"High",_constructor:"CheckboxItem",defaultValue:true,changed:function(b,a,c){b.parent.updateAnalDetails();}},{name:"Significant",_constructor:"CheckboxItem",defaultValue:true,changed:function(b,a,c){b.parent.updateAnalDetails();
}},{name:"Moderate",_constructor:"CheckboxItem",defaultValue:true,changed:function(b,a,c){b.parent.updateAnalDetails();}},{name:"Low",_constructor:"CheckboxItem",defaultValue:true,changed:function(b,a,c){b.parent.updateAnalDetails();
}}],numCols:4,autoDraw:false,titleWidth:0});this.form1.parent=this;this.form2=isc.DynamicForm.create({fields:[{_constructor:"RowSpacer"},{name:"numRecords",title:"# of Records",editorType:"spinner",defaultValue:30,min:1,max:100,step:1,width:70,changed:function(b,a,c){b.parent.updateAnalDetails();
}}],numCols:2,autoDraw:false});this.form2.parent=this;this.form3=isc.DynamicForm.create({fields:[{_constructor:"RowSpacer"},{name:"3D",title:"3D Appearance",defaultValue:true,_constructor:"CheckboxItem",changed:function(b,a,c){b.parent.updateAnalDetails();
}},{name:"Reverse",title:"Reverse Sort Direction",defaultValue:false,_constructor:"CheckboxItem",changed:function(b,a,c){b.parent.updateAnalDetails();}}],numCols:2,titleWidth:0,autoDraw:false});this.form3.parent=this;
this.controller=isc.VLayout.create({height:"100%",width:200,backgroundColor:qrmCtrlColor,autoDraw:false});this.controller.addMembers([this.analysisGrid,isc.LayoutSpacer.create({height:5,autoDraw:false}),this.form1,this.form2,this.form3]);
this.analImage=isc.HTMLPane.create({ID:"analysisImage",width:"100%",height:"100%",showEdges:false,contents:"<div id='loadingWrapper' style='margin-top:200px'><div id='loading'><div class='loadingIndicator'><img alt='' src='./images/icons/16/message.png' style='float: left' /> &nbsp;Select Analysis Tool from List<br /></div></div></div>"});
this.addMembers([this.controller,this.analImage]);},updateAnalDetails:function(c){this.analImgInit=true;var d=c;if(d==null){d=this.analysisGrid.getSelectedRecord();}if(d){try{var a=Math.random();isc.RPCManager.sendRequest({prompt:"Retreiving Analysis Chart",actionURL:"./getAnalChart",evalResult:true,params:{"class":d.clazz,param1:d.param1,num:this.form2.getItem("numRecords").getValue(),b3D:this.form3.getItem("3D").getValue(),bReverse:this.form3.getItem("Reverse").getValue(),bEx:this.form1.getItem("Extreme").getValue(),bHigh:this.form1.getItem("High").getValue(),bSig:this.form1.getItem("Significant").getValue(),bMod:this.form1.getItem("Moderate").getValue(),bLow:this.form1.getItem("Low").getValue(),x:this.analImage.width,y:this.analImage.height,bDescend:checkDescendants.getValue(),contextID:projectID,map:true,nocache:a},callback:function(i,h,g){var f='<img style="border-width:0px;border-style:none;" usemap="#imageMap_'+a+'" src="'+Page.getAppDir()+"getAnalChart?image=true&nocache="+a+1+'">';
f=f+h;analysisImage.contents=f;analysisImage.markForRedraw();}});}catch(b){alert("Update Analysis Detail "+b.message);}}},updateAnalOptions:function(a){this.form3.getItem("3D").setDisabled(!a.b3D);this.form2.getItem("numRecords").setDisabled(!a.bNumElem);
this.form3.getItem("Reverse").setDisabled(!a.bReverse);this.form1.getItem("Extreme").setDisabled(!a.bTol);this.form1.getItem("High").setDisabled(!a.bTol);this.form1.getItem("Significant").setDisabled(!a.bTol);
this.form1.getItem("Moderate").setDisabled(!a.bTol);this.form1.getItem("Low").setDisabled(!a.bTol);},setProject:function(){this.analysisGrid.fetchData();this.updateAnalDetails();},navigateAway:function(){return true;
}});}function defineSubjectiveRankWidget(){isc.QRMSaveButton.create({ID:"projectSaveBtnRank",disabled:true,click:function(){if(qoQRM.riskProjectEditMode=="project"){projectTabSet.getTabPane(projectTabSet.getSelectedTab()).saveFn();
}SubjectiveRank.saveChanges();}});isc.QRMRefreshButton.create({title:"Reset",ID:"projectResetBtnRank",disabled:true,click:function(){if(qoQRM.riskProjectEditMode=="project"){projectTabSet.getTabPane(projectTabSet.getSelectedTab()).resetFn();
}SubjectiveRank.cancelChanges();}});isc.QRMExportButton.create({ID:"projectExportBtnRank",title:"Export Chart",action:"qoReportEngine.flowController({baseValues:true, reportID:-200, submit:true, noSelectWindow:true});"});
var a=isc.HLayout.create({width:"100%",align:"right",members:[projectSaveBtnRank,projectResetBtnRank,projectExportBtnRank],layoutTopMargin:5,layoutMargin:5,membersMargin:4});isc.defineClass("SubjectiveRankWidget","VLayout");
isc.SubjectiveRankWidget.addProperties({helpURL:"./html/subjRank_helpText.html",qrmDirty:false,autoDraw:false,ID:"SubjectiveRank",visibility:"hidden",layoutLeftMargin:0,initWidget:function(){this.Super("initWidget",arguments);
this.helpHTML=isc.HTMLPane.create({width:180,height:"100%",styleName:"exampleTextBlock",overflow:"hidden",contentsOrig:"<div style='valign:top'><hr>	<ol><li>Select and drag the risk to it's new ranking <br>&nbsp;	</li><li>By default, risks are ranked according to their tolerance, probability and impact. <br>&nbsp;</li><li>Color of each item corresponds to the <i>Current Tolerance</i> of the risk . <br>&nbsp;</li><li>Use the <i>Project Navigator</i> to select a different project. <br>&nbsp;</li><li>Details of the risk are displayed when the mouse passes over each item. <br>&nbsp;</li> <li>Double Click on any item to open the Risk Editor for the item. <br>&nbsp;</li><li>Select <strong><i>Save</i></strong> to save any ranking changes. <br>&nbsp;	</li><li>Select <strong><i>Reset</i></strong> to undo any changes since the last save. <br>&nbsp;	</li></ol><hr></div>"});
this.controller=isc.VLayout.create({backgroundColor:qrmCtrlColor,width:180,mouseOver:function(){this.parent.helpHTML.setContents("");}});this.controller.parent=this;this.controller.addMember(this.helpHTML);
this.rankTable=isc.ListGrid.create({height:"100%",ID:"RankTable",gridComponents:["header","body"],canReorderRecords:true,dragDataAction:"MOVE",dragTrackerMode:"record",dragTrackrtStyle:"gridDragTrackerQRM",showAllRecords:true,alternateRecordStyles:true,canSort:false,fields:[{name:"riskProjectCode",title:"Risk Code",width:80},{name:"currentTolerance",title:"Tolerance",type:"image",align:"center",width:70,imageURLPrefix:"tol",imageURLSuffix:".png"},{name:"title",width:"100%",title:"Risk Title"}],recordDoubleClick:function(){qoRiskController.riskID=RankTable.getSelectedRecord().riskID;
getRiskAndDisplay(qoRiskController.riskID);},cellOver:function(b,d,c){this.parent.helpHTML.setContents("<div style='valign:top'><hr><strong>"+b.riskProjectCode+" - "+b.title+"<br><br>Description:<br><br></strong>"+b.description.substring(0,500)+"<hr></div>");
return true;},drop:function(){this.Super("drop",arguments);SubjectiveRank.setDirty();return true;},getBaseStyle:function(b,d,c){if(c==0){return"rankItem"+b.currentTolerance;}else{return this.Super("getBaseStyle",arguments);
}}});this.rankTable.parent=this;this.bottomPane=isc.HLayout.create({width:"100%",height:"100%",membersMargin:4});this.bottomPane.addMember(this.controller);this.bottomPane.addMember(this.rankTable);this.addMember(a);
this.addMember(this.bottomPane);},setClean:function(){projectSaveBtnRank.disable();projectResetBtnRank.disable();SubjectiveRank.qrmDirty=false;},setDirty:function(){projectSaveBtnRank.enable();projectResetBtnRank.enable();
this.qrmDirty=true;},saveChanges:function(d,f,c){var g=this.rankTable.data[0].riskID;var h=this.rankTable.data;for(var b=1;b<h.length;b++){g=g+"##"+h[b].riskID;}isc.RPCManager.sendRequest({prompt:"Saving Changes",showPrompt:true,params:{PROJECTID:SubjectiveRank.currentProjectID,RANKS:g},callback:function(k,j,i){SubjectiveRank.setClean();
if(isA.Boolean(d)){if(d){SubjectiveRank.setProjectLocal();}}if(isA.Boolean(f)){if(f){SubjectiveRank.setClean();RiskTableWindow.selectTab(c);}}},actionURL:"./updateRanksRPC"});},cancelChanges:function(){this.setProjectLocal();
},isDirty:function(){return this.qrmDirty;},setProject:function(){if(SubjectiveRank.isDirty()){isc.ask("Save Changes to Risk Rank Order?",function(b){if(b){SubjectiveRank.saveChanges(true);}else{SubjectiveRank.setClean();
SubjectiveRank.setProjectLocal();}});}else{SubjectiveRank.setClean();SubjectiveRank.setProjectLocal();}},setProjectLocal:function(){SubjectiveRank.setClean();this.currentProjectID=projectID;isc.RPCManager.sendRequest({prompt:"Retrieving Risks in Rank Order",showPrompt:true,evalResult:true,params:{DESCENDANTS:checkDescendants.getValue(),PROJECTID:SubjectiveRank.currentProjectID},callback:function(d,c,b){RankTable.setData(c);
SubjectiveRank.setClean();},actionURL:"./getRiskLiteFetchSorted"});},navigateAway:function(c,b){if(c&&SubjectiveRank.isDirty()){isc.say("Please save changes before switching modes");return false;}else{if(c&&!SubjectiveRank.isDirty()){return true;
}}if(SubjectiveRank.isDirty()){isc.ask("Save Changes to Risk Rank Order?",function(d){if(d){SubjectiveRank.saveChanges(false,true,b);}else{SubjectiveRank.setClean();RiskTableWindow.selectTab(b);}});return false;
}else{SubjectiveRank.setClean();return true;}}});}function defineRelationshipWidget(){isc.defineClass("RelationshipWidget","VLayout");isc.RelationshipWidget.addProperties({helpURL:"./html/summaryRisk_helpText.html",membersMargin:5,qrmDirty:false,ID:"Relationship",visibility:"hidden",dirtyRecords:new Array(),initWidget:function(){this.Super("initWidget",arguments);
try{this.controllerButtonsForm=isc.HLayout.create({height:30,membersMargin:5,layoutMargin:5,backgroundColor:qrmCtrlColor,members:[isc.Label.create({width:"100%"}),isc.QRMSaveButton.create({ID:"projectSaveBtnRel",click:function(f,d,g){Relationship.saveChanges();
}}),isc.QRMRefreshButton.create({title:"Reset",autoDraw:false,ID:"projectResetBtnRel",click:function(f,d,g){Relationship.cancelChanges();}}),isc.QRMAddButton.create({title:"New Risk",ID:"relationNewBtn",click:function(f,d,g){this.parent.newSummaryRisk();
}}),isc.QRMExportButton.create({disabled:false,click:function(f,d,g){qoReportEngine.flowController({baseValues:true,reportID:-300,submit:true,noSelectWindow:true});}})]});relationNewBtn.parent=this;this.controllerButtonsForm.parent=this;
this.unAllocatedGrid=isc.ListGrid.create({ID:"UnAllocatedTable",autoDraw:false,dataSource:riskLiteDS,alternateRecordStyles:true,canReorderRecords:false,canDragRecordsOut:true,canAcceptDroppedRecords:true,saveLocally:true,dragDataAction:"copy",sortFieldNum:0,sortDirection:"ascending",recordDrop:function(j,d,g,f){if(j.find("forceDownParent",true)||j.find("forceDownChild",true)){isc.say("Cannot move Propogated Risks");
return;}if(j.find("summaryRisk",true)){isc.say("Cannot move Summary Risks");return;}this.parent.enableButtons();j.setProperty("newParentSummaryRisk",-1);Relationship.dirtyRecords.addList(j);for(var h=0;
h<j.length;h++){f.removeData(j[h]);}},cellOver:function(d,g,f){this.parent.RiskTableDetailViewer.setData(d);return true;},recordDoubleClick:function(){qoRiskController.riskID=UnAllocatedTable.getSelectedRecord().riskID;
getRiskAndDisplay(qoRiskController.riskID);},fields:[{name:"riskProjectCode",title:"Risks",formatCellValue:function(g,d,h,f){return g+" - "+d.title;}}]});this.unAllocatedGrid.parent=this;this.parentTree=isc.TreeGrid.create({ID:"parentTree",canReorderRecords:true,canAcceptDroppedRecords:true,canDragRecordsOut:true,dragDataAction:"move",canDropOnLeaves:true,nodeIcon:"[SKIN]file.png",folderIcon:"[SKIN]folder.png",fields:[{name:"riskProjectCode",title:"Summary and Top Propogated Risks",formatCellValue:function(g,d,h,f){return g+" - "+d.title;
}}],cellOver:function(d,g,f){this.parent.RiskTableDetailViewer.setData(d);return true;},recordDoubleClick:function(){qoRiskController.riskID=parentTree.getSelectedRecord().riskID;getRiskAndDisplay(qoRiskController.riskID);
},folderDrop:function(d,h,g,f){if(h=="undefined"||h==this.data.root){isc.say("Please drop risks onto exisitng an Summary Risk");return;}if(h.forceDownParent){isc.say("You cannot add a risk to a top level Propogated Risk");
return;}d.setProperty("newParentSummaryRisk",h.riskID);Relationship.dirtyRecords.addList(d);if(((isc.isA.Tree(f.getData())&&isc.isA.Tree(this.data)&&f.getData().getRoot()==this.data.getRoot()))&&(this.dragDataAction!=isc.TreeGrid.COPY&&this.dragDataAction!=isc.TreeGrid.CLONE)){f.getData().moveList(d,h,g);
this.parent.enableButtons();}else{this.parent.enableButtons();this.data.addList(d,h);}}});this.parentTree.parent=this;var b=isc.HLayout.create({membersMargin:5});b.addMember(this.parentTree);b.addMember(this.unAllocatedGrid);
this.RiskTableDetailViewer=isc.DetailViewer.create({height:210,width:"100%",overflow:"scroll",dataSource:riskLiteDS,autoDraw:false,fields:[{name:"riskProjectCode",title:"Risk Code",canEdit:false,width:60,align:"left"},{name:"title",title:"Title",align:"left",width:"100%"},{name:"description",title:"Description",align:"left",width:"100%"},{name:"ownerName",title:"Owner",align:"center",width:120},{name:"manager1Name",title:"Manager",align:"center",width:120},{name:"treatedImpact",title:"Impact",type:"double",formatCellValue:function(h,f){var d=f.inherentImpact;
var g=f.treatedImpact;if(isc.isA.Number(d)){d=Math.floor(d);}if(isc.isA.Number(g)){g=Math.floor(g);}else{return;}return"Inherent Impact = "+d+" Treated Impact = "+g;},align:"center"},{name:"treatedProb",title:"Probability",type:"double",formatCellValue:function(h,f){var d=f.inherentProb;
var g=f.treatedProb;if(isc.isA.Number(d)){d=Math.floor(d);}if(isc.isA.Number(g)){g=Math.floor(g);}else{return;}return"Inherent Probability = "+d+" Treated Probability = "+g;},align:"center"},{name:"treated",title:"Treated",type:"boolean",formatCellValue:function(d){if(d){return"Yes";
}return"No";},width:55}]});this.RiskTableDetailViewer.setData({});var a=isc.VLayout.create({height:"100%",members:[this.controllerButtonsForm,b]});this.addMembers([a,this.RiskTableDetailViewer]);}catch(c){alert(c.description);
}},disableButtons:function(){projectSaveBtnRel.disable();projectResetBtnRel.disable();},enableButtons:function(){projectSaveBtnRel.enable();projectResetBtnRel.enable();this.qrmDirty=true;},newSummaryRisk:function(a){alert(a);
if(this.qrmDirty){isc.say("Please save changes before creating a new summary risk");return;}else{newRisk(a);}},saveChanges:function(d,a){var c=new Array();for(var b=0;b<this.dirtyRecords.length;b++){c.push({riskID:this.dirtyRecords[b].riskID,newParentSummaryRisk:this.dirtyRecords[b].newParentSummaryRisk,parentSummaryRisk:this.dirtyRecords[b].parentSummaryRisk,origParentSummaryRisk:this.dirtyRecords[b].origParentSummaryRisk,tempIndex:this.dirtyRecords[b].tempIndex,relationshipID:this.dirtyRecords[b].relationshipID});
}isc.RPCManager.sendRequest({actionURL:"./updateFamilyRPC",prompt:"Saving Changes",showPrompt:true,params:{PROJECTID:Relationship.currentProjectID,CHANGES:JSON.stringify(c)},callback:function(h,g,f){Relationship.disableButtons();
Relationship.qrmDirty=false;Relationship.setProjectLocal();if(isA.Boolean(d)){if(d){RiskTableWindow.selectTab(a);}}}});},cancelChanges:function(){this.setProjectLocal();},isDirty:function(){return this.qrmDirty;
},setProject:function(){this.RiskTableDetailViewer.setData({});if(this.isDirty()){isc.ask("Save Changes to Summary Risk Relationships?",function(a){if(a){Relationship.saveChanges(false);Relationship.setProjectLocal();
}else{Relationship.setProjectLocal();}});}else{this.setProjectLocal();}},setProjectLocal:function(){this.dirtyRecords.clear();this.disableButtons();this.currentProjectID=projectID;this.qrmDirty=false;isc.RPCManager.sendRequest({actionURL:"./getRiskLiteRPC",prompt:"Retrieving Summary Risk Relationships",showPrompt:true,evalResult:true,params:{ULTRALITE:true,DESCENDANTS:checkDescendants.getValue(),PROJECTID:this.currentProjectID,FAMILY:true,NOCACHE:Math.random()},callback:function(g,d,b){var c=d[0];
Relationship.disableButtons();Relationship.qrmDirty=false;if(isc.isA.Array(c)){for(var a=0;a<c.length;a++){if(c[a].summaryRisk||c[a].forceDownParent){c[a]["isFolder"]=true;c[a]["isFolderProperty"]=true;
c[a]["parentSummaryRisk"]=-100;}}}else{try{if(c.summaryRisk||c.forceDownParent){c.isFolder=true;c.isFolderProperty=true;c.parentSummaryRisk=-100;}}catch(f){}}parentTree.setData(isc.Tree.create({ID:"parentTreeData",modelType:"parent",showRoot:false,rootValue:-100,nameProperty:"riskProjectCode",idField:"riskID",parentIdField:"parentSummaryRisk",data:c}));
parentTree.getData().closeAll();UnAllocatedTable.setData(d[1]);}});},setDirty:function(){Relationship.enableButtons();Relationship.qrmDirty=true;},setClean:function(){Relationship.disableButtons();Relationship.qrmDirty=false;
},navigateAway:function(b,a){if(b&&this.isDirty()){isc.say("Please save changes before switching modes");return false;}else{if(b&&!this.qrmDirty){return true;}}if(this.isDirty()){isc.ask("Save Changes to Summary Risk Relationships?",function(c){if(c){Relationship.saveChanges(true,a);
}else{Relationship.setClean();RiskTableWindow.selectTab(a);}});return false;}else{Relationship.setClean();return true;}}});}function defineReportWidget(){isc.ToolStrip.create({ID:"ReportsControls",width:"100%",height:26,defaultLayoutAlign:"center",membersMargin:5,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMDeleteButton.create({showDisabledIcon:true,ID:"userJobTableHLayDelBtn",prompt:"Delete Selected Report",click:function(){isc.ask("Are you sure you want to delete the selected reports?",function(a){if(a){isc.RPCManager.sendRequest({evalResult:false,prompt:"Deleting Job",actionURL:"./deleteUserJobs",params:{DATA:JSON.stringify(userJobTable.getSelection())},callback:function(d,c,b){qoQRM.ConcurrentPane.setProject();
}});}});}}),isc.QRMRefreshButton.create({prompt:"Refresh Completed Reports",click:function(){qoQRM.ConcurrentPane.setProject();}})]});isc.ToolStrip.create({ID:"ScheduleReportsControls",defaultLayoutAlign:"center",width:"100%",height:26,membersMargin:5,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMDeleteButton.create({showDisabledIcon:true,ID:"schedReportTableHLayDelBtn",prompt:"Delete Selected Scheduled Report",click:function(){isc.ask("Are you sure you want to delete the selected scheduled jobs?",function(a){if(a){isc.RPCManager.showPrompt=true;
isc.RPCManager.sendRequest({prompt:"Deleting Job",evalResult:true,params:{DATA:JSON.stringify(schedJobTable.getSelection())},callback:function(d,b,c){schedJobTable.updateJobScheduleTable();},actionURL:"./scheduleJobDelete"});
}});}}),isc.QRMAddButton.create({prompt:"New Scheduled Report",title:"New Schedule",click:function(){isc.say("To schedule a report, you first need to execute a report and the report can then be scheduled from the viewing window");
}})]});isc.ListGrid.create({ID:"userJobTable",autoDraw:false,height:"50%",selectionAppearance:"checkbox",gridComponents:["header","body",ReportsControls],selectionUpdated:function(b,a){if(this.getSelection().length>0){userJobTableHLayDelBtn.setDisabled(false);
}else{userJobTableHLayDelBtn.setDisabled(true);}},alternateRecordStyles:true,emptyMessage:"No Report or Analysis Jobs Found",fields:[{title:"Status",type:"text",width:80,align:"center",formatCellValue:function(d,a,f,b,c){if(a.failed){return"Failed";
}else{if((a.readyToCollect||a.collected)&&a.jobDescription.indexOf("(Excel)")!=-1){return"<a href = './report?action=download&format=xlsx&jobID="+a.jobID+"' >Download</a>";}else{if((a.readyToCollect||a.collected)&&a.downloadOnly){return"<a href = './QRMAttachment?getJobResult=true&JOBID="+a.jobID+"' >Download</a>";
}else{if(a.readyToCollect||a.collected){return"<a href = './QRMReportWindow.jsp?jobID="+a.jobID+"' onclick=\"openReport("+a.jobID+');return false;">Ready</a>';}else{if(a.processing){return"Processing";
}else{if(a.readyToExecute||(!a.processing&&!a.readyToExecute)){return"Queued";}}}}}}}},{name:"jobID",title:"Job ID",type:"text",width:80,align:"center"},{name:"jobDescription",title:"Description",width:"100%",align:"left"},{name:"queuedDate",title:"Queued Date",width:180,align:"center",type:"date",formatCellValue:function(a){if(a){return a.toDateString()+"  "+a.toLocaleTimeString();
}}},{name:"executedDate",title:"Completed",width:180,align:"center",type:"date",formatCellValue:function(a){if(a){return a.toDateString()+"  "+a.toLocaleTimeString();}else{return"Pending";}}}]});isc.ListGrid.create({autoDraw:false,ID:"schedJobTable",gridComponents:["header","body",ScheduleReportsControls],headerHeight:40,modalEditing:true,alternateRecordStyles:true,selectionAppearance:"checkbox",selectionUpdated:function(b,a){if(this.getSelection().length>0){schedReportTableHLayDelBtn.setDisabled(false);
}else{schedReportTableHLayDelBtn.setDisabled(true);}},height:"50%",width:"100%",canEdit:false,emptyMessage:"No Scheduled Reports",updateJobScheduleTable:function(){try{schedJobTable.getField(3).valueMap=qoValueMap.project;
}catch(a){alert(a.message);}isc.RPCManager.showPrompt=false;prompt:"Retrieving Scheduled Jobs",isc.RPCManager.sendRequest({evalResult:true,actionURL:"./getUserScheduledJobs",callback:function(b,h,j){try{schedJobTable.getField(3).valueMap=qoValueMap.project;
}catch(n){alert(n.message);}try{var o=new Date();var m=h.length;for(var k=0;k<m;k++){var l=h[k];var c=l.timeStr.split(":");var f=parseInt(c[0],10);var g=parseInt(c[1],10);o.setUTCHours(f);o.setUTCMinutes(g);
o.setUTCSeconds(0);l.timeStr=o.toLocaleTimeString();}schedJobTable.setData(h);}catch(n){alert(n.message);}}});isc.RPCManager.sendRequest({evalResult:true,actionURL:"./getHomePageReports",callback:function(f,c,b){try{schedJobTable.getField(2).valueMap=c.getValueMap("internalID","title");
}catch(d){alert(d.message);}}});},recordDoubleClick:function(h,b,g,f,a,d,c){schedJobTable.deselectAllRecords();getScheduleReportWindow().show();scheduleReportForm.setValues(b);DescendantForm2.setValues(b);
QRMNavigator2.selectSingleRecord(QRMNavigator2.data.data.find("projectID",b.projectID));},getBaseStyle:function(a,c,b){if(b==2&&(a.reportID==-50000||a.reportID==-50001)){return"qrmRiskExportEntry";}return this.Super("getBaseStyle",arguments);
},fields:[{name:"description",title:"Description",type:"text",width:"100%",align:"left"},{name:"reportID",title:"Report Type",type:"select",width:170,align:"center"},{name:"projectID",title:"Project",type:"select",width:130,align:"center"},{name:"descendants",title:"Desc",type:"boolean",width:50,align:"center"},{name:"Mon",type:"boolean",width:40},{name:"Tue",type:"boolean",width:40},{name:"Wed",type:"boolean",width:40},{name:"Thu",type:"boolean",width:40},{name:"Fri",type:"boolean",width:40},{name:"Sat",type:"boolean",width:40},{name:"Sun",type:"boolean",width:40},{title:"Time",name:"timeStr",type:"text",width:80,align:"center"},{title:"Email",name:"email",type:"boolean",width:50,align:"center"}],headerSpans:[{fields:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],title:"Days to Run"}]});
isc.defineClass("ConcurrentWidget","VLayout");isc.ConcurrentWidget.addProperties({helpURL:"./html/backgroundTasks_helpText.html",autoDraw:false,ID:"ConcurrentWidgetID",membersMargin:0,layoutMargin:0,visibility:"hidden",backgroundColor:qrmCtrlColor,members:[isc.LayoutSpacer.create({height:20}),isc.IButton.create({title:"Select and Execute Report...",icon:"[SKIN]/actions/forward.png",width:200,showDisabledIcon:false,click:function(){qoReportEngine.selectAndRunReport();
}}),isc.LayoutSpacer.create({height:20}),isc.Label.create({height:30,width:"100%",layoutMargin:5,backgroundColor:qrmCtrlColor,align:"left",wrap:false,contents:"<span style='font-weight:bold'>Completed Reports</span>"}),userJobTable,isc.Label.create({height:30,width:"100%",layoutMargin:5,backgroundColor:qrmCtrlColor,align:"left",wrap:false,contents:"<span style='font-weight:bold'>Scheduled Reports</span>"}),schedJobTable],setProject:function(a){isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./getAllUserJobs",prompt:"Retrieving User Jobs",evalResult:false,callback:function(d,c,b){userJobTable.setData(JSON.parse(c,dateParser));}});schedJobTable.updateJobScheduleTable();
schedJobTable.deselectAllRecords();userJobTable.deselectAllRecords();schedReportTableHLayDelBtn.setDisabled(true);userJobTableHLayDelBtn.setDisabled(true);},navigateAway:function(){return true;}});}function openReport(a){isc.RPCManager.sendRequest({evalResult:true,actionURL:"./getReportBean?jobID="+a,callback:function(g,m,k){var i=m.reportDescription;
var d=m.executionDate;var c=m.executionTime;var j=m.person;var p=m.projectName;var h=m.descendants;var o=m.projectID;var f=m.reportID;isc.DynamicForm.create({width:"100%",ID:"RepDownloadForm",colWidths:[20,"*"],autoDraw:true,titleWidth:10,fields:[{type:"header",defaultValue:"Download this report in the selected format",startRow:true,colSpan:2},{_constructor:"RowSpacerItem"},{linkTitle:"Download as PDF",target:"javascript",click:function(){window.open("./report?action=download&format=pdf&jobID="+a,"_qrmDownloadTarget");
openReportWindow.hide();isc.say("<center>Preparing Report For download.</center><center>The report will download when preparation is complete</center>");},canEdit:false,_constructor:"LinkItem"},{linkTitle:"Download as Word",target:"javascript",click:function(){window.open("./report?action=download&format=doc&jobID="+a,"_qrmDownloadTarget");
openReportWindow.hide();isc.say("<center>Preparing Report For download.</center><center>The report will download when preparation is complete</center>");},canEdit:false,_constructor:"LinkItem"},{linkTitle:"Download as Excel",target:"javascript",click:function(){window.open("./report?action=download&format=xlsx&jobID="+a,"_qrmDownloadTarget");
openReportWindow.hide();isc.say("<center>Preparing Report For download.</center><center>The report will download when preparation is complete</center>");},canEdit:false,_constructor:"LinkItem"},{linkTitle:"Download as PowerPoint",target:"javascript",click:function(){window.open("./report?action=download&format=pptx&jobID="+a,"_qrmDownloadTarget");
openReportWindow.hide();isc.say("<center>Preparing Report For download.</center><center>The report will download when preparation is complete</center>");},canEdit:false,_constructor:"LinkItem"},{linkTitle:"View in Browser",target:"javascript",click:function(){window.open("./report?action=view&jobID="+a,"ReportWindow");
openReportWindow.hide();},canEdit:false,_constructor:"LinkItem"},{_constructor:"RowSpacerItem"}]});isc.DynamicForm.create({ID:"RepScheduleForm",numCols:4,colWidths:[10,100,10,100],fields:[{type:"header",defaultValue:"Schedule this report to be run automatically in future",startRow:true,colSpan:4},{_constructor:"RowSpacerItem"},{type:"header",defaultValue:"Days of Execution",startRow:true,colSpan:2},{name:"Mon",title:"Monday",type:"checkbox",defaultValue:true},{name:"Tue",title:"Tuesday",type:"checkbox",defaultValue:true},{name:"Wed",title:"Wednesday",type:"boolean",defaultValue:true},{name:"Thu",title:"Thursday",type:"boolean",defaultValue:true},{name:"Fri",title:"Friday",type:"boolean",defaultValue:true},{name:"Sat",title:"Saturday",type:"boolean",defaultValue:true},{name:"Sun",title:"Sunday",type:"boolean",defaultValue:true},{_constructor:"RowSpacerItem"},{type:"header",defaultValue:"Time of Execution",startRow:true,colSpan:4},{name:"timeStr",title:"Execution Time",_constructor:"TimeItem",showTitle:false,colSpan:2},{_constructor:"RowSpacerItem"},{type:"header",defaultValue:"Report Distribution",startRow:true,colSpan:4},{title:"Email Results To User",name:"email",type:"boolean"}]});
isc.DynamicForm.create({ID:"RepScheduleForm2",titleOrientation:"top",numCols:1,fields:[{title:"Additional Recipients Email Addresses (seperated by a comma or newline)",name:"additionalUsers",type:"textarea",width:"100%"}]});
var n=isc.HLayout.create({width:"100%",height:35,layoutMargin:5,membersMargin:5,members:[isc.LayoutSpacer.create({width:"100%"}),isc.IButton.create({width:160,title:"Close",click:function(){openReportWindow.hide();
}}),isc.IButton.create({width:160,title:"Submit Scheduled Report",click:function(){if(RepScheduleForm.validate()){var q=RepScheduleForm.getValues();try{q.Hour=q.timeStr.getUTCHours();q.Min=q.timeStr.getMinutes();
}catch(r){q.Hour=q.timeStr.substring(0,1);q.Min=q.timeStr.sunstring(3,4);}q.projectID=o;q.descendants=h;q.additionalUsers=RepScheduleForm2.getValue("additionalUsers");q.internalID=-1;q.description=i;q.reportID=f;
q.jobID=a;isc.RPCManager.showPrompt=true;try{isc.RPCManager.sendRequest({prompt:"Scheduling Job",actionURL:"./scheduleJobUpdate",params:{DATA:JSON.stringify(q)},callback:function(v,t,s){try{schedJobTable.updateJobScheduleTable();
isc.say("Report Scheduled");}catch(u){alert(u.message);}}});}catch(r){alert(r.message);}}}})]});var l="<br/><b>&nbsp;Report Name:</b>&nbsp;"+i+"<br/><b>&nbsp;Date of Execution:</b>&nbsp;"+d+"<br/><b>&nbsp;Time of Execution:</b>&nbsp;"+c;
l=l+"<br/><b>&nbsp;User Name:</b>&nbsp;"+j;var b=100;if(o>0){l=l+"<br/><b>&nbsp;Project:</b>&nbsp;"+p+"<br/><b>&nbsp;Descendants:</b>&nbsp;"+h;b=120;}isc.HTMLPane.create({ID:"ReportDetailPane",dynamicContents:true,contents:l,height:b,width:"100%"});
isc.HLayout.create({ID:"LeftStackSection",width:"100%",autoDraw:true,members:[isc.VLayout.create({members:[ReportDetailPane,RepDownloadForm]}),isc.VLayout.create({members:[RepScheduleForm,RepScheduleForm2,n]})]});
isc.Window.create({ID:"openReportWindow",title:"Download and Schedule Reports",layoutMargin:5,memberMargin:5,width:800,height:500,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[LeftStackSection]});
}});}function getScheduleReportWindow(){isc.DynamicForm.create({ID:"scheduleReportForm",numCols:2,height:"100%",width:440,titleWidth:140,fields:[{name:"description",title:"Description",type:"text",width:300,align:"left",required:true},{name:"reportID",title:"Report Type",type:"select",valueMap:qoValueMap.projectReport,width:200,required:true,disabled:true},{type:"header",defaultValue:"Days and Time of Execution",startRow:true,colSpan:2},{name:"Mon",type:"boolean",defaultValue:true},{name:"Tue",type:"boolean",defaultValue:true},{name:"Wed",type:"boolean",defaultValue:true},{name:"Thu",type:"boolean",defaultValue:true},{name:"Fri",type:"boolean",defaultValue:true},{name:"Sat",type:"boolean",defaultValue:true},{name:"Sun",type:"boolean",defaultValue:true},{title:"Time",name:"timeStr",type:"time",width:80,required:true},{type:"header",defaultValue:"Report Distribution",startRow:true,colSpan:2},{title:"Email Results To User",name:"email",type:"boolean"},{title:"Additional Recipients (Email addresses seperated by a comma or newline)",name:"additionalUsers",type:"textarea",width:300}]});
var b=isc.HLayout.create({width:400,height:35,layoutMargin:5,members:[isc.LayoutSpacer.create({width:"100%"}),isc.IButton.create({width:180,title:"Submit Scheduled Report",click:function(){if(scheduleReportForm.validate()){var c=scheduleReportForm.getValues();
try{c.Hour=c.timeStr.getUTCHours();c.Min=c.timeStr.getMinutes();}catch(d){c.Hour=c.timeStr.substring(0,1);c.Min=c.timeStr.sunstring(3,4);}try{c.projectID=QRMNavigator2.getSelectedRecord().projectID;}catch(d){alert("Please select the desired project");
return;}c.descendants=DescendantForm2.getValue("descendants");c.update=true;c.projectName=QRMNavigator2.getSelectedRecord().projectTitle;isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:"Updating Job",evalResult:true,actionURL:"./scheduleJobUpdate",params:{DATA:JSON.stringify(c)},callback:function(i,g,f){try{scheduleReportWindow.hide();
schedJobTable.updateJobScheduleTable();}catch(h){alert(h.message);}}});}}})]});var a=isc.VLayout.create({members:[scheduleReportForm,b]});isc.HLayout.create({ID:"scheduleReportLayout",width:650,membersMargin:5,members:[createProjectSelectorLayout(),a]});
isc.Window.create({ID:"scheduleReportWindow",title:"Schedule A Report",layoutMargin:5,memberMargin:5,autoSize:true,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:false,items:[scheduleReportLayout]});
return scheduleReportWindow;}function createProjectSelectorLayout(){isc.TreeGrid.create({showConnectors:true,height:"100%",width:"100%",ID:"QRMNavigator2",autoDraw:false,autoFetchData:false,loadDataOnDemand:false,folderIcon:"[SKIN]folder.png",nameProperty:"projectTitle",fields:[{title:"Risk Projects",name:"projectTitle",formatCellValue:function(c,a,d,b){if(a.projectID>0){return c+" ("+a.projectCode+")";
}else{return c;}}}],dataArrived:function(){this.getData().openAll();}});QRMNavigator2.setData(isc.Tree.create({ID:"projectTreeData",modelType:"parent",showRoot:false,nameProperty:"projectID",idField:"projectID",parentIdField:"parentID",data:projects}));
isc.DynamicForm.create({fields:[{defaultValue:false,align:"left",title:"Include Descedant Projects",type:"CheckboxItem",name:"descendants",startRow:true}],align:"right",ID:"DescendantForm2",titleWidth:0,width:"100%",numCols:2});
return isc.VLayout.create({height:460,width:250,members:[QRMNavigator2,DescendantForm2]});}function getSignificantEventsGrid(){return isc.ListGrid.create({autoDraw:false,ID:"eventGrid",backgroundColor:qrmCtrlColor,width:"100%",height:"100%",alternateRecordStyles:true,recordDoubleClick:function(){var a=eventGrid.getSelectedRecord();
if(a.element=="RISK"||a.element=="TASKS"){qoRiskController.riskID=a.internalID;getRiskAndDisplay(qoRiskController.riskID);}if(a.element=="INCIDENT"){RiskTableWindow.selectTab("IncidentsPaneID");}if(a.element=="REVIEW"){RiskTableWindow.selectTab("ReviewPaneID");
}},fields:[{name:"name",title:"Event"},{name:"element",title:"Element",showIf:"false",GROUP_RISK:1,GROUP_INCIDENT:2,GROUP_REVIEW:3,GROUP_TASK:4,getGroupValue:function(c,a,d,f,b){if(a.element=="RISK"){return this.GROUP_RISK;
}if(a.element=="INCIDENT"){return this.GROUP_INCIDENT;}if(a.element=="REVIEW"){return this.GROUP_REVIEW;}if(a.element=="TASKS"){return this.GROUP_TASK;}},getGroupTitle:function(a,b,d,f,c){switch(a){case this.GROUP_RISK:return"Recently Added Risks";
break;case this.GROUP_INCIDENT:return"Recently Reported Incidents and Issues";break;case this.GROUP_REVIEW:return"Upcoming Risk Reviews";break;case this.GROUP_TASK:return"Outstanding User Tasks";break;
}}},{name:"date",title:"Date",type:"date",align:"center",width:100,formatCellValue:function(d,a,f,b,c){if(d&&a.element!="TASKS"){return d.getShortMonthName()+" "+d.getDate()+", "+d.getFullYear();}else{return"";
}}}],groupStartOpen:[4],groupByField:"element"});}function updateProjectContingency(){isc.Window.create({ID:"percentileModalWindow",title:"Contingency Percentile",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[isc.DynamicForm.create({autoDraw:false,height:48,ID:"percentileForm",padding:4,fields:[{name:"percentile",title:"Percentile",type:"spinner",min:0,max:100,step:5,defaultValue:80},{type:"button",title:"Update Contingency",colSpan:2,align:"right",click:function(){percentileModalWindow.hide();
isc.RPCManager.sendRequest({prompt:"Updating Project Contingency Calculations",evalResult:false,params:{PROJECTID:project.projectID,DESCENDANTS:checkDescendants.getValue(),PERCENTILE:percentileForm.getItem("percentile").getValue()},callback:function(c,b,a){updateSelectedProject();
},actionURL:"./updateProjectContingency"});}}]})]});}function getReviewWidget(){return isc.VLayout.create({helpURL:"./html/reviews_helpText.html",qrmDirty:false,ID:"Review",height:"100%",width:"100%",members:[isc.ListGrid.create({autoDraw:false,width:"100%",ID:"reviewWidgetTable",height:"30%",selectionType:"single",gridComponents:["header","body",isc.ToolStrip.create({defaultLayoutAlign:"center",membersMargin:5,width:"100%",height:26,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMEditButton.create({showDisabledIcon:true,ID:"revListViewEditBtn",prompt:"Edit Selected Review",click:function(){try{viewEditReview(reviewWidgetTable.getSelectedRecord());
}catch(a){alert(a);}}}),isc.QRMDeleteButton.create({ID:"revListDeleteBtn",showDisabledIcon:true,prompt:"Remove Selected Review",click:function(){Review.deleteReview(reviewWidgetTable.getSelectedRecord());
}}),isc.QRMAddButton.create({showDisabledIcon:true,prompt:"Schedule New Review",title:"New Review",click:function(){isc.Window.create({ID:"scheduleReviewSimpleModalWindow",title:"New Scheduled Review",autoSize:true,showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[getScheduleReviewSimpleLayout()]});
}})]})],alternateRecordStyles:true,sortField:2,sortDirection:"ascending",recordClick:function(){revListViewEditBtn.setDisabled(false);revListDeleteBtn.setDisabled(false);},recordDoubleClick:function(h,b,g,f,a,d,c){viewEditReview(b);
},fields:[{name:"reviewComments",showIf:"false"},{name:"title",title:"Review",width:"100%"},{name:"scheduledDate",title:"Schdueled Date",type:"date",align:"center",width:120,formatCellValue:function(a){try{if(a){return a.getShortMonthName()+" "+a.getDate()+", "+a.getFullYear();
}}catch(b){}}},{name:"actualDate",title:"Actual Date",type:"date",align:"center",width:120,formatCellValue:function(a){try{if(a){return a.getShortMonthName()+" "+a.getDate()+", "+a.getFullYear();}}catch(b){}}},{name:"reviewComplete",title:"Complete",type:"boolean",width:80,getGroupTitle:function(a,b,d,f,c){if(a){return("Completed Reviews");
}else{return("Scheduled Reviews");}}}],groupStartOpen:"all",groupByField:"reviewComplete"})],setProjectLocal:function(){revListViewEditBtn.setDisabled(true);revListDeleteBtn.setDisabled(true);isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({prompt:"Retrieving Scheduled Reviews",actionURL:"./getAllReviews",evalResult:false,callback:function(c,b,a){reviewWidgetTable.setData(JSON.parse(b,dateParser));}});},deleteReview:function(a){isc.ask("Are you sure you want to delete the selected review?",function(b){if(b){isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./deleteReview",prompt:"Deleting Review",evalResult:true,params:{REVIEWID:a.reviewID},callback:function(f,d,c){if(d){isc.say("Review not deleted. Only the project risk manager or the root project manager can delete the review");
}Review.setProjectLocal();}});}});}});}function viewEditReview(a){try{qoCurrent.Review=a;isc.Window.create({ID:"viewEditReviewModalWindow",headerControls:["headerLabel","closeButton"],items:[getReviewEditReviewLayout()],height:MainPane.height*0.95,width:1100,title:"Review Details",isModal:true,showModalMask:true,showMaximizeButton:true,autoCenter:true,layoutMargin:0,edgeTop:30,headerDefaults:{layoutMargin:1,membersMargin:5,height:26},closeClick:function(){viewEditReviewModalWindow.hide();
},setDirty:function(){viewEditReviewModalWindow.dirty=true;if(!qoCurrent.Review.reviewComplete){editReviewSaveButton.setDisabled(false);editReviewSaveButton.setTitle("<span style='font-weight:bold'>Save</span>");
}else{isc.say('Review has already been marked as "Complete". No changes will be saved');}},setClean:function(){viewEditReviewModalWindow.dirty=false;editReviewSaveButton.setDisabled(true);}});viewEditReviewModalWindow.show();
reviewDetailForm1.setData(qoCurrent.Review);reviewDetailForm1.getItem("reviewComplete").setDisabled(qoCurrent.Review.reviewComplete);editReviewSaveButton.setDisabled(qoCurrent.Review.reviewComplete);isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./getReviewRisks",evalResult:true,prompt:"Getting Review Risks",params:{REVIEWID:qoCurrent.Review.reviewID},callback:function(f,d,c){reviewRiskTable.setData(d);}});
getReviewAttachments(qoCurrent.Review.reviewID);viewEditReviewModalWindow.setClean();}catch(b){alert(b.message);}}function getReviewAttachments(a){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./getReviewAttachments",prompt:"Retrieving Review Attachment",evalResult:true,params:{REVIEWID:a},callback:function(d,c,b){reviewAttachmentTable.setData(c);
}});}function getReviewEditReviewLayout(){var a=isc.VLayout.create({width:"100%",height:"100%",membersMargin:5,layoutMargin:0,members:[getReviewForm1(),isc.QRMLabel.create({title:"Review Attachments"}),isc.ListGrid.create({ID:"reviewAttachmentTable",height:"100%",width:"100%",autoDraw:false,alternateRecordStyles:true,selectionAppearance:"checkbox",emptyMessage:"No Attachments for Review",gridComponents:["header","body",isc.ToolStrip.create({defaultLayoutAlign:"center",width:"100%",height:26,membersMargin:5,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMDeleteButton.create({click:function(){isc.RPCManager.sendRequest({actionURL:"./deleteReviewAttachments",evalResult:false,params:{DATA:reviewAttachmentTable.getSelection().internalID},callback:function(f,d,c){getReviewAttachments(qoCurrent.Review.reviewID);
}});}}),isc.QRMAddButton.create({prompt:"Add New Attachment",title:"Add New Attachment",width:180,click:function(){isc.Window.create({items:[isc.QRMAttachmentForm.create({ID:"reviewAttachmentForm"})],ID:"reviewAttachmentWindow",title:"Review Attachment",layoutMargin:0,autoDraw:true,isModal:true,showModalNask:true,autoSize:true,autoCenter:true});
reviewAttachmentForm.showForm(qoCurrent.Review.reviewID,"REVIEW",function(){reviewAttachmentWindow.hide();getReviewAttachments(qoCurrent.Review.reviewID);});reviewAttachmentWindow.show();}})]})],fields:[{name:"description",title:"Decription",width:"50%",align:"left"},{title:"Attachment",type:"text",width:100,align:"center",formatCellValue:function(g,c,h,d,f){if(c.attachmentURL){return"<a href = '"+c.attachmentURL+"' target='_blank'>Download</a>";
}else{return"<a href = '"+c.url+"' target='_blank'>View</a>";}}}]})]});isc.ListGrid.create({ID:"reviewRiskTable",autoDraw:false,width:"100%",alternateRecordStyles:true,height:"100%",selectionAppearance:"checkbox",confirmCancelEditing:true,confirmDiscardEdits:true,getBaseStyle:function(c,f,d){if(d==0||d==1){return"rankItem"+c.currentTolerance;
}else{return this.Super("getBaseStyle",arguments);}},emptyMessage:"No Risk for this Review Found",fields:[{name:"riskProjectCode",title:"Risk",canEdit:false,align:"left",width:80},{name:"title",title:"Title",canEdit:false,align:"left"},{name:"comment",title:"Review Comment",canEdit:true,editorType:"textArea",editorProperties:{height:60}}],recordClick:function(j,d,i,h,c,g,f){reviewRiskEditBtn.setDisabled(false);
},editorEnter:function(){reviewRiskFinishEditBtn.show();reviewRiskCancelEditBtn.show();reviewRiskFinishEditBtn.setDisabled(false);reviewRiskEditBtn.hide();viewEditReviewModalWindow.setDirty();},editorExit:function(f,c,g,h,d){reviewRiskFinishEditBtn.hide();
reviewRiskCancelEditBtn.hide();reviewRiskEditBtn.show();return true;}});isc.HLayout.create({ID:"reviewEditorToolStrip",height:26,membersMargin:5,align:"right",initWidget:function(){this.Super("initWidget",arguments);
isc.QRMEditButton.create({ID:"reviewRiskEditBtn",title:"Edit",disabled:true,click:function(){reviewRiskTable.startEditing(reviewRiskTable.getRecordIndex(reviewRiskTable.getSelectedRecord()));}});isc.QRMFinishButton.create({title:"Finish Edits",ID:"reviewRiskFinishEditBtn",disabled:true,visibility:"hidden",click:function(){reviewRiskTable.getSelection().setProperty("dirty",true);
reviewRiskTable.endEditing();this.setDisabled(true);}});isc.QRMCancelButton.create({title:"Cancel Edits",ID:"reviewRiskCancelEditBtn",visibility:"hidden",click:function(){reviewRiskTable.cancelEditing();
}});this.addMembers([reviewRiskEditBtn,reviewRiskCancelEditBtn,reviewRiskFinishEditBtn]);}});var b=isc.HLayout.create({width:"100%",membersMargin:5,layoutMargin:0,defaultLayoutAlign:"center",members:[isc.DynamicForm.create({ID:"reviewRiskUpdateSelector",numCols:1,layoutMargin:0,titleOrientation:"top",showTitle:true,layoutAlign:"center",width:"100%",fields:[{type:"textarea",title:"Enter comments on specific risks and press 'Apply Updates' to add comments to selected risks",showTitle:true,name:"update",width:"100%",height:160,required:true,defaultValue:"Enter Risk Review Comment"}]}),isc.IButton.create({title:"Apply Update",width:140,click:function(){viewEditReviewModalWindow.setDirty();
if(reviewRiskTable.getSelection().length>0){reviewRiskTable.getSelection().setProperty("comment",reviewRiskUpdateSelector.getField("update").getValue());reviewRiskTable.getSelection().setProperty("dirty",true);
for(var c=0;c<reviewRiskTable.data.length;c++){reviewRiskTable.refreshRow(c);}}else{isc.say("No risks are selected for updating");}}})]});isc.QRMSaveButton.create({title:"Save",ID:"editReviewSaveButton",click:function(){try{reviewRiskTable.endEditing();
var f=reviewDetailForm1.getValues();var d=new Object();d.scheduledDate=simplifyDate(f.scheduledDate);d.actualDate=simplifyDate(f.actualDate);d.title=f.title;d.reviewComments=f.reviewComments;d.reviewComplete=f.reviewComplete;
d.reviewID=f.reviewComplete;isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./updateReview",prompt:"Updating Review",evalResult:true,params:{REVIEWID:qoCurrent.Review.reviewID,RISKDATA:JSON.stringify(reviewRiskTable.getData().findAll("dirty",true)),REVIEWDATA:JSON.stringify(d)},callback:function(i,h,g){Review.setProjectLocal();
viewEditReviewModalWindow.setClean();}});}catch(c){alert(c.message);Review.setProjectLocal();}}});isc.HLayout.create({ID:"reviewTopToolStrip",align:"right",layoutTopMargin:5,layoutMargin:5,membersMargin:4,members:[editReviewSaveButton]});
isc.TabSet.create({ID:"reviewTabSet",width:"100%",height:"100%",tabBarPosition:"top",tabs:[{title:"Details and Attachments",pane:a},{title:"Risks Under Review",pane:isc.VLayout.create({membersMargin:5,width:"100%",height:"100%",members:[b,reviewRiskTable,reviewEditorToolStrip]})}]});
return isc.VLayout.create({layoutMargin:5,width:"100%",height:"100%",members:[reviewTopToolStrip,reviewTabSet]});}function getReviewForm1(){return isc.DynamicForm.create({ID:"reviewDetailForm1",autoDraw:false,titleOrientation:"left",titleWidth:130,width:"100%",numCols:2,fields:[{name:"title",title:"Review Title",width:"*",required:true,changed:"viewEditReviewModalWindow.setDirty();"},{name:"reviewComments",title:"Comments",type:"textarea",width:"*",height:300,changed:"viewEditReviewModalWindow.setDirty();"},{name:"scheduledDate",required:true,title:"Schuduled Date",changed:"viewEditReviewModalWindow.setDirty();",type:"date"},{name:"actualDate",title:"Actual Date",type:"date",changed:"viewEditReviewModalWindow.setDirty();",defaultValue:null},{name:"reviewComplete",title:"Review Completed",type:"boolean",change:function(b,a,c){if(c){try{isc.ask("Once a review is marked as being complete, no further updates can be made. \nDo you wish to proceed marking this review complete?",function(f){a.setValue(f);
viewEditReviewModalWindow.dirty=true;editReviewSaveButton.setDisabled(false);editReviewSaveButton.setTitle("<span style='font-weight:bold'>Save</span>");});}catch(d){alert(d.message);}return true;}else{a.setValue(c);
return true;}}},{name:"reviewID",type:"hidden"}]});}function defineQRMTileImage(){isc.defineClass("QRMTileImage","Img");isc.QRMTileImage.addProperties({width:100,height:100,imageType:"tile",src:"[SKIN]grid.gif",qrmDirty:false,baseURL:"./paintMetric",setQRMUrl:function(){this.setSrc(this.baseURL+this.QRMURL+"&DESCENDANTS="+checkDescendants.getValue());
}});}function getReviewPane(){return isc.VLayout.create({width:"100%",height:"100%",ID:"reviewPane",membersMargin:5,layoutMargin:5,navigateAway:function(){return true;},setProject:function(){this.setProjectLocal();
},setProjectLocal:function(){Review.setProjectLocal();},members:[isc.HLayout.create({membersMargin:5,members:[isc.Label.create({height:30,width:"100%",layoutMargin:5,align:"left",wrap:false,contents:"<span style='font-weight:bold'>Completed and Scheduled Reviews of Risks</span>"}),isc.DynamicForm.create({width:300,numCols:2,titleWidth:"200",ID:"reviewFilterForm",autoDraw:false,fields:[{name:"riskID",type:"text",required:true,title:"Reviews for Risk Code",characterCasing:"upper",width:100,colSpan:1,keyPress:function(d,c,b,a){if(b=="Enter"||b=="Tab"){try{qrmFindReviewsByRisk(d.getValue());
}catch(f){alert("Risk Table Line 1065"+f.message);}}}}]}),isc.IButton.create({width:65,align:"center",title:"Find",click:function(){try{qrmFindReviewsByRisk(reviewFilterForm.getItem("riskID").getValue());
}catch(a){alert(a.message);}}}),isc.IButton.create({width:65,align:"center",title:"Clear Filter",click:function(){try{reviewPane.setProject();reviewFilterForm.clearValues();}catch(a){alert(a.message);}}})]}),getReviewWidget()]});
}function qrmFindReviewsByRisk(a){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({prompt:"Retrieving Scheduled Reviews",actionURL:"./getAllReviews?riskCode="+a,evalResult:false,callback:function(d,c,b){reviewWidgetTable.setData(JSON.parse(c,dateParser));
}});}function defineOverviewWidget(){var b=isc.VLayout.create({width:660,height:"100%",membersMargin:5,members:[isc.Label.create({align:"left",height:15,wrap:false,contents:"<span class='qrmMinorTitle' style='color:black'>Metrics<span>"}),isc.ListGrid.create({ID:"overviewMetricTable",autoDraw:false,alternateRecordStyles:true,height:"100%",fields:[{name:"data",title:"Metric",canEdit:false,align:"left",width:230},{name:"value",title:"Value",canEdit:false,align:"left",width:"100%"}]})]});
var c=isc.TileLayout.create({ID:"overviewMetricList",backgroundColor:qrmCtrlColor,height:210,animateTileChange:false,autoDraw:true,expandMargins:false,tileHeight:200,tileWidth:200,width:"100%",setData:function(h){if(this.tiles!=null){this.tiles.setProperty("qrmDirty",true);
}if(h!=null&&h.length>0){for(var f=0;f<h.length;f++){var g=h[f];var d=this.tiles.find("ID",g.metricID);if(d!=null){d.qrmDirty=false;d.QRMURL=g.picture;}else{this.addTile(isc.QRMTileImage.create({ID:g.metricID,qrmDirty:false,QRMURL:g.picture}));
}}}this.clearDirty();},clearDirty:function(){if(this.tiles==null){return;}for(var d=0;d<this.tiles.length;d++){var f=this.tiles[d];if(f.qrmDirty){f.hide();}else{f.show();f.setQRMUrl();}}}});var a=isc.VLayout.create({membersMargin:5,width:"100%",height:"100%",members:[isc.Label.create({align:"left",height:15,wrap:false,contents:"<span class='qrmMinorTitle' style='color:black'>Significant Events<span>"}),getSignificantEventsGrid()]});
isc.defineClass("OverviewWidget","VLayout");isc.OverviewWidget.addProperties({membersMargin:5,height:"100%",width:"100%",setProject:function(){this.setProjectLocal();},navigateAway:function(){return true;
},setProjectLocal:function(){isc.RPCManager.sendRequest({prompt:"Retrieving Project Data",actionURL:"./getWelcomeData",evalResult:false,params:{PROJECTID:projectID},callback:function(g,f,d){eventGrid.setData(JSON.parse(f,dateParser));
}});isc.RPCManager.sendRequest({actionURL:"./getMetrics",evalResult:true,params:{DESCENDANTS:checkDescendants.getValue(),PROJECTID:project.projectID},callback:function(g,f,d){overviewMetricList.setData(f);
}});isc.RPCManager.sendRequest({actionURL:"./getOverviewData",evalResult:true,params:{DESCENDANTS:checkDescendants.getValue(),PROJECTID:project.projectID},callback:function(g,f,d){overviewMetricTable.setData(f);
}});},members:[isc.HLayout.create({membersMargin:5,align:"center",width:"100%",height:"100%",members:[b,a]}),c]});}function actOnChange(b){var c=b.getValue("distType");var k=parseFloat(b.getValue("mean"));
var g=parseFloat(b.getValue("stdDev"));var a=parseFloat(b.getValue("simple"));var d=parseFloat(b.getValue("min"));var i=parseFloat(b.getValue("max"));var h=parseFloat(b.getValue("most"));var f=parseFloat(b.getValue("lower"));
var j=parseFloat(b.getValue("upper"));if(c=="au.com.quaysystems.qrm.util.probability.NormalDistribution"&&k>0&&g>0){updateFormChart(b);}else{if(c=="au.com.quaysystems.qrm.util.probability.SimpleDistribution"&&a>0){updateFormChart(b);
}else{if(c=="au.com.quaysystems.qrm.util.probability.TriangularDistribution"&&d>0&&h>0&&i>0&&d<h&&h<i){updateFormChart(b);}else{if(c=="au.com.quaysystems.qrm.util.probability.TriGenDistribution"&&(d<h)&&(h<i)&&(f<j)&&j<i&&f>d){updateFormChart(b);
}else{if((c=="au.com.quaysystems.qrm.util.probability.TruncNormalDistribution")&&(f>0)&&(j>0)&&(f<j)&&(k>0)&&(g>0)){updateFormChart(b);}else{if(c=="au.com.quaysystems.qrm.util.probability.UniformDistribution"&&f>=0&&j>0&&f<j){updateFormChart(b);
}else{b.parentElement.chart.setSrc("[SKIN]grid.gif");}}}}}}}function defineRiskConsequenceProbWidget(){isc.defineClass("RiskConsequenceProbWidget","HLayout");isc.RiskConsequenceProbWidget.addProperties({preMit:true,membersMargin:5,topMargin:5,width:"100%",autoDraw:false,qrmDirty:false,editEnabled:false,clear:function(){this.qrmDirty=false;
this.currentRecord=null;this.descreteGrid.hide();this.probInputForm.show();this.chart.show();},setQRMData:function(record){this.clear();var newRec=new Object();newRec.mean=(this.preMit)?record.costDistributionParamsArray[0]:record.postCostDistributionParamsArray[0];
newRec.stdDev=(this.preMit)?record.costDistributionParamsArray[1]:record.postCostDistributionParamsArray[1];newRec.min=(this.preMit)?record.costDistributionParamsArray[2]:record.postCostDistributionParamsArray[2];
newRec.most=(this.preMit)?record.costDistributionParamsArray[3]:record.postCostDistributionParamsArray[3];newRec.max=(this.preMit)?record.costDistributionParamsArray[4]:record.postCostDistributionParamsArray[4];
newRec.lower=(this.preMit)?record.costDistributionParamsArray[5]:record.postCostDistributionParamsArray[5];newRec.upper=(this.preMit)?record.costDistributionParamsArray[6]:record.postCostDistributionParamsArray[6];
newRec.simple=(this.preMit)?record.costDistributionParamsArray[7]:record.postCostDistributionParamsArray[7];try{newRec.probability=(this.preMit)?record.riskConsequenceProb:record.postRiskConsequenceProb;
}catch(e){newRec.probability=0;}try{newRec.distType=(this.preMit)?record.costDistributionType:record.postCostDistributionType;}catch(e){newRec.distType="au.com.quaysystems.qrm.util.probability.NormalDistribution";
}this.probInputForm.show();this.probInputForm.setValues(newRec);if(newRec.distType=="au.com.quaysystems.qrm.util.probability.DiscreteDistribution"){var st=(this.preMit)?record.costDistributionParams:record.postCostDistributionParams;
var params=eval("("+st+")");params.setProperty("dirty",false);this.descreteGrid.setData(params);this.descreteGrid.dataChanged();this.chart.hide();this.descreteGrid.show();}else{updateFormChart(this.probInputForm);
this.chart.show();this.descreteGrid.hide();}},setMitState:function(state){this.preMit=state;if(state){this.probInputForm.getItem("title").setValue("Pre Mitigation");}if(qoQRM.singlePhase){this.probInputForm.getItem("title").setValue("");
}},initWidget:function(){this.Super("initWidget",arguments);this.probInputForm=isc.DynamicForm.create({titleOrientation:"left",numCols:2,titleWidth:140,width:300,fields:[{type:"header",defaultValue:qoQRM.singlePhase?"":this.preMit?"Pre Mtitgation":"Post Mtitgation",name:"title",startRow:true},{startRow:true,width:80,required:true,type:"double",name:"probability",keyPressFilter:"[0-9.]",title:"% Probability",validators:[{type:"floatRange",min:0,max:100}],defaultValue:100,changed:function(form,item,value){}},{startRow:true,name:"distType",title:"Distribution Type",editorType:"select",valueMap:qoValueMap.distributionType,redrawOnChange:true,change:function(form,item,value,oldValue){if(item.valueMap[value]=="Discrete"){form.parentElement.chart.hide();
form.parentElement.descreteGrid.show();}else{form.parentElement.descreteGrid.hide();form.parentElement.chart.show();}actOnChange(form);},changed:function(form,item,value,oldValue){actOnChange(form);}},{name:"mean",title:"Mean",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.NormalDistribution' || form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TruncNormalDistribution'",changed:function(form,item,value){actOnChange(form);
}},{name:"stdDev",title:"Std. Deviation",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.NormalDistribution' || form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TruncNormalDistribution'",changed:function(form,item,value){actOnChange(form);
}},{name:"min",title:"Minimum",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriangularDistribution' || form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriGenDistribution'",changed:function(form,item,value){actOnChange(form);
}},{name:"most",title:"Most Likely",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriangularDistribution' || form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriGenDistribution'",changed:function(form,item,value){actOnChange(form);
}},{name:"max",title:"Maximum",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriangularDistribution' || form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriGenDistribution'",changed:function(form,item,value){actOnChange(form);
}},{name:"lower",title:"Lower Limit",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:" form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriGenDistribution'|| form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.UniformDistribution'|| form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TruncNormalDistribution'",changed:function(form,item,value){actOnChange(form);
}},{name:"upper",title:"Upper Limit",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TriGenDistribution'|| form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.UniformDistribution'|| form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.TruncNormalDistribution'",changed:function(form,item,value){actOnChange(form);
}},{name:"simple",title:"Value",type:"double",required:true,validators:[{type:"floatRange",min:0}],keyPressFilter:"[0-9.]",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.SimpleDistribution' ",changed:function(form,item,value){actOnChange(form);
}},{type:"spacer",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.DiscreteDistribution' ",colSpan:2},{name:"AddBtn",title:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp;&nbsp;&nbsp;&nbsp;",type:"button",showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.DiscreteDistribution' ",align:"right",showTitle:false,colSpan:2,click:function(form,item){var records=form.parentElement.descreteGrid.getData();
records.push({value:100,prop:100,dirty:true});form.parentElement.descreteGrid.setData(records);form.parentElement.descreteGrid.dataChanged();}},{name:"DeleteBtn",title:"Delete",type:"button",width:70,align:"right",showTitle:false,colSpan:2,showIf:"form.getValue('distType') == 'au.com.quaysystems.qrm.util.probability.DiscreteDistribution' ",click:function(form,item){form.parentElement.descreteGrid.removeSelectedRecord();
}}]});this.descreteGrid=isc.ListGrid.create({width:400,height:200,confirmDiscardEdits:false,alternateRecordStyles:true,autoSaveEdits:true,canEdit:true,editEvent:"click",visibility:"hidden",autoDraw:false,editorExit:function(editCompletionEvent,record,newValue,rowNum,colNum){if(editCompletionEvent!="escape"){record.dirty=true;
}return true;},getBaseStyle:function(record,rowNum,colNum){try{if(typeof(record.dirty)=="undefined"){return this.Super("getBaseStyle",arguments);}else{if(record.dirty){return"newRecord";}else{return this.Super("getBaseStyle",arguments);
}}}catch(e){return"newRecord";}},removeSelectedRecord:function(){try{var records=this.data;records.remove(this.getSelectedRecord());this.setData(records);this.dataChanged();}catch(e){alert(e);}},fields:[{name:"value",title:"Value",type:"double",align:"center",primaryKey:true,required:true,keyPressFilter:"[0-9.]"},{name:"prop",title:"Proportion",align:"center",type:"double",required:true,keyPressFilter:"[0-9.]"}]});
this.chart=isc.Img.create({border:"1px solid black",imageType:"tile",src:"[SKIN]grid.gif",height:200,width:400,autoDraw:false});this.addMembers([this.probInputForm,this.chart,this.descreteGrid]);}});}function updateFormChart(b){var a=(b.parentElement.preMit)?"true":"false";
b.parentElement.chart.setSrc(Page.getAppDir()+"getConsequenceImage?PREMIT="+a+"&WIDTH="+b.parentElement.chart.width+"&HEIGHT="+b.parentElement.chart.height+"&VALUES="+JSON.stringify(b.getValues()));b.parentElement.qrmDirty=true;
}function getIncidentWidgetPane(){return isc.VLayout.create({helpURL:"./html/incidents_helpText.html",qrmDirty:false,height:"100%",width:"100%",membersMargin:5,setProject:function(){this.setProjectLocal();
},setProjectLocal:function(){Issue.setProject();},navigateAway:function(a){return true;},members:[createIncidentFilterPane(),getIssuePaneListGrid()]});}function createIncidentFilterPane(){isc.DynamicForm.create({fields:[{type:"header",defaultValue:"Status",startRow:true},{showTitle:false,name:"Active",defaultValue:true,changed:"incidentFilterGroupChanged()",_constructor:"CheckboxItem"},{showTitle:false,name:"Closed",defaultValue:true,changed:"incidentFilterGroupChanged()",_constructor:"CheckboxItem"},{_constructor:"RowSpacerItem"},{_constructor:"RowSpacerItem"},{_constructor:"Button",align:"right",colSpan:2,endRow:true,disabled:true,title:"Clear Filters",ID:"clearFiltersBtnIncident",click:function(){try{clearIncidentFilterGroup();
qoQRM.RiskTablePane.setProject();this.disable();}catch(a){alert(a.message);}}}],numCols:1,ID:"DynamicFormStatusIncident",autoDraw:false});isc.DynamicForm.create({numCols:1,ID:"DynamicFormToleranceIncident",autoDraw:false,titleWidth:40,fields:[{type:"header",defaultValue:"Severity",changed:"incidentFilterGroupChanged()",startRow:true},{showTitle:false,name:"Extreme",defaultValue:true,changed:"incidentFilterGroupChanged()",_constructor:"CheckboxItem"},{showTitle:false,name:"High",defaultValue:true,changed:"incidentFilterGroupChanged()",_constructor:"CheckboxItem"},{showTitle:false,name:"Significant",defaultValue:true,changed:"incidentFilterGroupChanged()",_constructor:"CheckboxItem"},{showTitle:false,name:"Moderate",defaultValue:true,changed:"incidentFilterGroupChanged()",_constructor:"CheckboxItem"},{showTitle:false,name:"Low",defaultValue:true,changed:"incidentFilterGroupChanged()",_constructor:"CheckboxItem"}]});
isc.DynamicForm.create({numCols:1,ID:"DynamicFormToleranceIncident2",autoDraw:false,fields:[{type:"header",defaultValue:"Impacted Risk Code",startRow:true},{name:"riskID",type:"text",showTitle:false,characterCasing:"upper",width:100,colSpan:2,keyPress:function(d,c,b,a){if(b=="Enter"||b=="Tab"){try{qrmFindIncidentByRisk(d.getValue());
}catch(f){alert("Risk Table Line 1065"+f.message);}}}},{type:"header",defaultValue:"Incident or Issue Code",startRow:true},{name:"incidentID",type:"text",showTitle:false,characterCasing:"upper",width:100,colSpan:2,keyPress:function(d,c,b,a){if(b=="Enter"||b=="Tab"){try{qrmFindIncidentByIncident(d.getValue());
}catch(f){alert("Risk Table Line 1065"+f.message);}}}}]});isc.DynamicForm.create({ID:"incidentDetailForm22",autoDraw:false,titleOrientation:"left",width:150,numCols:1,fields:[{_constructor:"HeaderItem",defaultValue:"Areas of Impact",colSpan:2},{name:"impReputation",defaultValue:true,title:"Reputation",type:"checkbox",defaultValue:true,changed:"incidentFilterGroupChanged()",showTitle:false},{name:"impSafety",defaultValue:true,title:"Human Safety",type:"checkbox",defaultValue:true,changed:"incidentFilterGroupChanged()",showTitle:false},{name:"impSpec",defaultValue:true,title:"Specification",showTitle:false,defaultValue:true,changed:"incidentFilterGroupChanged()",type:"checkbox"},{name:"impTime",defaultValue:true,title:"Schedule",showTitle:false,defaultValue:true,changed:"incidentFilterGroupChanged()",type:"checkbox"},{name:"impCost",defaultValue:true,title:"Cost",defaultValue:true,type:"checkbox",changed:"incidentFilterGroupChanged()",showTitle:false},{name:"impEnviron",defaultValue:true,title:"Environment",defaultValue:true,type:"checkbox",changed:"incidentFilterGroupChanged()",showTitle:false}]});
isc.HStack.create({membersMargin:15,backgroundColor:qrmCtrlColor,margin:2,layoutMargin:5,height:"180",ID:"FilterGroup2Incident",members:[DynamicFormToleranceIncident,incidentDetailForm22,DynamicFormToleranceIncident2,DynamicFormStatusIncident],autoDraw:false});
return isc.HStack.create({backgroundColor:qrmCtrlColor,membersMargin:15,height:"180",members:[FilterGroup2Incident],autoDraw:false});}function qrmFindIncidentByRisk(a){isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({prompt:"Finding Incident",evalResult:false,actionURL:"./findIncidentByRisk",params:{RISKCODE:a,NOCACHE:Math.random()},callback:function(f,c,b){try{try{issueGrid.setData((JSON.parse(c,dateParser)));
}catch(d){alert(d.message);}clearFiltersBtnIncident.enable();}catch(d){isc.say("No Incident or Issues Found");DynamicFormToleranceIncident2.getItem("riskID").setValue(null);return;}}});}function qrmFindIncidentByIncident(id){isc.RPCManager.showPrompt=true;
isc.RPCManager.sendRequest({prompt:"Finding Incident or Issue",evalResult:false,actionURL:"./findIncidentByIncident",params:{INCIDENTID:id,NOCACHE:Math.random()},callback:function(rpcResponse,data,rpcRequest){try{var foundIncident=eval(data);
if(!foundIncident.projectID){isc.say("No Incident or Issues Found");DynamicFormToleranceIncident2.getItem("incidentID").setValue(null);return;}else{findIncidentCB(foundIncident);clearFiltersBtnIncident.enable();
}}catch(e){isc.say("No Incident or Issues Found");DynamicFormToleranceIncident2.getItem("incidentID").setValue(null);return;}}});}function findIncidentCB(b){try{isc.RPCManager.sendRequest({prompt:"Getting Risk Project",showPrompt:true,evalResult:false,params:{PROJECTID:b.projectID,DESCENDANTS:checkDescendants.getValue()},callback:function(j,g,f){project=JSON.parse(g,dateParser);
updateSelectedProject(true);clearFiltersBtn.enable();setTolMatixCB(project);var c=-1;try{for(var d=0;QRMNavigator.getRecord(d).projectID!=project.projectID&&d<1000;d++){c++;}}catch(h){}QRMNavigator.selectSingleRecord(c+1);
isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({prompt:"Retreiving Issue and Incident Summaries",actionURL:"./getAllIncidentsSummary",evalResult:false,bypassCache:true,params:{DESCENDANTS:checkDescendants.getValue(),PROJECTID:projectID,PROCESSFILTER:true,INCIDENTID:b.incidentID,NOCACHE:Math.random()},callback:function(k,i,l){try{issueGrid.setData((JSON.parse(i,dateParser)));
}catch(m){alert(m.message);}}});},actionURL:"./getRiskProject"});}catch(a){alert(a);isc.say("Risk Could Not Be Found");DynamicFormTolerance.getItem("riskID").setValue(null);return;}}function incidentFilterGroupChanged(){DynamicFormToleranceIncident2.getItem("riskID").setValue(null);
DynamicFormToleranceIncident2.getItem("incidentID").setValue(null);clearFiltersBtnIncident.enable();Issue.setProjectLocal();}function clearIncidentFilterGroup(a){DynamicFormToleranceIncident.getItem("Extreme").setValue(true);
DynamicFormToleranceIncident.getItem("High").setValue(true);DynamicFormToleranceIncident.getItem("Significant").setValue(true);DynamicFormToleranceIncident.getItem("Moderate").setValue(true);DynamicFormToleranceIncident.getItem("Low").setValue(true);
DynamicFormStatusIncident.getItem("Active").setValue(true);DynamicFormStatusIncident.getItem("Closed").setValue(true);DynamicFormToleranceIncident2.getItem("riskID").setValue(null);DynamicFormToleranceIncident2.getItem("incidentID").setValue(null);
incidentDetailForm22.getItem("impReputation").setValue(true);incidentDetailForm22.getItem("impSafety").setValue(true);incidentDetailForm22.getItem("impSpec").setValue(true);incidentDetailForm22.getItem("impTime").setValue(true);
incidentDetailForm22.getItem("impCost").setValue(true);incidentDetailForm22.getItem("impEnviron").setValue(true);if(a){return;}Issue.setProjectLocal();}function getIssuePaneListGrid(){return isc.VLayout.create({ID:"Issue",height:"100%",width:"100%",setProject:function(){this.setProjectLocal();
},setProjectLocal:function(){try{issueListViewEditBtn.setDisabled(true);issueListDeleteBtn.setDisabled(true);isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({prompt:"Retreiving Issue and Incident Summaries",actionURL:"./getAllIncidentsSummary",evalResult:false,bypassCache:true,params:{DESCENDANTS:checkDescendants.getValue(),PROJECTID:projectID,PROCESSFILTER:true,TOLEX:DynamicFormToleranceIncident.getItem("Extreme").getValue(),TOLHIGH:DynamicFormToleranceIncident.getItem("High").getValue(),TOLSIG:DynamicFormToleranceIncident.getItem("Significant").getValue(),TOLMOD:DynamicFormToleranceIncident.getItem("Moderate").getValue(),TOLLOW:DynamicFormToleranceIncident.getItem("Low").getValue(),STATACTIVE:DynamicFormStatusIncident.getItem("Active").getValue(),STATCLOSED:DynamicFormStatusIncident.getItem("Closed").getValue(),STATIMPREPUTATION:incidentDetailForm22.getItem("impReputation").getValue(),STATIMPSAFETY:incidentDetailForm22.getItem("impSafety").getValue(),STATIMPSPEC:incidentDetailForm22.getItem("impSpec").getValue(),STATIMPTIME:incidentDetailForm22.getItem("impTime").getValue(),STATIMPCOST:incidentDetailForm22.getItem("impCost").getValue(),STATIMPENVIRON:incidentDetailForm22.getItem("impEnviron").getValue(),NOCACHE:Math.random()},callback:function(f,c,b){try{issueGrid.setData((JSON.parse(c,dateParser)));
}catch(d){alert(d.message);}}});}catch(a){alert(a.message);}},deleteIncident:function(a){isc.ask("Are you sure you want to delete the selected issue or incident?",function(b){if(b){isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./deleteIncident",evalResult:true,params:{INCIDENTID:a.incidentID},callback:function(f,d,c){if(d){isc.say("Item not deleted. Only the original submitter or the root project manager can delete the item");
}Issue.setProjectLocal();}});}});},members:[isc.QRMLabel.create({title:"Issues and Incidents"}),isc.ListGrid.create({ID:"issueGrid",width:"100%",height:"100%",alternateRecordStyles:true,groupByField:"bActive",sortField:"severity",sortDirection:"descending",groupStartOpen:"all",gridComponents:["header","body",isc.ToolStrip.create({defaultLayoutAlign:"center",width:"100%",height:26,membersMargin:5,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMEditButton.create({ID:"issueListViewEditBtn",prompt:"Edit Selected Issue",click:function(){editQRMIncident(issueGrid.getSelectedRecord());
}}),isc.QRMDeleteButton.create({ID:"issueListDeleteBtn",prompt:"Remove Selected Item",click:function(){Issue.deleteIncident(issueGrid.getSelectedRecord());}}),isc.QRMAddButton.create({title:"New Issue",prompt:"Add New Issue",click:function(){editQRMIncident({incidentID:-1,bIssue:true});
}}),isc.QRMAddButton.create({title:"New Incident",prompt:"Add New Incident",click:function(){editQRMIncident({incidentID:-1,bIssue:false});}})]})],recordClick:function(h,b,g,f,a,d,c){issueListViewEditBtn.setDisabled(false);
issueListDeleteBtn.setDisabled(false);},recordDoubleClick:function(h,b,g,f,a,d,c){editQRMIncident(b);},fields:[{name:"incidentProjectCode",title:"Code",width:100,canReorder:false},{name:"severity",includeInRecordSummary:false,showGridSummary:false,showGroupSummary:false,title:"Severity",type:"image",align:"center",width:70,canReorder:false,canGroupBy:true,imageURLPrefix:"tol",imageURLSuffix:".png",getGroupValue:function(c,a,d,f,b){return c;
},getGroupTitle:function(a,b,d,f,c){switch(a){case 5:return"Extreme";break;case 4:return"High";break;case 3:return"Significant";break;case 2:return"Moderate";break;case 1:return"Low";break;}}},{name:"bIssue",title:"Issue or Incident",align:"center",width:100,formatCellValue:function(a){if(a){return"Issue";
}else{return"Incident";}},getGroupTitle:function(a,b,d,f,c){if(a){return"Issues";}else{return"Incidents";}}},{name:"title",title:"Issue",width:"100%"},{name:"reportedByStr",title:"Reported By",width:120,align:"center"},{name:"dateIncident",title:"Date Occured",type:"date",align:"center",width:120,formatCellValue:function(a){try{if(a){return a.getShortMonthName()+" "+a.getDate()+", "+a.getFullYear();
}}catch(b){}}},{name:"bActive",showIf:"false",getGroupValue:function(c,a,d,f,b){return c;},getGroupTitle:function(a,b,d,f,c){if(a){return"Active";}else{return"Closed";}}}]})]});}function defineMultiViewWindow(c,a){if(a){isc.TabSet.create({ID:"incidentTabSet",width:"100%",height:"100%",tabBarPosition:"top",tabs:[{title:(c)?"Issue":"Incident Details",pane:getIncidentEditorDetail(c)}]});
}else{isc.TabSet.create({ID:"incidentTabSet",width:"100%",height:"100%",tabBarPosition:"top",tabs:[{title:(c)?"Issue":"Incident Details",pane:getIncidentEditorDetail(c)},{title:"Impacted Risks",pane:getIncidentEditorRisks(c)},{title:"Impacted Objectives",pane:getIncidentEditorObjective()},{title:"Resolution Disposition",pane:isc.VLayout.create({width:"100%",height:"100%",members:[getIncidentEditorDisposition(c),getIncidentEditorConsequences(c)]})},{title:"Attachments",pane:isc.VLayout.create({width:"100%",height:"100%",members:[getIncidentEditorAttachment(c)]})}]});
}try{isc.QRMSaveButton.create({title:"Save",ID:"multiSaveBtn",disabled:true,click:function(){saveIncidentChanges(function(h,f,d){viewEditMultiModalWindow.setClean();if(qoCurrent.Incident.incidentID==-1){try{viewEditMultiModalWindow.hide();
Issue.setProjectLocal();}catch(g){alert(g.message);}}else{displayIncident();Issue.setProjectLocal();}});}});isc.QRMRefreshButton.create({ID:"multiResetBtn",disabled:true,click:function(){displayIncident();
}});try{isc.Window.create({ID:"viewEditMultiModalWindow",headerControls:["headerLabel","closeButton"],headerDefaults:{layoutMargin:0,membersMargin:5,height:26},items:[isc.VLayout.create({layoutMargin:5,members:[isc.HLayout.create({align:"right",layoutTopMargin:5,layoutMargin:5,membersMargin:4,members:[multiSaveBtn,multiResetBtn]}),incidentTabSet]})],height:Math.min(MainPane.height,760),width:Math.min(MainPane.width*0.98,1250),dirty:false,isModal:true,showModalMask:true,showMaximizeButton:true,autoCenter:true,layoutMargin:0,edgeTop:30,closeClick:function(){incidentUpdatesTable.cancelEditing();
if(this.dirty){isc.ask((c)?"Save Changes to Issue?":"Save Changes to Incident?",function(d){if(d){saveIncidentChanges(function(){try{viewEditMultiModalWindow.dirty=false;viewEditMultiModalWindow.hide();
Issue.setProjectLocal();}catch(f){alert(f.message);}});}else{viewEditMultiModalWindow.hide();viewEditMultiModalWindow.dirty=false;Issue.setProjectLocal();}});}else{viewEditMultiModalWindow.hide();Issue.setProjectLocal();
}},setDirty:function(){try{viewEditMultiModalWindow.dirty=true;multiSaveBtn.setDisabled(false);if(qoCurrent.Incident.incidentID!=-1){multiResetBtn.setDisabled(false);}viewEditMultiModalWindow.setTitle("<span>* "+((!a)?qoCurrent.Incident.incidentProjectCode+" - "+qoCurrent.Incident.title:(c)?"New Issue":"New Incident")+"</span>");
}catch(d){alert(d.message);}},setClean:function(){try{viewEditMultiModalWindow.dirty=false;multiSaveBtn.setDisabled(true);multiResetBtn.setDisabled(true);viewEditMultiModalWindow.setTitle((!a)?qoCurrent.Incident.incidentProjectCode+" - "+qoCurrent.Incident.title:(c)?"New Issue":"New Incident");
}catch(d){alert(d.message);}}});}catch(b){alert(b.message);}}catch(b){alert(b.message);}}function getIncidentEditorDetail(a){isc.DynamicForm.create({ID:"incidentDetailForm1",autoDraw:false,titleOrientation:"left",colWidths:[140,200],width:700,numCols:2,fields:[{name:"title",title:(a)?"Issue":"Incident",width:650,changed:"viewEditMultiModalWindow.setDirty();",required:true},{name:"dateIncident",required:true,title:"Date",changed:"viewEditMultiModalWindow.setDirty();",type:"date"},{name:"reportedByStr",required:true,title:"Reported By",changed:"viewEditMultiModalWindow.setDirty();",type:"text"},{name:"bActive",title:"Currently Active",changed:"viewEditMultiModalWindow.setDirty();",type:"checkbox",defaultValue:false},{name:"severity",title:"Severrity",type:"select",defaultValue:2,changed:"viewEditMultiModalWindow.setDirty();",valueMap:{5:"Extreme",4:"High",3:"Significant",2:"Moderate",1:"Low"}},{name:"description",title:"Description",required:true,changed:"viewEditMultiModalWindow.setDirty();",type:"textarea",width:650,height:100},{name:"incidentID",type:"hidden"},{name:"bIssue",type:"hidden",defaultValue:a}]});
isc.DynamicForm.create({ID:"incidentDetailForm2",autoDraw:false,titleOrientation:"left",width:200,numCols:1,fields:[{_constructor:"HeaderItem",defaultValue:"Areas of Impact",colSpan:2},{name:"impReputation",width:"200",title:"Reputation",type:"checkbox",defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",showTitle:false},{name:"impSafety",width:"200",title:"Human Safety",type:"checkbox",defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",showTitle:false},{name:"impSpec",width:"200",title:"Specification",showTitle:false,defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",type:"checkbox"},{name:"impTime",width:"200",title:"Schedule",showTitle:false,defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",type:"checkbox"},{name:"impCost",width:"200",title:"Cost",defaultValue:false,type:"checkbox",changed:"viewEditMultiModalWindow.setDirty();",showTitle:false},{name:"impEnviron",width:"200",title:"Environment",defaultValue:false,type:"checkbox",changed:"viewEditMultiModalWindow.setDirty();",showTitle:false}]});
return isc.VLayout.create({membersMargin:5,members:[isc.QRMLabel.create({title:(a)?"Issue Details":"Incident Details"}),isc.HLayout.create({membersMargin:20,layoutMargin:5,members:[incidentDetailForm1,incidentDetailForm2]}),getMultiEditorUpdates(a)]});
}function getIncidentEditorRisks(a){isc.ListGrid.create({ID:"incidentPossibleRiskList",width:"100%",height:"100%",dataSource:riskLiteDS,canDragRecordsOut:true,dragDataAction:"copy",alternateRecordStyles:true,autoFetchData:false,fields:[{name:"currentTolerance",title:" ",type:"image",align:"center",width:30,imageURLPrefix:"tol",imageURLSuffix:".png"},{name:"riskProjectCode",title:"Risk",canEdit:false,align:"left",width:60},{name:"title",title:"Title",align:"left"}]});
isc.ListGrid.create({ID:"incidentRiskTable",width:"100%",height:"100%",canAcceptDroppedRecords:true,canRemoveRecords:true,autoFetchData:false,alternateRecordStyles:true,preventDuplicates:true,leaveScrollbarGap:false,warnOnRemoval:true,removeRecordClick:function(){this.Super("removeRecordClick",arguments);
viewEditMultiModalWindow.setDirty();},emptyMessage:(a)?"No Risks for this Issue Found":"No Risks for this Incident Found",fields:[{name:"currentTolerance",title:" ",type:"image",align:"center",width:30,imageURLPrefix:"tol",imageURLSuffix:".png"},{name:"riskProjectCode",title:"Risk",canEdit:false,align:"left",width:60},{name:"title",title:"Title",align:"left"}]});
return isc.HLayout.create({membersMargin:10,height:"100%",width:"100%",members:[isc.VLayout.create({width:"100%",members:[isc.QRMLabel.create({title:"Impacted Risks"}),incidentRiskTable]}),isc.Img.create({src:"arrow_left.png",width:32,height:32,layoutAlign:"center",click:function(){incidentRiskTable.transferSelectedData(incidentPossibleRiskList);
viewEditMultiModalWindow.setDirty();}}),isc.VLayout.create({width:"100%",members:[isc.QRMLabel.create({title:(a)?"Select the risks impacted by this issue":"Select the risks impacted by this incident"}),incidentPossibleRiskList]})]});
}function getIncidentEditorObjective(){isc.TreeGrid.create({ID:"IncidentObjectiveTree",height:"100%",width:"100%",cursor:"hand",nodeIcon:"[SKIN]file.png",folderIcon:"[SKIN]file.png",closedIconSuffix:"",showOpenIcons:false,showDropIcons:false,showConnectors:true,data:isc.Tree.create({modelType:"parent",nameProperty:"objective",idField:"objectiveID",parentIdField:"parentID",data:qoAll.Objectives}),rowClick:function(b,c,a){b.active=!b.active;
viewEditMultiModalWindow.setDirty();IncidentObjectiveTree.redraw();},getCellCSSText:function(a,c,b){if(c==0){return"color:black;";}if(b==0){if(a.active){return"color:red;";}}}});return isc.VLayout.create({height:"100%",width:"100%",membersMargin:5,members:[IncidentObjectiveTree]});
}function getIncidentEditorDisposition(a){isc.DynamicForm.create({ID:"incidentDispositionForm1",autoDraw:false,titleOrientation:"left",colWidths:[140,350],width:700,numCols:2,fields:[{name:"lessonsLearnt",title:"Lessons Learnt",required:true,changed:"viewEditMultiModalWindow.setDirty();",type:"textarea",width:600,height:100},{name:"controls",title:"Controls In Place",type:"textarea",changed:"viewEditMultiModalWindow.setDirty();",width:600,height:100},{name:"incidentID",type:"hidden"}]});
isc.DynamicForm.create({ID:"incidentDispositionForm2",autoDraw:false,titleOrientation:"left",width:200,numCols:1,fields:[{_constructor:"HeaderItem",defaultValue:"Quality Measures",colSpan:2},{name:"bControl",width:"200",title:"Controls Operated Effectively",type:"checkbox",defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",showTitle:false},{name:"bCauses",width:"200",title:"Actual Causes Were Identified",type:"checkbox",defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",showTitle:false},{name:"bMitigated",width:"200",title:"Mitigation and Response Plan were Effective",showTitle:false,defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",type:"checkbox"},{name:"bIdentified",width:"200",title:"Risk Previously Identified",showTitle:false,defaultValue:false,changed:"viewEditMultiModalWindow.setDirty();",type:"checkbox"},{name:"bRated",width:"200",title:"Risk Rated and Assesed Correctly",defaultValue:false,type:"checkbox",changed:"viewEditMultiModalWindow.setDirty();",showTitle:false},{name:"bReviews",width:"200",title:"Reviews of Risk Effective",defaultValue:false,type:"checkbox",changed:"viewEditMultiModalWindow.setDirty();",showTitle:false}]});
if(a){return isc.VLayout.create({membersMargin:5,members:[isc.QRMLabel.create({title:"Issue Disposition"}),isc.HLayout.create({membersMargin:20,layoutMargin:5,members:[incidentDispositionForm1]})]});}else{return isc.VLayout.create({membersMargin:5,members:[isc.QRMLabel.create({title:"Incident Disposition"}),isc.HLayout.create({membersMargin:20,layoutMargin:5,members:[incidentDispositionForm1,incidentDispositionForm2]})]});
}}function getIncidentEditorAttachment(a){return isc.VLayout.create({width:"100%",height:"100%",membersMargin:5,layoutMargin:0,members:[isc.QRMLabel.create({title:(a)?"Issue Attachements":"Incident Attachments"}),isc.ListGrid.create({ID:"incidentAttachmentTable",height:"100%",width:"100%",autoDraw:false,alternateRecordStyles:true,selectionAppearance:"checkbox",emptyMessage:(a)?"No Attachments for Issue found":"No Attachments for Incident found",gridComponents:["header","body",isc.ToolStrip.create({defaultLayoutAlign:"center",width:"100%",height:26,membersMargin:5,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMDeleteButton.create({click:function(){isc.RPCManager.sendRequest({actionURL:"./removeAttachments",params:{DATA:JSON.stringify(incidentAttachmentTable.getSelection().getProperty("internalID"))},callback:function(d,c,b){getIncidentAttachments(qoCurrent.Incident.incidentID);
}});}}),isc.QRMAddButton.create({prompt:(a)?"Add Issue Attachment":"Add Incident Attachment",title:(a)?"Add Issue Attachment":"Add Incident Attachment",width:180,click:function(){isc.Window.create({items:[isc.QRMAttachmentForm.create({ID:"incidentAttachmentForm"})],ID:"incidentAttachmentWindow",title:"Incident Attachment",layoutMargin:0,autoDraw:true,isModal:true,showModalNask:true,autoSize:true,autoCenter:true});
incidentAttachmentForm.showForm(qoCurrent.Incident.incidentID,"INCIDENT",function(){incidentAttachmentWindow.hide();getIncidentAttachments(qoCurrent.Incident.incidentID);});incidentAttachmentWindow.show();
}})]})],fields:[{name:"description",title:"Decription",width:"50%",align:"left"},{title:"Attachment",type:"text",width:100,align:"center",formatCellValue:function(f,b,g,c,d){if(b.attachmentURL){return"<a href = '"+b.attachmentURL+"' target='_blank'>Download</a>";
}else{return"<a href = '"+b.url+"' target='_blank'>View</a>";}}}]})]});}function getIncidentEditorConsequences(b){var a=isc.ListGrid.create({ID:"incidentConsequencesTable",autoDraw:false,alternateRecordStyles:true,width:"100%",height:"100%",confirmCancelEditing:true,confirmDiscardEdits:true,gridComponents:["header","body",isc.ToolStrip.create({defaultLayoutAlign:"center",width:"100%",height:26,membersMargin:5,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMAddButton.create({width:150,title:"Add New Consequence",prompt:"Add New Consequence",click:function(){incidentConsequencesTable.startEditingNew();
viewEditMultiModalWindow.setDirty();}}),isc.QRMDeleteButton.create({showDisabledIcon:true,icon:"[SKIN]/actions/remove.png",title:"Delete",prompt:"Remove Selected Consequence",click:function(){try{incidentConsequencesTable.removeSelectedRecord();
viewEditMultiModalWindow.setDirty();this.parentElement.dirty=true;}catch(c){alert(c.message);}}})]})],removeSelectedRecord:function(){try{var c=this.data;c.remove(this.getSelectedRecord());this.setData(c);
this.dataChanged();}catch(d){alert(d);}},emptyMessage:(b)?"No Quantifiable Consequences for this Issue Found":"No Quantifiable Consequences for this Incident Found",fields:[{name:"description",title:"Description",canEdit:true,align:"left",changed:"viewEditMultiModalWindow.setDirty();",width:"100%"},{name:"typeID",title:"Type",canEdit:true,type:"select",align:"center",changed:"viewEditMultiModalWindow.setDirty();",defaultValue:2,valueMap:qoValueMap.quantTypes,width:200},{name:"value",title:"Value",canEdit:true,align:"center",width:100,changed:"viewEditMultiModalWindow.setDirty();",validateOnChange:true,validators:[{type:"isFloat"}]}]});
return isc.VLayout.create({membersMargin:5,height:"100%",width:"100%",members:[isc.QRMLabel.create({title:(b)?"Quatifiable Consequences of Issue":"Quatifiable Consequences of Incident"}),a]});}function getMultiEditorUpdates(b){var a=isc.ListGrid.create({ID:"incidentUpdatesTable",autoDraw:false,alternateRecordStyles:true,width:"100%",height:"100%",confirmCancelEditing:true,confirmDiscardEdits:true,gridComponents:["header","body",isc.ToolStrip.create({defaultLayoutAlign:"center",width:"100%",height:26,membersMargin:5,members:[isc.LayoutSpacer.create({width:"*"}),isc.QRMAddButton.create({title:"Add New Update",width:120,prompt:"Add New Update",ID:"multiAddUpdateBtn",click:function(){incidentUpdatesTable.startEditingNew({id:-1,reportedByStr:userName,dateEntered:new Date()});
viewEditMultiModalWindow.setDirty();}})]})],removeSelectedRecord:function(){try{var c=this.data;c.remove(this.getSelectedRecord());this.setData(c);this.dataChanged();}catch(d){alert(d);}},emptyMessage:(b)?"No Upates for this Issue Found":"No Upates for this Incident Found",editorExit:function(g,c,i,j,d){if(c==null&&i==null){incidentUpdatesTable.cancelEditing();
try{var f=this.data;f.remove(c);this.setData(f);this.dataChanged();}catch(h){alert(h);}}},fields:[{name:"description",title:"Update",canEdit:true,align:"left",changed:"viewEditMultiModalWindow.setDirty();",width:"100%"},{name:"reportedByStr",canEdit:false,align:"center",width:130,title:"Entered By"},{canEdit:false,name:"dateEntered",title:"Date Entered",type:"date",align:"center",width:120,formatCellValue:function(c){if(c){return c.getShortMonthName()+" "+c.getDate()+", "+c.getFullYear();
}}}]});return isc.VLayout.create({membersMargin:5,width:"100%",height:"100%",members:[isc.QRMLabel.create({ID:"incidentUpdateLabel",title:(b)?"Issue Updates":"Incident Updates"}),a]});}function getIncidentAttachments(a){isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./getIncidentAttachments",evalResult:true,params:{INCIDENTID:a},callback:function(d,c,b){incidentAttachmentTable.setData(c);}});}function getIncidentUpdates(a){isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./getIncidentUpdates",evalResult:true,params:{INCIDENTID:a},callback:function(f,c,b){try{incidentUpdatesTable.setData(c);}catch(d){alert("Error Setting incident Updates "+d.message);
}}});}function editQRMIncident(a){var b=(a.incidentID==-1)?true:false;try{qoCurrent.Incident=a;defineMultiViewWindow(a.bIssue,b);try{viewEditMultiModalWindow.show();}catch(c){alert("Line 917 "+c.message);
}if(qoCurrent.Incident.incidentID==-1){incidentDetailForm1.setData(qoCurrent.Incident);incidentDetailForm2.setData(qoCurrent.Incident);viewEditMultiModalWindow.setClean();multiResetBtn.setDisabled(true);
multiAddUpdateBtn.setDisabled(true);incidentUpdatesTable.hide();incidentUpdateLabel.hide();return;}else{multiResetBtn.setDisabled(false);multiAddUpdateBtn.setDisabled(false);incidentUpdatesTable.show();
incidentUpdateLabel.show();}displayIncident();viewEditMultiModalWindow.setClean();viewEditMultiModalWindow.setTitle((!b)?a.incidentProjectCode+" - "+a.title:(bIssue)?"New Issue":"New Incident");}catch(c){alert("Error in editQRMIncident "+c.message);
}}function displayIncident(){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./getIncident",evalResult:false,params:{INCIDENTID:qoCurrent.Incident.incidentID},callback:function(g,c,b){try{qoCurrent.Incident=JSON.parse(c,dateParser);
incidentTabSet.selectTab(0);incidentDetailForm1.setData(qoCurrent.Incident);incidentDetailForm2.setData(qoCurrent.Incident);incidentDispositionForm1.setData(qoCurrent.Incident);incidentDispositionForm2.setData(qoCurrent.Incident);
qoAll.Objectives.setProperty("active",false);var f=qoCurrent.Incident.objectivesImpacted;for(var a=0;a<f.length;a++){IncidentObjectiveTree.data.data.find("objectiveID",f[a]).active=true;}IncidentObjectiveTree.getData().openAll();
}catch(d){alert(d.message);}try{incidentConsequencesTable.setData(qoCurrent.Incident.impacts);}catch(d){incidentConsequencesTable.setData(null);}try{incidentUpdatesTable.setData(qoCurrent.Incident.updates);
}catch(d){incidentUpdatesTable.setData(null);}isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./getIncidentRisks",evalResult:true,params:{INCIDENTID:qoCurrent.Incident.incidentID},callback:function(h,j,i){incidentRiskTable.setData(j);
}});incidentPossibleRiskList.fetchData({DESCENDANTS:checkDescendants.getValue(),PROJECTID:project.projectID,OPERATION:"getRiskLiteFetch"});getIncidentAttachments(qoCurrent.Incident.incidentID);viewEditMultiModalWindow.setClean();
}});}function saveIncidentChanges(a){var g=incidentDetailForm1.getValues();if(g.incidentID!=-1){var d=IncidentObjectiveTree.data.data.findAll("active",true);var f=new Array();if(d!=null){for(var c=0;c<d.length;
c++){f.add(d[c].objectiveID);}}else{f.add(-1);}g.objectivesImpacted=f;var b=incidentRiskTable.data;var h=new Array();if(b!=null){for(c=0;c<b.length;c++){h.add(b[c].riskID);}}else{h.add(-1);}g.risksImpacted=h;
g.impacts=incidentConsequencesTable.getData();g.updates=incidentUpdatesTable.getData();}isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./updateIncident",evalResult:true,params:{INCIDENTID:qoCurrent.Incident.incidentID,VALUE:g,PROJECTID:project.projectID},callback:a});
}function riskEditorDirty(){if(!qoRiskController.secAllowEdit||!qoRiskController.allowEditorChanges){return;}riskSaveBtn.setDisabled(false);riskResetBtn.setDisabled(false);if(!qoRiskController.dirty){idRiskEditorWindow.setTitle("<span >*"+qoRiskController.currentRisk.riskProjectCode+" - "+qoRiskController.currentRisk.title+"</span>");
}qoRiskController.dirty=true;qoCurrent.Pane.dirty=true;var a=qoCurrent.Tab;var b=a.title;if(b.charAt(b.length-1)!="*"){riskTabSet.setTabTitle(a,b+"*");}}function getRiskAttachments(){isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./getRiskAttachments",evalResult:true,params:{RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(c,b,a){riskEditorAttachmentTable.setData(b);
}});}function getRiskComments(){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./getRiskComments",evalResult:false,params:{RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(c,b,a){riskEditorCommentTable.setData(JSON.parse(b,dateParser));
}});}function getRiskAndDisplayInt(b,a){qoRiskEditor.createRiskEditor();isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({showPrompt:true,prompt:"Retrieving Risk",actionURL:"./getRisk",evalResult:false,params:{RISKID:qoRiskController.riskID,PROJECTID:project.projectID,NOCACHE:Math.random()},callback:function(f,d,c){getRiskAndDisplayCallBack(d,null,a);
}});}function getRiskCodeAndDisplayInt(a){isc.RPCManager.showPrompt=true;isc.RPCManager.sendRequest({showPrompt:true,prompt:"Retrieving Risk",actionURL:"./getRiskCode",evalResult:false,params:{RISKID:a,PROJECTID:project.projectID,NOCACHE:Math.random()},callback:function(f,c,b){try{qoRiskEditor.createRiskEditor();
getRiskAndDisplayCallBack(c);}catch(d){alert(d.message);isc.say(c);}}});}function getRiskAndDisplayCallBack(d,b,a){var g=b||0;var c=JSON.parse(d,dateParser);qoRiskController.currentRisk=c;qoRiskController.dirty=false;
idRiskEditorWindow.setHeight(Math.min(MainPane.getHeight()*0.98,760));idRiskEditorWindow.setWidth(Math.min(MainPane.getWidth()*0.98,1100));idRiskEditorWindow.centerInPage();idRiskEditorWindow.show();if(c.userUpdateSecurity){qoRiskController.secAllowEdit=true;
idRiskEditorWindow.setTitle("<span>"+c.riskProjectCode+" - "+c.title+"</span>");}else{qoRiskController.secAllowEdit=false;idRiskEditorWindow.setTitle("<span>(Read Only) "+c.riskProjectCode+" - "+c.title+"</span>");
}riskTabSet.selectTab(g);qoCurrent.TabNum=g;qoCurrent.Tab=riskTabSet.getSelectedTab();qoCurrent.TabPane=riskTabSet.getTabPane(qoCurrent.Tab);qoCurrent.TabID="riskBasicEditorLayout";registerRiskInterest(qoRiskController.riskID);
try{qoRiskEditor.displayRisk(c);}catch(f){alert("Error display risk: "+f.message);}}function newRisk(d,c){if(typeof(editNewRiskBasicModalWindow)=="undefined"){var b=isc.HLayout.create({height:30,width:"100%",membersMargin:5,align:"right",layoutMargin:5,members:[isc.QRMSaveButton.create({title:"Submit",align:"center",width:100,click:function(){if(!riskNewBasicForm.validate()){return;
}var h=parseInt(riskNewBasicForm.getValue("riskID"),10);var g=riskNewBasicForm.getValues();g.startExposure=simplifyDate(g.startExposure);g.endExposure=simplifyDate(g.endExposure);var f="./newRisk";if(h==qoQRM.qrmNewRisk||h==qoQRM.qrmNewSummaryRisk){isc.RPCManager.showPrompt=true;
editNewRiskBasicModalWindow.closeClick();if(riskNewBasicForm.getValue("forceDownRisk")){f="./newForceDownRisk";}isc.RPCManager.sendRequest({prompt:"Creating New Risk",evalResult:true,params:{DATA:JSON.stringify(riskNewBasicForm.getValues())},callback:function(k,j,i){isc.say("Risk assigned ID: "+j);
if(h==qoQRM.qrmNewRisk){updateSelectedProject();}else{if(h==qoQRM.qrmNewSummaryRisk){Relationship.setProjectLocal();}}},actionURL:f});}}}),isc.QRMCancelButton.create({title:"Cancel",click:function(){editNewRiskBasicModalWindow.closeClick();
}})]});var a=isc.DynamicForm.create({ID:"riskNewBasicForm",numCols:2,titleWidth:140,width:"100%",height:"100%",hiliteRequiredFields:true,fields:[{name:"title",type:"text",title:"Risk Title",width:600,required:true},{name:"summaryRisk",title:"Summary Risk",defaultValue:false,type:"checkbox"},{name:"forceDownRisk",title:"Propogated Risk",defaultValue:false,type:"checkbox",change:"form.getField('typePropogation').setDisabled(!value)"},{name:"typePropogation",type:"radioGroup",colSpan:"*",vertical:true,disabled:true,valueMap:{0:"Immediate Sub Projects",1:"All Sub Projects"},redrawOnChange:true,defaultValue:0,title:"Propogate Risk To:"},{name:"description",width:600,type:"textarea",required:true,height:90,title:"Description"},{name:"consequences",width:600,title:"Consequences",height:90,required:true,type:"textarea"},{name:"cause",width:600,title:"Possible Causes",height:90,type:"textarea"},{name:"ownerID",width:200,title:"Risk Owner",required:true,type:"select",allowEmptyValue:false,startRow:true},{name:"manager1ID",width:200,title:"Risk Manager",required:true,type:"select",allowEmptyValue:false,startRow:true},{name:"startExposure",width:300,title:"Start of Exposure",type:"date",startRow:true},{name:"endExposure",width:300,title:"End of Exposure",type:"date",startRow:true},{name:"riskID",_constructor:"HiddenItem"},{name:"projectID",_constructor:"HiddenItem"}]});
isc.Window.create({ID:"editNewRiskBasicModalWindow",title:"New Risk",height:Math.min(MainPane.height*0.95,600),width:Math.min(MainPane.width*0.95,900),showMinimizeButton:false,autoCenter:true,isModal:true,showModalMask:true,autoDraw:true,items:[isc.VLayout.create({width:"100%",membersMargin:5,layoutMargin:5,members:[a,b]})]});
}else{editNewRiskBasicModalWindow.show();}riskNewBasicForm.getItem("ownerID").setValueMap(qoValueMap.owner);riskNewBasicForm.getItem("manager1ID").setValueMap(qoValueMap.manager);riskNewBasicForm.clearValues();
riskNewBasicForm.setValues({riskID:-1,projectID:projectID,forceDownRisk:false,typePropogation:0});riskNewBasicForm.getField("typePropogation").setDisabled(true);if(d==qoQRM.qrmNewSummaryRisk){editNewRiskBasicModalWindow.setTitle("New Summary Risk");
riskNewBasicForm.getItem("summaryRisk").setValue(true);riskNewBasicForm.getItem("summaryRisk").disable();riskNewBasicForm.getItem("forceDownRisk").setValue(false);riskNewBasicForm.getItem("forceDownRisk").disable();
}else{if(d==qoQRM.qrmNewPropogatedRisk){editNewRiskBasicModalWindow.setTitle("New Propogated Risk");riskNewBasicForm.getItem("summaryRisk").setValue(false);riskNewBasicForm.getItem("summaryRisk").disable();
riskNewBasicForm.getItem("forceDownRisk").setValue(true);riskNewBasicForm.getItem("forceDownRisk").disable();riskNewBasicForm.getField("typePropogation").setDisabled(false);}}}function deleteConsequence(a){isc.ask("Delete selected consequece?",function(b){if(b){isc.RPCManager.showPrompt=false;
isc.RPCManager.sendRequest({actionURL:"./deleteConsequence",evalResult:true,params:{ID:a,RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(g,f,d){for(var c=0;c<f.length;c++){f[c].type=f[c].quantImpactType.description+" ("+f[c].quantImpactType.units+")";
}riskEditorConsequenceTable.setData(f);}});}});}function updateRiskEditorContingency(){var a=contingencyForm.getValues();a.riskID=qoRiskController.riskID;isc.RPCManager.sendRequest({actionURL:"./calcRiskContingency",showPrompt:true,prompt:"Calculating Contingency",evalResult:false,params:{RISKID:qoRiskController.currentRisk.riskID,PROJECTID:qoRiskController.currentRisk.projectID,DATA:JSON.stringify(a)},callback:function(f,c,b){try{contingencyForm2.getItem("viewState").setDisabled(false);
contingencyForm2.getItem("viewState").setValueDisabled("UnTreated",false);contingencyForm2.getItem("viewState").setValueDisabled("Treated",false);contingencyForm2.markForRedraw();contingencyForm.setValues(JSON.parse(c,dateParser));
contingencyForm.getItem("saveContingencyButton").setDisabled(false);contingencyGraph.setSrc(Page.getAppDir()+"getContingencyGraph?HEIGHT="+contingencyGraph.getHeight()+"&WIDTH="+contingencyGraph.getWidth()+"&preMit="+contingencyForm2.getItem("viewState").getValue()+"&nocache="+Math.random());
}catch(d){isc.say(d.message);}}});}function updateConsequnceTable(){var c=false;var a=qoRiskController.currentRisk.probConsequenceNodes;for(var b=0;b<a.length;b++){a[b].type=a[b].quantImpactType.description+" ("+a[b].quantImpactType.units+")";
a[b].costCategroy=a[b].quantImpactType.costCategroy;if(a[b].quantImpactType.costCategroy){c=true;}}if(c&&!riskBasicForm.getItem("useCalculatedContingency").getValue()){consqCostWarningLabel.show();}else{consqCostWarningLabel.hide();
}try{riskEditorConsequenceTable.setData(a);riskEditorConsequenceTable.markForRedraw();consqCostWarningLabel.markForRedraw();contingencyForm.getItem("saveContingencyButton").setDisabled(true);contingencyForm.setValues(qoRiskController.currentRisk);
}catch(d){isc.say(d.message);}contingencyForm2.getItem("viewState").setDisabled(true);contingencyGraph.setSrc("[SKIN]grid.gif");}function newRiskComment(){isc.Window.create({ID:"riskCommentModalWindow",title:"Risk Comment",showMinimizeButton:false,autoSize:true,autoCenter:true,isModal:true,showModalMask:true,closeClick:function(){RiskCommentForm.clearValue("comment");
RiskCommentForm.clearValue("commenturl");RiskCommentForm.clearValue("UploadItem0");riskCommentModalWindow.hide();},autoDraw:true,items:[getNewCommentLayout()]});riskCommentModalWindow.show();RiskCommentForm.getItem("riskID").setValue(qoRiskController.currentRisk.riskID);
}function getNewCommentLayout(){return isc.VLayout.create({membersMargin:5,layoutMargin:5,members:[isc.DynamicForm.create({ID:"RiskCommentForm",numCols:1,titleOrientation:"top",width:600,encoding:"multipart",target:"_qrmFormTarget",action:"./QRMComment?saveComment=true",fields:[{_constructor:"HeaderItem",defaultValue:"New Comment"},{title:"Comment",required:true,name:"comment",_constructor:"TextArea",width:"600",height:200},{title:"File Attachment",name:"UploadItem0",_constructor:"UploadItem",width:600},{title:"Comment URL",name:"commenturl",_constructor:"Text",width:600},{name:"riskID",type:"hidden"}]}),isc.ToolStrip.create({autoDraw:false,width:600,layoutMargin:5,membersMargin:5,height:24,members:[isc.Label.create({contents:"",width:"100%",autoDraw:false}),isc.QRMSaveButton.create({title:"Submit",click:function(){if(RiskCommentForm.validate()){RiskCommentForm.submitForm();
RiskCommentForm.clearValue("comment");RiskCommentForm.clearValue("commenturl");RiskCommentForm.clearValue("UploadItem0");riskCommentModalWindow.hide();}}}),isc.QRMCancelButton.create({click:function(){RiskCommentForm.clearValue("comment");
RiskCommentForm.clearValue("commenturl");RiskCommentForm.clearValue("UploadItem0");riskCommentModalWindow.hide();}})]})]});}function getRiskReviewLayoutData(){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({evalResult:false,params:{RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(c,b,a){riskReviewLayoutRevTable.setData(JSON.parse(b,dateParser));
},actionURL:"./getRiskReviews"});}function getRiskAuditData(){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({actionURL:"./getRiskComments",evalResult:false,params:{RISKID:qoRiskController.riskID,PROJECTID:project.projectID},callback:function(a,f,g){var i=JSON.parse(f,dateParser);
var d=null;var m=null;var k=null;var b=null;var l=null;var c=null;try{d=i.findAll("identification",true).find("review",true);}catch(j){}try{m=i.findAll("evaluation",true).find("review",true);}catch(j){}try{k=i.findAll("mitigation",true).find("review",true);
}catch(j){}try{b=i.findAll("identification",true).find("approval",true);}catch(j){}try{l=i.findAll("evaluation",true).find("approval",true);}catch(j){}try{c=i.findAll("mitigation",true).find("approval",true);
}catch(j){}var h=new Array();if(typeof(d)=="undefined"||d==null){d=new Object();d.person="-";d.comment="Not Yet Entered";}d.step="Identification Review",h.push(d);if(typeof(b)=="undefined"||b==null){b=new Object();
b.person="-";b.comment="Not Yet Entered";}b.step="Identification Approval",h.push(b);if(typeof(m)=="undefined"||m==null){m=new Object();m.person="-";m.comment="Not Yet Entered";}m.step="Evaluation Review",h.push(m);
if(typeof(l)=="undefined"||l==null){l=new Object();l.person="-";l.comment="Not Yet Entered";}l.step="Evaluation Approval",h.push(l);if(typeof(k)=="undefined"||k==null){k=new Object();k.person="-";k.comment="Not Yet Entered";
}k.step="Mitigation Review",h.push(k);if(typeof(c)=="undefined"||c==null){c=new Object();c.person="-";c.comment="Not Yet Entered";}c.step="Mitigation Approval",h.push(c);riskReviewLayoutAuditTable.setData(h);
}});}function getSaveAsSubmitForm(){return isc.DynamicForm.create({autoDraw:true,ID:"SaveAsSubmitForm",visibility:"hidden",action:"./QRMReport/report",canSubmit:true,fields:[{name:"riskID",type:"hidden"},{name:"format",type:"hidden"},{name:"ReportID",type:"hidden",defaultValue:-2}]});
}function newAudit(){isc.Window.create({ID:"riskAuditModalWindow",title:"Register Audit Milestone",showMinimizeButton:false,autoSize:true,autoCenter:true,isModal:true,showModalMask:true,closeClick:function(){RiskAuditForm.clearValue("comment");
riskAuditModalWindow.hide();},autoDraw:true,items:[getNewAuditLayout()]});riskAuditModalWindow.show();}function getNewAuditLayout(){return isc.VLayout.create({membersMargin:5,layoutMargin:5,members:[isc.DynamicForm.create({ID:"RiskAuditForm",numCols:1,titleOrientation:"top",width:600,fields:[{_constructor:"HeaderItem",defaultValue:"Register Audit"},{title:"Audit Type",required:true,name:"type",_constructor:"SelectItem",width:600,defaultValue:1,valueMap:{1:"Identification of Risk Reviewed",2:"Identification of Risk Approved",3:"Evaluation of Risk Reviewed",4:"Evaluation of Risk Approved",5:"Mitigation Plan of Risk Reviewed",6:"Mitigation Plan of Risk Approved"}},{title:"Comment",required:true,name:"comment",_constructor:"TextArea",width:"600",height:200}]}),isc.ToolStrip.create({autoDraw:false,width:600,layoutMargin:5,membersMargin:5,backgroundColor:"white",height:24,members:[isc.Label.create({contents:"",width:"100%",autoDraw:false}),isc.QRMSaveButton.create({title:"Submit",click:function(){if(RiskAuditForm.validate()){var a=RiskAuditForm.getItem("type");
isc.ask("Are you sure you wisk to register '"+a.valueMap[a.getValue()]+"' for risk "+qoRiskController.currentRisk.riskProjectCode,function(b){if(b){isc.RPCManager.showPrompt=false;isc.RPCManager.sendRequest({evalResult:true,params:{DATA:JSON.stringify(RiskAuditForm.getValues()),RISKID:qoRiskController.currentRisk.riskID,PROJECTID:project.projectID},callback:function(f,d,c){RiskAuditForm.clearValue("comment");
RiskAuditForm.resetValue("type");riskAuditModalWindow.hide();qoRiskController.resetOnExit=true;if(d){isc.say("Audit Registered");}else{isc.say("User Not Authorised to Register an Audit");}getRiskAuditData();
},actionURL:"./registerAudit"});}else{RiskAuditForm.clearValue("comment");RiskAuditForm.resetValue("type");riskAuditModalWindow.hide();}});}}}),isc.QRMCancelButton.create({click:function(){RiskAuditForm.clearValue("comment");
RiskAuditForm.resetValue("type");riskAuditModalWindow.hide();}})]})]});}function resetCurrentProject(){resetProject(project.projectID);}function resetProject(a){isc.RPCManager.sendRequest({prompt:"Retrieving Risk Project",showPrompt:true,evalResult:false,actionURL:"./getRiskProjectMgr",params:{PROJECTID:a,NONCACHE:Math.random()},callback:function(b,n,h){try{var g=JSON.parse(n,dateParser);
qoAll.Users.clear();qoStakeHolders.RiskManagers.clear();qoStakeHolders.RiskOwners.clear();primCats.clear();secCats.clear();project=g[0];qoAll.Users=g[1];reportGrid.setData(g[3]);projectID=project.projectID;
projCats=project.riskCategorys;qoQRM.projectTitleStr=project.projectTitle;projectLabel.markForRedraw();try{qoAll.Users.setProperty("owner",false);qoAll.Users.setProperty("manager",false);qoAll.Users.setProperty("user",false);
if(project.riskownersIDs!=null){for(var k=0;k<project.riskownersIDs.length;k++){try{var f=qoAll.Users.find("stakeholderID",project.riskownersIDs[k]);if(f!=null){f.owner=true;f.user=true;}}catch(m){}}}if(project.riskmanagerIDs!=null){for(var k=0;
k<project.riskmanagerIDs.length;k++){try{var f=qoAll.Users.find("stakeholderID",project.riskmanagerIDs[k]);if(f!=null){f.manager=true;f.user=true;}}catch(m){}}}try{projectBasicForm.getItem("projectRiskManagerID").setValueMap(qoAll.Users.findAll("manager",true).getValueMap("stakeholderID","name"));
}catch(m){isc.say("QRM Erorr LHB003");}try{if(project.riskusersIDs!=null){for(var k=0;k<project.riskusersIDs.length;k++){qoAll.Users.find("stakeholderID",project.riskusersIDs[k]).user=true;}}}catch(m){isc.say("QRM Erorr FM003");
}stakeGrid.setData([]);stakeGrid.setData(qoAll.Users);projectBasicForm.setValues(project);matEditor.setTolString(project.matrix);if(project.parentID>1){matEditor.setLockMatrix(true);}else{matEditor.setLockMatrix(false);
}var c=new Object();try{c.action5=project.tolActions.find("tolLevel",5).longName;c.action4=project.tolActions.find("tolLevel",4).longName;c.action3=project.tolActions.find("tolLevel",3).longName;c.action2=project.tolActions.find("tolLevel",2).longName;
c.action1=project.tolActions.find("tolLevel",1).longName;}catch(m){alert(m.message);alert(JSON.stringify(project.tolActions));}try{tolActionForm.getItem("action5").title="<span style='color:white;font-weight:bold;background:red;padding:2px 5px 2px 5px;'>"+project.tolActions.find("tolLevel",5).shortName+"</span>";
tolActionForm.getItem("action4").title="<span style='color:white;font-weight:bold;background:orange;padding:2px 5px 2px 5px;'>"+project.tolActions.find("tolLevel",4).shortName+"</span>";tolActionForm.getItem("action3").title="<span style='color:black;font-weight:bold;background:yellow;padding:2px 5px 2px 5px;'>"+project.tolActions.find("tolLevel",3).shortName+"</span>";
tolActionForm.getItem("action2").title="<span style='color:black;font-weight:bold;background:#00ff00;padding:2px 5px 2px 5px;'>"+project.tolActions.find("tolLevel",2).shortName+"</span>";tolActionForm.getItem("action1").title="<span style='color:black;font-weight:bold;background:#00ffff;padding:2px 5px 2px 5px;'>"+project.tolActions.find("tolLevel",1).shortName+"</span>";
}catch(m){alert(m.message);}tolActionForm.setData(c);projectEditorCategory.deleteCats.clear();projCats.remove(projCats.find("internalID",1));for(var k=0;k<projCats.getLength();k++){switch(projCats[k].generation){case -1:projCats[k].imageIndicator=4;
break;case 1:projCats[k].imageIndicator=1;break;case 0:projCats[k].imageIndicator=5;break;}var l=projCats[k].sec;if(l!=null){for(var d=0;d<l.getLength();d++){switch(l[d].generation){case -1:l[d].imageIndicator=4;
break;case 1:l[d].imageIndicator=1;break;case 0:l[d].imageIndicator=5;break;}}}}primCatGrid.setData(projCats);secCatGrid.setData([]);projectEditorPrimCatToolStrip.newBtn.enable();projectEditorPrimCatToolStrip.delBtn.disable();
projectEditorPrimCatToolStrip.editBtn.disable();projectEditorSecCatToolStrip.delBtn.disable();projectEditorSecCatToolStrip.editBtn.disable();projectEditorSecCatToolStrip.newBtn.disable();try{projectTabsForm.getItem("riskMitigation").setValue((qoQRM.pageMitigation&project.tabsToUse)?true:false);
projectTabsForm.getItem("riskResponse").setValue((qoQRM.pageResponse&project.tabsToUse)?true:false);projectTabsForm.getItem("riskConsequences").setValue((qoQRM.pageConsequence&project.tabsToUse)?true:false);
projectTabsForm.getItem("riskControls").setValue((qoQRM.pageControl&project.tabsToUse)?true:false);projectTabsForm.getItem("riskObjectives").setValue((qoQRM.pageObjective&project.tabsToUse)?true:false);
projectTabsForm.getItem("riskAttachment").setValue((qoQRM.pageAttachment&project.tabsToUse)?true:false);projectTabsForm.getItem("riskComments").setValue((qoQRM.pageComment&project.tabsToUse)?true:false);
projectTabsForm.getItem("riskAudit").setValue((qoQRM.pageAudit&project.tabsToUse)?true:false);}catch(m){alert(m.message);}projectEditorConsequence.deleteCons.clear();for(var k=0;k<project.impactTypes.getLength();
k++){switch(project.impactTypes[k].generation){case -1:project.impactTypes[k].imageIndicator=4;break;case 1:project.impactTypes[k].imageIndicator=1;break;case 0:project.impactTypes[k].imageIndicator=5;
break;}}EditorQuantTypesGrid.setData(project.impactTypes);for(var k=0;k<project.objectives.getLength();k++){switch(project.objectives[k].generation){case -1:project.objectives[k].imageIndicator=4;break;
case 1:project.objectives[k].imageIndicator=1;break;case 0:project.objectives[k].imageIndicator=5;break;}}projectEditorObjective.deleteObjs.clear();projObjectives=project.objectives;projObjectives.remove(projObjectives.find("objectiveID",1));
projObjectives.add({objectiveID:1,parentID:-1,objective:"Project Objectives"});objectiveTreeDS.testData=projObjectives;idProjectObjectiveTree.fetchData();qoProjectManager.projectEditorClean();}catch(m){isc.say(m.message);
}}catch(m){alert(m.message);}}});}function preInit(){qoValueMap.init();dateEnd.setFullYear(dateEnd.getFullYear()+10,12,31);isc.DateItem.addProperties({endDate:dateEnd});qoRiskController.riskID=0;qoRiskController.dirty=false;
qoRiskController.allowEditorChanges=true;qoRiskController.secAllowEdit=false;qoRiskController.currentRisk=null;Date.setShortDisplayFormat("toEuropeanShortDate");Date.setNormalDisplayFormat("toLocaleString");
isc.setAutoDraw(false);Array.prototype.clear=function(){this.length=0;};isc.RPCManager.addClassProperties({handleTransportError:function(d,b,a,c){if(a==401||a==405){if(c.indexOf("LOGGEDOUT")!=-1){isc.say("Logged out of Quay Risk Manager",function(){window.open(c.split("*")[1],"_self");
});}else{isc.say("Your session has expired or is invalid. You will need to login to Quay Risk Manager.",function(){window.open("./login.jsp","_self");});}}else{MainPane.hide();document.getElementById("loadingWrapper").style.display="none";
isc.say("An error occured processing your request. The server may be offline. You will need to login to Quay Risk Manager again.");RPCManager.suspendTransaction(d);}}});}function constructRepMgrApp(){try{isc.setAutoDraw(false);
ServerPane=defineServerControlPane();RepPane=defineRepositoryPane();SchedJobPane=defineScheduledJobPane();ComplJobPane=defineCompletedJobPane();return TabSet.create({ID:"RepMgrTabSet",tabBarPosition:"top",tabs:[{title:"Server Control",pane:ServerPane},{title:"Repositories",pane:RepPane},{title:"Scheduled Jobs",pane:SchedJobPane},{title:"Completed Jobs",pane:ComplJobPane}]});
}catch(a){alert(a.message);}}function defineRepositoryPane(){isc.VLayout.create({membersMargin:5,width:"100%",height:"100%",autoDraw:true,ID:"RepositoryPane"});isc.ListGrid.create({ID:"RepGrid",width:"100%",height:"100%",alternateRecordStyles:true,fields:[{name:"rep",showTitle:true,title:"Repository",type:"select",width:200},{name:"repmgr",width:"200",title:"Repository Risk Manager",required:true,type:"select",allowEmptyValue:false,optionDataSource:"allUsersDS",displayField:"name",valueField:"stakeholderID"},{name:"active",width:"70",title:"Active",required:true,type:"boolean"},{name:"autoAddUsers",width:"120",title:"Auto Add Users",required:true,type:"boolean"},{name:"sessionlimit",title:"Session Limit",width:"80",required:true,align:"center",editorType:"spinner",min:-1,max:100,step:1,width:95},{name:"sessions",width:"80",align:"center",title:"# Sessions",required:true,type:"text"},{name:"userlimit",title:"User Limit",width:"50",align:"center",required:true,editorType:"spinner",min:-1,max:100,step:1,width:95},{name:"url",width:"400",title:"Access URL",required:true,type:"text"}],getBaseStyle:function(b,d,c){if(c==5){if(b.sessionlimit==-1){return"rankItem1";
}if(b.sessions==b.sessionlimit){return"rankItem4";}if(b.sessions>=b.sessionlimit-3){return"rankItem3";}return"rankItem1";}else{return this.Super("getBaseStyle",arguments);}},recordDoubleClick:function(){editRepository();
var b=this.getSelectedRecord();if(b===null){return;}repositoryForm.setData(b);}});var a=isc.HLayout.create({height:30,membersMargin:5,layoutMargin:5,members:[isc.Label.create({width:"100%"}),isc.IButton.create({title:"Refresh",width:140,autoDraw:false,click:function(c,b,d){getRepositories();
}}),isc.IButton.create({title:"Edit Repository",width:140,autoDraw:false,click:function(d,c,f){editRepository();var b=RepGrid.getSelectedRecord();if(b===null){return;}repositoryForm.setData(b);}}),isc.IButton.create({title:"Populate With Test Data",width:145,autoDraw:false,click:function(c,b,d){seedRepository();
}}),isc.IButton.create({title:"New Repository",width:140,autoDraw:false,click:function(c,b,d){newRepository();}}),isc.IButton.create({title:"Delete Reposiotry",width:140,autoDraw:false,click:function(c,b,d){isc.RPCManager.sendRequest({evalResult:false,params:{repURL:RepGrid.getSelectedRecord().url,NONCACHE:Math.random()},callback:function(j,h,g){data=JSON.parse(h,dateParser);
reps=data[0];orgUsers=data[1];repMap.clear();for(var f=0;f<reps.length;f++){repMap.put(reps[f].repID,reps[f]);}getRepositoryEditForm();RepGrid.setData(reps);},actionURL:"./deleteRepository"});}})]});RepositoryPane.addMember(RepGrid);
RepositoryPane.addMember(a);return RepositoryPane;}function defineServerControlPane(){isc.VLayout.create({membersMargin:5,width:"100%",height:"100%",autoDraw:true,ID:"ServerControlPane"});isc.HLayout.create({membersMargin:5,width:"100%",height:"100%",autoDraw:true,ID:"mainH"});
ServerControlPane.addMember(mainH);isc.VLayout.create({membersMargin:5,width:350,height:"100%",autoDraw:true,ID:"leftV"});mainH.addMember(leftV);isc.VLayout.create({membersMargin:5,width:650,height:"100%",autoDraw:true,ID:"leftV2"});
mainH.addMember(leftV2);isc.HLayout.create({membersMargin:5,width:800,height:50,autoDraw:true,ID:"leftV3"});mainH.addMember(getSessionPane());isc.ListGrid.create({ID:"QueueGrid",width:"100%",height:150,alternateRecordStyles:true,fields:[{name:"method",showTitle:true,title:"Queue",type:"text",width:"100%"},{name:"count",showTitle:true,title:"Length",type:"text",width:100,align:"center"}]});
isc.ListGrid.create({ID:"TransactionGrid",width:"100%",height:"100%",alternateRecordStyles:true,sortFieldNum:1,sortDirection:"descending",fields:[{name:"method",showTitle:true,title:"Method",type:"text",width:"100%"},{name:"count",showTitle:true,title:"Count",type:"text",width:100,align:"center"}]});
isc.ListGrid.create({ID:"PeopleGrid",width:"100%",height:"100%",dataSource:allUsersDS,autoFetch:true,alternateRecordStyles:true,fields:[{name:"name",showTitle:true,title:"Name",type:"text",width:150},{name:"email",showTitle:true,title:"Email",type:"text",width:"100%"},{name:"allowLogon",showTitle:true,title:"Allow Logon",type:"boolean",width:100}]});
var a=isc.HLayout.create({height:30,membersMargin:5,layoutMargin:5,members:[isc.Label.create({width:"100%"}),isc.IButton.create({title:"Refresh",width:130,autoDraw:false,click:function(d,c,f){PeopleGrid.fetchData({nocache:Math.random()});
}}),isc.IButton.create({title:"Delete",width:130,autoDraw:false,click:function(d,c,f){deleteUser();}}),isc.IButton.create({title:"Disable Logon",width:130,autoDraw:false,click:function(d,c,f){disableLogon();
}}),isc.IButton.create({title:"Enable Logon",width:130,autoDraw:false,click:function(d,c,f){enableLogon();}})]});var b=isc.HLayout.create({height:30,membersMargin:5,layoutMargin:5,members:[isc.Label.create({width:"100%"}),isc.IButton.create({title:"Refresh",width:140,autoDraw:false,click:function(d,c,f){refreshServerControl();
}})]});leftV.addMember(isc.Label.create({height:25,contents:"<b>Work Queues</b>"}));leftV.addMember(QueueGrid);leftV.addMember(isc.Label.create({height:25,contents:"<b>Server Functions</b>"}));leftV.addMember(TransactionGrid);
leftV2.addMember(isc.Label.create({height:25,contents:"<b>Stakeholders</b>"}));leftV2.addMember(PeopleGrid);leftV2.addMember(a);leftV3.addMember(isc.DynamicForm.create({numCols:4,width:600,titleWidth:200,padding:10,fields:[{name:"message",type:"text",width:300,title:"Broadcast Message",required:true},{type:"button",startRow:false,endRow:true,name:"Send",align:"right",click:"sendBroadcastMessage(this.form.getItem('message').getValue())"}]}));
ServerControlPane.addMember(leftV3);ServerControlPane.addMember(b);return ServerControlPane;}function defineScheduledJobPane(){var b=isc.ListGrid.create({autoDraw:false,ID:"schedJobTable",selectionType:"single",headerHeight:40,modalEditing:true,alternateRecordStyles:true,height:"100%",width:"100%",canEdit:false,emptyMessage:"No Scheduled Reports",updateJobScheduleTable:function(){isc.RPCManager.showPrompt=false;
prompt:"Retrieving Scheduled Jobs",isc.RPCManager.sendRequest({evalResult:true,params:{OPERATION:"getUserScheduledJobs"},callback:function(f,k,l){try{var q=new Date();var o=k.length;for(var m=0;m<o;m++){var n=k[m];
var g=n.timeStr.split(":");var h=parseInt(g[0],10);var j=parseInt(g[1],10);q.setUTCHours(h);q.setUTCMinutes(j);q.setUTCSeconds(0);n.timeStr=q.toLocaleTimeString();}schedJobTable.setData(k);}catch(p){alert(p.message);
}},actionURL:"./QRMServer"});},recordDoubleClick:function(){getScheduleReportWindow().show();scheduleReportForm.setValues(schedJobTable.getSelectedRecord());DescendantForm2.setValues(schedJobTable.getSelectedRecord());
QRMNavigator2.selectRecord(schedJobTable.getSelectedRecord());var d=-1;try{for(var f=0;QRMNavigator2.getRecord(f).projectID!=schedJobTable.getSelectedRecord().projectID&&f<1000;f++){d++;}}catch(g){}QRMNavigator2.selectSingleRecord(d+1);
},getBaseStyle:function(d,g,f){if(f==1&&(d.reportID==-50000||d.reportID==-50001)){return"qrmRiskExportEntry";}return this.Super("getBaseStyle",arguments);},fields:[{name:"description",title:"Description",type:"text",width:150,align:"left"},{name:"reportID",title:"Report Type",type:"select",width:170,align:"center"},{name:"projectID",title:"Project",type:"select",width:130,align:"center"},{name:"descendants",title:"Desc",type:"boolean",width:50,align:"center"},{name:"Mon",type:"boolean",width:40},{name:"Tue",type:"boolean",width:40},{name:"Wed",type:"boolean",width:40},{name:"Thu",type:"boolean",width:40},{name:"Fri",type:"boolean",width:40},{name:"Sat",type:"boolean",width:40},{name:"Sun",type:"boolean",width:40},{title:"Time",name:"timeStr",type:"text",width:80,align:"center"},{title:"Email",name:"email",type:"boolean",width:50,align:"center"},{name:"database",title:"Organisation",type:"text",width:150,align:"center"},{name:"databaseUser",title:"Database URL",type:"text",width:"100%",align:"left"}],headerSpans:[{fields:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],title:"Days to Run"}]});
var a=isc.HLayout.create({height:30,membersMargin:5,layoutMargin:5,members:[isc.Label.create({width:"100%"}),isc.IButton.create({title:"Refresh",width:140,autoDraw:false,click:function(f,d,g){getScheduledJobs();
}}),isc.IButton.create({title:"Delete Job",width:140,autoDraw:false,click:function(f,d,g){deleteJob();}})]});var c=isc.VLayout.create({membersMargin:2,layoutMargin:2,layoutTopMargin:2,height:"100%",width:"100%",members:[b,a],layoutBottomMargin:2,layoutRightMargin:2,layoutLeftMargin:2,autoDraw:true});
return c;}function defineCompletedJobPane(){isc.ListGrid.create({ID:"completedJobTable",autoDraw:false,alternateRecordStyles:true,height:"100%",emptyMessage:"No Report or Analysis Jobs Found",fields:[{name:"jobID",title:"Job ID",type:"text",width:80,align:"center"},{name:"collected",title:"Viewed",type:"boolean",width:"70",align:"center"},{name:"jobDescription",title:"Description",width:200,align:"left"},{name:"queuedDate",title:"Queued Date",width:200,align:"center",type:"time",formatCellValue:function(c){if(c){return c.toDateString()+"  "+c.toLocaleTimeString();
}}},{name:"executedDate",title:"Completed",width:200,align:"center",type:"date",formatCellValue:function(c){if(c){return c.toDateString()+"  "+c.toLocaleTimeString();}else{return"Pending";}}},{name:"jobJdbcURL",title:"Database URL",width:400,align:"left"}]});
var a=isc.HLayout.create({height:30,membersMargin:5,layoutMargin:5,members:[isc.Label.create({width:"100%"}),isc.IButton.create({title:"Refresh",width:140,autoDraw:false,click:function(d,c,f){getCompletedJobResult();
}}),isc.IButton.create({title:"Delete Two Week Old",width:140,autoDraw:false,click:function(d,c,f){deleteJobResult(14);}}),isc.IButton.create({title:"Delete Two Day Old",width:140,autoDraw:false,click:function(d,c,f){deleteJobResult(2);
}}),isc.IButton.create({title:"Delete Job",width:140,autoDraw:false,click:function(d,c,f){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"deleteCompletedJob",jobID:completedJobTable.getSelectedRecord().jobID,url:completedJobTable.getSelectedRecord().jobJdbcURL,NONCACHE:Math.random()},callback:function(j,i,g){try{completedJobTable.setData(JSON.parse(i,dateParserDebug));
}catch(h){alert(h.message);}},actionURL:"./sessionControl"});}})]});var b=isc.VLayout.create({membersMargin:2,layoutMargin:2,layoutTopMargin:2,height:"100%",width:"100%",members:[completedJobTable,a],layoutBottomMargin:2,layoutRightMargin:2,layoutLeftMargin:2,autoDraw:true});
return b;}function disableLogon(){isc.RPCManager.sendRequest({evalResult:false,params:{stakeholderID:PeopleGrid.getSelectedRecord().stakeholderID,NONCACHE:Math.random()},callback:function(c,b,a){refreshServerControl();
PeopleGrid.fetchData({nocache:Math.random()});},actionURL:"./disableLogon"});}function enableLogon(){isc.RPCManager.sendRequest({evalResult:false,params:{stakeholderID:PeopleGrid.getSelectedRecord().stakeholderID,NONCACHE:Math.random()},callback:function(c,b,a){refreshServerControl();
PeopleGrid.fetchData({nocache:Math.random()});},actionURL:"./enableLogon"});}function getSessionPane(){isc.ListGrid.create({ID:"SessionGrid",width:"100%",height:"100%",timeFormatter:"toLong24HourTime",alternateRecordStyles:true,fields:[{name:"name",title:"User Name",type:"text",width:200},{name:"orgName",width:"100",title:"Organisation"},{name:"dbUser",width:"100",title:"Database User",type:"text"},{name:"sessionID",width:"220",title:"Session ID",type:"text"},{name:"lastAccess",width:"180",title:"Last Access",type:"time"},{name:"numTransactions",width:"70",title:"Transactions",type:"text",align:"center"},{name:"sessionEnabled",width:"120",title:"Session Enabled",required:true,type:"boolean"},{name:"remoteHost",width:"220",title:"Remote Host",type:"text"},{name:"remoteAddr",width:"220",title:"Remote Address",type:"text"}]});
var a=isc.HLayout.create({height:30,membersMargin:5,layoutMargin:5,members:[isc.Label.create({width:"100%"}),isc.IButton.create({title:"Refresh",width:140,autoDraw:false,click:function(d,c,f){getSessions();
}}),isc.IButton.create({title:"Disable Session",width:140,autoDraw:false,click:function(d,c,f){disableSession();}}),isc.IButton.create({title:"Clear Defunct Sessions",width:140,autoDraw:false,click:function(d,c,f){clearDefunct();
}})]});var b=isc.VLayout.create({membersMargin:2,layoutMargin:2,layoutTopMargin:2,height:"100%",width:"100%",members:[isc.Label.create({height:25,contents:"<b>Active Sessions</b>"}),SessionGrid,a],layoutBottomMargin:2,layoutRightMargin:2,layoutLeftMargin:2,autoDraw:true});
return b;}function getRepositories(){isc.RPCManager.sendRequest({evalResult:false,params:{NONCACHE:Math.random()},callback:function(d,c,b){data=JSON.parse(c,dateParser);reps=data[0];orgUsers=data[1];repMap.clear();
for(var a=0;a<reps.length;a++){repMap.put(reps[a].repID,reps[a]);}getRepositoryEditForm();RepGrid.setData(reps);},actionURL:"./getAllRepositories"});}function getSessions(){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"getAllSessions",NONCACHE:Math.random()},callback:function(c,b,a){SessionGrid.setData(JSON.parse(b,dateParserTime2));
},actionURL:"./sessionControl"});}function getScheduledJobs(){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"getAllScheduledJobs",NONCACHE:Math.random()},callback:function(d,c,a){try{schedJobTable.setData(JSON.parse(c));
}catch(b){alert(b.message);}},actionURL:"./sessionControl"});}function deleteJob(){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"deleteJob",jobID:schedJobTable.getSelectedRecord().internalID,repository:schedJobTable.getSelectedRecord().repository,NONCACHE:Math.random()},callback:function(d,c,a){try{schedJobTable.setData(JSON.parse(c));
}catch(b){alert(b.message);}},actionURL:"./sessionControl"});}function disableSession(){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"disableSession",sessionID:SessionGrid.getSelectedRecord().sessionID,NONCACHE:Math.random()},callback:function(c,b,a){SessionGrid.setData(JSON.parse(b));
},actionURL:"./sessionControl"});}function clearDefunct(){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"clearDefunct",NONCACHE:Math.random()},callback:function(c,b,a){SessionGrid.setData(JSON.parse(b));
},actionURL:"./sessionControl"});}function getRepositoryEditForm(){isc.DynamicForm.create({ID:"repositoryForm",numCols:2,autoDraw:false,titleWidth:250,padding:10,hiliteRequiredFields:true,width:"100%",fields:[{type:"header",defaultValue:"Edit Repository"},{name:"rep",showTitle:true,editorType:"text",title:"Repository",width:240,required:true},{name:"repmgr",width:320,title:"Repository Risk Manager",required:true,type:"comboBox",allowEmptyValue:false,startRow:true,optionDataSource:"allUsersDS",pickListWidth:320,displayField:"name",valueField:"stakeholderID"},{name:"url",width:"600",title:"Access URL",required:true,type:"text",allowEmptyValue:false,startRow:true},{name:"active",width:"200",title:"Active",required:true,type:"boolean",allowEmptyValue:false,startRow:true},{name:"autoAddUsers",width:"200",title:"Auto Add Users",required:true,type:"boolean",allowEmptyValue:false,startRow:true},{name:"sessionlimit",width:"200",title:"Session Limit",required:true,editorType:"spinner",min:-1,max:100,step:1,width:70,startRow:true},{name:"userlimit",width:"200",title:"User Limit",required:true,editorType:"spinner",min:-1,max:100,step:1,width:70,startRow:true},{name:"repLogonMessage",width:"600",height:"150",title:"Logon Message",required:true,type:"textArea",allowEmptyValue:true,startRow:true},{name:"validateBtn",title:"Save Changes",type:"button",colSpan:2,endRow:true,align:"right",click:function(){isc.RPCManager.sendRequest({actionURL:"./updateRep",evalResult:true,params:{DATA:JSON.stringify(repositoryForm.getValues())},callback:function(c,b,a){alert(b);
modalEditRepWindow.hide();getRepositories();}});}}]});return repositoryForm;}function editRepository(){isc.Window.create({ID:"modalEditRepWindow",title:"Edit Repository",width:900,height:500,autoCenter:true,isModal:true,showModalMask:true,showMinimizeButton:false,autoDraw:false,closeClick:function(){this.Super("closeClick",arguments);
},items:[getRepositoryEditForm()]});modalEditRepWindow.show();}function seedRepository(){if(typeof(modalSeedRepWindow)=="undefined"){isc.Window.create({ID:"modalSeedRepWindow",title:"Seed Reoository",width:500,height:320,autoCenter:true,isModal:true,showModalMask:true,showMinimizeButton:false,autoDraw:false,closeClick:function(){this.Super("closeClick",arguments);
},items:[getSeedForm()]});}modalSeedRepWindow.show();}function getSeedForm(){isc.DynamicForm.create({ID:"seedForm",numCols:2,autoDraw:false,titleWidth:250,padding:10,width:"100%",fields:[{type:"header",defaultValue:"Seed Repository"},{name:"createProjectStructure",title:"Create Project Structure",type:"boolean",defaultValue:true},{name:"createTestUsers",title:"Create Test Users",type:"boolean",defaultValue:true},{name:"numRisks",title:"Number of Risks",editorType:"spinner",defaultValue:0,min:0,max:1000,step:10},{name:"maxNumControlsPerRisk",title:"Max Number of Controls",editorType:"spinner",defaultValue:5,min:0,max:20,step:1},{name:"maxNumberObjectivesPerRisk",title:"Max Number of Objectives",editorType:"spinner",defaultValue:5,min:0,max:20,step:1},{name:"maxNumberMitigationStepsPerRisk",title:"Max Number of Mitigation",editorType:"spinner",defaultValue:10,min:0,max:20,step:1},{name:"maxNumberCommentsPerRisk",title:"Max Number of Comments",editorType:"spinner",defaultValue:5,min:0,max:20,step:1},{name:"maxNumberConsequences",title:"Max Number of Consequences",editorType:"spinner",defaultValue:5,min:0,max:20,step:1},{_constructor:"RowSpacerItem"},{name:"validateBtn",title:"Seed Repository",type:"button",colSpan:2,endRow:true,align:"right",click:function(){isc.RPCManager.sendRequest({actionURL:"./normaliseProject",showPrompt:true,prompt:"Seeding Repository with Data...Please Standby",evalResult:true,params:{repURL:RepGrid.getSelectedRecord().url,repDBUser:"",createProjectStructure:seedForm.getItem("createProjectStructure").getValue(),createTestUsers:seedForm.getItem("createTestUsers").getValue(),maxNumControlsPerRisk:seedForm.getItem("maxNumControlsPerRisk").getValue(),maxNumberObjectivesPerRisk:seedForm.getItem("maxNumberObjectivesPerRisk").getValue(),maxNumberMitigationStepsPerRisk:seedForm.getItem("maxNumberMitigationStepsPerRisk").getValue(),maxNumberCommentsPerRisk:seedForm.getItem("maxNumberCommentsPerRisk").getValue(),numRisks:seedForm.getItem("numRisks").getValue(),maxNumberConsequences:seedForm.getItem("maxNumberConsequences").getValue()},callback:function(c,b,a){alert("Population of Data Complete");
modalSeedRepWindow.hide();}});}}]});return seedForm;}function newRepository(){isc.DynamicForm.create({width:550,titleWidth:180,padding:10,ID:"addRepositoryForm",fields:[{type:"header",defaultValue:"Create New Repository"},{name:"repTitle",showTitle:true,editorType:"text",title:"Repository",width:240,required:true},{name:"reporgcode",showTitle:true,editorType:"text",title:"Organisation Code",width:240,required:true},{name:"RowSpacerItem0",_constructor:"RowSpacerItem"},{name:"repmgr",width:320,title:"Repository Risk Manager",type:"comboBox",allowEmptyValue:false,optionDataSource:"allUsersDS",pickListWidth:320,displayField:"compoundName",valueField:"stakeholderID"},{_constructor:"StaticTextItem",defaultValue:"or",title:""},{name:"repname",width:320,title:"New Risk Manager Name",type:"text",allowEmptyValue:false,startRow:true},{name:"repemail",width:320,title:"New Risk Manager Email",type:"text",allowEmptyValue:false,startRow:true},{name:"reppass",width:320,title:"New Risk Manager Password",type:"text",allowEmptyValue:false,startRow:true},{name:"RowSpacerItem0",_constructor:"RowSpacerItem"},{name:"validateBtn",title:"Submit",type:"button",align:"right",colSpan:2,click:function(){try{if(addRepositoryForm.validate()){isc.RPCManager.sendRequest({prompt:"Adding Repository",evalResult:true,params:{OPERATION:"addRepository",DATA:JSON.stringify(addRepositoryForm.getValues())},callback:function(d,c,b){alert(c);
getRepositories();modalAddRepWindow.hide();},actionURL:"./addRepository"});}else{alert("Not Valid for some reason");}}catch(a){alert(a.message);}}}]});isc.Window.create({ID:"modalAddRepWindow",title:"New Repository",autoSize:true,autoCenter:true,isModal:true,showModalMask:true,showMinimizeButton:false,autoDraw:false,closeClick:function(){this.Super("closeClick",arguments);
},items:[addRepositoryForm]});modalAddRepWindow.show();}function sendBroadcastMessage(a){isc.RPCManager.sendRequest({actionURL:"./sessionControl",evalResult:true,params:{OPERATION:"sendBroadcastMessage",DATA:a}});
broadcastWindow.hide();}function dateParserTime2(c,d){var b;if(typeof d==="string"){b=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2}).(\d{3})/.exec(d);if(b){return new Date(b[1],+b[2]-1,+b[3],b[4],b[5],b[6],b[7]);
}}return d;}function dateParserDebug(c,d){var b;if(typeof d==="string"){b=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/.exec(d);if(b){return new Date(+b[1],+b[2]-1,+b[3],+b[4],+b[5],+b[6],0);}b=/^(\d{4})-(\d{2})-(\d{2})/.exec(d);
if(b){return new Date(Date.UTC(+b[1],+b[2]-1,+b[3]));}}return d;}function deleteJobResult(a){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"deleteJobResult",DAYINTERVAL:a,NONCACHE:Math.random()},callback:function(f,d,b){try{completedJobTable.setData(JSON.parse(d,dateParserDebug));
}catch(c){alert(c.message);}},actionURL:"./sessionControl"});}function getCompletedJobResult(){isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"getCompletedJobResult",NONCACHE:Math.random()},callback:function(d,c,a){try{completedJobTable.setData(JSON.parse(c,dateParserDebug));
}catch(b){alert(b.message);}},actionURL:"./sessionControl"});}function getWorkQueueLengths(){isc.RPCManager.sendRequest({evalResult:false,params:{NONCACHE:Math.random()},callback:function(d,c,b){var a=JSON.parse(c);
workQueueHTML='<table border="1"><tr><td style="width:250px" align="left"><b>Queue</b></td><td style="width:70px" align="center"><b>Length</b></td></tr>';workQueueHTML=workQueueHTML+'<tr><td align="left">Email Queue</td><td align="center">'+a[0]+"</td></tr>";
workQueueHTML=workQueueHTML+'<tr><td align="left">Report Queue</td><td align="center">'+a[1]+"</td></tr>";workQueueHTML=workQueueHTML+'<tr><td align="left">Monte Carlo Queue</td><td align="center">'+a[2]+"</td></tr>";
workQueueHTML=workQueueHTML+"</table>";workQueuesPane.markForRedraw();},actionURL:"./getWorkQueueLengths"});}function repMgrInit(){isc.RestDataSource.create({ID:"allUsersDS",fields:[{name:"name",title:"Name"},{name:"email",title:"Email"},{name:"compoundName",title:"Compound Name"},{name:"allowLogon",title:"Allow Logon",type:"boolean"}],fetchDataURL:"./getAllUsersDS"});
repMap=new Map();getRepositories();refresh();PeopleGrid.fetchData({nocache:Math.random()});try{}catch(a){alert(a.message);}}function refreshServerControl(){isc.RPCManager.sendRequest({evalResult:false,params:{NONCACHE:Math.random()},callback:function(d,c,a){try{QueueGrid.setData(JSON.parse(c));
}catch(b){alert(b.message);}},actionURL:"./getWorkQueueLengths"});isc.RPCManager.sendRequest({evalResult:false,params:{OPERATION:"getTransactionUsage",NONCACHE:Math.random()},callback:function(d,c,a){try{TransactionGrid.setData(JSON.parse(c));
}catch(b){alert(b.message);}},actionURL:"./sessionControl"});getSessions();}function refresh(){getSessions();getScheduledJobs();getCompletedJobResult();refreshServerControl();}var workQueueHTML;try{BrowserDetect.init();
defineJSON();preInit();qoProjectManager.defineMgrWidgets();qoQRM.init();constructApp();if(!userRepMgr){getUserProjects(true);}else{userID=1;toggleMode(2);}}catch(e){alert(e.message);}